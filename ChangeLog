2008-12-30 14:10  xavier

	* [r4846] src/grid/derivatives.F90, src/grid/mesh.F90,
	  src/grid/mesh_function_inc.F90, src/grid/ob_interface.F90,
	  src/hamiltonian/rkb_projector.F90, src/ions/dynamics.F90,
	  src/states/restart.F90: Removed some unused variables.

2009-01-02 17:18  acastro

	* [r4847] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/states.F90: Separated
	  the calculations of the density matrix, which is transferred
	  to mesh_function module, from its printout. Also, now it does not
	  break in the parallel case as before.

2009-01-05 10:41  marques

	* [r4848] libxc/DONE, libxc/TODO, libxc/src/Makefile.am,
	  libxc/src/gga_x_bayesian.c: Added a new form for the exachange
	  enhancement factor that comes from a bayesian best fit procedure

2009-01-05 10:48  marques

	* [r4849] src/grid/mesh_function_inc.F90, src/xc/xc.F90: Needed an
	  #ifdef to compile

2009-01-05 12:36  marques

	* [r4850] src/main/one_shot.F90, src/system/v_ks.F90,
	  src/system/xc_OEP_inc.F90: Now also orbital functionals work in
	  the one_shot mode

2009-01-05 20:48  acastro

	* [r4851] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/states.F90: o Removed
	  some problems that appeared when computing the density
	  matrix in parallel.
	  
	  o Now the computation of the density matrix uses the
	  cube_function_m
	  module, which makes it easier, and hopefully easier to generalize
	  to
	  higher dimension.

2009-01-08 23:31  dstrubbe

	* [r4852] src/basic/loct_parser.F90, src/ions/simul_box.F90,
	  src/math/fft.F90, src/utils/dielectric_function.F90: A point of
	  spelling: replaced "can not" with "cannot"

2009-01-09 16:11  xavier

	* [r4853] src/grid/grid.F90, src/grid/mesh_function_inc.F90,
	  src/grid/par_vec.F90, src/hamiltonian/epot.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90,
	  src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/species_pot.F90, src/include/global.h,
	  src/main/casida.F90, src/main/casida_inc.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/one_shot.F90,
	  src/main/phonons_fd.F90, src/main/static_pol.F90,
	  src/main/unocc.F90, src/main/unocc_inc.F90,
	  src/opt_control/defstates.F90, src/opt_control/opt_control.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/poisson/poisson.F90, src/poisson/solver_3D.F90,
	  src/poisson/solver_fft.F90, src/poisson/solver_multigrid.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_evolution_inc.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/ground_state.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/states/elf.F90,
	  src/states/restart.F90, src/states/restart_inc.F90,
	  src/states/states.F90, src/states/states_calc_inc.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/system/energy_inc.F90, src/system/exponential.F90,
	  src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert_inc.F90,
	  src/system/preconditioners.F90, src/system/system.F90,
	  src/system/v_ks.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/system/xc_OEP_x_inc.F90, src/td/cpmd.F90,
	  src/td/cpmd_inc.F90, src/td/ob_rti.F90, src/td/td.F90,
	  src/td/td_calc.F90, src/td/td_init.F90, src/td/td_rti.F90,
	  src/td/td_write.F90, src/xc/axc.F90, src/xc/vxc.F90: Renamed gr%m
	  to gr%mesh.

2009-01-09 16:19  xavier

	* [r4854] src/hamiltonian/epot.F90, src/scf/eigen.F90,
	  src/scf/ground_state.F90, src/scf/lcao.F90,
	  src/states/linear_response.F90, src/states/states.F90,
	  src/states/states_calc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/td/cpmd.F90, src/td/td.F90:
	  Renamed wfs_are_real to states_are_real (the same for
	  wfs_are_complex).

2009-01-09 17:03  xavier

	* [r4855] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/main/gcm.F90,
	  src/main/unocc.F90, src/scf/eigen_cg_inc.F90,
	  src/scf/eigen_evolution_inc.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/eigen_mg_inc.F90, src/scf/eigen_plan_inc.F90,
	  src/scf/eigen_rmmdiis_inc.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/subspace_inc.F90,
	  src/system/energy_inc.F90, src/system/exponential.F90,
	  src/system/linear_solver_inc.F90, src/td/cpmd_inc.F90,
	  src/td/ob_rti.F90, src/td/td_calc.F90: * Renamed hpsi to
	  hamiltonian_apply.

2009-01-09 22:07  xavier

	* [r4856] src/basic/global.F90, src/include/global.h,
	  src/td/ob_mem.F90: Now M_ONE and M_ZERO are macros. This should
	  allow the compiler to
	  optimize more the code.

2009-01-10 12:22  xavier

	* [r4857] src/basic/datasets.F90, src/basic/multicomm.F90,
	  src/basic/units.F90, src/grid/curv_briggs.F90,
	  src/grid/curv_gygi.F90, src/grid/curv_modine.F90,
	  src/grid/curvlinear.F90, src/grid/derivatives.F90,
	  src/grid/double_grid.F90, src/grid/grid.F90,
	  src/grid/io_function.F90, src/grid/mesh_init.F90,
	  src/grid/multigrid.F90, src/grid/scalar_mesh.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/scf_tol.F90, src/hamiltonian/species_pot.F90,
	  src/ions/dynamics.F90, src/ions/geometry.F90,
	  src/ions/simul_box.F90, src/ions/xyz_adjust.F90,
	  src/ions/xyz_file.F90, src/main/casida.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/main.F90,
	  src/main/phonons_fd.F90, src/main/run.F90,
	  src/main/static_pol.F90, src/main/test.F90, src/main/unocc.F90,
	  src/math/fftw3.F90, src/math/ode_solver_inc.F90,
	  src/math/root_solver.F90, src/math/sparskit_inc.F90,
	  src/math/tdfunction.F90, src/opt_control/defstates.F90,
	  src/opt_control/filters.F90, src/opt_control/iter.F90,
	  src/opt_control/parameters.F90, src/opt_control/read.F90,
	  src/opt_control/target.F90, src/poisson/poisson.F90,
	  src/poisson/solver_3D.F90, src/poisson/solver_fft.F90,
	  src/poisson/solver_multigrid.F90, src/scf/eigen.F90,
	  src/scf/ground_state.F90, src/scf/lcao.F90, src/scf/scf.F90,
	  src/species/ps.F90, src/species/species.F90, src/states/elf.F90,
	  src/states/mix.F90, src/states/restart.F90, src/states/smear.F90,
	  src/states/states.F90, src/states/states_calc.F90,
	  src/states/states_kpoints.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/vdW.F90, src/system/exponential.F90,
	  src/system/linear_solver.F90, src/system/output_h_sys.F90,
	  src/system/pert.F90, src/system/preconditioners.F90,
	  src/system/v_ks.F90, src/system/xc_OEP.F90, src/td/cpmd.F90,
	  src/td/ob_mem.F90, src/td/ob_rti.F90, src/td/pes.F90,
	  src/td/pes_rc.F90, src/td/spectrum.F90, src/td/td.F90,
	  src/td/td_init.F90, src/td/td_rti.F90, src/td/td_write.F90,
	  src/utils/broad.F90, src/utils/dielectric_function.F90,
	  src/utils/harmonic_spectrum.F90, src/utils/phonon_spectrum.F90,
	  src/utils/xyzanim.F90, src/xc/functionals.F90, src/xc/xc.F90:
	  Renamed check_inp to datasets_check.

2009-01-10 16:07  xavier

	* [r4858] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/main/casida.F90,
	  src/main/gcm.F90, src/main/geom_opt.F90, src/main/one_shot.F90,
	  src/main/phonons_fd.F90, src/main/run.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/opt_control/finalcheck.F90,
	  src/opt_control/opt_control.F90, src/opt_control/propagation.F90,
	  src/opt_control/read.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_evolution_inc.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/ground_state.F90, src/scf/lcao.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/system/energy.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver.F90, src/system/linear_solver_inc.F90,
	  src/system/output_h.F90, src/system/output_h_sys.F90,
	  src/system/pert_inc.F90, src/system/preconditioners_inc.F90,
	  src/system/system.F90, src/system/v_ks.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/td/cpmd_inc.F90, src/td/ob_mem.F90, src/td/ob_rti.F90,
	  src/td/td.F90, src/td/td_calc.F90, src/td/td_init.F90,
	  src/td/td_rti.F90, src/td/td_write.F90: Renamed the hamiltonian
	  object from h to hm.

2009-01-10 20:08  xavier

	* [r4859] src/basic/profiling.F90, src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/grid/par_vec.F90,
	  src/grid/par_vec_inc.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/scf/eigen.F90, src/scf/lcao.F90, src/scf/scf.F90,
	  src/td/td.F90: Moved some profiling variables to their own
	  modules.

2009-01-10 20:38  xavier

	* [r4860] src/grid/derivatives_inc.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/par_vec.F90,
	  src/grid/par_vec_inc.F90, src/grid/submesh.F90,
	  src/grid/submesh_inc.F90: Renamed vp%p to vp%npart.

2009-01-11 10:38  xavier

	* [r4861] configure.ac: Removed some whitespaces that might produce
	  problems with autoconf.

2009-01-11 22:28  xavier

	* [r4862] src/main/main.F90, src/main/run.F90: Renamed run_prog_m
	  to run_m.

2009-01-13 08:24  marques

	* [r4863] configure.ac, src/beak/beak.h: Some compilers (pathscale)
	  did not implement SSE, even if the header
	  file is available. These changes now allow octopus to compile in
	  milipeia
	  
	  BTW, Xavier, the file operate_ri_vec.c gives lots of warnings,
	  and the
	  code accesses directly the type __m128d, which the manual says
	  one
	  should not do... is it possible to clean it?

2009-01-13 10:22  xavier

	* [r4864] src/beak/operate_ri_vec.c: The SSE code was doing some
	  ilegal (but correct) pointer castings.

2009-01-14 11:39  xavier

	* [r4865] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/main/phonons_fd.F90,
	  src/main/run.F90, src/main/static_pol.F90, src/scf/scf.F90,
	  src/system/v_ks.F90, src/td/td.F90, src/td/td_rti.F90: Now the
	  hamiltonian stores the total potential, this saves time and
	  simplifies the routine to apply the hamiltonian. The price to pay
	  is
	  that hamiltonian_update_potential must be called each time
	  hm%vpsl or
	  hm%vhxc are changed.

2009-01-14 23:21  xavier

	* [r4866] src/hamiltonian/Makefile.am,
	  src/hamiltonian/em_field.F90, src/hamiltonian/em_field_inc.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90: Added a new object,
	  em_field_t, that stores an electromagnetic field
	  and can apply it over a wave-function.

2009-01-15 18:03  xavier

	* [r4867] src/hamiltonian/Makefile.am, src/hamiltonian/lasers.F90:
	  Added a function to generate a em_field from a laser.

2009-01-15 18:55  xavier

	* [r4868] src/hamiltonian/em_field.F90,
	  src/hamiltonian/em_field_inc.F90, src/hamiltonian/lasers.F90:
	  Removed the uniform vector potential from em_field. Since the
	  idea is
	  to finally handle it through a phase, there is no need to have
	  it.

2009-01-15 20:07  xavier

	* [r4869] src/hamiltonian/lasers.F90: A couple of line were too
	  long.

2009-01-16 10:07  acastro

	* [r4870] src/opt_control/opt_control.F90: The code did not compile
	  if the newuoa library was present, due to the
	  change of name of the hamiltonian variable.

2009-01-16 11:38  xavier

	* [r4871] src/hamiltonian/em_field.F90,
	  src/hamiltonian/em_field_inc.F90: Added a function to apply an
	  em_field to a single function.

2009-01-17 02:53  dstrubbe

	* [r4872] src/states/states_dim.F90, src/states/states_kpoints.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90: *) Made a
	  preprocessor variable for the name of the output directory for
	  kdotp and em_resp
	  *) Added a function kpoint_index that tells what number k-point
	  (without spin) a given ik refers to
	  *) Made kdotp use states_dim_get_spin_index and kpoint_index in
	  naming output files

2009-01-17 03:20  dstrubbe

	* [r4873] src/main/run.F90, src/main/static_pol.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/vdW.F90: Renamed pol_lr module to em_resp for
	  consistently with the filename.

2009-01-17 21:12  xavier

	* [r4874] src/td/td_rti.F90: Initial implementation of the Visscher
	  propagator, for the moment it
	  can only propagate a time independent hamiltonian.

2009-01-17 22:30  xavier

	* [r4875] src/td/td_rti.F90: Now the Visscher propagator works for
	  time dependent Hamiltonians.
	  
	  This is a nice scheme that only requires two real applications of
	  the
	  Hamiltonian per time step.

2009-01-17 23:30  xavier

	* [r4876] src/td/td_rti.F90,
	  testsuite/real_time/07-visscher.01-gs.inp,
	  testsuite/real_time/07-visscher.02-td.inp,
	  testsuite/real_time/07-visscher.test: * Added a test for the
	  visscher propagator. The results agree with
	  other propagators.

2009-01-18 09:02  dstrubbe

	* [r4877] src/main/casida.F90, src/opt_control/defstates.F90,
	  src/opt_control/target.F90, src/states/restart.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/raman.F90,
	  src/sternheimer/vdW.F90, src/td/td.F90: *) Combined routine
	  "read_wfs" which appeared in several copies in the Sternheimer
	  modules with the almost identical routine
	  "restart_look_and_read." Now an error will be generated when no
	  wavefunctions are found, which was not the case in most places
	  from which "restart_look_and_read" was called.
	  
	  I notice that Raman and phonons explicitly set the wavefunctions
	  to be real. Why is this? Shouldn't they be complex for a periodic
	  system?

2009-01-18 09:06  xavier

	* [r4878] src/td/td_rti.F90: * Now the exponential midpoint rule is
	  used to propagate the initial
	  imaginary part in the Visscher propagator.
	  * Some optimizations.

2009-01-20 01:39  dstrubbe

	* [r4879] src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90: Now raman and phonon calculations
	  don't require ground-state wavefunctions to be real.

2009-01-20 02:40  acastro

	* [r4880] src/opt_control/defstates.F90,
	  src/opt_control/target.F90: Bug fix; the optimal control tests
	  were failing since the change in
	  the "restart_look_and_read" routine.

2009-01-20 20:58  dstrubbe

	* [r4881] src/main/casida.F90, src/states/restart.F90,
	  src/td/td.F90: Fixed the problem Alberto pointed out in two other
	  places too: the specify_dir optional argument is not used, since
	  in the old version of the routine the corresponding argument was
	  ignored.

2009-01-20 21:55  dstrubbe

	* [r4882] src/include/global.h, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90, src/sternheimer/vdW.F90: Created
	  preprocessor constants in global.h for each Sternheimer routine's
	  restart directory, so those that use other routines' restart info
	  can be sure to be getting it from the same place it was put. This
	  may not be the best way to do it; let me know if you have a
	  better suggestion.

2009-01-20 22:18  dstrubbe

	* [r4883] src/sternheimer/em_resp.F90: Fix to last commit in which
	  I forgot to replace RESTART_DIR in em_resp.F90, which had caused
	  a test to fail.

2009-01-21 00:47  dstrubbe

	* [r4884] src/sternheimer/Makefile.am, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/raman.F90: *)
	  Reorganized kdotp and em_resp modules so that you first do a
	  kdotp run, then do an em_resp run. This way it is much easier to
	  do multiple frequencies, and removes a lot of duplicated code.
	  The calculation of alpha and beta will occur within the em_resp
	  run even for a periodic system.
	  *) Moved calculation of polarizability of periodic system to
	  em_resp_calc
	  *) Added variable to force calculation of alpha and beta without
	  kdotp wfns, as though it were a finite system.
	  *) Repeated "use" statement in raman.F90 removed.

2009-01-21 01:15  dstrubbe

	* [r4885] src/sternheimer/em_resp.F90: *) A small fix to a compiler
	  portability issue (can't use NDIM in declaration)
	  *) "Info: calculating response for direction..." is only printed
	  when it is necessary to do that calculation.

2009-01-21 14:35  acastro

	* [r4886] src/td/td_rti.F90: Bug fix; the code was crashing when
	  attempting to perform an
	  "associated" call over an uninitialized pointer.

2009-01-21 15:32  marques

	* [r4887] src/poisson/poisson.F90, src/poisson/solver_1D.F90,
	  src/poisson/solver_fft.F90: Added the possibility of changing the
	  parameter a (v=1/sqrt(a^2+x^2) in
	  the soft coulomb interaction in 1d. Alberto, was it you who
	  implemented
	  the periodic FFT solver in 1D? Can you please check if the
	  formula I
	  implemented is correct?

2009-01-21 17:56  acastro

	* [r4888] external_libs/newuoa/Makefile.am,
	  external_libs/newuoa/bigden.f90, external_libs/newuoa/biglag.f90,
	  external_libs/newuoa/newuoa.f90,
	  external_libs/newuoa/newuoa_mod.f90,
	  external_libs/newuoa/newuob.f90, external_libs/newuoa/trsapp.f90,
	  external_libs/newuoa/update.f90, src/common-rules.make,
	  src/opt_control/opt_control.F90: I put together all the
	  subroutines of the newuoa library into one
	  module; that way their names cannot collide with other parts of
	  the
	  code (except for only one public entity, and only if the module
	  is
	  used).

2009-01-22 03:46  dstrubbe

	* [r4889] src/sternheimer/sternheimer.F90,
	  src/system/linear_solver.F90, src/td/ob_rti.F90,
	  testsuite/linear_response/02-h2o_pol_lr.test: *) Changed default
	  Sternheimer solver to QMR instead of bicgstab.
	  *) By default preorthogonalization of wavefunctions against
	  occupied states is now done at the start of each Sternheimer SCF
	  cycle.
	  *) Changed test reference data since these alter results
	  slightly.
	  QMR and preorthogonalization make calculations converge better in
	  general, though they may take more time. This is why I have made
	  them default. For kdotp in particular the calculation does not
	  converge at all without these settings.
	  *) A few typographic issues in ob_rti.F90

2009-01-22 07:12  acastro

	* [r4890] src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90: Added a subroutine that provides
	  the upper and lower bounds of the
	  parameters that define the control functions for OCT.

2009-01-22 15:48  xavier

	* [r4891] src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/vdW.F90: A
	  function name was too long (stupid fortran limitation).

2009-01-23 23:20  dstrubbe

	* [r4892] src/states/restart.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90: *) Reading ground-state wavefunctions
	  must come before reading linear-response wavefunctions in em_resp
	  *) Slight improvement to formatting of warnings in kdotp and
	  em_resp
	  *) Renamed asserted variables to more meaningful things in
	  restart
	  *) Made output message give more info in restart

2009-01-25 09:22  xavier

	* [r4893] src/basic/calc_mode.F90, src/grid/mesh.F90,
	  src/main/Makefile.am, src/main/main.F90, src/main/run.F90,
	  src/states/states.F90: Added a new calculation mode: "memory".
	  
	  It tells you how much memory octopus will require to run.

2009-01-25 09:44  xavier

	* [r4894] src/main/memory.F90: Forgot to add a file.

2009-01-25 11:39  acastro

	* [r4895] src/td/td.F90, src/td/td_init.F90: All tests in
	  testsuite/real_time directory were failing, due to bad
	  usage of intent(out) in td_init.

2009-01-25 22:32  acastro

	* [r4896] src/opt_control/Makefile.am,
	  src/opt_control/defstates.F90, src/opt_control/filters.F90,
	  src/opt_control/initst.F90, src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_constants.F90,
	  src/opt_control/target.F90: The definition of the initial state
	  (for the OCT runs) is done now in
	  its own module.

2009-01-26 09:24  marques

	* [r4897] src/main/unocc.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/lcao_inc.F90: *) As discussed
	  in the mailing list, now unocc goes through all states,
	  and not only the unoccupied ones
	  *) When verbose output is on, the eigensolver does not output the
	  progress bar -- the output was a bit messy when running from a
	  terminal

2009-01-26 09:29  marques

	* [r4898] src/main/unocc.F90: Sorry, forgot a stop

2009-01-26 09:30  marques

	* [r4899] src/scf/lcao_inc.F90: ...and a print... I am really
	  sloppy ;))

2009-01-26 13:20  acastro

	* [r4900] src/scf/eigen.F90: The use of an optional variable was
	  causing the code to break whenever
	  that variable was not present.

2009-01-26 21:12  acastro

	* [r4901] src/basic/Makefile.am, src/basic/loct.F90,
	  src/basic/loct_inc.F90, src/states/states.F90, src/td/td_rti.F90:
	  Added a routine, loct_copy_pointer, that permits to copy the
	  arrays
	  defined as pointers in derived data types. There are quite a few
	  places in the code where this has to be done, and it is annoying
	  to do
	  the same every time (I changed a couple of places, but there are
	  some
	  more around).
	  
	  I am not sure, however, if Fortran has a smarter way to do this.

2009-01-29 20:35  dstrubbe

	* [r4902] src/main/main.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90: *) Compiler flags is no
	  longer truncated to 80 characters at top of output, so you can
	  see the whole string
	  *) A few corrections to comments

2009-01-30 04:10  dstrubbe

	* [r4903] src/basic/io.F90, src/grid/derivatives.F90,
	  src/grid/scalar_mesh.F90, src/include/global.h,
	  src/ions/geometry.F90, src/ions/solids.F90,
	  src/main/one_shot.F90, src/main/unocc.F90, src/scf/scf.F90,
	  src/states/states_kpoints.F90: *) Variable reference stated that
	  if no k-points blocks were provided, the default was the gamma
	  point, but this was not actually implemented and instead an error
	  message was written. Now the default has been implemented.
	  *) When there are atoms that are too close, before exiting, the
	  program writes the geometry to static/geometry.xyz so you can
	  actually see what the problem is.
	  *) All instances of "static" I could find, specifying the output
	  directory, have been replaced by a preprocessor constant
	  STATIC_DIR to make sure they are all really the same.
	  *) Some miscellaneous formatting and corrections to comments.

2009-01-30 13:18  acastro

	* [r4904] src/grid/scalar_mesh.F90, src/main/unocc.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90: o
	  Added a '/' after the STATIC_DIR, recently introduced by David,
	  in a
	  couple of places where it was missing.
	  
	  o Some maintenance changed in the opt_control directory (removal
	  of
	  unnecessary variables, etc.)

2009-01-30 14:38  xavier

	* [r4905] src/grid/mesh_init.F90, src/grid/nl_operator.F90: To save
	  memory, now the mesh%resolution array is only allocated if
	  multiresolution is actually used.

2009-01-30 15:31  xavier

	* [r4906] src/grid/mesh.F90, src/ions/simul_box.F90,
	  src/main/unocc_inc.F90: * Whether resolution is allocated or not
	  is now considered by memory run mode.
	  * Fixed an out of bounds in the calculation of matrix elements.

2009-01-31 11:21  xavier

	* [r4907] src/basic/Makefile.am, src/basic/distributed.F90,
	  src/basic/mpi_lib.F90, src/basic/multicomm.F90,
	  src/basic/profiling.F90, src/grid/basins.F90, src/grid/batch.F90,
	  src/grid/cube_function.F90, src/grid/curv_modine.F90,
	  src/grid/curvlinear.F90, src/grid/fourier_space.F90,
	  src/grid/grid.F90, src/grid/gridhier.F90, src/grid/multigrid.F90,
	  src/grid/ob_interface.F90, src/grid/stencil.F90,
	  src/grid/stencil_cube.F90, src/grid/stencil_star.F90,
	  src/grid/stencil_starplus.F90, src/grid/stencil_variational.F90,
	  src/hamiltonian/hgh_projector.F90,
	  src/hamiltonian/kb_projector.F90, src/hamiltonian/ob_lead.F90,
	  src/hamiltonian/rkb_projector.F90, src/include/global.h,
	  src/ions/crystal.F90, src/ions/geometry.F90,
	  src/ions/simul_box.F90, src/ions/vibrations.F90,
	  src/ions/xyz_file.F90, src/main/casida.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/math/Makefile.am, src/math/fftw3.F90, src/math/lalg_adv.F90,
	  src/math/math.F90, src/math/ode_solver.F90,
	  src/math/root_solver.F90, src/math/solvers.F90,
	  src/math/splines.F90, src/math/tdfunction.F90,
	  src/opt_control/filters.F90, src/opt_control/initst.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/poisson/conj_grad.F90,
	  src/poisson/corrections.F90, src/poisson/solver_isf.F90,
	  src/poisson/solver_multigrid.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/species/atomic.F90,
	  src/species/logrid.F90, src/species/ps.F90,
	  src/species/ps_cpi.F90, src/species/ps_cpi_file.F90,
	  src/species/ps_fhi.F90, src/species/ps_fhi_file.F90,
	  src/species/ps_hgh.F90, src/species/ps_in_grid.F90,
	  src/species/ps_psf.F90, src/species/ps_psf_file.F90,
	  src/species/ps_upf.F90, src/species/species.F90,
	  src/states/elf.F90, src/states/excited_states.F90,
	  src/states/linear_response.F90, src/states/magnetic.F90,
	  src/states/mix.F90, src/states/restart.F90, src/states/smear.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/vdW.F90, src/system/energy.F90,
	  src/system/exponential_split.F90, src/system/output_h_sys.F90,
	  src/system/system.F90, src/system/xc_OEP_kernel.F90,
	  src/td/ob_mem.F90, src/td/ob_rti.F90, src/td/ob_src.F90,
	  src/td/pes.F90, src/td/spectrum.F90, src/td/td_write.F90,
	  src/utils/broad.F90, src/utils/cross_section.F90,
	  src/utils/dielectric_function.F90,
	  src/utils/oscillator_strength.F90, src/utils/phonon_spectrum.F90:
	  * Included the possibility of doing a space (memory) profiling in
	  Octopus.

2009-01-31 19:51  xavier

	* [r4908] src/sternheimer/sternheimer_inc.F90: The resulting vector
	  after solving the Sternheimer equation has to be
	  re-orthogonalized, this greatly increases convergency (we had
	  this
	  before and it was removed at some point).

2009-01-31 22:58  xavier

	* [r4909] src/sternheimer/sternheimer_inc.F90,
	  src/system/linear_solver_inc.F90: Orthogonalizing the initial
	  search direction in the bigcstab
	  algorithms improves considerably the convergence rate of the
	  algorithm.

2009-02-01 11:23  xavier

	* [r4910] src/states/linear_response_inc.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90,
	  src/system/linear_solver_inc.F90: * Fixed a problem with the
	  bicgstab solver introduced in my last commit.
	  * Some code cleaning in sternheimer.

2009-02-01 11:59  xavier

	* [r4911] src/system/linear_solver_inc.F90: Remove unnecessary
	  initializations to zero in the bicgstab solver.

2009-02-01 13:57  xavier

	* [r4912] src/sternheimer/sternheimer_inc.F90: Unit conversion was
	  missing in Sternheimer output.

2009-02-01 14:21  xavier

	* [r4913] src/hamiltonian/scf_tol.F90: Changed the default value of
	  the AdaptiveTolFactor variable to 0.9.
	  This seems to give the best results.

2009-02-01 21:04  xavier

	* [r4914] src/sternheimer/em_resp.F90: Another unit conversion
	  missing.

2009-02-03 10:24  xavier

	* [r4915] src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/sternheimer/phonons_lr.F90, src/system/pert_inc.F90: Added
	  the possibility of precalculating the ionic potential and
	  storing it instead of calculating it every time, this is useful
	  for
	  the calculation of vibrational modes where the calculation of the
	  dynamical matrix consumes considerable time.

2009-02-03 13:44  xavier

	* [r4916] src/ions/vibrations.F90, src/sternheimer/phonons_lr.F90:
	  * The dynamical matrix is now printed by components.
	  * One expectation value does not have to be calculated.

2009-02-03 14:43  xavier

	* [r4917] src/basic/profiling.F90: Memory profiling produced huge
	  files, now only allocations that
	  actually change the memory footprint of the program are reported.

2009-02-03 16:17  xavier

	* [r4918] src/sternheimer/phonons_lr.F90: The symmetry of the
	  dynamical matrix is now take into account.

2009-02-03 20:25  acastro

	* [r4919] src/opt_control/parameters.F90: Corrected some little bug
	  in the use of mixing schemes for OCT runs.

2009-02-04 02:30  dstrubbe

	* [r4920] src/hamiltonian/epot_inc.F90, src/scf/eigen.F90,
	  src/states/states.F90: A few trivial changes.

2009-02-04 13:01  marques

	* [r4921] src/main/casida.F90, src/main/one_shot.F90,
	  src/states/states.F90, src/sternheimer/sternheimer.F90,
	  src/system/v_ks.F90, src/xc/vxc.F90: Cleaned a bit the generation
	  of the total density that goes in the
	  calculation of vxc and fxc.

2009-02-04 13:07  marques

	* [r4922] src/sternheimer/em_resp_calc_inc.F90: The evaluation of
	  kxc was not taking non-linear core corrections into account

2009-02-04 17:59  xavier

	* [r4923] src/sternheimer/phonons_lr.F90, src/system/pert.F90,
	  src/system/pert_inc.F90: The <0|2|0> term of the dynamical matrix
	  now is calculated directly
	  instead of using pert_expectation_value, the previous way was
	  very
	  slow (80% of computer time).

2009-02-05 08:14  xavier

	* [r4924] src/scf/scf.F90: The ConvRelForce criterion was not well
	  defined, its value was always
	  1.0. So I removed it and renamed ConvAbsForce to ConvForce.

2009-02-06 00:23  dstrubbe

	* [r4925] libxc/m4/acx.m4, m4/fortran.m4: The macro that checks for
	  "very long lines" used a test program with a line that was very
	  long, but still not nearly so long as some lines generated by the
	  ALLOCATE preprocessor macro in the code. The PGI 8.0-1 Fortran
	  compiler passed that test in the configure script since it could
	  handle 140 characters in a line, but could not handle 270
	  characters. I approximately tripled the length of that line in
	  the test program to 433 characters, so that now PGI is considered
	  not to accept long lines.

2009-02-06 09:59  xavier

	* [r4926] src/hamiltonian/Makefile.am,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/hamiltonian/scissor.F90,
	  src/hamiltonian/scissor_inc.F90: Now a scissor operator can be
	  included in the hamiltonian. (still not
	  tested).

2009-02-06 11:07  xavier

	* [r4927] src/hamiltonian/scissor_inc.F90: Some fixed in the
	  scissor operator.

2009-02-06 17:54  dstrubbe

	* [r4928] src/hamiltonian/epot.F90, src/scf/scf.F90,
	  src/states/smear.F90: *) The single-point Berry's phase dipole
	  calculation gives an error if the smearing is not semiconducting,
	  since otherwise it is unclear (or maybe impossible) to construct
	  a Slater determinant.
	  *) The quantum of polarization is used to reduce the dipole (in
	  the periodic case) to the smallest magnitude, for ease of
	  analysis.

2009-02-06 23:30  xavier

	* [r4929] src/basic/loct_inc.F90: Pointer copy routines now use a
	  forall loop.

2009-02-06 23:31  xavier

	* [r4930] src/beak/operate_ri.c, src/poisson/solver_multigrid.F90:
	  Gauss seidel relaxation is now done by a C routine.

2009-02-06 23:46  xavier

	* [r4931] configure.ac, src/beak/beak.h: The changes in the macros
	  made by Miguel caused that SSE was not used
	  in any compiler. Miguel, if compilation fails in Milipeia can you
	  send
	  the error so we can write a proper fix?

2009-02-07 09:59  xavier

	* [r4932] src/beak/operate_ri.c, src/grid/multigrid.F90,
	  src/grid/multigrid_inc.F90, src/poisson/solver_multigrid.F90:
	  Several improvements in the multigrid code.

2009-02-07 11:35  xavier

	* [r4933] src/hamiltonian/scissor_inc.F90, src/td/td.F90,
	  src/td/td_init.F90: Added the option of adding a scissor operator
	  to the Hamiltonian
	  during time propagation. Still testing is needed.

2009-02-07 17:42  xavier

	* [r4934] src/td/td.F90: The phase of the ground state orbitals for
	  the scissor operator was
	  missing. Now the scissor operator works properly for fixed atoms.

2009-02-08 17:16  xavier

	* [r4935] src/sternheimer/em_resp.F90: Fixed a serious memory leak
	  in sternheimer when several frequencies
	  were calculated (lr wave-functions were allocated again for each
	  frequency).

2009-02-08 18:08  xavier

	* [r4936] testsuite/linear_response/02-h2o_pol_lr.test: My last
	  commit changed a bit the results of a test.

2009-02-08 19:11  xavier

	* [r4937] src/sternheimer/sternheimer_inc.F90: As discussed with
	  David, now only one preorthogonalization (before
	  calculating the density) is done.

2009-02-09 17:57  acastro

	* [r4938] src/basic/messages.F90, src/opt_control/Makefile.am,
	  src/opt_control/check_input.F90, src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_constants.F90,
	  src/opt_control/opt_control_global.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90,
	  src/opt_control/read.F90: Added documentation for some variables,
	  and some comments in the
	  code. Also, some re-naming and maintenance changes in the OCT
	  part.

2009-02-09 21:45  dstrubbe

	* [r4939] src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/ions/geometry.F90, src/sternheimer/em_resp.F90: *)
	  Implemented calculation of Born effective charges, from the
	  derivative of the ionic forces with respect to electric
	  perturbation. Still in testing.
	  *) Some tweaks to output in em_resp.
	  *) In em_resp, renamed "dir" variable to "idir" to reduce
	  confusion between direction and directory.

2009-02-09 22:40  acastro

	* [r4940] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: A couple of problems caught by my
	  compiler: ".eq." should not be used
	  for booleans (use ".eqv." instead), some intent(in) should be
	  intent(inout), and one line too long.

2009-02-11 02:23  dstrubbe

	* [r4941] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: *) A bit of cleaning up
	  *) Born charges now given as magnitude and phase rather than real
	  and imaginary part, which seems more useful

2009-02-11 20:39  dstrubbe

	* [r4942] src/hamiltonian/epot.F90: I previously made the
	  calculation in a periodic system fail if semiconducting smearing
	  was not used, because my routine to
	  calculate the dipole could not handle other smearing schemes. But
	  I shouldn't have made it impossible to do these runs;
	  it's just that the dipole is not accurate. Now just a warning is
	  written.

2009-02-11 23:57  xavier

	* [r4943] src/grid/io_function_inc.F90: Bugfix: Units were not
	  considered by dx output.

2009-02-12 05:06  dstrubbe

	* [r4944] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: *) Now using minus frequency as well
	  for non-zero frequencies for Born effective charges.
	  *) The acoustic sum rule is now checked and the degree of
	  violation output, before correcting it.
	  *) I think there was a factor of st%d%kweights(ik) missing for
	  calculation of regular forces in the non-local pseudopotential
	  part

2009-02-12 05:19  dstrubbe

	* [r4945] share/util/display_mesh_index.gp,
	  src/sternheimer/em_resp.F90: *) Removed a debugging statement
	  accidentally left in my last commit,
	  which I think caused a compilation failure
	  *) Made the display gnuplot script work

2009-02-12 05:28  dstrubbe

	* [r4946] src/grid/io_function.F90, src/hamiltonian/epot_inc.F90,
	  src/ions/simul_box.F90: *) Actually I think the problem was
	  breaking a line in an ASSERT macro
	  *) Added an error message when you don't specify OutputHow
	  because previously it just did nothing if you hadn't specified
	  the output method
	  *) A little formatting

2009-02-12 09:08  acastro

	* [r4947] src/hamiltonian/epot_inc.F90: Another problem with long
	  lines (even if the ASSERT macro is broken
	  into several lines, it may happen that the argument is already
	  too
	  long).

2009-02-13 03:33  dstrubbe

	* [r4948] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: A fix for Born charges at zero
	  frequency.

2009-02-13 10:52  acastro

	* [r4949] src/basic/command_line.F90, src/basic/getopt_f.c,
	  src/td/spectrum.F90, src/utils/harmonic_spectrum.F90: o Repaired
	  the calculation of the harmonic spectrum from the
	  acceleration, which was broken for low dimensional systems (the
	  file
	  was not properly read).
	  
	  o I introduced another mode for the oct-harmonic-spectrum
	  utility: for
	  each multiple of the fundamental frequency, an algorithm looks
	  for the
	  peak of the spectrum in its vicinity. The program then these
	  maxima
	  only.

2009-02-14 00:26  dstrubbe

	* [r4950] src/grid/grid.F90, src/grid/gridhier_inc.F90,
	  src/grid/multigrid.F90, src/grid/multigrid_inc.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90: A while
	  ago, gr%m was renamed to gr%mesh, so as not to have a
	  single-letter variable name. I continued this by changing m to
	  mesh in the multigrid and fine meshes, and some functional
	  arguments.

2009-02-14 14:34  acastro

	* [r4951] src/poisson/solver_multigrid.F90,
	  src/system/preconditioners_inc.F90: Some "m" that still needed to
	  be changed to "mesh".

2009-02-14 15:18  acastro

	* [r4952] src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/propagation.F90: o The use of an optional
	  argument without checking if it is really
	  present caused a segfault.
	  
	  o Removal of some unused variables.

2009-02-15 11:08  acastro

	* [r4953] src/basic/command_line.F90, src/basic/getopt_f.c,
	  src/opt_control/target.F90, src/td/spectrum.F90,
	  src/utils/harmonic_spectrum.F90: Cleaned up the harmonic spectrum
	  calculation, which I had messed up a
	  little.

2009-02-15 18:33  acastro

	* [r4954] src/opt_control/initst.F90,
	  src/opt_control/opt_control.F90, src/opt_control/parameters.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90:
	  Improved the printing of the Fourier transform of the control
	  functions used for QOCT runs. In the way, some unimportant
	  details
	  were fixed.

2009-02-15 20:11  xavier

	* [r4955] src/grid/hypercube.F90: Included routines to convert from
	  an hypercubical grid to a linear
	  array and back. These routines were written by Nicole Helbig and
	  this
	  is a copy of her original code, they are not used yet.

2009-02-15 20:47  xavier

	* [r4956] src/grid/Makefile.am, src/grid/hypercube.F90: Moved
	  hypercube routines inside a module and changed the code to
	  octopus style.

2009-02-15 21:42  xavier

	* [r4957] src/sternheimer/em_resp.F90: Corrected the calculation of
	  circular dichroism.

2009-02-16 00:00  dstrubbe

	* [r4958] src/sternheimer/em_resp.F90: Now the tensor combinations
	  of the hyperpolarizability for hyper-Rayleigh scattering (HRS)
	  are calculated, for the VV and HV polarizations.

2009-02-16 08:22  xavier

	* [r4959] src/sternheimer/em_resp.F90: Changed the message
	  displayed for circular dichroism.

2009-02-16 09:00  xavier

	* [r4960] src/grid/Makefile.am, src/grid/hypercube.F90,
	  src/grid/index.F90, src/grid/mesh.F90, src/grid/mesh_init.F90,
	  src/ions/simul_box.F90: Defined a new boxshape: hypercube
	  (actually an hyperparallelepiped).
	  This is to introduce arbitrary dimensions in octopus.

2009-02-16 15:45  xavier

	* [r4961] src/grid/hypercube.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/nl_operator.F90,
	  src/ions/simul_box.F90: Now the hypercubic grid is working (up to
	  3d).

2009-02-16 23:17  xavier

	* [r4962] src/grid/multigrid.F90, src/ions/crystal.F90,
	  src/ions/simul_box.F90, src/math/math_inc.F90,
	  src/system/pert_inc.F90: Some fixes required for running with
	  MAX_DIM = 4.

2009-02-17 17:27  acastro

	* [r4963] src/opt_control/check_input.F90: For QOCT runs, mask-type
	  absorbing boundaries were not allowed;
	  however in certain cases they should be allowed. I corrected the
	  check
	  in order to allow those cases.

2009-02-18 03:23  dstrubbe

	* [r4964] src/hamiltonian/species_pot.F90, src/ions/Makefile.am,
	  src/ions/dynamics.F90, src/ions/interaction.F90,
	  src/ions/ion_dynamics.F90, src/ions/ion_interaction.F90: *)
	  Changed the name of a misleadingly labeled routine in its
	  push_sub() command
	  *) Changed the names of two files to correspond to the names of
	  their modules

2009-02-18 15:21  nitsche

	* [r4965] src/grid/mesh.F90, src/grid/mesh_init.F90: * Fixed the
	  transport mode. Problems were:
	  - MAX_DIM<==>sb%dim related stuff
	  - optimization of the mesh in blocks does not work with the
	  transport mode. MeshBlockSizeXY and MeshBlockSizeXY must be both
	  1.
	  - a non-initialized pointer
	  There is still a problem with MPI, so I will not switch on the
	  tests yet...

2009-02-19 06:18  xavier

	* [r4966] src/hamiltonian/epot_inc.F90: Bugfix: Now the epot_force
	  uses complex values, but the MPI routines
	  where still using MPI_FLOATs. This caused the forces to be wrong
	  in
	  parallel runs.

2009-02-19 07:01  xavier

	* [r4967] src/hamiltonian/hamiltonian.F90, src/ions/crystal.F90,
	  src/ions/simul_box.F90, src/states/states_kpoints.F90: More fixes
	  for MAX_DIM = 4.

2009-02-19 07:44  xavier

	* [r4968] src/sternheimer/em_resp.F90: A repeated + sign caused
	  problems with some compilers.

2009-02-19 10:23  xavier

	* [r4969] src/states/states.F90: Bugfix: After Miguel's commit
	  [4921] the spinor tests started failing.
	  This fixes it, it seems to me that there was a previous bug for
	  systems with core corrections and spinors that Miguel's commit
	  extended to all systems with spinors.
	  
	  It would be nice it someone could review my changes.

2009-02-19 13:26  acastro

	* [r4970] src/states/states.F90: The previous commit (#4969)
	  "overcorrected" one mistake that caused a
	  failure in the spinors test since #4921. It turns out that one of
	  the
	  changes from spin_channels to nspin was right, but the other two
	  were
	  not. Now I think that the routine is correct, and the test is
	  passed.

2009-02-19 13:38  acastro

	* [r4971] src/main/casida.F90: Corrected a typo in the
	  documentation that caused some confusion in
	  the users. Thanks to Myrta Gruning for finding this out.

2009-02-19 14:29  xavier

	* [r4972] src/grid/submesh.F90, src/hamiltonian/projector.F90,
	  src/ions/solids.F90, src/main/main.F90, src/states/states.F90:
	  More fixes for MAX_DIM = 4.

2009-02-19 15:27  xavier

	* [r4973] src/ions/xyz_file.F90: Components higher than 3 of the
	  velocity are now initialized to zero.

2009-02-19 15:52  xavier

	* [r4974] configure.ac: Now the value of MAX_DIM can be changed
	  from the configure script.

2009-02-19 17:24  xavier

	* [r4975] src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/ions/simul_box.F90, src/scf/scf.F90, src/states/states.F90:
	  Welcome to the fourth dimension!
	  ================================
	  
	  Now Octopus works in 4D mode, to do it you have to configure
	  octopus with
	  --with-max-dim=4 and put dimensions=4 in the input file. Only
	  non-iteracting electrons with user defined species can be used.

2009-02-19 17:48  xavier

	* [r4976] src/grid/hypercube.F90: Memory allocations made a huge
	  overhead in the hypercube routines.

2009-02-19 23:19  dstrubbe

	* [r4977] src/hamiltonian/epot.F90, src/hamiltonian/projector.F90,
	  src/td/td.F90: A recent change to projector_init_phases used a
	  variable which seems only to have been initialized in some cases
	  and not in others, causing a
	  segmentation fault. Now the dimension is explicitly passed in to
	  the function, like for projector_init and submesh_init_sphere.

2009-02-20 00:20  dstrubbe

	* [r4978] src/sternheimer/kdotp.F90: Stopped every node writing
	  about degenerate subspaces in calculation of effective masses.

2009-02-20 01:29  dstrubbe

	* [r4979] src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/system/pert_inc.F90: *)
	  Changed parenthesis for X() function macro to standard way we
	  write it
	  *) Took ownership of the two files for the kdotp perturbation

2009-02-20 02:01  dstrubbe

	* [r4980] src/hamiltonian/epot_inc.F90: *) Some fixes to the
	  calculation of forces and Born effective charges. I think
	  electron-ion forces in periodic systems were not being
	  calculated correctly since the boundary conditions were not set
	  on the ghost/boundary points before taking gradients.
	  *) Changed MAX_DIM to NDIM in a bunch of places to avoid seg
	  faults after the new 4D changes.
	  *) However, the Born charges (and hence probably the forces) are
	  still not right in periodic systems. More coming soon.

2009-02-20 03:26  dstrubbe

	* [r4981] src/math/math_inc.F90, src/system/pert_inc.F90: *) The
	  application of perturbations involved first applying phases
	  e^ikr. In fact, this is incorrect because when pseudopotential
	  projectors
	  are used, they apply these phases themselves. The phases are no
	  longer applied in the perturbations.
	  *) The phases were giving the correct result from derivatives,
	  i.e. e^-ikr grad (e^ikr u) = grad u + ik u. But it is simpler to
	  just write this
	  out where it occurs for the grad in kdotp and curl in magnetic.
	  *) To be able to use a cross product in a forall statement, I
	  declared the cross product a pure function.

2009-02-20 03:54  dstrubbe

	* [r4982] src/hamiltonian/epot_inc.F90: Now the boundary conditions
	  are set on NP_PART for the gradients as well, before they are
	  using applying pseudopotential projectors. Previously, the forces
	  in the cubic MgO crystal were exactly zero even when one of the
	  atoms was displaced. Now there is a reasonable force on that
	  displaced atom and its neighbors.
	  
	  However, the forces still break symmetry somewhat in the
	  undisplaced case, as they should actually be exactly zero then.
	  Perhaps this is due to problems in the ion-ion forces.

2009-02-20 11:14  acastro

	* [r4983] src/td/spectrum.F90: The minimization in spectrum_hs (to
	  get the maxima of the harmonic
	  spectrum) was not robust enough, which could cause the call to
	  GSL to
	  break. Now the code continues even if it does not find a minimum.

2009-02-20 16:00  xavier

	* [r4984] m4/sse.m4, src/beak/operate_ri_vec.c: This fixes the
	  compilation problem with icc 11.

2009-02-20 20:36  dstrubbe

	* [r4985] src/grid/cube_function_inc.F90,
	  src/hamiltonian/hamiltonian_inc.F90: Added and fixed some
	  push_sub statements.

2009-02-20 22:18  dstrubbe

	* [r4986] src/grid/cube_function.F90,
	  src/grid/cube_function_inc.F90, src/grid/derivatives.F90,
	  src/poisson/poisson.F90, src/poisson/solver_3D.F90,
	  src/poisson/solver_fft.F90, src/system/v_ks.F90: *) Added and
	  fixed missing push_sub statements
	  *) Changed some MAX_DIM to 3 in cube functions; 3 is hard-coded
	  into
	  many places anyway, so it is certainly not general to more
	  dimensions
	  *) Some corrections to documentation
	  *) Translated MULTIGRILLA to MULTIGRID

2009-02-20 22:53  dstrubbe

	* [r4987] src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/xc/vxc.F90: *) Added more push_sub statements
	  *) Changed m to mesh in derivatives
	  *) Replaced der%mesh%sb%dim by der%dim, since there was a more
	  direct
	  way to access this information, and since mesh%sb%dim seemed to
	  cause seg faults sometimes
	  
	  However, I have still not found the source of all the seg faults
	  on
	  corvo ...

2009-02-20 23:23  dstrubbe

	* [r4988] src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90: *) Trying to make pre-filter
	  preconditioner work for Sternheimer equation in periodic boundary
	  conditions. This does not seem to make any improvement though. It
	  still does not work.
	  *) Replaced PRE_SMOOTHING by PRE_FILTER for preconditioner to be
	  consistent with names in documentation

2009-02-20 23:32  dstrubbe

	* [r4989] src/system/pert_inc.F90: My previous commit removing the
	  application of k-point phases in perturbations was mistaken. Now
	  it is back as it was.

2009-02-21 00:00  dstrubbe

	* [r4990] src/grid/derivatives_inc.F90,
	  src/hamiltonian/epot_inc.F90: *) Now k-point phases are applied
	  in calculation of forces/Born charges too
	  *) A couple of debugging statements removed that was accidentally
	  left in a previous commit

2009-02-21 15:09  xavier

	* [r4991] src/sternheimer/em_resp.F90,
	  src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90: Added the possibility of
	  giving arbitrary perturbed wave-functions to
	  the sternheimer equation.

2009-02-22 08:40  xavier

	* [r4992] src/hamiltonian/epot_inc.F90: An error in the application
	  in the phases when calculating the forces
	  was causing out of bound accesses.

2009-02-22 20:35  dstrubbe

	* [r4993] src/grid/derivatives_inc.F90, src/hamiltonian/epot.F90,
	  src/poisson/Makefile.am, src/poisson/conj_grad.F90,
	  src/poisson/corrections.F90, src/poisson/cutoffs.F90,
	  src/poisson/poisson_cg.F90, src/poisson/poisson_corrections.F90,
	  src/poisson/poisson_cutoff.F90, src/poisson/poisson_fft.F90,
	  src/poisson/poisson_isf.F90, src/poisson/poisson_multigrid.F90,
	  src/poisson/solver_fft.F90, src/poisson/solver_isf.F90,
	  src/poisson/solver_multigrid.F90: *) Corrected comments about
	  setting boundary conditions for derivatives
	  *) Changed names of files in poisson directory to correspond with
	  the names of the modules
	  *) Also changed a couple of push_sub statements and module names
	  to make everything consistent

2009-02-22 22:17  dstrubbe

	* [r4994] src/ions/simul_box.F90: The routine to periodically
	  translate atoms into the simulation box was not taking into
	  account the BoxOffset. Now it does.

2009-02-24 15:43  xavier

	* [r4995] src/basic/loct_parser.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/ob_lead.F90, src/hamiltonian/species_pot.F90,
	  src/ions/simul_box.F90, src/opt_control/initst.F90,
	  src/opt_control/target.F90, src/poisson/poisson_fft.F90,
	  src/species/species.F90, src/states/restart.F90: Now
	  loct_parse_expression takes a vector instead of the individual
	  components.

2009-02-24 16:01  xavier

	* [r4996] liboct_parser/parser_f.c, src/basic/loct_parser.F90: Now
	  the C routine for parsing expression also takes a vector.

2009-02-24 16:25  xavier

	* [r4997] liboct_parser/parser_f.c: Now a 4d potential can be
	  specified by using 'w' as the fourth
	  dimension.

2009-02-25 10:25  marques

	* [r4998] libxc/src/Makefile.am, libxc/src/lda_c_1d_csc.c,
	  libxc/src/libxc_master.F90, libxc/src/test.c,
	  libxc/src/work_lda_1d.c, libxc/src/xc.h, libxc/src/xc_config.h,
	  libxc/src/xc_f.c, src/xc/functionals.F90: I implemented the 1D
	  correlation LDA of Barone's group. Note that this
	  has not been tested, and that there is the exchange missing...

2009-02-25 11:46  xavier

	* [r4999] src/grid/mesh_init.F90: A stencil is now always used to
	  partition the mesh.

2009-02-25 17:14  xavier

	* [r5000] src/grid/mesh_init.F90: Generalized some parts of the
	  initialization of the mesh in parallel to an
	  arbitrary number of dimensions.

2009-02-25 17:40  xavier

	* [r5001] libxc/src/Makefile.am, libxc/src/lda_c_2d_prm.c,
	  libxc/src/lda_c_2d_prm08.c, libxc/src/libxc_master.F90,
	  libxc/src/xc.h, libxc/src/xc_f.c,
	  libxc/testsuite/xc-consistency.c, src/xc/functionals.F90: Due to
	  the 31 character limitation I had to rename the lda_c_2d_prm08
	  functional
	  to lda_c_2d_prm. Miguel, can you check that I did it correctly?

2009-02-25 22:18  xavier

	* [r5002] src/grid/Makefile.am, src/grid/mesh_init.F90: Domain
	  parallelization now works in 4D.

2009-02-26 02:12  dstrubbe

	* [r5003] src/basic/loct_parser.F90: The Portland compiler objected
	  to the way the interface was declared in loct_parser, giving the
	  error:
	  PGF90-S-0070-Incorrect sequence of statements (loct_parser.F90:
	  233)
	  I moved the "module procedure" lines to after the subroutine,
	  which is what the Intel Fortran reference says is how the syntax
	  is supposed to go. I hope this is what was meant.

2009-02-26 09:25  xavier

	* [r5004] src/grid/grid.F90, src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/grid/mesh_init.F90,
	  src/grid/multigrid.F90, src/states/restart.F90: Some code
	  cleaning.

2009-02-26 16:42  xavier

	* [r5005] src/grid/double_grid_apply.F90, src/math/fftw3.F90: Some
	  fixes for max-dim=4.

2009-02-26 21:18  dstrubbe

	* [r5006] src/grid/mesh_function_inc.F90, src/ions/simul_box.F90,
	  src/states/states.F90, src/sternheimer/kdotp.F90: *) Turned on
	  calculation of effective masses by default, since it doesn't take
	  much time and is useful as a diagnostic
	  *) Replaced some MAX_DIM by mesh%sb%dim, which were causing a seg
	  fault
	  *) Changed "m" to "mesh" in various places
	  *) Changed another one-character name: "c" to "cube"
	  *) Added a warning to documentation on variable BoxOffset since
	  its use seems to change the results for the ground state
	  significantly.
	  *) Changed "st%wfs_type == M_REAL" to "states_are_real(st)" in
	  one place

2009-02-27 02:59  dstrubbe

	* [r5007] src/sternheimer/kdotp.F90: Now the actual default value,
	  not just the documentation, for CalculateEffectiveMasses has been
	  changed.

2009-02-28 12:13  acastro

	* [r5008] src/hamiltonian/lasers.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/one_shot.F90,
	  src/main/phonons_fd.F90, src/main/unocc.F90,
	  src/opt_control/initst.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/scf/scf.F90,
	  src/states/states.F90, src/system/system.F90, src/td/td.F90,
	  src/td/td_init.F90, src/td/td_rti.F90: o The states_calc_dim
	  subroutine accepted a states_t argument as
	  intent(in), and a density as intent(out). However, in most cases
	  it
	  was the density inside the states_t variable that was passed as
	  the
	  density to be computed. This is inconsistent, although probable
	  legal
	  since the compilers did not complain. In anycase, I think it is
	  better
	  and easier to use an optional argument, that does not need to be
	  passed if it is the density of the states_t argument the one that
	  we
	  want to calculate.
	  
	  o Simplified the optimal control code in several points. Also,
	  added
	  some comments and documentation.

2009-03-01 13:59  rozzi

	* [r5009] src/grid/mesh.F90, src/hamiltonian/hamiltonian.F90:
	  implemented absorbing boundaries for the minimum box

2009-03-01 19:53  xavier

	* [r5010] src/grid/Makefile.am, src/grid/cubic_mesh.F90,
	  src/grid/cubic_mesh_low.c: This is the initial implementation of
	  the cubic grid in C. The idea is
	  to be able to use any C FFT library and avoid all the transposing
	  done
	  by Fortran FFTW.

2009-03-02 01:27  dstrubbe

	* [r5011] src/grid/io_function_inc.F90: Renamed "m" and "c" to
	  "mesh" and "cube" in some places.

2009-03-02 02:03  xavier

	* [r5012] src/hamiltonian/gauge_field.F90: The plasmon frequency
	  now is printed the correct units.

2009-03-02 10:42  xavier

	* [r5013] m4/sse.m4: Made the SSE2 test more strict by including an
	  operation in the test
	  code. Miguel can you check whether it solves the problem with
	  pathscale?

2009-03-02 13:42  marques

	* [r5014] configure.ac, m4/sse.m4: Xavier's hack did not work, so I
	  decided to revert it and to include a
	  switch to explicitly disable sse2. In this way the user can work
	  around
	  buggy compilers (even the latest version of pathscale 3.2 has the
	  problem)

2009-03-03 00:41  dstrubbe

	* [r5015] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/ions/simul_box.F90, src/states/restart.F90,
	  src/system/output_h_sys.F90: *) Corrected push_sub's
	  *) Removed references to obsolete gnuplot option to OutputHow,
	  which had no effect anyway
	  *) Added XCrySDen format for 3D data
	  *) Added documentation about printing linear-response density,
	  which was not mentioned in the variable reference although it was
	  implemented

2009-03-03 05:09  dstrubbe

	* [r5016] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/main/casida_inc.F90, src/main/static_pol.F90,
	  src/sternheimer/em_resp.F90, src/system/output_h.F90,
	  src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/system.F90: *) Now
	  XCrySDen output includes the actual atomic coordinates. Passing
	  in the geometry to the output functions required changes in many
	  places. Coordinates are offset so that an atom at (0,0,0) would
	  be in the center of the cell.
	  *) A small change to the XCrysDen output grid due to this strange
	  thing about general vs periodic grids.
	  *)

2009-03-03 07:50  acastro

	* [r5017] src/main/unocc.F90, src/opt_control/finalcheck.F90,
	  src/opt_control/opt_control.F90, src/opt_control/target.F90:
	  h_sys_output_states has a new interface, but its calls were not
	  updated all over the code. Now I think the all are.

2009-03-03 08:17  acastro

	* [r5018] src/poisson/poisson_fft.F90,
	  src/poisson/poisson_finite_cyl.c: A couple of bugs resulted in
	  massive memory usage when running in 2D
	  with different spacings. Thanks to Matthieu for reporting this
	  bug.

2009-03-03 10:14  xavier

	* [r5019] src/grid/cubic_mesh.F90, src/grid/cubic_mesh_low.c: Small
	  fixes in the cubic mesh.

2009-03-03 13:24  marques

	* [r5020] src/sternheimer/em_resp_calc_inc.F90,
	  src/system/pert.F90: Corrected reference and removed duplicated
	  print

2009-03-03 15:57  acastro

	* [r5021] src/math/sparskit.F90, src/td/td_rti.F90: The code did
	  not compile with sparskit, due to a couple of
	  details. Now it does (did not check that it still works with
	  sparskit,
	  though).

2009-03-03 17:47  nitsche

	* [r5022] src/grid/mesh_init.F90, src/grid/par_vec.F90,
	  src/states/restart.F90, src/states/states.F90: * changed the way
	  to check the mesh-block-size if open boundaries scheme is used,
	  now the size must explicitly set to 1
	  * read_free_states now only reads the occupied states (this
	  should change when xc is implemented for transport)
	  * vec_global2local did not check if the array global was actually
	  associated
	  * bugfix (NP -> NP_PART)
	  * new optional parameter for states_look to look for occupied
	  states

2009-03-04 01:10  xavier

	* [r5023] src/grid/cubic_mesh.F90, src/grid/cubic_mesh_low.c: Added
	  some functions to the cubic_mesh.

2009-03-04 06:26  xavier

	* [r5024] src/utils/dielectric_function.F90: Some fixes in the
	  calculation of the dielectric function.

2009-03-04 06:31  xavier

	* [r5025] external_libs/spglib/AUTHORS,
	  external_libs/spglib/COPYING, external_libs/spglib/ChangeLog,
	  external_libs/spglib/INSTALL, external_libs/spglib/Makefile.am,
	  external_libs/spglib/Makefile.in, external_libs/spglib/NEWS,
	  external_libs/spglib/README, external_libs/spglib/aclocal.m4,
	  external_libs/spglib/bravais.c, external_libs/spglib/bravais.h,
	  external_libs/spglib/cell.c, external_libs/spglib/cell.h,
	  external_libs/spglib/compile, external_libs/spglib/config.guess,
	  external_libs/spglib/config.h.in,
	  external_libs/spglib/config.sub, external_libs/spglib/configure,
	  external_libs/spglib/configure.ac, external_libs/spglib/depcomp,
	  external_libs/spglib/install-sh, external_libs/spglib/ispglib.h,
	  external_libs/spglib/ltmain.sh, external_libs/spglib/mathfunc.c,
	  external_libs/spglib/mathfunc.h, external_libs/spglib/missing,
	  external_libs/spglib/pointgroup.c,
	  external_libs/spglib/pointgroup.h,
	  external_libs/spglib/primitive.c,
	  external_libs/spglib/primitive.h, external_libs/spglib/python,
	  external_libs/spglib/python/Makefile.am,
	  external_libs/spglib/python/Makefile.in,
	  external_libs/spglib/python/ase,
	  external_libs/spglib/python/ase/Makefile,
	  external_libs/spglib/python/ase/_spglib.c,
	  external_libs/spglib/python/ase/conf.py,
	  external_libs/spglib/python/ase/example_ase.py,
	  external_libs/spglib/python/ase/index.rst,
	  external_libs/spglib/python/ase/setup.py,
	  external_libs/spglib/python/ase/spglib.py,
	  external_libs/spglib/python/ase/src,
	  external_libs/spglib/python/example.py,
	  external_libs/spglib/python/libpyspg.c,
	  external_libs/spglib/ruby, external_libs/spglib/ruby/example1.c,
	  external_libs/spglib/ruby/example1.rb,
	  external_libs/spglib/ruby/extconf_example1.rb,
	  external_libs/spglib/spacegroup.c,
	  external_libs/spglib/spacegroup.h,
	  external_libs/spglib/spacegroup_data.c,
	  external_libs/spglib/spacegroup_data.h,
	  external_libs/spglib/spacegroup_database.c,
	  external_libs/spglib/spacegroup_database.h,
	  external_libs/spglib/spglib.c, external_libs/spglib/spglib.h,
	  external_libs/spglib/spglib_f.c, external_libs/spglib/src,
	  external_libs/spglib/src/ChangeLog,
	  external_libs/spglib/src/Makefile.am,
	  external_libs/spglib/src/Makefile.in,
	  external_libs/spglib/src/bravais.c,
	  external_libs/spglib/src/bravais.h,
	  external_libs/spglib/src/bravais_art.c,
	  external_libs/spglib/src/bravais_art.h,
	  external_libs/spglib/src/cell.c, external_libs/spglib/src/cell.h,
	  external_libs/spglib/src/debug.c,
	  external_libs/spglib/src/debug.h,
	  external_libs/spglib/src/mathfunc.c,
	  external_libs/spglib/src/mathfunc.h,
	  external_libs/spglib/src/pointgroup.c,
	  external_libs/spglib/src/pointgroup.h,
	  external_libs/spglib/src/primitive.c,
	  external_libs/spglib/src/primitive.h,
	  external_libs/spglib/src/spacegroup.c,
	  external_libs/spglib/src/spacegroup.h,
	  external_libs/spglib/src/spacegroup_data.c,
	  external_libs/spglib/src/spacegroup_data.h,
	  external_libs/spglib/src/spacegroup_database.c,
	  external_libs/spglib/src/spacegroup_database.h,
	  external_libs/spglib/src/spglib.c,
	  external_libs/spglib/src/spglib.h,
	  external_libs/spglib/src/symmetry.c,
	  external_libs/spglib/src/symmetry.h,
	  external_libs/spglib/symmetry.c, external_libs/spglib/symmetry.h,
	  external_libs/spglib/test.c: Updated spglib to version 0.5.1.

2009-03-04 07:28  xavier

	* [r5026] external_libs/spglib/Makefile.am,
	  external_libs/spglib/Makefile.in,
	  external_libs/spglib/aclocal.m4, external_libs/spglib/compile,
	  external_libs/spglib/config.guess,
	  external_libs/spglib/config.h.in,
	  external_libs/spglib/config.sub, external_libs/spglib/configure,
	  external_libs/spglib/configure.ac, external_libs/spglib/depcomp,
	  external_libs/spglib/install-sh, external_libs/spglib/ltmain.sh,
	  external_libs/spglib/missing, external_libs/spglib/python,
	  external_libs/spglib/ruby, external_libs/spglib/src/Makefile.am,
	  external_libs/spglib/src/Makefile.in: * The new version of spglib
	  is now compiled.
	  * Removed some useless parts of spglib.

2009-03-04 10:47  mjv500

	* [r5027] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/output_h_sys.F90:
	  added mass_scaling input var

2009-03-04 12:05  xavier

	* [r5028] configure.ac, external_libs/spglib/src/Makefile.am,
	  src/common-rules.make, src/ions/Makefile.am, src/ions/spglib_f.c,
	  src/ions/symmetries.F90: Initial implementation of an interface
	  for spglib.

2009-03-04 13:27  acastro

	* [r5029] src/ions/symmetries.F90: My compiler complained about the
	  procedures "symmetries_init" and
	  "symmetries_end" being public, and the data type "symmetries_t"
	  not
	  being public. If it is not public, it cannot be the argument of a
	  public procedure.
	  
	  The components of symmetries_t may be private, though.

2009-03-04 21:35  rozzi

	* [r5030] share/util/mf.cfg, share/util/mf.net: Added a new "TD"
	  module to the dx script. This mode allows to generate a set of
	  images from a td run. The user must choose some parameters like
	  the number of time steps between consecutive frames, the value
	  and units of the time step, etc., and then the sequencer can be
	  used to go through the files in the proper td.* directories to
	  generate the images. You can conveniently combine this module
	  with the "Script mode". Press play, go for a coffee (or a beer),
	  and when you are back all the images are ready to be joined into
	  a movie. Since only one sequencer is allowed to exist, I had to
	  remove it from the slab module, where i feel it is less
	  necessary.

2009-03-04 23:51  dstrubbe

	* [r5031] src/grid/mesh_function_inc.F90: *) Some fixes to
	  push_sub's
	  *) Removed one-line setting of defaults for optional arguments
	  which can cause a seg-fault.

2009-03-05 04:59  xavier

	* [r5032] src/ions/Makefile.am, src/ions/crystal.F90,
	  src/ions/spglib_f.c, src/ions/symmetries.F90,
	  src/states/states_kpoints.F90: * Now spglib is used to analyze
	  the symmetries of the system. This is
	  much cleaner than the previous code we had.
	  
	  * Generation of k-point is now always done following the
	  Monkhorstpack
	  scheme..

2009-03-05 07:40  xavier

	* [r5033]
	  testsuite/periodic_systems/01-free_electrons.01-ground_state.inp,
	  testsuite/periodic_systems/02-cosine_potential.01-ground_state.inp,
	  testsuite/periodic_systems/03-sodium_chain.01-ground_state.inp,
	  testsuite/periodic_systems/03-sodium_chain.02-ground_state_disp.inp,
	  testsuite/periodic_systems/04-silicon.01-gs.inp: The tests for
	  periodic systems now have the k points explicitly in the
	  input file (until the new k point generator completely
	  functional).

2009-03-05 07:47  xavier

	* [r5034] src/ions/crystal.F90: For the moment symmetry reduction
	  of the Brillouin zone only works for
	  periodicity in 3 dimensions.

2009-03-05 09:13  marques

	* [r5035] libxc/src/lda_c_hl.c, libxc/src/lda_c_pw.c,
	  libxc/src/lda_c_pz.c, libxc/src/lda_c_rpa.c,
	  libxc/src/lda_c_vwn.c, libxc/src/lda_c_wigner.c,
	  libxc/src/lda_xc_teter93.c, libxc/src/work_lda.c: Cleaned a bit
	  the LDAs.

2009-03-05 13:04  marques

	* [r5036] libxc/src/lda.c, libxc/src/lda_c_hl.c,
	  libxc/src/lda_c_pw.c, libxc/src/lda_c_pz.c,
	  libxc/src/lda_c_rpa.c, libxc/src/lda_c_vwn.c,
	  libxc/src/lda_c_wigner.c, libxc/src/lda_c_xalpha.c,
	  libxc/src/lda_xc_teter93.c, libxc/src/test.c, libxc/src/util.h,
	  libxc/src/work_lda.c, libxc/src/xc.h: *) Simplified a bit more
	  the interface to the routines.
	  *) Added support for spin-unpolarized Kxc, and added the third
	  derivatives of wigner and rpa corelation functionals.

2009-03-05 16:24  mjv500

	* [r5037] src/ions/crystal.F90: presumed 3D kpoints

2009-03-05 16:25  mjv500

	* [r5038] src/states/states_calc.F90: presumed 3D kpoints

2009-03-05 16:27  mjv500

	* [r5039] src/grid/mesh_function_inc.F90, src/states/Makefile.am,
	  src/states/density_matrix.F90, src/states/embedded_particles.F90,
	  src/states/states.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: embedded particles and density
	  matrix modules

2009-03-05 19:30  xavier

	* [r5040] src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/hamiltonian.F90: * Fixed a memory leak in the
	  calculation of the forces.
	  * Some output in hamiltonian_init is outdated.
	  * Removed the debubgging output of the mass scaling.

2009-03-05 20:44  dstrubbe

	* [r5041] src/ions/crystal.F90: A push_sub got lost in the
	  reorganization of the code.

2009-03-05 22:49  xavier

	* [r5042] src/ions/symmetries.F90: Included the option of
	  generating a k point grid with reduced symmetry.

2009-03-06 00:35  dstrubbe

	* [r5043] src/system/energy_inc.F90: Fixed up some more push_sub's.
	  Really a large fraction of them do not actually correspond to the
	  file name and function name.

2009-03-06 00:37  dstrubbe

	* [r5044] src/scf/lcao_inc.F90: More push_sub's.

2009-03-06 00:39  dstrubbe

	* [r5045] src/scf/eigen_cg_inc.F90: push_sub's

2009-03-06 00:40  dstrubbe

	* [r5046] src/states/states_calc_inc.F90: push_sub's

2009-03-06 00:41  dstrubbe

	* [r5047] src/grid/batch.F90: push_sub's

2009-03-06 00:42  dstrubbe

	* [r5048] src/grid/batch_inc.F90: More push_sub's corrected while
	  using DebugLevel = 2 for stack trace

2009-03-06 00:44  dstrubbe

	* [r5049] src/grid/mesh_init.F90: push_sub's

2009-03-06 00:46  dstrubbe

	* [r5050] src/grid/nl_operator.F90, src/grid/nl_operator_inc.F90:
	  push_sub's and comments

2009-03-06 01:37  dstrubbe

	* [r5051] src/grid/par_vec.F90, src/grid/par_vec_inc.F90:
	  push_sub's and comments

2009-03-06 03:09  dstrubbe

	* [r5052] src/ions/simul_box.F90: push_sub's

2009-03-06 03:48  xavier

	* [r5053] src/ions/symmetries.F90: I disabled for the moment the
	  output of the symmetry information.

2009-03-06 10:08  marques

	* [r5054] external_libs/spglib/src/Makefile.am: debug.h has to be
	  referenced in the Makefile, otherwise it will not be
	  added to the distribution

2009-03-06 16:10  mjv500

	* [r5055] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/density_matrix.F90:
	  generalized densmat calculation to any dimension and choice of
	  embedded particle

2009-03-06 22:11  dstrubbe

	* [r5056] src/grid/derivatives_inc.F90, src/scf/subspace_inc.F90:
	  push_sub's

2009-03-07 01:39  dstrubbe

	* [r5057] src/grid/double_grid.F90, src/grid/double_grid_apply.F90,
	  src/hamiltonian/projector.F90, src/species/species.F90:
	  push_sub's and comments

2009-03-07 15:33  acastro

	* [r5058] src/poisson/Makefile.am, src/poisson/poisson.F90,
	  src/poisson/poisson_cutoff.F90, src/poisson/poisson_cutoffs.c,
	  src/poisson/poisson_fft.F90, src/poisson/poisson_finite_cyl.c,
	  src/poisson/solver_1D.F90, src/poisson/solver_3D.F90: Added the
	  reciprocal space method to integrate Hartree's integral in
	  1D for finite systems. That is, implemented the cutoff soft
	  Coulomb
	  interaction in reciprocal space for finite ("0D-periodic")
	  systems in
	  1D. This method is now the default, instead the direct sum
	  ("direct1D"), since it is way faster.
	  
	  Also, corrected the case of 1D-periodic systems in 1D, which was
	  wrong
	  because of a wrong factor in the definition of the soft-Coulomb
	  interaction in reciprocal space.
	  
	  This means that we now have reciprocal space Hartree integral
	  integrators for all possible dimensions, and periodicities:
	  3D/3D,
	  3D/2D, 3D/1D, 3D/0D, 2D/2D, 2D/1D, 2D/0D, 1D/1D and finally,
	  1D/0D (in
	  the 1D case, we assume soft Coulomb instead of normal Coulomb
	  since
	  otherwise we get infinities everywhere).

2009-03-07 18:10  acastro

	* [r5059] src/grid/mesh_init.F90: Variable "p", which should
	  contain the number of real space
	  partitions, was being used uninitialized in routine
	  mesh_partition. This caused octopus to break with my compiler,
	  although I guess some other compilers/setups would just put a
	  zero for
	  p. This however, meant that the if clause
	  
	  if(p .lt. 8) then
	  default_method = RCB
	  else
	  default_method = GRAPH
	  end if
	  
	  
	  would always be true for "RCB", whatever it means. I think it has
	  been
	  this way since r4657. Xavier, maybe you want to check this, in
	  case it
	  is relevant.

2009-03-08 08:19  dstrubbe

	* [r5060] src/grid/double_grid.F90, src/hamiltonian/projector.F90,
	  src/species/species.F90, src/sternheimer/em_resp_calc.F90: Some
	  trivial changes.

2009-03-08 11:01  xavier

	* [r5061] src/ions/simul_box.F90, src/states/states_kpoints.F90: *
	  Bugfix: the default k point was not initialized properly.
	  
	  * Removed debugging output for simul_box_in_box.

2009-03-08 11:35  xavier

	* [r5062] src/opt_control/parameters.F90: Added (again) a
	  workaround for a bug in the IBM compiler. This time I
	  put a comment to avoid it being reverted.

2009-03-09 09:11  marques

	* [r5063] libxc/src/lda.c, libxc/src/lda_c_rpa.c,
	  libxc/src/lda_c_wigner.c, libxc/src/lda_xc_teter93.c,
	  libxc/src/test.c, libxc/src/util.h, libxc/src/work_lda.c,
	  src/xc/fxc.F90, src/xc/kxc.F90, src/xc/vxc.F90: *) Added support
	  for the calculation of kxc (the 3rd derivative of Exc)
	  in libxc. I also changed the interface to something more
	  reasonable. Now
	  we have, when spin is polarized, kxc(4) = (uuu, uud, udd, ddd)
	  
	  *) Now octopus does stop if one tries to run with fxc or kxc !=
	  LDA. Up
	  to now it was simply ignoring fxc (i.e., it was performing an RPA
	  calculation). David and Xavier, please check this one out.

2009-03-09 10:16  marques

	* [r5064] libxc/src/lda_c_pz.c,
	  testsuite/linear_response/02-h2o_pol_lr.test: Now Perdew-Zunger
	  has analitic 3rd derivatives. Due to that, the values
	  of the hyperpolarizability test changed slightly (4th digit)

2009-03-09 12:30  marques

	* [r5065] Makefile.am, liboct_parser/parser_f.c,
	  liboct_parser/string_f.h, libstring_f, libxc/DONE,
	  libxc/src/test.c, src/basic/getopt_f.c, src/basic/io_binary.c,
	  src/basic/oct_f.c, src/basic/oct_gdlib_f.c, src/basic/recipes.c,
	  src/basic/varinfo_low.c, src/basic/write_iter_low.c,
	  src/common-rules.make: I got rid of libstring_f. It was replaced
	  simply by a header file
	  (string_f.h) that is included twice in octopus (liboct_parser and
	  libxc/src). The main difference is that TO_C_STR passed to a
	  subroutien
	  instead of a function.
	  
	  I used the opportunity to fix the strcasestr definition that was
	  quite
	  broken.

2009-03-09 13:39  mjv500

	* [r5066] src/states/density_matrix.F90: generalize output file
	  names dens mat

2009-03-09 14:08  marques

	* [r5067] libxc/DONE, libxc/src/lda_c_pw.c: Now pw also has
	  analytical Kxc

2009-03-09 16:51  mjv500

	* [r5068] src/states/density_matrix.F90: added normal density
	  output (in embedded dimensions)

2009-03-09 16:52  mjv500

	* [r5069] configure.ac, liboct_parser/Makefile.am,
	  libxc/configure.ac, src/common-rules.make: had to fix
	  dependencies after removal of libstring_f - someone competent
	  check this

2009-03-09 20:47  helbig

	* [r5070] src/states/density_matrix.F90: potential calculation
	  commented out

2009-03-10 01:21  xavier

	* [r5071] testsuite/periodic_systems/05-lithium.01-gs.inp,
	  testsuite/periodic_systems/05-lithium.02-td.inp,
	  testsuite/periodic_systems/05-lithium.test,
	  testsuite/periodic_systems/Makefile.am: Added test for the time
	  propagation with gauge field in solids.

2009-03-10 01:29  acastro

	* [r5072] src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90:
	  Bug fixed: some uninitialized variables (only when running in
	  parallel).

2009-03-10 04:30  xavier

	* [r5073] src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian_inc.F90: Moved the application of the
	  gauge field to its own module.

2009-03-10 06:04  xavier

	* [r5074] src/td/td.F90,
	  testsuite/periodic_systems/05-lithium.02-td.inp,
	  testsuite/periodic_systems/05-lithium.03-td-restart.inp,
	  testsuite/periodic_systems/05-lithium.test,
	  testsuite/periodic_systems/Makefile.am: * Restart functionality
	  for simulations with gauge field was not working.
	  * The restart of the simulation is now checked by the test.

2009-03-10 09:04  xavier

	* [r5075] src/hamiltonian/gauge_field.F90, src/td/td.F90,
	  src/td/td_rti.F90: Now gauge_field_get_force returns an object of
	  type gauge_force_t.

2009-03-10 10:53  mjv500

	* [r5076] src/states/Makefile.am, src/states/density_matrix.F90,
	  src/states/embedded_particles.F90,
	  src/states/modelmb_particles.F90, src/system/output_states.F90:
	  changed naming of embedded to modelmb

2009-03-11 08:58  marques

	* [r5077] libxc/src/Makefile.am, libxc/src/lda_c_vwn.c,
	  libxc/src/xc_f.c: Now also VWN has analytical Kxc

2009-03-11 09:00  marques

	* [r5078] libxc/src/string_f.h: It is easier to maintain a copy of
	  this file here, so that this library
	  is indeed independent.

2009-03-12 00:06  helbig

	* [r5079] src/grid/mesh_function_inc.F90,
	  src/states/density_matrix.F90, src/states/ksinversion.F90,
	  src/states/modelmb_particles.F90: density matrix normalized,
	  kspotential inversion added(not working yet)

2009-03-12 00:37  mjv500

	* [r5080] src/states/Makefile.am, src/states/ksinversion.F90:
	  cleaned ksinversion

2009-03-14 14:58  helbig

	* [r5081] src/grid/mesh_function_inc.F90,
	  src/states/density_matrix.F90, src/states/ksinversion.F90:
	  calculation of density for ModelMB, cleaned density matrix,
	  continued with KS potential calculation

2009-03-14 15:47  mjv500

	* [r5082] src/states/density_matrix.F90: modif output names for
	  density matrices

2009-03-15 12:00  xavier

	* [r5083] src/main/geom_opt.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/scf/ground_state.F90,
	  src/scf/scf.F90, src/td/td_init.F90: Changed the order of the
	  arguments of scf_init.

2009-03-15 23:12  xavier

	* [r5084] src/main/run.F90, src/opt_control/opt_control.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/td/td.F90, src/td/td_init.F90: Some consistency fixes:
	  
	  * Renamed timedep_m to td_m.
	  * Changed the order of the parameters for td_init.

2009-03-16 08:33  marques

	* [r5085] libxc/src/gga_x_am05.c, libxc/src/gga_x_b86.c,
	  libxc/src/gga_x_b86_mgc.c, libxc/src/gga_x_b88.c,
	  libxc/src/gga_x_bayesian.c, libxc/src/gga_x_dk87.c,
	  libxc/src/gga_x_ft97.c, libxc/src/gga_x_g96.c,
	  libxc/src/gga_x_lg93.c, libxc/src/gga_x_mpbe.c,
	  libxc/src/gga_x_optx.c, libxc/src/gga_x_pbe.c,
	  libxc/src/gga_x_pbea.c, libxc/src/gga_x_pw86.c,
	  libxc/src/gga_x_pw91.c, libxc/src/gga_x_rpbe.c,
	  libxc/src/gga_x_wc.c, libxc/src/lda_x.c, libxc/src/mgga_x_m06l.c,
	  libxc/src/test.c, libxc/src/util.h, libxc/src/work_gga_x.c: Som
	  cleaning in the ggas

2009-03-17 10:03  mjv500

	* [r5086] libxc/src/lda_x.c: MIGUEL CHECK THIS stray float

2009-03-17 16:28  mjv500

	* [r5087] src/states/density_matrix.F90,
	  src/states/modelmb_particles.F90: added dipole moment calculation

2009-03-19 05:35  xavier

	* [r5088] src/grid/derivatives_inc.F90, src/hamiltonian/epot.F90,
	  src/hamiltonian/epot_inc.F90, src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/include/global.h,
	  src/main/geom_opt.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/poisson/poisson.F90,
	  src/scf/scf.F90, src/states/elf.F90, src/states/magnetic.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/states/states_calc_inc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/vdW.F90,
	  src/system/exponential_split.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert.F90,
	  src/system/pert_inc.F90, src/system/preconditioners.F90,
	  src/system/system.F90, src/system/v_ks.F90, src/td/td.F90,
	  src/td/td_calc.F90, src/td/td_write.F90, src/xc/axc.F90,
	  src/xc/vxc.F90: Removed the NDIM macro.

2009-03-19 05:54  xavier

	* [r5089] src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/include/global.h,
	  src/main/gcm.F90, src/main/unocc_inc.F90,
	  src/opt_control/initst.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/scf/eigen_cg_inc.F90,
	  src/scf/eigen_evolution_inc.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/lcao_inc.F90, src/scf/ob_lippmann_schwinger.F90,
	  src/scf/subspace_inc.F90, src/states/elf.F90,
	  src/states/magnetic.F90, src/states/states.F90,
	  src/states/states_block.F90, src/states/states_calc_inc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert_inc.F90,
	  src/system/preconditioners_inc.F90, src/td/td_rti.F90,
	  src/xc/axc.F90, src/xc/vxc.F90: Removed the NP_PART macro.

2009-03-20 09:48  marques

	* [r5090] configure.ac, liboct_parser/Makefile.am,
	  libxc/configure.ac, libxc/src/Makefile.am,
	  libxc/src/lda_c_1d_csc.c, libxc/src/lda_c_2d_amgb.c,
	  libxc/src/lda_x.c, libxc/src/test.c, libxc/src/work_lda.c,
	  libxc/src/work_lda_1d.c, src/common-rules.make,
	  src/xc/functionals.F90, src/xc/xc.F90,
	  testsuite/finite_systems_2d/01-quadratic_box.03-hartree+xc.inp,
	  testsuite/finite_systems_2d/01-quadratic_box.04-spin_polarized.inp:
	  Reorganization of the LDAs of reduced dimension. Now there is a
	  common
	  driver routine in work_lda that handles 1, 2, and 3 dimensions. I
	  also
	  took the opportunity to add fxc and kxc to the 2d ldas (both
	  exchange
	  and amgb). I do not know if his is useful (someone interested in
	  hyperpolarizabilities of 2D systems?), but I added it for
	  completeness.

2009-03-20 12:00  marques

	* [r5091] libxc/DONE, libxc/src/lda_c_2d_prm.c,
	  libxc/src/lda_c_hl.c, libxc/src/test.c: Some more fixes, and now
	  HL also has Kxc.

2009-03-20 14:40  marques

	* [r5092] libxc/src/lda_x_2d.c: Forgot this file... sorry.

2009-03-20 15:31  marques

	* [r5093] src/grid/derivatives.F90: After many requests by Matthieu
	  and Nicole, I included the possibility
	  of having different masses in the different spatial directions.
	  This is
	  controlled by the block MoldelMBMasses. I am not 100% sure that
	  this
	  works, but I think so (the harmonic oscillator works ;). The idea
	  is to
	  do a coordinate transformation when one calculates the
	  coefficients of
	  the derivatives. Note that this is a hack, and that *all*
	  derivatives in
	  the code will be afected, so be careful.
	  
	  Note that I created a new section for the variables related to
	  the
	  Many-body models (Hamiltonian::Models). Matthieu and Nicole,
	  could you
	  please move the variables you have introduced there?

2009-03-20 15:41  marques

	* [r5094] src/grid/derivatives.F90: Sorry, I had forgotten to
	  change the name of the variable ;)

2009-03-21 18:28  acastro

	* [r5095] src/grid/derivatives.F90: Changed the name of
	  "MoldelMBMasses" to "ModelMBMasses", which I
	  assume was the first idea; and added the "%End% at the end of the
	  documentation block (otherwise the perl scripts complains).

2009-03-22 14:21  acastro

	* [r5096] src/hamiltonian/lasers.F90,
	  src/opt_control/check_input.F90, src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_global.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp: Corrected
	  outdated documentation, added some more, added comments to
	  make the code more readable. Also, reorganised a couple of things
	  in
	  order to make things more intuitive for the user/developer (all
	  this
	  refers exclusively to OCT stuff).

2009-03-23 07:38  marques

	* [r5097] src/grid/derivatives.F90: Forgot the block_end call. I am
	  really rusty ;))

2009-03-24 15:04  nitsche

	* [r5098] src/grid/io_function_inc.F90: * updated
	  X(output_function) to handle also non-domain parallelization
	  
	  Comment: "ParallelizationStrategy = par_kpoints" is NOT working
	  (e.g. try 01-free_electrons.01-ground_state.inp), with the
	  following commits I am trying to fix some of these issues. I
	  would be glad if someone could check my changings as I am not an
	  expert in MPI...

2009-03-24 15:26  nitsche

	* [r5099] src/grid/mesh_init.F90, src/states/restart.F90: *
	  mesh_init.F90: uninitialized pointers for parallelization,
	  splitted an if statement due to an uninitialized array
	  * restart.F90: uninitialized pointer, splitted if statement if
	  read error occurs, fixed problem in read_free_states with
	  parallelization in kpoints

2009-03-24 15:58  nitsche

	* [r5100] src/system/output_states.F90: * fixed some outputs
	  related to non-domain parallelization

2009-03-24 16:56  nitsche

	* [r5101] src/td/ob_rti.F90, src/td/td_write.F90: * fixed bugs
	  related to kpoints-parallelization

2009-03-24 20:41  acastro

	* [r5102] src/hamiltonian/epot.F90: Bug fix: when using
	  pseudopotential with core charge corrections, this
	  core-charge was "accumulated" every time the ionic potential was
	  computed. This was not a problem for single-point calculations,
	  since
	  this potential was computed only once. However, it was a problem
	  for
	  example for geometry-optimization runs (in fact, I found the bug
	  because it was reported as a problem with geometry optimization
	  in the
	  mailing list).
	  
	  Version 3.0.1 is also affected by this bug (I will correct it
	  also in
	  3.0.x branch, since it is somehow a "severe" bug), and I guess
	  that
	  also td runs were compromised, if the ions moved.

2009-03-24 20:50  acastro

	* [r5103] src/hamiltonian/epot.F90: Sorry, my previous bug-fix was
	  buggy.

2009-03-25 10:00  nitsche

	* [r5105] src/hamiltonian/epot.F90, src/td/td.F90: * fixes related
	  to kpoint-parallelization

2009-03-25 10:07  nitsche

	* [r5106] src/hamiltonian/hamiltonian_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90: * fixes related to
	  kpoint-parallelization

2009-03-25 10:35  nitsche

	* [r5107] src/hamiltonian/hamiltonian.F90, src/states/states.F90: *
	  again fixes issues due to kpoints-parallelization

2009-03-25 11:00  nitsche

	* [r5108] src/hamiltonian/gauge_field.F90,
	  src/states/excited_states_inc.F90: * removed useless loop
	  * fixes due to kpoints parallelization

2009-03-25 11:16  nitsche

	* [r5109] src/states/states_calc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/system/pert_inc.F90: *
	  fixed issues related to kpoint parallelization

2009-03-25 11:22  nitsche

	* [r5110] src/system/output_linear_response.F90,
	  src/td/pes_mask.F90, src/td/pes_rc.F90: * fixed kpoint
	  parallelization related stuff

2009-03-25 12:42  nitsche

	* [r5111] src/td/td_calc.F90: * fixed issue due to kpoint
	  parallelization

2009-03-25 14:26  nitsche

	* [r5112] src/hamiltonian/lasers.F90, src/td/td_init.F90: * fixed
	  problem in laser_write_info, dt and max_iter were always zero for
	  non optimal control.
	  
	  Alberto, could you check if it is still as you intended it to be?

2009-03-26 02:06  dstrubbe

	* [r5113] src/main/run.F90, src/states/states.F90,
	  src/system/v_ks.F90: *) Some tweaks to documentation and comments
	  *) Now real wavefunctions are used for a periodic system if the
	  k-sampling is gamma-point only

2009-03-26 05:11  xavier

	* [r5114] src/hamiltonian/epot.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/include/global.h,
	  src/main/gcm.F90, src/main/one_shot.F90, src/main/static_pol.F90,
	  src/main/unocc_inc.F90, src/opt_control/target.F90,
	  src/poisson/poisson.F90, src/poisson/poisson_multigrid.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/ground_state.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/states/elf.F90,
	  src/states/magnetic.F90, src/states/restart.F90,
	  src/states/states.F90, src/states/states_calc_inc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert_inc.F90,
	  src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90, src/system/v_ks.F90,
	  src/system/xc_OEP.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_x_inc.F90,
	  src/td/ob_rti.F90, src/td/td.F90, src/td/td_calc.F90,
	  src/td/td_rti.F90, src/td/td_write.F90, src/xc/axc.F90,
	  src/xc/vxc.F90: Removed the NP macro.

2009-03-26 09:11  xavier

	* [r5115] src/scf/eigen_lobpcg_inc.F90: Small cleaning of lobpcg.

2009-03-26 10:27  marques

	* [r5116] libxc/ChangeLog, libxc/Makefile.am, libxc/PACKAGING,
	  libxc/configure.ac, libxc/m4/acx.m4: Several details necessary to
	  package libxc.
	  *) There is now a PACKAGING file
	  *) FCCPP explanation now appears in ./configure --help
	  *) Automatic generation of ChangeLog file -- maybe it would be
	  better to
	  separate it per years, but I don't know how to do it well...

2009-03-26 14:45  nitsche

	* [r5118] src/scf/eigen.F90, src/states/restart.F90: *
	  eigensolver_run now works with k-point parallelization
	  * fixed issues within restart_write and restart_read (k-point
	  parallelization)

2009-03-26 16:39  nitsche

	* [r5119] src/basic/io.F90, src/basic/profiling.F90: * added some
	  missing pop_sub, cleanup

2009-03-26 16:42  nitsche

	* [r5120] src/grid/derivatives_inc.F90, src/grid/mesh_init.F90,
	  src/grid/par_vec_inc.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90,
	  src/main/casida.F90, src/opt_control/opt_control.F90,
	  src/poisson/poisson.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/lcao.F90, src/species/ps.F90, src/species/ps_hgh.F90,
	  src/states/mix_inc.F90, src/td/cpmd.F90, src/td/ob_mem.F90,
	  src/td/td.F90, src/td/td_write.F90: * added more missing pop_sub,
	  cleanup

2009-03-26 21:04  xavier

	* [r5121] src/scf/eigen_lobpcg_inc.F90: The LOBPCG solver was
	  broken for StateBlockSize smaller than the total
	  number of vectors, this fixes the problem.

2009-03-26 21:28  xavier

	* [r5122] src/states/states_block_inc.F90: Added profiling regions
	  to state_compactify and states_uncompactify.

2009-03-27 03:08  xavier

	* [r5123] src/grid/mesh_function_inc.F90,
	  src/states/states_block.F90, src/states/states_block_inc.F90: The
	  states_blockt_mul routine now uses mf_dotp_batch instead of blas
	  for the multiplication (this is faster since the copies are
	  avoided).

2009-03-27 05:26  xavier

	* [r5124] src/scf/eigen_lobpcg_inc.F90, src/scf/subspace_inc.F90,
	  src/states/states_calc_inc.F90: * Improved the interface for
	  states_linear_combination.
	  * Replaced a blas abuse by a forall loop.

2009-03-27 10:31  xavier

	* [r5125] src/scf/eigen_lobpcg.F90, src/scf/eigen_lobpcg_inc.F90: *
	  Added a progress bar to the lobpcg eigensolver.

2009-03-27 11:12  nitsche

	* [r5126] src/basic/distributed.F90, src/ions/simul_box.F90,
	  src/math/tdfunction.F90, src/states/states.F90: * fixed some
	  missing pop_sub()
	  * ierr was not initialized in td_function which was the case when
	  function_name is not found inside a block
	  * distributed_nullify was not setting the default values in
	  mpi_grp, which triggered a bug when using different
	  parallelization strategies in successive runs

2009-03-27 12:55  nitsche

	* [r5127] src/states/restart.F90: * fixed problems of loading
	  restart information for open boundaries when in parallel mode

2009-03-27 22:18  dstrubbe

	* [r5128] testsuite/linear_response/02-h2o_pol_lr.test: Changed
	  slightly the results of the hyperpolarizability test to reflect
	  the new values from Miguel's new analytic version of the LDA Kxc
	  kernel.

2009-03-30 18:05  acastro

	* [r5129] src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90: Removed some duplicated
	  variables, which were causing some
	  trouble. Also, removed the option of phase-and-envelope
	  optimization,
	  which was not coded properly. Eventually it should be put back.

2009-03-31 09:09  marques

	* [r5131] libxc/AUTHORS, libxc/NEWS, libxc/README,
	  libxc/src/lda_x.c: Little corrections to some stupid files

2009-03-31 09:29  marques

	* [r5133] libxc/ChangeLog, libxc/Makefile.am,
	  libxc/src/Makefile.am: A couple more fixes to the make
	  environment

2009-03-31 12:56  marques

	* [r5134] doc/html/vars/Makefile.am, src/basic/loct.F90,
	  src/basic/loct_inc.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/states/Makefile.am,
	  src/states/states.F90, src/system/preconditioners.F90,
	  src/td/td_write.F90: *) Fixed all errors reported by valgrind for
	  the morse test. This included a couple of
	  uninitialized variables and some memory leaks in states_copy
	  *) Fixed dependencies to be able to do make -j4

2009-03-31 13:18  marques

	* [r5135] src/basic/loct.F90, src/basic/loct_inc.F90,
	  src/hamiltonian/hamiltonian.F90, src/hamiltonian/lasers_inc.F90,
	  src/states/states.F90, src/td/td_write.F90: *) got rid of my
	  recently introduced loct_pointer_nullify, as the macro DEALLOC
	  does the same
	  *) fixed memory leak in hartree_fock calculations

2009-03-31 13:33  marques

	* [r5136] src/td/td.F90, src/td/td_write.F90: Removed record_length
	  from writing of gauge field. It works fine with my gfortran.
	  Xavier, please
	  check if it breaks something...

2009-04-01 09:06  acastro

	* [r5137] src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90: Changed a little how the
	  parametrization of the control functions is
	  done. Also, added more comments and documentation.

2009-04-01 10:18  nitsche

	* [r5138] src/hamiltonian/hamiltonian.F90,
	  src/states/states_calc_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90, src/td/td.F90: * fixed problem in
	  states_calc_inc.F90 when compiling with MPI
	  * numerous fixes in order to get transport working in parallel
	  
	  The propagation itself now works in parallel. The calculation of
	  the green functions is still only done by the root node.

2009-04-01 13:40  xavier

	* [r5139] src/grid/Makefile.am, src/grid/cubic_mesh.F90,
	  src/grid/cubic_mesh.h, src/grid/cubic_mesh_fft.c,
	  src/grid/cubic_mesh_low.c: Added a file for fourier space
	  routines of cubic_mesh.

2009-04-01 23:55  acastro

	* [r5140] src/td/ob_rti.F90: Just one little problem with the 132
	  column length limit in some
	  compilers (gfortran, in my case).

2009-04-02 12:30  nitsche

	* [r5141] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/ob_lead.F90, src/scf/ground_state.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/states/Makefile.am,
	  src/states/ob_green.F90, src/states/states.F90: * the green
	  function calculation (for Lippmann-Schwinger) is now parallel

2009-04-02 12:44  nitsche

	* [r5142] src/states/states.F90: * bugfix for the last commit of me

2009-04-02 14:41  xavier

	* [r5143] src/grid/Makefile.am, src/sternheimer/em_resp.F90,
	  src/sternheimer/sternheimer_inc.F90: * When the system is
	  periodic, the r perturbation in Sternheimer is
	  now calculated as i d/dk. This makes the polarizability position
	  independent.
	  
	  * A build dependency was missing.

2009-04-03 05:03  xavier

	* [r5144] src/td/td_rti.F90: Parallelization in K points of the
	  time propagation.

2009-04-03 08:10  acastro

	* [r5145] src/opt_control/parameters.F90,
	  testsuite/optimal_control/04-box.test: Fix of a (small) bug in
	  the OCT part: when optimizing with fixed
	  fluence, the code was not using the fluence of the laser field
	  specified in the input file, but rather doing some
	  transformations on
	  this, and then computing the fluence. I had to change one test
	  value.

2009-04-03 09:33  xavier

	* [r5146] src/basic/profiling.F90: Memory profiling is now enable
	  separately of time profiling.

2009-04-03 12:34  xavier

	* [r5147] src/hamiltonian/hamiltonian_inc.F90: Phases for the k
	  points are now applied by blocks.

2009-04-03 12:39  xavier

	* [r5148] src/hamiltonian/hamiltonian_inc.F90: Some lines in my
	  last commit were too long.

2009-04-03 14:30  xavier

	* [r5149] src/sternheimer/kdotp.F90: Bugfix: out of bounds access
	  in kdotp.

2009-04-04 18:12  acastro

	* [r5150] src/opt_control/iter.F90, src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90: Solved some memory leaks
	  detected by valgrind.

2009-04-04 18:54  dstrubbe

	* [r5151] src/sternheimer/em_resp.F90: Missing variable
	  initialization added. Thanks to Tobias for catching this.

2009-04-05 15:23  xavier

	* [r5152] src/hamiltonian/epot.F90: The calculation of the dipole
	  for periodic systems didn't work for
	  real wave-functions. David, can you check my changes?

2009-04-05 16:31  xavier

	* [r5153] src/basic/io.F90, src/math/filters.F90,
	  testsuite/real_time/01-etrs.01-gs.inp,
	  testsuite/real_time/01-etrs.02-td.inp,
	  testsuite/real_time/01-etrs.03-td_lanczos.inp,
	  testsuite/real_time/01-etrs.test,
	  testsuite/real_time/02-aetrs.01-gs.inp,
	  testsuite/real_time/02-aetrs.02-td.inp,
	  testsuite/real_time/02-aetrs.03-td_lanczos.inp,
	  testsuite/real_time/02-aetrs.test,
	  testsuite/real_time/03-exp_mid.01-gs.inp,
	  testsuite/real_time/03-exp_mid.02-td.inp,
	  testsuite/real_time/03-exp_mid.test,
	  testsuite/real_time/05-cpmd.01-gs.inp,
	  testsuite/real_time/05-cpmd.02-verlet.inp,
	  testsuite/real_time/05-cpmd.03-vel_verlet.inp,
	  testsuite/real_time/05-cpmd.test,
	  testsuite/real_time/07-visscher.01-gs.inp,
	  testsuite/real_time/07-visscher.02-td.inp,
	  testsuite/real_time/07-visscher.test: Enabled pseudopotential
	  filtering in several tests.

2009-04-05 16:35  xavier

	* [r5154] src/basic/io.F90, src/math/filters.F90: Commited this
	  changes by mistake.

2009-04-05 18:42  dstrubbe

	* [r5155] src/hamiltonian/epot.F90: Thanks Xavier for noticing the
	  problem with the single-point Berry's phase calculation when we
	  have real wavefunctions. Your fix made only diagonal elements be
	  calculated though; now it is corrected.

2009-04-05 22:05  acastro

	* [r5156] src/math/splines.F90, src/math/tdfunction.F90,
	  src/opt_control/check_input.F90, src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp: Added the
	  option of representing a control function (for the OCT part)
	  as a Fourier series, but without the constrain of keeping a fixed
	  fluence (up to now one could represent it as a Fourier series,
	  but
	  always doing a fixed-fluence search).

2009-04-05 22:28  acastro

	* [r5157] src/hamiltonian/epot.F90: There was one extra parenthesis
	  that prevented the compilation.

2009-04-06 07:10  xavier

	* [r5158] src/species/ps.F90: HGH pseudopotentials set the l of the
	  local component to -1, this
	  caused the filtering to fail. So I changed l_loc to 0, But I am
	  not
	  sure if this correct or not.

2009-04-06 13:16  xavier

	* [r5159] src/species/ps.F90: My previous commit was wrong. Wow
	  l_loc = 0 is only used in HGH for
	  the filtering of the local part.

2009-04-06 15:49  xavier

	* [r5160] src/scf/eigen_rmmdiis_inc.F90: I started to reimplement
	  the diis solver based on the vasp paper.

2009-04-06 16:32  nitsche

	* [r5161] src/grid/ob_interface.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/states/restart.F90, src/states/states.F90,
	  src/system/output_states.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90: * corrected the (huge) overhead for open
	  boundaries due to the gs periodic run, now the speed of the
	  previous version is reached
	  * bug in h_sys_output_current_flow (k-points and states
	  parallelization)
	  * info for lead potentials can now show longer formulas
	  * corrected push_sub call (wrong name)

2009-04-06 16:47  xavier

	* [r5162] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90: * The
	  DIIS iteration now ends with a trial move.
	  * The default number of iterations is now 3 (the recommended
	  value).

2009-04-07 09:56  xavier

	* [r5163] src/hamiltonian/species_pot.F90, src/math/filters.F90,
	  src/species/ps.F90: Now atomic orbitals are also passed by
	  filter, this improves a bit the
	  quality of the LCAO.

2009-04-08 10:02  xavier

	* [r5164] src/opt_control/parameters.F90: OCT runs fail with g95,
	  it seems that this is caused by a compiler
	  bug. Now octopus stops with an error in this case.

2009-04-08 12:14  xavier

	* [r5165] src/hamiltonian/species_pot.F90, src/math/filters.F90,
	  src/species/ps.F90: I remove the filtering of atomic orbitals, I
	  will put it back after
	  releasing.

2009-04-08 12:36  xavier

	* [r5166] src/ions/vibrations.F90,
	  testsuite/linear_response/04-vib_modes.test: The output of the
	  vibrational modes test did not have a fixed format,
	  this caused the test to fail for some compilers.

2009-04-08 13:12  xavier

	* [r5167] testsuite/linear_response/03-vdw_sternheimer.test:
	  Updated the value for the VdW tests, now it is passed by the four
	  compilers I tried. The difference was quite small (0.0002).

2009-04-08 13:16  marques

	* [r5168] src/basic/loct_inc.F90, src/grid/derivatives.F90,
	  src/grid/nl_operator.F90, src/grid/stencil.F90: Fixed the long
	  standing memory leak when running with curvilinear coordinates.
	  Please be very careful next time you use _copy routines!!!!
	  
	  -This line, and those below, will be ignored--
	  
	  M src/basic/loct_inc.F90
	  M src/grid/derivatives.F90
	  M src/grid/stencil.F90
	  M src/grid/nl_operator.F90

2009-04-08 14:30  marques

	* [r5169] src/main/casida.F90: I belive that I fixed a couple of
	  memory leaks in casida. I am not sure, that I caught them all and
	  that I did not introduce further bugs. Let's wait for buildbot...

2009-04-08 14:53  marques

	* [r5170] src/states/linear_response.F90, src/sternheimer/vdW.F90:
	  Now the memory leaks in vdW were corrected. There is a bit of a
	  problem with the DEALLOC macro that only works for pointers. I
	  think we should have a macro for pointers and another for
	  allocatable arrays. I will think about it after the release...

2009-04-08 14:59  mjv500

	* [r5171] src/ions/crystal.F90: output format bugs for MAXDIM not 3

2009-04-08 15:01  mjv500

	* [r5172] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/states/density_matrix.F90: 4D output improvements

2009-04-08 15:15  marques

	* [r5173] src/basic/oct_f.c, src/grid/index.F90,
	  src/grid/mesh_function_inc.F90, src/ions/crystal.F90,
	  src/ions/simul_box.F90, src/math/root_solver.F90: Some compiler
	  warnings fixed

2009-04-09 18:19  xavier

	* [r5174] src/scf/lcao.F90, src/scf/lcao_inc.F90: Parallelization
	  in k points of LCAO: the eigenvalues are now
	  allgathered.

2009-04-09 18:32  xavier

	* [r5175] src/states/ksinversion.F90: Removed a ' from comments.

2009-04-09 18:37  micael

	* [r5176] liboct_parser/Makefile.am: string_f.h was not included in
	  the distribution, although I'm not sure this is the correct way
	  of fixing it.

2009-04-09 18:41  micael

	* [r5177] liboct_parser/Makefile.am: Wrong filename...

2009-04-09 22:05  xavier

	* [r5178] src/basic/units.F90, src/ions/ion_interaction.F90,
	  src/ions/simul_box.F90, src/ions/solids.F90,
	  src/opt_control/parameters.F90, src/species/atomic.F90,
	  src/species/ps_hgh.F90, src/species/ps_psf.F90,
	  src/utils/phonon_spectrum.F90: Tobias' patch: several literals
	  were defined without the proper
	  precision.

2009-04-10 06:13  xavier

	* [r5179] src/scf/scf.F90: K point parallelization: Angular
	  momentum information is now
	  allgathered.

2009-04-10 06:36  xavier

	* [r5180] src/states/states_calc_inc.F90: Bugfix: static arrays
	  should have dimensions known at compilation
	  time.
	  
	  Please be careful with this.

2009-04-10 07:02  xavier

	* [r5181] src/states/states_calc_inc.F90: Parallelization in k
	  points: now momemtum is allgathered.

2009-04-10 07:17  xavier

	* [r5182] src/basic/calc_mode.F90: Restricted parallelization modes
	  for the release: only the ground
	  state is parallelizable in k points (the rest hasn't been tested)
	  and
	  only the time propagation is parallel in states.

2009-04-10 12:40  acastro

	* [r5183] src/grid/hypercube.F90, src/grid/index.F90: Bug fix: for
	  lower dimensional cases, the functions were not printed
	  properly by the "output_function" routines, because of an
	  intent(out)
	  argument that was not set to zero as it should.

2009-04-10 12:49  xavier

	* [r5184] src/basic/messages.F90, src/scf/eigen.F90, src/td/td.F90,
	  testsuite/finite_systems_3d/20-eigensolver.06-rmmdiis.inp,
	  testsuite/periodic_systems/05-lithium.02-td.inp,
	  testsuite/periodic_systems/05-lithium.03-td-restart.inp: * Added
	  the function messages_devel_version to mark code that should
	  be used only in development mode.
	  
	  * Restricted time propagation for solids to development mode.
	  
	  * Restricted the rmmdiis eigensolver to development mode.

2009-04-10 15:06  xavier

	* [r5185] testsuite/finite_systems_3d/24-o2-spin.01-gs.inp,
	  testsuite/finite_systems_3d/24-o2-spin.test,
	  testsuite/finite_systems_3d/Makefile.am: Added a test for
	  parallelization over spin.

2009-04-11 07:26  xavier

	* [r5186] testsuite/finite_systems_1d/01-hydrogen.test,
	  testsuite/finite_systems_1d/02-neon_mpi.test,
	  testsuite/finite_systems_1d/09-morse.test,
	  testsuite/finite_systems_2d/01-quadratic_box.test,
	  testsuite/finite_systems_2d/02-fock-darwin.test,
	  testsuite/finite_systems_2d/03-helium_atom.test,
	  testsuite/finite_systems_2d/04-biot_savart.test,
	  testsuite/finite_systems_2d/05-spin_precession.test,
	  testsuite/finite_systems_2d/06-tdmagnetic.test,
	  testsuite/finite_systems_2d/07-hartree_fock.test,
	  testsuite/finite_systems_3d/01-carbon_atom.test,
	  testsuite/finite_systems_3d/02-curvlinear_coordinates.test,
	  testsuite/finite_systems_3d/03-functionals.test,
	  testsuite/finite_systems_3d/04-jellium.test,
	  testsuite/finite_systems_3d/05-multigrid_solver.test,
	  testsuite/finite_systems_3d/06-restart.test,
	  testsuite/finite_systems_3d/07-spin_orbit_coupling.test,
	  testsuite/finite_systems_3d/08-spin_orbit_coupling_full.test,
	  testsuite/finite_systems_3d/09-spinors.test,
	  testsuite/finite_systems_3d/11-sic.test,
	  testsuite/finite_systems_3d/12-forces.test,
	  testsuite/finite_systems_3d/13-full_potential_hydrogen.test,
	  testsuite/finite_systems_3d/15-hartree.test,
	  testsuite/finite_systems_3d/16-isf_solver.test,
	  testsuite/finite_systems_3d/18-current.test,
	  testsuite/finite_systems_3d/19-laser.test,
	  testsuite/finite_systems_3d/20-eigensolver.test,
	  testsuite/finite_systems_3d/21-lobpcg.test,
	  testsuite/finite_systems_3d/22-time_propagation.test,
	  testsuite/finite_systems_3d/23-go-na2.test,
	  testsuite/linear_response/01-casida.test,
	  testsuite/linear_response/02-h2o_pol_lr.test,
	  testsuite/linear_response/03-vdw_sternheimer.test,
	  testsuite/linear_response/04-vib_modes.test,
	  testsuite/linear_response/05-polarizability.test,
	  testsuite/oct-run_regression_test.pl,
	  testsuite/open_systems/01-wavepacket.test,
	  testsuite/open_systems/02-wavepacket_2d.test,
	  testsuite/open_systems/03-extended_eigenstate.test,
	  testsuite/open_systems/04-propagate_eigenstate.test,
	  testsuite/optimal_control/01-asym_doublewell.test,
	  testsuite/optimal_control/02-sym_doublewell.test,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/05-adw.test,
	  testsuite/optimal_control/06-zbr98.test,
	  testsuite/periodic_systems/01-free_electrons.test,
	  testsuite/periodic_systems/02-cosine_potential.test,
	  testsuite/periodic_systems/03-sodium_chain.test,
	  testsuite/periodic_systems/04-silicon.test,
	  testsuite/periodic_systems/05-lithium.test,
	  testsuite/real_time/01-etrs.test,
	  testsuite/real_time/02-aetrs.test,
	  testsuite/real_time/03-exp_mid.test,
	  testsuite/real_time/04-etrs_single.test,
	  testsuite/real_time/05-cpmd.test,
	  testsuite/real_time/07-visscher.test: The test files had several
	  fields that are not used so I removed them
	  (many of these fields were outdated anyway).

2009-04-11 07:39  xavier

	* [r5187] testsuite/periodic_systems/05-lithium.01-gs.inp,
	  testsuite/periodic_systems/05-lithium.test: Enabled k point
	  parallelization of the lithium test.

2009-04-11 08:03  xavier

	* [r5188] src/sternheimer/sternheimer.F90: Restricted Sternheimer
	  for periodic system to development version.

2009-04-11 09:51  xavier

	* [r5189] src/grid/curvlinear.F90, src/grid/double_grid.F90,
	  src/grid/double_grid_apply.F90, src/grid/nl_operator.F90,
	  src/system/v_ks.F90, src/system/xc_OEP.F90: Replaced all checks
	  for conf%devel_version by calls to
	  messages_devel_version.

2009-04-11 15:12  xavier

	* [r5190] src/sternheimer/sternheimer.F90: Preorthogonalization is
	  only enabled if semiconductor smearing is
	  used. This fixes the polarizability test.

2009-04-11 15:32  xavier

	* [r5191] src/system/preconditioners.F90: Sometimes the filter
	  preconditioner gives problems for periodic
	  systems, so it is now disabled in that case.

2009-04-11 15:54  xavier

	* [r5192]
	  testsuite/finite_systems_3d/01-carbon_atom.03-ground_state_double_grid.inp:
	  This test has to run as DevelVersion.

2009-04-11 16:02  xavier

	* [r5193] src/ions/ion_dynamics.F90: Restricted the (half
	  implemented) Nose-Hoover thermostat to the
	  development version.

2009-04-11 16:52  xavier

	* [r5194] src/grid/mesh_function_inc.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  Bugfix: the Biot Savart test did not work in parallel.

2009-04-12 05:20  dstrubbe

	* [r5195] src/sternheimer/em_resp.F90: *) Previous formulation of
	  hyper-Rayleigh scattering (HRS) hyperpolarizabilities implicitly
	  assumed Kleinman symmetry (permutation of indices). Now I have
	  generalized the equations, as is needed for the non-static case.
	  *) HRS hyperpolarizability is now properly computed as a complex
	  number rather than a real number, since it can be complex when
	  omega or eta is nonzero.
	  *) Noted that these HRS hyperpolarizabilities apply only to the
	  liquid or gas phase, where there is no long-range order so
	  orientations are uncorrelated and isotropic. In a crystal, the
	  tensor components of beta would be used directly to study HRS.

2009-04-12 08:27  acastro

	* [r5196] src/opt_control/propagation.F90, src/system/v_ks.F90,
	  src/td/td_rti.F90: A few details:
	  o Eliminated one long-standing memory leak that
	  appeared in OCT runs.
	  o One line was too long for compiler for compilers restricted
	  with the 132 columns rule.
	  o One uninitialized variable.

2009-04-12 20:03  dstrubbe

	* [r5197] src/sternheimer/em_resp.F90: *) Reorganized subroutines
	  in em_resp to undo an unnecessary change I made a while ago
	  *) Hyperpolarizability beta file was being written for the
	  frequency corresponding to each factor, which is misleading since
	  it only corresponds to one frequency, and could also cause extra
	  confusion by overwriting previous beta files in a calculation
	  with multiple frequencies. Now it is written only for the first
	  factor, and the documentation says so.
	  *) The wavefunctions and circular dichroism files were being
	  written to a directory labelled by the frequency (without the
	  factors), which is incorrect since they are actually calculated
	  for the frequency times the factors. Now they are written for
	  each factor in the appropriate directories.

2009-04-12 21:51  dstrubbe

	* [r5198] src/main/main.F90, src/opt_control/target.F90,
	  src/scf/scf.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90: *) Noted in documentation runs that
	  are development-only.
	  *) Added variable to enable calculation of Born charges, so that
	  this can be marked development-only.
	  *) Broke up a line that was too long and preventing compilation
	  in some builds
	  *) Marked kdotp run as development-only: I am pretty confident
	  about the k.p wavefunctions, but the effective masses have some
	  problems, and k.p is only useful for periodic em_resp which is
	  development-only anyway.
	  *) Added geometry to output_function calls in opt_control/target
	  so that XCrySDen output format can be used.
	  *) Explained warning on single-point Berry's phase for multiple
	  k-points more.

2009-04-13 07:25  xavier

	* [r5199] testsuite/linear_response/01-casida.test: Enabled the
	  casida test in parallel.

2009-04-13 08:26  xavier

	* [r5200] src/grid/io_function_inc.F90,
	  src/grid/mesh_function_inc.F90, src/hamiltonian/hamiltonian.F90,
	  src/ions/simul_box.F90, src/main/casida.F90,
	  src/poisson/poisson_cutoffs.c, src/scf/eigen.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/states/density_matrix.F90,
	  src/states/ksinversion.F90, src/states/restart.F90,
	  src/states/states.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/system/v_ks.F90,
	  src/td/ob_rti.F90, src/utils/harmonic_spectrum.F90: Removed
	  several unused variables.

2009-04-13 09:02  xavier

	* [r5201] src/ions/simul_box.F90, src/main/gcm.F90,
	  src/main/main.F90, src/sternheimer/raman.F90: Restricted some
	  parts to developmente version:
	  
	  * Open boundaries
	  * Raman
	  * GCM

2009-04-13 22:25  xavier

	* [r5202] libxc/Makefile.am, share/Makefile.am: This fixes the
	  problem with make distcheck.

2009-04-13 22:35  xavier

	* [r5203] src/scf/lcao_inc.F90: A line was too long.

2009-04-14 07:41  marques

	* [r5204] share/Makefile.am: Xavier, your change deleted some
	  distributed files when performing make distcheck. This should
	  correct it.

2009-04-14 08:25  marques

	* [r5205] share/Makefile.am: Another try at the distcheck problem

2009-04-14 09:49  xavier

	* [r5206] src/hamiltonian/ob_lead.F90: Bugfix: A non-initialized
	  variable.

2009-04-14 10:22  xavier

	* [r5207] src/species/atomic.F90, src/species/ps_psf.F90,
	  src/td/ob_rti.F90: Fixed some compiler warnings.

2009-04-14 13:12  xavier

	* [r5208] ChangeLog, Makefile.am, PACKAGING, doc/ChangeLog.2001.gz,
	  doc/ChangeLog.2002.gz, doc/ChangeLog.2003.gz,
	  doc/ChangeLog.2004.gz, doc/ChangeLog.2005.gz,
	  doc/ChangeLog.2006.gz, doc/ChangeLog.2007.gz,
	  doc/ChangeLog.2008.gz, doc/Makefile.am: Added ChangeLog and
	  PACKAGING files.

2009-04-14 13:32  xavier

	* [r5209] src/opt_control/opt_control.F90, src/scf/scf.F90,
	  testsuite/optimal_control/01-asym_doublewell.01-ground_state.inp,
	  testsuite/optimal_control/01-asym_doublewell.02-oct_run.inp,
	  testsuite/optimal_control/01-asym_doublewell.03-oct_run.inp,
	  testsuite/optimal_control/02-sym_doublewell.01-ground_state.inp,
	  testsuite/optimal_control/02-sym_doublewell.02-unocc.inp,
	  testsuite/optimal_control/02-sym_doublewell.03-oct.inp,
	  testsuite/optimal_control/03-localtarget.01-gs.inp,
	  testsuite/optimal_control/03-localtarget.02-oct.inp,
	  testsuite/optimal_control/03-localtarget.03-gs-mp.inp,
	  testsuite/optimal_control/03-localtarget.04-oct-mp.inp,
	  testsuite/optimal_control/04-box.01-ground_state.inp,
	  testsuite/optimal_control/04-box.02-oct_long.inp,
	  testsuite/optimal_control/04-box.03-oct_long.inp,
	  testsuite/optimal_control/04-box.04-oct_long.inp,
	  testsuite/optimal_control/04-box.05-oct_long.inp,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp,
	  testsuite/optimal_control/05-adw.01-ground_state.inp,
	  testsuite/optimal_control/05-adw.02-filter_fixed.inp,
	  testsuite/optimal_control/05-adw.03-filter_indirect.inp,
	  testsuite/optimal_control/06-zbr98.01-ground_state.inp,
	  testsuite/optimal_control/06-zbr98.02-oct.inp: * Added a warning
	  about angular momentum and non-local pseudos.
	  * Put optimal control as DevelVersion (it gives problems with
	  some
	  compilers).

2009-04-14 13:45  xavier

	* [r5210] debian/control, debian/rules: Updated the debian scripts.

2009-04-14 13:48  xavier

	* [r5211] configure.ac, debian/changelog: * Changed version to
	  3.1.0.

2009-04-14 14:37  xavier

	* [r5213] share/Makefile.am: Bugfix: some files in share/ were not
	  copied to the build directory.

2009-04-14 15:18  marques

	* [r5216] src/basic/distributed.F90, src/basic/loct_inc.F90,
	  src/basic/mpi_lib_inc.F90, src/basic/multicomm.F90,
	  src/basic/profiling.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/nl_operator.F90,
	  src/grid/stencil.F90, src/hamiltonian/epot.F90,
	  src/hamiltonian/hamiltonian.F90, src/include/global.h,
	  src/main/casida.F90, src/states/linear_response.F90,
	  src/states/states.F90, src/td/ob_mem.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90, src/td/td_write.F90: Started building a more
	  comprehensive memory profiling system

2009-04-14 16:01  xavier

	* [r5217] src/include/global.h: Fixes the problem with deallocation
	  macros.

2009-04-14 17:54  xavier

	* [r5218] src/basic/mpi_lib_inc.F90: Fixes compilation in parallel.

2009-04-14 19:39  xavier

	* [r5219] src/basic/multicomm.F90: Bugfix: xlf returns 1 as number
	  of threads inside omp master.

2009-04-14 21:53  xavier

	* [r5221] src/basic/multicomm.F90: My last commit was wrong, it was
	  a problem with libraries.

2009-04-14 22:02  acastro

	* [r5222] src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_global.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90:
	  Added the usual conjugate gradients method as an optimization
	  algorithm for QOCT.

2009-04-14 23:36  acastro

	* [r5223] src/hamiltonian/hamiltonian.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/td/td_rti.F90: QOCT with time-dependent targets was not
	  working, since I don't know
	  when. I have put it back to work (I think), although some more
	  testing
	  is needed.
	  
	  In order to make it work, I added the option of using
	  Crank-Nicholson
	  as time propagator, without using the SPARSKIT package to solve
	  the
	  linear system -- instead I use the QMR solver. The reason is (1)
	  that
	  I was finding this latter option very slow, and (2) it would be
	  nice
	  to have Crank-Nicholson without depending on SPARSKIT anyway.
	  
	  For open-boundaries calculations (transport), the Crank-Nicholson
	  with
	  the QMR solver is used also. It would be nice to unify the two
	  procedures.

2009-04-15 12:44  mjv500

	* [r5224] src/grid/derivatives.F90, src/states/Makefile.am,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/system/output_states.F90, src/system/system.F90: derivatives
	  now use modelMB structure masses

2009-04-15 12:48  mjv500

	* [r5225] src/states/density_matrix.F90,
	  src/system/output_states.F90: removed argument for
	  write_density_matrix

2009-04-15 13:10  marques

	* [r5226] src/grid/basins.F90, src/grid/batch.F90,
	  src/grid/cube_function_inc.F90, src/grid/curv_modine.F90,
	  src/grid/curvlinear.F90, src/grid/derivatives.F90,
	  src/grid/derivatives_inc.F90, src/grid/double_grid.F90,
	  src/grid/double_grid_apply.F90, src/grid/fourier_space_inc.F90,
	  src/grid/grid.F90, src/grid/gridhier_inc.F90,
	  src/grid/hypercube.F90, src/grid/io_function_inc.F90,
	  src/grid/mesh.F90, src/grid/mesh_function_inc.F90,
	  src/grid/mesh_init.F90, src/grid/multigrid.F90,
	  src/grid/nl_operator.F90, src/grid/ob_interface.F90,
	  src/grid/par_vec.F90, src/grid/par_vec_inc.F90,
	  src/grid/scalar_mesh.F90, src/grid/stencil_star.F90,
	  src/grid/stencil_variational.F90, src/grid/submesh.F90,
	  src/grid/submesh_inc.F90, src/hamiltonian/em_field.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/hgh_projector.F90,
	  src/hamiltonian/hgh_projector_inc.F90,
	  src/hamiltonian/kb_projector.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/lasers_inc.F90, src/hamiltonian/ob_lead.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/rkb_projector.F90,
	  src/hamiltonian/species_pot.F90, src/ions/geometry.F90,
	  src/ions/ion_dynamics.F90, src/ions/simul_box.F90,
	  src/ions/symmetries.F90, src/ions/vibrations.F90,
	  src/ions/xyz_file.F90, src/main/casida.F90,
	  src/main/casida_inc.F90, src/main/gcm.F90, src/main/geom_opt.F90,
	  src/main/one_shot.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/math/fftw3.F90,
	  src/math/lalg_adv_lapack.F90, src/math/math.F90,
	  src/math/math_inc.F90, src/math/ode_solver_inc.F90,
	  src/math/root_solver.F90, src/math/root_solver_inc.F90,
	  src/math/solvers_inc.F90, src/math/sparskit_inc.F90,
	  src/math/splines.F90, src/math/tdfunction.F90,
	  src/opt_control/filters.F90, src/opt_control/initst.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/poisson/poisson.F90, src/poisson/poisson_cg.F90,
	  src/poisson/poisson_corrections.F90, src/poisson/poisson_fft.F90,
	  src/poisson/poisson_isf.F90, src/poisson/poisson_multigrid.F90,
	  src/poisson/solver_1D.F90, src/poisson/solver_2D.F90,
	  src/scf/eigen.F90, src/scf/eigen_cg_inc.F90,
	  src/scf/eigen_evolution_inc.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/lcao.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/species/atomic.F90,
	  src/species/logrid.F90, src/species/ps.F90,
	  src/species/ps_cpi.F90, src/species/ps_cpi_file.F90,
	  src/species/ps_fhi.F90, src/species/ps_hgh.F90,
	  src/species/ps_in_grid.F90, src/species/ps_psf.F90,
	  src/species/ps_psf_file.F90, src/species/ps_upf.F90,
	  src/species/species.F90, src/states/density_matrix.F90,
	  src/states/elf.F90, src/states/excited_states.F90,
	  src/states/excited_states_inc.F90, src/states/ksinversion.F90,
	  src/states/linear_response_inc.F90, src/states/magnetic.F90,
	  src/states/mix.F90, src/states/mix_inc.F90,
	  src/states/modelmb_particles.F90, src/states/ob_green.F90,
	  src/states/restart.F90, src/states/smear.F90,
	  src/states/states.F90, src/states/states_block_inc.F90,
	  src/states/states_calc.F90, src/states/states_calc_inc.F90,
	  src/states/states_dim.F90, src/states/states_kpoints.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/system/energy_inc.F90, src/system/exponential.F90,
	  src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h.F90,
	  src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert.F90,
	  src/system/pert_inc.F90, src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90, src/system/system.F90,
	  src/system/v_ks.F90, src/system/xc_KLI_inc.F90,
	  src/system/xc_OEP.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/system/xc_OEP_x_inc.F90, src/td/cpmd.F90,
	  src/td/cpmd_inc.F90, src/td/ob_mem.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90, src/td/pes_mask.F90, src/td/pes_rc.F90,
	  src/td/spectrum.F90, src/td/td.F90, src/td/td_calc.F90,
	  src/td/td_rti.F90, src/td/td_write.F90, src/utils/broad.F90,
	  src/utils/dielectric_function.F90,
	  src/utils/oscillator_strength.F90, src/utils/phonon_spectrum.F90,
	  src/xc/axc.F90, src/xc/fxc.F90, src/xc/kxc.F90, src/xc/vxc.F90:
	  Replaced all deallocates by safe versions

2009-04-15 13:18  mjv500

	* [r5227] src/states/modelmb_particles.F90: fixed default modelMB
	  values

2009-04-15 13:23  marques

	* [r5228] src/system/exponential_split.F90: I hope this fixes the
	  compilation problem with buildbot

2009-04-15 13:50  marques

	* [r5229] src/system/exponential_split.F90: Forgot this one...

2009-04-15 13:52  marques

	* [r5230] src/basic/profiling.F90, src/basic/string.F90,
	  src/include/global.h: I have to leave, but Xavier promised to
	  clean this tuff ;)

2009-04-15 14:17  xavier

	* [r5231] src/td/ob_rti.F90: This should fix compilation with g95.

2009-04-15 14:56  xavier

	* [r5232] src/basic/profiling.F90, src/grid/scalar_mesh.F90,
	  src/include/global.h: * Now profiling_space is used to call
	  memory profiling functions.
	  * Scalar mesh did not use profiling_m.

2009-04-15 15:07  mjv500

	* [r5233] .: make svn ignore bin directory

2009-04-15 15:56  xavier

	* [r5234] src/basic/profiling.F90: Improved the memory profiling
	  output.

2009-04-15 16:09  xavier

	* [r5235] src/basic/profiling.F90: Added a mode of full memory
	  profiling.

2009-04-15 16:16  acastro

	* [r5236] src/grid/io_function_inc.F90, src/math/sparskit_inc.F90:
	  A couple of SAFE_DEALLOCATE issues that prevented compilation.

2009-04-15 16:22  acastro

	* [r5237] src/opt_control/opt_control.F90, src/td/td_rti.F90: Some
	  more SAFE_DEALLOCATE problems when compiling.

2009-04-15 16:44  acastro

	* [r5238]
	  testsuite/optimal_control/01-asym_doublewell.01-ground_state.inp,
	  testsuite/optimal_control/01-asym_doublewell.02-oct_run.inp,
	  testsuite/optimal_control/01-asym_doublewell.03-oct_run.inp,
	  testsuite/optimal_control/01-asym_doublewell.test,
	  testsuite/optimal_control/02-sym_doublewell.03-oct.inp,
	  testsuite/optimal_control/02-sym_doublewell.test,
	  testsuite/optimal_control/03-localtarget.01-gs.inp,
	  testsuite/optimal_control/03-localtarget.02-oct.inp,
	  testsuite/optimal_control/03-localtarget.04-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/04-box.02-oct_long.inp,
	  testsuite/optimal_control/04-box.03-oct_long.inp,
	  testsuite/optimal_control/04-box.04-oct_long.inp,
	  testsuite/optimal_control/04-box.05-oct_long.inp,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/05-adw.01-ground_state.inp,
	  testsuite/optimal_control/05-adw.02-filter_fixed.inp,
	  testsuite/optimal_control/05-adw.03-filter_indirect.inp,
	  testsuite/optimal_control/05-adw.test,
	  testsuite/optimal_control/06-zbr98.test: Small modifications to
	  the QOCT tests input files, so that they run
	  much faster.

2009-04-15 20:00  xavier

	* [r5239] src/grid/Makefile.am, src/grid/curvilinear.F90,
	  src/grid/curvlinear.F90, src/grid/derivatives.F90,
	  src/grid/double_grid.F90, src/grid/grid.F90,
	  src/grid/gridhier.F90, src/grid/mesh.F90,
	  src/grid/mesh_function_inc.F90, src/grid/mesh_init.F90,
	  src/grid/multigrid.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/hgh_projector_inc.F90,
	  src/hamiltonian/kb_projector_inc.F90,
	  src/hamiltonian/rkb_projector.F90,
	  src/hamiltonian/species_pot.F90, src/poisson/poisson.F90,
	  src/poisson/poisson_multigrid.F90, src/states/restart.F90,
	  src/states/states_block_inc.F90, src/states/states_calc_inc.F90,
	  src/system/preconditioners.F90: curvlinear -> curvilinear

2009-04-15 20:31  xavier

	* [r5240] src/grid/curv_gygi.F90, src/grid/curvilinear.F90: The
	  curv_gygi module now copies the atomic coordinates, instead of
	  using the geometry object at each call.

2009-04-15 21:00  xavier

	* [r5241] src/grid/curv_modine.F90, src/grid/curvilinear.F90,
	  src/grid/mesh_init.F90, src/hamiltonian/species_pot.F90: Now
	  curvilinear coordinates only require the geometry at
	  initialization.

2009-04-16 07:51  xavier

	* [r5242] src/grid/grid.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/multigrid.F90,
	  src/states/restart.F90: Included a pointer to the curvilinear
	  coordinates in the mesh.

2009-04-16 09:12  xavier

	* [r5243] src/grid/mesh_init.F90: My last commit broke Compilation
	  in parallel.

2009-04-16 09:29  marques

	* [r5244] src/basic/profiling.F90, src/grid/curvilinear.F90,
	  src/grid/mesh.F90, src/grid/nl_operator_inc.F90,
	  src/grid/submesh.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/species_pot.F90, src/ions/geometry.F90,
	  src/math/splines.F90, src/scf/lcao_inc.F90,
	  src/species/logrid.F90, src/species/ps_psf.F90,
	  src/species/species.F90, src/states/mix_inc.F90,
	  src/states/states_calc_inc.F90: Many, many allocates were
	  missing. I caught a lot of them, by using the carbon atom test. I
	  will run other tests now, and try to sort out the rest of the
	  allocates...

2009-04-16 10:33  marques

	* [r5245] src/basic/mpi.F90, src/grid/grid.F90,
	  src/ions/geometry.F90, src/ions/simul_box.F90,
	  src/math/splines.F90, src/states/states.F90: Removed all
	  assignment(=) from octopus. Overloading operators is a very bad
	  thing to do, as it makes impossible to grep where the assignments
	  are made. This can lead to bugs that are extraordinarely hard to
	  find. In any case, we do not really use the assignments. Call the
	  _copy routine explicitly from now on, please.

2009-04-16 10:43  xavier

	* [r5246] src/grid/io_function_inc.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/poisson/solver_1D.F90,
	  src/poisson/solver_2D.F90: Defined the mesh_x_global function,
	  that will replace mesh%x_global.

2009-04-16 11:02  marques

	* [r5247] src/species/ps.F90, src/species/ps_hgh.F90: Another
	  couple of variables that were not deallocated.
	  I introduced a GOTO statement in octopus ;) I hope you don't kill
	  me. Actually I do think we can use them in cases as this: there
	  was if(something) dealloc a couple o stuff; pop_sub; exit, which
	  is again very prone to errors. I replaced it by a goto 999, where
	  999 is before the final deallocs of the routine. This is, I
	  thinkl, but cleaner, and therefore I give green light that it
	  becomes common practice in octopus...

2009-04-16 13:04  nitsche

	* [r5248]
	  testsuite/open_systems/01-wavepacket.01-deriv_order_1.inp,
	  testsuite/open_systems/01-wavepacket.02-deriv_order_4.inp,
	  testsuite/open_systems/01-wavepacket.test,
	  testsuite/open_systems/02-wavepacket_2d.01-full_q.inp,
	  testsuite/open_systems/02-wavepacket_2d.test,
	  testsuite/open_systems/03-extended_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/03-extended_eigenstate.02-ring_leads_2d.inp,
	  testsuite/open_systems/03-extended_eigenstate.test,
	  testsuite/open_systems/04-propagate_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/04-propagate_eigenstate.test: * enabled
	  the open boundary tests (MPI is not working due to changes for
	  version 3.1.0)
	  
	  Is there a way to disable the tests just for MPI? Now it will
	  just stop with an error message.
	  I am trying hard to parallelize the transport mode (gs + td) in
	  k-points...

2009-04-16 13:15  xavier

	* [r5249] src/grid/mesh_function_inc.F90: Now interpolate functions
	  do not require mesh%x_global (they create a
	  local copy).

2009-04-16 14:40  xavier

	* [r5250] src/grid/mesh.F90: Now mesh_x_global calculates the value
	  instead of using mesh%x_global.

2009-04-16 15:19  xavier

	* [r5251] src/grid/mesh.F90, src/grid/mesh_init.F90: Removed
	  mesh::x_global.

2009-04-16 16:42  xavier

	* [r5252] src/grid/mesh.F90: I had forgotten to remove the x_global
	  component of mesh.

2009-04-16 16:44  acastro

	* [r5253] src/basic/distributed.F90, src/basic/multicomm.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/hamiltonian.F90,
	  src/ions/geometry.F90, src/ions/simul_box.F90, src/main/run.F90,
	  src/states/states.F90, src/states/states_dim.F90: Added default
	  initialization to NULL() of the pointers included in
	  several data types. This allows calling "associated(x)" without
	  crashing.
	  
	  In the way, I found one copy of a geometry type variable through
	  the
	  previously overloaded "=", which should be done now with
	  "geometry_copy". This caused
	  open_systems/03-extended_eigenstate.test
	  to fail in my machine; now it still fails, but due to something
	  else.

2009-04-17 09:39  xavier

	* [r5254] src/basic/profiling.F90, src/include/global.h: The memory
	  profiling now also prints the size of the allocation.

2009-04-17 11:06  xavier

	* [r5255] configure.ac, src/basic/profiling.F90,
	  src/include/global.h, src/system/exponential_split.F90: The size
	  of allocations is now correctly calculated thanks to the
	  sizeof intrinsic. Since sizeof is not standard Fortran I included
	  a
	  autoconf macro to detect it (all the compilers I have tried
	  support
	  it, though).

2009-04-17 11:11  xavier

	* [r5256] m4/fc_sizeof.m4: I forgot a file.

2009-04-17 12:56  marques

	* [r5257] libxc/ChangeLog, libxc/Makefile.am, libxc/configure.ac,
	  libxc/m4/acx.m4, libxc/m4/fcflags.m4, libxc/src/Makefile.am,
	  libxc/src/functionals.c, libxc/src/get_funcs.pl, libxc/src/gga.c,
	  libxc/src/gga_c_am05.c, libxc/src/gga_c_lm.c,
	  libxc/src/gga_c_lyp.c, libxc/src/gga_c_p86.c,
	  libxc/src/gga_c_pbe.c, libxc/src/gga_c_pw91.c,
	  libxc/src/gga_perdew.c, libxc/src/gga_x_2d_b86_mgc.c,
	  libxc/src/gga_x_am05.c, libxc/src/gga_x_b86.c,
	  libxc/src/gga_x_b86_mgc.c, libxc/src/gga_x_b88.c,
	  libxc/src/gga_x_bayesian.c, libxc/src/gga_x_dk87.c,
	  libxc/src/gga_x_ft97.c, libxc/src/gga_x_g96.c,
	  libxc/src/gga_x_lg93.c, libxc/src/gga_x_mpbe.c,
	  libxc/src/gga_x_optx.c, libxc/src/gga_x_pbe.c,
	  libxc/src/gga_x_pbea.c, libxc/src/gga_x_pw86.c,
	  libxc/src/gga_x_pw91.c, libxc/src/gga_x_rpbe.c,
	  libxc/src/gga_x_wc.c, libxc/src/gga_xc_1w.c,
	  libxc/src/gga_xc_b97.c, libxc/src/gga_xc_edf1.c,
	  libxc/src/gga_xc_lb.c, libxc/src/gga_xc_xlyp.c,
	  libxc/src/hyb_gga.c, libxc/src/hyb_gga_xc_b1wc.c,
	  libxc/src/hyb_gga_xc_b3lyp.c, libxc/src/hyb_gga_xc_b97.c,
	  libxc/src/hyb_gga_xc_o3lyp.c, libxc/src/hyb_gga_xc_pbeh.c,
	  libxc/src/lca.c, libxc/src/lca_lch.c, libxc/src/lca_omc.c,
	  libxc/src/lda.c, libxc/src/lda_c_1d_csc.c,
	  libxc/src/lda_c_2d_amgb.c, libxc/src/lda_c_2d_prm.c,
	  libxc/src/lda_c_hl.c, libxc/src/lda_c_pw.c, libxc/src/lda_c_pz.c,
	  libxc/src/lda_c_rpa.c, libxc/src/lda_c_vwn.c,
	  libxc/src/lda_c_wigner.c, libxc/src/lda_c_xalpha.c,
	  libxc/src/lda_x.c, libxc/src/lda_x_2d.c,
	  libxc/src/lda_xc_teter93.c, libxc/src/libxc_master.F90,
	  libxc/src/mgga.c, libxc/src/mgga_c_tpss.c,
	  libxc/src/mgga_x_lta.c, libxc/src/mgga_x_m06l.c,
	  libxc/src/mgga_x_tau_hcth.c, libxc/src/mgga_x_tpss.c,
	  libxc/src/mgga_xc_vsxc.c, libxc/src/mix_func.c,
	  libxc/src/special_functions.c, libxc/src/string_f.h,
	  libxc/src/test.c, libxc/src/util.c, libxc/src/util.h,
	  libxc/src/work_gga_becke.c, libxc/src/work_gga_x.c,
	  libxc/src/work_gga_x_2d.c, libxc/src/work_lda.c,
	  libxc/src/work_mgga_c.c, libxc/src/work_mgga_x.c, libxc/src/xc.h,
	  libxc/src/xc_f.c, libxc/src/xc_s.h, libxc/testsuite/Makefile.am,
	  libxc/testsuite/xc-consistency.c, libxc/testsuite/xc-get_data.c,
	  libxc/testsuite/xc-reference.pl,
	  libxc/testsuite/xc-run_testsuite: Changed the license with the
	  script that Tobias sent. Thanks Tobias.

2009-04-17 13:16  xavier

	* [r5258] src/include/global.h: The sizeof intrinsic gives problems
	  with some compilers, so I will
	  disable its use while I find a way to fix it.

2009-04-17 14:02  xavier

	* [r5259] src/scf/eigen.F90, src/scf/eigen_rmmdiis.F90,
	  src/scf/eigen_rmmdiis_inc.F90: Now the DIIS eigensolver does a
	  steepest descent reduction in the
	  first step.

2009-04-17 14:30  xavier

	* [r5260] src/scf/eigen_rmmdiis_inc.F90: The steepest descent steps
	  in DIIS are now preconditioned.

2009-04-17 15:39  xavier

	* [r5261] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90: Fixed
	  some errors in the DIIS start iteration.

2009-04-17 17:24  xavier

	* [r5262] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90:
	  Reorganized a bit the diis code.

2009-04-17 17:53  xavier

	* [r5263] src/scf/eigen_rmmdiis_inc.F90: More improvements to the
	  diis code, now I removed the re-calculation of
	  the residual.

2009-04-17 18:58  xavier

	* [r5264] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90: Added
	  preconditioning to the rmmdiis eigensolver.

2009-04-17 23:43  xavier

	* [r5265] testsuite/finite_systems_3d/10-fullerene.01-gs.inp,
	  testsuite/finite_systems_3d/10-fullerene.test,
	  testsuite/finite_systems_3d/Makefile.am: The diis eigensolver
	  appears to be working, so I added a test for it:
	  a fullerene molecule.

2009-04-18 00:13  xavier

	* [r5266] src/basic/calc_mode.F90, src/scf/eigen_rmmdiis_inc.F90: *
	  Reenabled parallelization in k points for all modes and
	  parallelization in states for the ground state.

2009-04-18 07:19  xavier

	* [r5267] testsuite/finite_systems_3d/Makefile.am: Removed
	  whitespaces after a backslash.

2009-04-18 14:25  xavier

	* [r5268] src/scf/eigen_rmmdiis_inc.F90: * The calculation of
	  lambda in the diis solver was not correct.
	  * Reorganized the code for the first iteration of diis.

2009-04-18 15:07  xavier

	* [r5269] src/scf/eigen_rmmdiis_inc.F90: * Now the diis eigensolver
	  also preconditions the calculation of lambda.
	  * Added the restriction to value of lambda.

2009-04-18 16:26  acastro

	* [r5270] src/math/oct_gsl_min_f.c, src/opt_control/iter.F90,
	  src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_global.F90: Improved the output of
	  the iteration information in QOCT runs.
	  
	  Added a double check for the computation of the gradient of the
	  QOCT
	  merit functional.

2009-04-18 16:48  xavier

	* [r5271] src/scf/eigen.F90: Updated the description for the
	  rmmdiis eigensolver.

2009-04-18 22:51  nitsche

	* [r5272] src/grid/ob_interface.F90, src/hamiltonian/ob_lead.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/states/ob_green.F90,
	  src/td/ob_mem.F90: * changed some static arrays to allocatables
	  * replaced some lalg_copy calls

2009-04-18 23:24  nitsche

	* [r5273] src/system/output_h_sys.F90: * extended h_sys_output_all
	  to handle k-point parallelization

2009-04-19 05:29  xavier

	* [r5274] src/grid/batch.F90, src/grid/batch_inc.F90,
	  src/grid/mesh_function_inc.F90, src/scf/eigen_rmmdiis_inc.F90:
	  Optimization:
	  * The batch object now stores a copy of the contiguous array it
	  is
	  available.
	  * Blas gemm is used by mf_dotp_batch if possible.

2009-04-19 06:03  xavier

	* [r5275] src/states/states_block_inc.F90: Now states_blockt_mul
	  initializes the batchs as contiguous if it is
	  possible.

2009-04-19 09:52  acastro

	* [r5276] src/opt_control/iter.F90,
	  src/opt_control/opt_control.F90: I learn from the buildbot that
	  xlf does not like my style of
	  quotations in the format definitions. I think this change should
	  make
	  them legal.

2009-04-19 12:04  acastro

	* [r5277] src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers.F90, src/hamiltonian/lasers_inc.F90: A
	  solution for some weird compiler error (ifort 10.0 in opteron
	  machines).

2009-04-19 12:39  acastro

	* [r5278] src/opt_control/initst.F90: There was another case of
	  copying states_t variables being copied
	  through the overloaded "=", which no longer exists.

2009-04-19 17:12  xavier

	* [r5279] src/grid/mesh_function_inc.F90,
	  src/scf/eigen_rmmdiis_inc.F90: * Added more profiling regions to
	  the Xmf_dotp_batch function.
	  * Added progress bar output to the first iteration of diis.

2009-04-19 18:11  xavier

	* [r5280] src/grid/batch_inc.F90, src/scf/eigen_rmmdiis_inc.F90:
	  The hamiltonian in the rmmdiis eigensolver is now applied by
	  blocks.

2009-04-19 19:03  xavier

	* [r5281] src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90: Added
	  preconditioner_apply_batch function.

2009-04-19 20:34  acastro

	* [r5282] src/opt_control/target.F90,
	  testsuite/optimal_control/03-localtarget.test: A couple of little
	  numerical bugs that made however a big difference
	  in some QOCT results.

2009-04-19 22:09  xavier

	* [r5283] src/scf/eigen_rmmdiis_inc.F90: More operations done by
	  blocks.

2009-04-19 22:29  xavier

	* [r5284] src/scf/eigen_rmmdiis_inc.F90: More operations by blocks.

2009-04-20 07:17  xavier

	* [r5285] src/grid/mesh_function_inc.F90,
	  src/scf/eigen_rmmdiis_inc.F90: More changes to the rmmdiis
	  solver:
	  * Deallocations were missing.
	  * Some reductions are now done by blocks.

2009-04-20 09:58  xavier

	* [r5286] src/scf/eigen_rmmdiis_inc.F90: The case when the
	  diagonalization fails is now handled properly.

2009-04-20 09:58  xavier

	* [r5287] src/opt_control/opt_control.F90: Fixed the compilation
	  with xlf.

2009-04-20 10:03  xavier

	* [r5288] src/scf/eigen_rmmdiis_inc.F90: Some deallocations were
	  missing.

2009-04-20 11:55  mjv500

	* [r5289] src/grid/derivatives.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  cleaned modelMB init copy end

2009-04-20 15:35  nitsche

	* [r5290] src/ions/simul_box.F90, src/scf/ground_state.F90,
	  src/states/restart.F90, src/states/states.F90, src/td/ob_rti.F90,
	  testsuite/open_systems/01-wavepacket.01-deriv_order_1.inp,
	  testsuite/open_systems/01-wavepacket.02-deriv_order_4.inp,
	  testsuite/open_systems/01-wavepacket.test,
	  testsuite/open_systems/02-wavepacket_2d.01-full_q.inp,
	  testsuite/open_systems/02-wavepacket_2d.test,
	  testsuite/open_systems/03-extended_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/03-extended_eigenstate.02-ring_leads_2d.inp,
	  testsuite/open_systems/03-extended_eigenstate.test,
	  testsuite/open_systems/04-propagate_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/04-propagate_eigenstate.02-ring_leads_2d.inp,
	  testsuite/open_systems/04-propagate_eigenstate.test,
	  testsuite/open_systems/Makefile.am: * fixed a memory leak
	  * fixed open boundary mode to run with k-point parallelization
	  * updated corresponding tests, added a full transport test

2009-04-20 15:50  nitsche

	* [r5291] src/states/states.F90: * some cleanup of my last commit

2009-04-20 17:31  mjv500

	* [r5292] src/grid/derivatives.F90: stray debug lines

2009-04-20 22:33  acastro

	* [r5293] src/grid/io_function_inc.F90, src/states/restart_inc.F90:
	  When reading a function from file, if the reading fails, the
	  array
	  that should contain the function becomes undefined since it is
	  passes
	  as intent(out). I think it should be intent(inout) so that if the
	  reading is not succesfull, the array does not change.

2009-04-20 22:34  xavier

	* [r5294] src/states/states.F90: The call to modelmb_particles_end
	  causes a segmentation fault, I don't
	  know how to fix it so I commented the line.

2009-04-20 23:04  xavier

	* [r5295] src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90:
	  Added the project_psi_batch function.

2009-04-20 23:39  acastro

	* [r5296] src/opt_control/propagation.F90: Yet another states_t
	  variable was being copied with "=" instead of
	  with states_copy, creating the usual trouble.

2009-04-21 07:52  marques

	* [r5297] libxc/testsuite/Makefile.am, src/basic/calc_mode.F90,
	  src/grid/io_function.F90, src/grid/mesh_function_inc.F90,
	  src/grid/mesh_init.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/ions/simul_box.F90, src/main/Makefile.am, src/main/main.F90,
	  src/main/run.F90, src/states/mix.F90, src/states/restart.F90,
	  src/system/output_h.F90: I implemented the inversion of the
	  Kohn-Sham equations (static). It seems to work in simple cases,
	  but the iterative procedure does lack stability, and fails to
	  converge for more complicated densities...

2009-04-21 12:49  xavier

	* [r5298] src/hamiltonian/projector_inc.F90: Optimization of the
	  application of the projector in blocks.

2009-04-21 13:07  marques

	* [r5299] src/main/invert_ks.F90: The missing file.

2009-04-21 13:38  xavier

	* [r5300] src/hamiltonian/projector_inc.F90: My last commit broke
	  compliation in parallel.

2009-04-21 16:39  acastro

	* [r5301] src/hamiltonian/projector_inc.F90,
	  src/opt_control/opt_control.F90,
	  testsuite/optimal_control/04-box.08-oct_long.inp,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/Makefile.am: o Added a test for the
	  newly added conjugate gradients QOCT scheme.
	  
	  o A few lines were too long in projector_inc.F90.

2009-04-21 17:08  xavier

	* [r5302] src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/system/preconditioners_inc.F90: Now the filter preconditioner
	  acts by blocks.

2009-04-21 17:21  xavier

	* [r5303]
	  testsuite/finite_systems_3d/20-eigensolver.06-rmmdiis.inp,
	  testsuite/finite_systems_3d/20-eigensolver.test: Updated the
	  results for the diis eigensolver.

2009-04-21 18:06  mjv500

	* [r5304] src/grid/mesh.F90, src/grid/mesh_init.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90: debug
	  hypercube mesh%x generation

2009-04-21 18:17  mjv500

	* [r5305] src/states/modelmb_particles.F90, src/system/system.F90:
	  mass copying routine

2009-04-21 19:40  xavier

	* [r5306] src/basic/distributed.F90, src/basic/multicomm.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/hamiltonian.F90,
	  src/main/run.F90, src/states/states.F90,
	  src/states/states_dim.F90: The segmentation fault in gfortran
	  seemed to be a compiler problem*,
	  removing the initializations to null, that Alberto introduced the
	  other day, avoids it.
	  
	  * I am not sure if this is actually a problem or it is a side
	  effect
	  of variables being declared save.

2009-04-21 21:29  acastro

	* [r5307] testsuite/optimal_control/03-localtarget.03-gs-mp.inp,
	  testsuite/optimal_control/03-localtarget.03-tdoct.inp,
	  testsuite/optimal_control/03-localtarget.04-gs-mp.inp,
	  testsuite/optimal_control/03-localtarget.04-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.05-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/Makefile.am: Added a test for QOCT with
	  time-dependent targets.

2009-04-21 23:27  acastro

	* [r5308] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/opt_control.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/td/td_rti.F90: A number of
	  bugs/problems that prevented QOCT with interacting
	  electrons to work.

2009-04-21 23:37  dstrubbe

	* [r5309] src/sternheimer/em_resp.F90: Added reference since I
	  found the equations I was using in the literature.

2009-04-22 10:34  marques

	* [r5310] m4/fc_sizeof.m4, src/basic/distributed.F90,
	  src/basic/messages.F90, src/basic/multicomm.F90,
	  src/basic/profiling.F90, src/common-rules.make,
	  src/grid/basins.F90, src/include/global.h, src/math/fftw3.F90,
	  src/math/lalg_adv.F90, src/math/lalg_adv_lapack.F90,
	  src/math/math.F90, src/math/math_inc.F90,
	  src/math/ode_solver_inc.F90, src/math/root_solver.F90,
	  src/math/root_solver_inc.F90, src/math/solvers_inc.F90,
	  src/math/splines.F90, src/math/tdfunction.F90: I have now
	  replaced our old ALLOCATE macro by a SAFE_ALLOCATE that now uses
	  the sizeof intrinsic of fortran to check the size of the
	  variables. A little detail that everyone should remember now is
	  that one should write
	  
	  SAFE_ALLOCATE(var(1:n))
	  
	  i.e., never forget the "1:" or fortran will not be able to check
	  the ize of the array. More commits will follow shortly ;)

2009-04-22 11:03  marques

	* [r5311] src/common-rules.make, src/include/global.h: I hope this
	  solves the compilatin issues.

2009-04-22 11:05  marques

	* [r5312] src/include/global.h, src/ions/xyz_file.F90,
	  src/species/atomic.F90, src/species/logrid.F90,
	  src/species/ps.F90, src/species/ps_cpi.F90,
	  src/species/ps_cpi_file.F90, src/species/ps_fhi.F90,
	  src/species/ps_hgh.F90, src/species/ps_in_grid.F90,
	  src/species/ps_psf.F90, src/species/ps_psf_file.F90,
	  src/species/ps_upf.F90, src/species/species.F90: Some more
	  ALLOCATE -> SAFE_ALLOCATE

2009-04-22 12:14  marques

	* [r5313] src/include/global.h: There was a backslash missing,
	  preventing compilation

2009-04-22 14:10  marques

	* [r5314] src/grid/basins.F90, src/grid/batch.F90,
	  src/grid/cube_function_inc.F90, src/grid/curv_gygi.F90,
	  src/grid/curv_modine.F90, src/grid/curvilinear.F90,
	  src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/grid/double_grid.F90, src/grid/double_grid_apply.F90,
	  src/grid/fourier_space_inc.F90, src/grid/grid.F90,
	  src/grid/gridhier_inc.F90, src/grid/hypercube.F90,
	  src/grid/io_function_inc.F90, src/grid/mesh_function_inc.F90,
	  src/grid/mesh_init.F90, src/grid/multigrid.F90,
	  src/grid/nl_operator.F90, src/grid/nl_operator_inc.F90,
	  src/grid/ob_interface.F90, src/grid/scalar_mesh.F90,
	  src/grid/stencil.F90, src/grid/stencil_star.F90,
	  src/grid/stencil_variational.F90, src/grid/submesh.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/hgh_projector.F90,
	  src/hamiltonian/hgh_projector_inc.F90,
	  src/hamiltonian/kb_projector.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/lasers_inc.F90, src/hamiltonian/ob_lead.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/rkb_projector.F90,
	  src/hamiltonian/species_pot.F90, src/include/global.h,
	  src/ions/crystal.F90, src/ions/geometry.F90,
	  src/ions/ion_dynamics.F90, src/ions/simul_box.F90,
	  src/ions/symmetries.F90, src/ions/vibrations.F90,
	  src/poisson/poisson.F90, src/poisson/poisson_cg.F90,
	  src/poisson/poisson_corrections.F90, src/poisson/poisson_fft.F90,
	  src/poisson/poisson_isf.F90, src/poisson/poisson_multigrid.F90,
	  src/poisson/solver_3D.F90, src/states/Makefile.am,
	  src/states/density_matrix.F90, src/states/elf.F90,
	  src/states/excited_states.F90, src/states/excited_states_inc.F90,
	  src/states/ksinversion.F90, src/states/linear_response.F90,
	  src/states/linear_response_inc.F90, src/states/magnetic.F90,
	  src/states/mix.F90, src/states/mix_inc.F90,
	  src/states/modelmb_particles.F90, src/states/ob_green.F90,
	  src/states/restart.F90, src/states/smear.F90,
	  src/states/states.F90, src/states/states_block.F90,
	  src/states/states_block_inc.F90, src/states/states_calc.F90,
	  src/states/states_calc_inc.F90, src/states/states_dim.F90,
	  src/states/states_kpoints.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h.F90,
	  src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert.F90,
	  src/system/pert_inc.F90, src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90, src/system/system.F90,
	  src/system/v_ks.F90, src/system/xc_KLI_inc.F90,
	  src/system/xc_OEP.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/system/xc_OEP_x_inc.F90, src/xc/axc.F90, src/xc/fxc.F90,
	  src/xc/kxc.F90, src/xc/vxc.F90: Many more ALLOCATE ->
	  SAFE_ALLOCATE

2009-04-22 15:55  marques

	* [r5315] src/opt_control/filters.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_evolution_inc.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/lcao.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/td/cpmd.F90, src/td/cpmd_inc.F90,
	  src/td/ob_mem.F90, src/td/ob_rti.F90, src/td/ob_src.F90,
	  src/td/pes_mask.F90, src/td/pes_rc.F90, src/td/spectrum.F90,
	  src/td/td.F90, src/td/td_calc.F90, src/td/td_rti.F90,
	  src/td/td_write.F90: And many more ALLOCATE -> SAFE_ALLOCATE

2009-04-22 16:28  mjv500

	* [r5316] src/td/spectrum.F90: bad parentheses

2009-04-22 16:30  mjv500

	* [r5317] src/states/modelmb_particles.F90, src/system/energy.F90:
	  correct copy of pointers and spacing format

2009-04-23 03:12  acastro

	* [r5318] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/opt_control.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90,
	  testsuite/optimal_control/07-qoct+tddft.01-ground_state.inp,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp,
	  testsuite/optimal_control/07-qoct+tddft.test,
	  testsuite/optimal_control/Makefile.am: Enabled the option of
	  doing QOCT with interacting electrons. Added a
	  test for a two-electron 2D case. I had to correct a few bugs here
	  and
	  there, and add the xc kernel to the definition of the QOCT
	  exchange-like operator.

2009-04-23 10:15  xavier

	* [r5319] src/include/global.h: Fixes a problem with compilers
	  where sizeof does not work on
	  non-allocated arrays.

2009-04-23 15:29  marques

	* [r5320] src/basic/messages.F90, src/basic/mpi_lib_inc.F90,
	  src/basic/multicomm.F90, src/basic/profiling.F90,
	  src/grid/mesh_init.F90, src/grid/par_vec.F90,
	  src/grid/par_vec_inc.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/hamiltonian.F90, src/include/global.h,
	  src/main/casida.F90, src/main/casida_inc.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/invert_ks.F90,
	  src/main/one_shot.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/opt_control/initst.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/poisson/solver_1D.F90, src/poisson/solver_2D.F90,
	  src/states/modelmb_particles.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/utils/broad.F90, src/utils/cross_section.F90,
	  src/utils/dielectric_function.F90,
	  src/utils/oscillator_strength.F90, src/utils/phonon_spectrum.F90:
	  Memory profiling is now much nicer. It can give you a summary of
	  the memory that was allocated/dellocated, and the largest
	  variables ever allocated by the code. Xavier, can you please now
	  try to solve the issues with xlf?

2009-04-23 15:41  xavier

	* [r5321] src/basic/profiling.F90: Fixed compilation issue in
	  Miguel's commit.

2009-04-23 15:59  nitsche

	* [r5322] src/grid/grid.F90, src/hamiltonian/ob_lead.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/td/ob_mem.F90,
	  src/td/ob_rti.F90: * Fixed memory leak in open boundaries.
	  * Fixed output in lippmann-schwinger cycle (in parallel).
	  * Fixed the issue of not be able to continue the calculation of
	  the memory coefficients. Now it uses less memory and is probably
	  faster. Saved coefficients with previous versions will not work
	  anymore.
	  * Changed some DEALLOCATE to SAFE_DEALLOCATE
	  * The td-run of the open boundaries now decides on its own what
	  solver it uses for the propagation. With a time-dependent
	  magnetic field in the central region the propagation switches to
	  Bi-CG as the QRM_sym is not suitable in this case (not yet the
	  best option, but the only one the does not suffer from
	  breakdowns).

2009-04-23 16:02  nitsche

	* [r5323] testsuite/open_systems/04-propagate_eigenstate.test: *
	  some outputs changed slightly due to the new calculation of the
	  memory coefficients

2009-04-23 16:10  xavier

	* [r5324] src/grid/submesh.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/projector.F90,
	  src/hamiltonian/projector_inc.F90: Removed the option of
	  performing asynchronously the reduction of the
	  pseudopotentials. This was much slower that the current scheme
	  and
	  consumed a considerable amount of memory.

2009-04-23 16:20  xavier

	* [r5325] src/basic/profiling.F90: More compilation issues due to
	  privacy of some types.

2009-04-23 16:53  xavier

	* [r5326] src/basic/profiling.F90: Converted output of memory
	  profiling to megabytes.

2009-04-23 18:23  acastro

	* [r5327] src/math/sparskit_inc.F90: Attempting to compile with
	  sparskit failed because of some ALLOCATEs.

2009-04-23 19:19  acastro

	* [r5328] src/states/modelmb_particles.F90, src/states/states.F90:
	  You won't believe this, but the modelmb segfault was back, at
	  least I
	  get it in the finite_systems_1d/09-morse.test and in the
	  optimal_control/01-asym_doublewell.test.
	  
	  I added a modelMB_particles_null routine, which is be called from
	  states_null. That way one is sure that the pointers point to
	  null, and
	  not to god knows what. This seems to solve the bug. Still,
	  states_null
	  is not perfect, since other derived data types within the
	  states_t
	  structure don't have the corresponding *_null routines.
	  
	  I don't know if we should add *_null routines everywhere for all
	  data
	  types, and make sure that they are called for every variable.
	  This
	  would be the only way to make sure that we can kill all pointers
	  safely (no matter if our deallocate routine is now called
	  "SAFE").
	  
	  The "=> NULL()" feature, if it works properly, would solve the
	  issue
	  more elegantly. And even better, I think, would be to use
	  "allocatable" arrays for derived data types, but you all voted
	  against
	  it.

2009-04-23 21:47  nitsche

	* [r5329] src/scf/ob_lippmann_schwinger.F90: * fix of the issue
	  tobias found within the lippmann-schwinger gs-run

2009-04-24 07:16  nitsche

	* [r5330] src/scf/ground_state.F90,
	  src/scf/ob_lippmann_schwinger.F90,
	  testsuite/open_systems/04-propagate_eigenstate.test: * fixed a
	  bug in initializing the wavefunctions for the lippmann-schwinger
	  calculation - this fixes the convergence and therefore the
	  warning that the scf is not converged (during lippmann-schwinger
	  cycle)
	  * fixed some more np <--> np_part, due to that the results
	  changed a bit and I adapted one test

2009-04-24 08:40  acastro

	* [r5331] src/hamiltonian/hamiltonian_inc.F90,
	  src/scf/eigen_cg_inc.F90, src/system/preconditioners_inc.F90:
	  Fixed a bug caused by use of non-initialized variables, related
	  to an
	  "intent(out)".

2009-04-24 12:15  marques

	* [r5332] perl/Makefile.am, perl/oct-analyze_projections,
	  perl/oct-analyze_projections.pl, perl/oct-check-deallocs,
	  perl/oct-vdW_c6, perl/oct-vdW_c6.pl: *) Added a little perl
	  script to check thinks that are nor deallocated after running
	  with full memory profiling
	  *) Now perl scripts use /usr/bin/env perl to run. This should be
	  quite portable.

2009-04-24 12:43  marques

	* [r5333] perl/oct-check-deallocs, perl/oct-check_deallocs: Sorry,
	  wrong filename

2009-04-24 13:43  marques

	* [r5334] src/basic/command_line.F90, src/basic/ialist.F90,
	  src/basic/iihash.F90, src/ions/simul_box.F90,
	  src/main/casida.F90, src/math/tdfunction.F90,
	  src/states/states.F90, src/states/states_dim.F90,
	  src/td/ob_src.F90, src/utils/oscillator_strength.F90: Some small
	  leftovers from the ALLOCATE stuff

2009-04-24 14:43  xavier

	* [r5335] src/ions/simul_box.F90: Xlf has problems with one
	  allocation, so it is done directly.

2009-04-24 15:45  acastro

	* [r5336] src/math/lalg_adv.F90, src/system/exponential.F90,
	  testsuite/finite_systems_1d/09-morse.test,
	  testsuite/finite_systems_2d/05-spin_precession.test,
	  testsuite/finite_systems_2d/06-tdmagnetic.test,
	  testsuite/optimal_control/02-sym_doublewell.test,
	  testsuite/optimal_control/03-localtarget.05-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/04-box.02-oct_long.inp,
	  testsuite/optimal_control/04-box.03-oct_long.inp,
	  testsuite/optimal_control/04-box.04-oct_long.inp,
	  testsuite/optimal_control/04-box.05-oct_long.inp,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp,
	  testsuite/optimal_control/04-box.08-oct_long.inp,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/05-adw.02-filter_fixed.inp,
	  testsuite/optimal_control/05-adw.03-filter_indirect.inp,
	  testsuite/optimal_control/06-zbr98.test,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp: There was a
	  bug in the the computation of the zlalg_exp; the
	  computation of the exponential of a matrix for complex hermitian
	  matrices was wrong. Because of this, the lanczos method was not
	  done
	  correctly. This has happened since we got rid of the expokit
	  library
	  (around seven months ago). Fortunately, the results were not too
	  compromised because the final computation was done by calling
	  zlalg_exp with the non-hermitian flag. However, the stop
	  criterion was
	  not computed correctly, and as a result we could have too many or
	  too
	  few iterations.
	  
	  The results of some tests changed a little bit (very small
	  changes
	  usually), and I changed slightly some of them.

2009-04-24 16:28  acastro

	* [r5337] testsuite/optimal_control/07-qoct+tddft.02-oct.inp,
	  testsuite/optimal_control/07-qoct+tddft.test: Changed a little
	  this test, which seemed to give slightly different
	  numbers with different compilers.

2009-04-26 07:40  nitsche

	* [r5338] src/states/states.F90: * initialized pointers in
	  states.F90 related to open boundaries to null, that fixes
	  (hopefully) the failing of deallocation in some cases of ob_green
	  in td-mode where it is not used

2009-04-26 08:24  nitsche

	* [r5339] src/states/states.F90: * next try: removed the null
	  initialization, added nullify of the open boundary pointers to
	  states_null

2009-04-26 08:31  acastro

	* [r5340] src/hamiltonian/hamiltonian.F90: One test (in the OCT
	  section) was producing rather different results
	  depending on the machine, and one of the reasons seems to be the
	  lack
	  of initialization to zero of this variable.

2009-04-26 17:55  xavier

	* [r5341] configure.ac: Changed version to 3.2.0pre1.

2009-04-26 19:37  xavier

	* [r5342] src/basic/Makefile.am: Some dependencies were missing.

2009-04-26 19:53  xavier

	* [r5343] src/scf/lcao.F90, src/scf/lcao_inc.F90: Included an
	  alternative implementation of LCAO.

2009-04-27 08:14  xavier

	* [r5344] src/grid/submesh.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/species_pot.F90, src/scf/lcao.F90,
	  src/scf/lcao_inc.F90, src/species/species.F90: Part of the atomic
	  orbitals are only calculated in a spherical grid
	  around the atom.

2009-04-27 08:43  xavier

	* [r5345] src/grid/submesh_inc.F90,
	  src/hamiltonian/species_pot.F90, src/scf/lcao_inc.F90,
	  src/species/species.F90: All orbitals are now calculated in the
	  submesh (integrals are still
	  done in the full mesh, though).

2009-04-27 09:30  micael

	* [r5346] configure.ac, m4/etsf_io.m4, src/common-rules.make,
	  src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/system/Makefile.am, src/system/output_etsf.F90,
	  src/system/output_h_sys.F90: Implemented basic support for the
	  ETSF file format. This is done using the ETSF_IO library. Note
	  that this is still experimental and limited to finite systems.
	  
	  As a bonus, we can now use v_sim to plot some of the output
	  produced by octopus.

2009-04-27 13:44  xavier

	* [r5347] src/scf/lcao_inc.F90: Now the submeshes for the
	  alternative LCAO are initialized once for
	  all orbitals.

2009-04-27 14:08  acastro

	* [r5348] src/opt_control/target.F90: Yet another case in which a
	  states_t variable was copied with the "="
	  sign, instead of with states_copy.

2009-04-27 15:13  xavier

	* [r5349] src/scf/lcao_inc.F90: Atomic orbitals are now also
	  precalculated.

2009-04-27 15:54  xavier

	* [r5350] src/grid/submesh.F90, src/grid/submesh_inc.F90,
	  src/scf/lcao_inc.F90: The matrix elements for LCAO are calculated
	  in the spherical grid.

2009-04-27 17:12  xavier

	* [r5351] src/scf/lcao_inc.F90: Matrix elements of orbitals that do
	  not overlap are not calculated.

2009-04-27 18:31  acastro

	* [r5352]
	  testsuite/optimal_control/07-qoct+tddft.01-ground_state.inp,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp: This test was
	  producing different results on different machines due to
	  its bad design (it used a state of a degenerate set, and this
	  could be
	  different on each run).

2009-04-27 18:36  acastro

	* [r5353] testsuite/optimal_control/07-qoct+tddft.test: Sorry, I
	  forgot to change the value of the test check in the previous
	  commit.

2009-04-28 13:17  acastro

	* [r5354] src/math/lalg_adv.F90, src/opt_control/check_input.F90,
	  src/opt_control/opt_control.F90, src/system/exponential.F90: Now
	  the time propagation with an inhomogeneous Schrodinger equation
	  can be also done using the exponential midpoint rule together
	  with the
	  Lanczos expansion. Before, one could only use the Crank-Nicholson
	  method.

2009-04-28 13:28  xavier

	* [r5355] src/sternheimer/em_resp.F90: Now when the frequency is
	  zero the sternheimer equation only for one sign
	  is calculated.

2009-04-28 16:26  xavier

	* [r5356] src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90: I am reimplementing the
	  2n+1 theorem expression in a more general and
	  cleaner way. This is the first step.

2009-04-30 00:57  acastro

	* [r5357] src/grid/mesh.F90: The open system tests (at least
	  open_systems/01-wavepacket.test and
	  open_systems/03-extended_eigenstate.test) were failing in my
	  machine
	  because of this little error (that affects only runs with reduced
	  dimensionality)

2009-05-01 19:23  mjv500

	* [r5358] src/grid/io_function_inc.F90,
	  src/grid/mesh_function_inc.F90, src/ions/geometry.F90,
	  src/ions/xyz_file.F90, src/states/Makefile.am,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: MB state sym checking and
	  antisymmetrization

2009-05-05 19:12  mjv500

	* [r5359] src/grid/mesh.F90, src/math/Makefile.am,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90: antisymmetrization starts
	  for MB wf

2009-05-05 19:45  mjv500

	* [r5360] src/math/permutations.F90: forgot permutations.F90

2009-05-05 19:55  helbig

	* [r5361] src/main/invert_ks.F90, src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90: some ks inversion plus bug
	  fixes from MJV

2009-05-06 13:19  nitsche

	* [r5362] src/ions/simul_box.F90: * fixed a bug in
	  simul_box_init_from_file when using more than one node with mpi
	  (changed read to iopar_read)

2009-05-06 16:54  mjv500

	* [r5363] src/grid/hypercube.F90, src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/main/invert_ks.F90,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90:
	  symmetrize mb states to s2 eigenfunctions, with Young tableaux

2009-05-06 17:30  mjv500

	* [r5364] src/grid/Makefile.am, src/grid/mesh_function.F90,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90: dependencies for modelmb_1part
	  datastructure

2009-05-06 17:31  mjv500

	* [r5365] src/grid/modelmb_1part.F90: creation of modelmb_1part
	  datastructure

2009-05-06 17:35  helbig

	* [r5366] src/states/modelmb_exchange_syms.F90: undeclared variable
	  now declared

2009-05-07 09:42  nitsche

	* [r5367] src/td/ob_mem.F90: * bugfix: a non-found file should not
	  be closed (ob_mem.read_coeffs)

2009-05-07 10:59  xavier

	* [r5368] src/scf/eigen_rmmdiis_inc.F90,
	  src/sternheimer/em_resp_calc_inc.F90: Some deallocations missing.

2009-05-07 16:40  mjv500

	* [r5369] src/math/Makefile.am, src/math/young.F90,
	  src/states/modelmb_exchange_syms.F90: added Young diagrams

2009-05-07 16:44  mjv500

	* [r5370] src/states/modelmb_exchange_syms.F90: limit output volume
	  for states projected out

2009-05-07 16:59  helbig

	* [r5371] src/states/modelmb_exchange_syms.F90: bug fixes in
	  modelmb

2009-05-08 09:18  acastro

	* [r5372] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/check_input.F90, src/opt_control/target.F90,
	  src/system/exponential.F90, src/td/td_rti.F90,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp,
	  testsuite/optimal_control/07-qoct+tddft.test: OCT with
	  interacting electrons was not working for more than two
	  electrons (only one orbital). Now it is, although it is rather
	  slow. In order to make it work, I had to change the way in which
	  the
	  propagation is performed (I introduced a new propagation scheme).

2009-05-08 23:30  xavier

	* [r5373] src/main/invert_ks.F90: Flush is not always available.

2009-05-09 13:08  xavier

	* [r5374] src/grid/submesh_inc.F90, src/scf/lcao_inc.F90: The
	  alternative LCAO implementation now works with domain
	  parallelization.

2009-05-09 22:20  xavier

	* [r5375] src/system/energy_inc.F90: An allgathering of eigenvalues
	  is missing, I will put a warning for
	  the moment.

2009-05-09 22:35  xavier

	* [r5376] src/scf/lcao_inc.F90: The alternative LCAO implementation
	  is now parallel in atoms (states).

2009-05-12 16:26  xavier

	* [r5377] src/scf/eigen_rmmdiis_inc.F90: The first iteration of
	  diis is also done by blocks.

2009-05-13 09:02  marques

	* [r5378] src/hamiltonian/scf_tol.F90,
	  src/system/linear_solver.F90: Added two new ways of changinf the
	  convergence during the lr scf process, linearly and
	  exponentially. For the h2o example, it turns out that the
	  exponential is the fastest, followed by the adaptative, constant,
	  and the linear.

2009-05-13 10:33  marques

	* [r5379] src/hamiltonian/scf_tol.F90,
	  src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90,
	  src/system/linear_solver.F90, src/system/linear_solver_inc.F90,
	  src/system/xc_OEP_inc.F90: Some cleaning of the way the scf_tol
	  was used

2009-05-13 10:54  marques

	* [r5380] libxc/src/gga_c_pbe.c, libxc/src/gga_x_pbe.c: Added a
	  couple of reparametrizations of the PBE by the group of Klaus
	  Capelle. Note that all the other combinations present in the
	  paper can be obatined by combining the already existing exchanges
	  and correlations of PBE and PBE_SOL. For example: GCGX =
	  x_PBE_SOL + c_PBE

2009-05-13 11:13  marques

	* [r5381] perl/Makefile.am: perl scripts were not included in the
	  distribution, which made make fail

2009-05-13 11:25  nitsche

	* [r5382] src/grid/ob_interface.F90, src/math/solvers_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/states/ob_green.F90,
	  src/states/states.F90, src/system/output_h_sys.F90,
	  src/td/ob_rti.F90, src/td/td_rti.F90,
	  testsuite/open_systems/04-propagate_eigenstate.test: * replaced
	  some lalg routines in the qmr-solver, surface green function and
	  lippmann-schwinger gs (for speedups)
	  * a lot of code cleaning for open boundaries
	  * changed convergence test of the surface green function
	  * Now the symmetric qmr-solver is always used within the
	  propagation of open boundary scheme. In the cases where the
	  operator is not complex symmetric (vector potential present) the
	  operator is symmetrized: A.x=b --> (A^T).A.x=(A^T).b
	  * Due to the changes some values in the test-suite changed as
	  well
	  * some preparations and changes for a magnetic field (or vector
	  potential) present in the ground state (not working yet)

2009-05-13 13:19  acastro

	* [r5383] src/hamiltonian/lasers_inc.F90,
	  src/opt_control/propagation.F90, src/system/output_etsf.F90: o
	  Removed some unnecessary use of pointers in the lasers module,
	  which
	  was causing internal compiler errors when compiling with intel. I
	  think the code is "safer" this way.
	  
	  o There was one parenthesis too many in a couple of places in
	  output_etsf.F90

2009-05-13 18:08  xavier

	* [r5384] src/sternheimer/em_resp_calc_inc.F90: Optimized a bit the
	  calculation of the hyperpolarizability.

2009-05-13 18:38  xavier

	* [r5385] src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90: More matrix elements in the
	  calculation of beta are precomputed.

2009-05-13 21:50  xavier

	* [r5386] src/grid/derivatives.F90: For non-curvilinear coordinates
	  Derivative weights are now generated using the stencil.

2009-05-13 22:38  xavier

	* [r5387] src/grid/derivatives_inc.F90, src/grid/mesh.F90,
	  src/grid/nl_operator.F90, src/ions/simul_box.F90: For zero bc now
	  the nl_operator uses a single boundary point.

2009-05-14 07:40  xavier

	* [r5388] src/grid/derivatives_inc.F90, src/grid/nl_operator.F90:
	  Using one point for the boundaries actually increases the number
	  of
	  in-grid stencils, it is possible to reduce it by playing a bit
	  with
	  boundary points in the nl_operator.

2009-05-14 10:02  helbig

	* [r5389] src/main/invert_ks.F90, src/states/restart.F90: td
	  density matrix output

2009-05-14 12:33  marques

	* [r5390] src/basic/messages.F90, src/basic/varia.c: Now the status
	  bar is printed when not in interactive.

2009-05-14 17:11  xavier

	* [r5391] src/main/invert_ks.F90, src/scf/lcao_inc.F90: Fixes some
	  things that xlf does not like.

2009-05-14 17:38  xavier

	* [r5392] src/scf/scf.F90, src/states/states.F90,
	  src/sternheimer/em_resp_calc_inc.F90,
	  src/system/output_states.F90, src/system/v_ks.F90: * Now the
	  current is only allocated for CDFT (i.e. never).
	  * Renamed st%j to st%current.

2009-05-14 22:33  mjv500

	* [r5393] src/grid/modelmb_1part.F90, src/ions/simul_box.F90,
	  src/math/young.F90, src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: restructured modelmb and fixed
	  MAX_DIM bug in simul_box

2009-05-14 22:36  mjv500

	* [r5394] src/states/density_matrix.F90: intent was incorrect

2009-05-14 22:39  mjv500

	* [r5395] src/states/density_matrix.F90: line lengths corrected

2009-05-15 09:26  xavier

	* [r5396] src/beak/operate_ri_vec.c: doperate_ri_vec can be
	  simplified a bit.

2009-05-15 09:27  xavier

	* [r5397] src/grid/batch.F90, src/grid/batch_inc.F90,
	  src/scf/lcao_inc.F90: * Now a batch can directly allocate and
	  deallocate components.
	  * This is used for the alternative LCAO.

2009-05-15 13:36  xavier

	* [r5398] src/grid/nl_operator.F90, src/grid/nl_operator_inc.F90:
	  Improved nl_operate_batch.

2009-05-15 13:40  xavier

	* [r5399] src/states/density_matrix.F90: * An intent declaration
	  was not correct.
	  * Removed some unnecessary "implicit none".

2009-05-15 14:26  xavier

	* [r5400] src/scf/scf.F90: The calculation of the forces can be
	  disabled with the
	  SCFCalculateForces variables.

2009-05-15 14:36  acastro

	* [r5401] src/opt_control/propagation.F90: Solved a couple of bugs
	  that affected the QOCT runs with interacting
	  electrons.

2009-05-16 10:31  xavier

	* [r5402] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/exponential.F90,
	  src/td/td_rti.F90: Removed hamiltonian_apply_all and
	  exponential_apply_all, these are
	  just particular cases of hamiltonian_apply_batch and
	  exponential_apply_batch.

2009-05-16 15:00  xavier

	* [r5403] src/beak/operate_ri.c: Improvements of the nl_operator.

2009-05-16 16:55  xavier

	* [r5404] src/system/energy_inc.F90: Removed a warning message. It
	  appears at every time propagation step.

2009-05-16 18:11  xavier

	* [r5405] src/scf/ground_state.F90, src/scf/lcao_inc.F90: Some
	  changes in the output of the LCAO.

2009-05-16 18:17  xavier

	* [r5406] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/exponential.F90,
	  src/td/td_rti.F90: Reverted changeset 5402.

2009-05-16 18:53  xavier

	* [r5407] src/hamiltonian/hamiltonian_inc.F90: Now
	  hamiltonian_apply_all uses hamiltonian_apply_batch.

2009-05-16 23:41  xavier

	* [r5408] src/system/exponential.F90: Optimization of
	  taylor_series_batch.

2009-05-17 14:16  xavier

	* [r5409] src/states/states.F90, src/system/energy.F90,
	  src/system/energy_inc.F90, src/system/v_ks.F90, src/td/td.F90:
	  Several small changes.

2009-05-17 16:45  xavier

	* [r5410] testsuite/real_time/02-aetrs.04-kick.inp,
	  testsuite/real_time/02-aetrs.test,
	  testsuite/real_time/Makefile.am: Added a test for propagation
	  with a kick, we didn't have any.

2009-05-17 17:14  mjv500

	* [r5411] src/states/density_matrix.F90: stray conflict in solved

2009-05-17 18:13  xavier

	* [r5412] src/td/pes.F90, src/td/td.F90, src/td/td_init.F90: * Some
	  cleaning of the TD part.
	  
	  * Removed the references to the DISABLE_PES macro.
	  
	  * Removed the ModifyOccupations variable, it was not documented
	  and as
	  far I know it was never used.

2009-05-17 19:18  mjv500

	* [r5413] src/states/Makefile.am, src/states/density_matrix.F90,
	  src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  modelmb density calculation + clean naming

2009-05-17 21:20  xavier

	* [r5414] src/basic/profiling.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/exponential.F90:
	  * The hamiltonian now calls axpy directly (to avoid a performance
	  problem with XLF).
	  * Moved some profiling objects from profiling_m to hamiltonian_m.
	  * Fixed the operation count for taylor_series_batch.

2009-05-17 22:44  xavier

	* [r5415] src/poisson/poisson.F90: Added variable
	  ParallelizationPoissonAllNodes that controls the nodes
	  used for the Poisson solver. By default all nodes are used, and I
	  think this causes problems with more than 500 processors.

2009-05-18 07:43  xavier

	* [r5416] src/td/td_write.F90: Included profiling regions for
	  functions in td_write.

2009-05-18 08:25  marques

	* [r5417] ChangeLog, libxc/ChangeLog, libxc/src/libxc_master.F90,
	  libxc/src/xc_f.c, src/basic/profiling.F90,
	  src/grid/mesh_function_inc.F90, src/math/loct_math.F90,
	  src/math/tdfunction.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90, src/scf/lcao_inc.F90,
	  src/system/output_h_sys.F90, src/td/spectrum.F90,
	  src/utils/oscillator_strength.F90, src/xc/functionals.F90,
	  src/xc/vxc.F90: Changes necessary to compile octopus in single
	  precision more. Alberto,
	  I guess I made a disaster in your opt-control code (that now will
	  not
	  wortk in single precision). The problem are the minimizing
	  routines that
	  do not have interfaces in single precision more. One should add
	  it...

2009-05-18 09:15  marques

	* [r5418] src/grid/grid.F90, src/grid/nl_operator.F90: We can now
	  turn off the tuning of the nl_operator. This saves a lot of
	  time when running 4d models with 1 orbital

2009-05-18 10:39  sakko

	* [r5419] src/grid/derivatives_inc.F90, src/grid/mesh_init.F90,
	  src/ions/simul_box.F90, src/poisson/poisson_cg.F90: Bug fixes and
	  improvements related to multiresolution method. Now the Poisson
	  solver seems to work with it.

2009-05-18 11:16  xavier

	* [r5420] src/poisson/poisson.F90, src/poisson/poisson_isf.F90,
	  src/poisson/solver_3D.F90: The ISF poisson solver is not
	  initialized for all nodes unless it is
	  required.

2009-05-18 11:17  micael

	* [r5421] m4/etsf_io.m4, src/system/output_etsf.F90: *) Corrected
	  the ETSF_IO configure test.
	  *) Removed a couple of debug statements.

2009-05-18 11:24  xavier

	* [r5422] src/math/loct_math.F90: Fixed compilation with g95.

2009-05-18 11:56  micael

	* [r5423] src/system/output_etsf.F90: Some calls to the ETSF_IO
	  error handler were missing.

2009-05-18 12:22  micael

	* [r5424] src/system/output_etsf.F90: *) Files in ETSF format now
	  include information about the octopus version.

2009-05-18 13:22  xavier

	* [r5425] m4/fc_sizeof.m4: Modified the test for the sizeof
	  intrinsic so it fails for the sun
	  compiler (as it should).
	  
	  This should fix the compilation problem with the sun compiler.

2009-05-18 14:36  xavier

	* [r5426] src/basic/multicomm.F90: Added a "wildcard" value to the
	  ParallelizationGroupRanks block.

2009-05-18 15:27  marques

	* [r5427] src/states/states.F90, src/system/Makefile.am,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  Started the painful move of the output of the matrix elements to
	  its own
	  module. Note that this is scattered all around... more to come ;)

2009-05-18 15:58  marques

	* [r5428] src/main/gcm.F90, src/main/unocc.F90,
	  src/opt_control/target.F90, src/scf/scf.F90,
	  src/states/states.F90, src/states/states_calc.F90,
	  src/states/states_calc_inc.F90, src/system/output_me.F90,
	  src/system/output_me_inc.F90, src/td/td_write.F90: *) forgot 2
	  files in my previous commit
	  *) Got rid of st%momentum. It makes no sense to calculate this
	  everywhere, so please calculate it when necessary. There is an
	  issue
	  with write_degeneracy_matrix, someone that knows what it is about
	  can
	  fix it? For now it will give probably nonsense, but I do not
	  understand
	  what this is for. The easy solution is to calculate the momentum
	  on the
	  spot.

2009-05-18 16:00  marques

	* [r5429] src/system/output_h_sys.F90: Condition was wrong.

2009-05-18 16:39  xavier

	* [r5430] src/scf/lcao_inc.F90: Improvement of the alternative
	  lcao.

2009-05-18 17:18  mjv500

	* [r5431] src/grid/derivatives.F90, src/grid/modelmb_1part.F90,
	  src/math/young.F90, src/states/Makefile.am,
	  src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  modelmb wf output

2009-05-18 17:18  mjv500

	* [r5432] src/states/modelmb_wf.F90: modelmb wf source

2009-05-18 18:29  xavier

	* [r5433] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/Makefile.am,
	  src/states/modelmb_density.F90,
	  src/states/modelmb_density_inc.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_density_matrix_inc.F90,
	  src/states/modelmb_exchange_syms.F90: Moved the calculation of
	  the few body density and density matrix to
	  the modules where they belong. We should not have physics inside
	  mesh.

2009-05-18 18:36  xavier

	* [r5434] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90: Simplified the names of
	  some members, since they belong to a structure
	  they were redundant.

2009-05-18 20:49  xavier

	* [r5435] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90: * More variables renamed.
	  * Some code formatting.

2009-05-18 21:18  xavier

	* [r5436] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/states/Makefile.am, src/states/modelmb_wf.F90,
	  src/system/output_states.F90: The function modelmb_wf_write is
	  now X(io_function_out_text).
	  
	  PS: Please do not put anything outside a module.

2009-05-18 21:53  xavier

	* [r5437] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90: Fixed compilation in
	  parallel.

2009-05-18 22:12  xavier

	* [r5438] src/grid/io_function_inc.F90: A small fix in
	  io_function_out_text.

2009-05-18 22:59  mjv500

	* [r5439] src/states/modelmb_density.F90,
	  src/states/modelmb_particles.F90: added particles_of_type to
	  modelmb

2009-05-19 08:30  micael

	* [r5440] src/common-rules.make: FCFLAGS_ETSF_IO is now passed on
	  to the compiler.

2009-05-19 08:32  marques

	* [r5441] src/scf/scf.F90, src/system/output_h_sys.F90,
	  src/system/output_me.F90: Now the angular momentum is also
	  treated as a matrix element

2009-05-19 09:00  marques

	* [r5442] src/main/Makefile.am, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_me.F90, src/system/output_me_inc.F90,
	  src/system/output_states.F90: Now also the one body and the two
	  body matrix elements are in the
	  output_me module. Note that this module is a mess, and could be
	  greatly
	  expanded and enhanced. Now I just gathered the routines that were
	  scattered around the code. The routines, BTW, are very low
	  quality and
	  will likely fail in almost every circunstance expect the standard
	  serial
	  atomic calculations in 3d...

2009-05-19 09:01  xavier

	* [r5443] src/states/restart.F90: Now writing restart files can be
	  disabled by using:
	  
	  RestartFileFormat = restart_none

2009-05-19 09:19  acastro

	* [r5444] src/system/output_etsf.F90: Some changes needed to
	  compile in single precision. The ETSF library
	  uses double precision data type (question: always? can one
	  compile the
	  library in single precision mode? or are there single precision
	  version of the routines?), and so one has to be a little careful
	  when
	  calling the library.

2009-05-19 09:29  xavier

	* [r5445] src/states/modelmb_particles.F90: Fxies compilation with
	  g95.

2009-05-19 09:30  xavier

	* [r5446] src/system/output_me.F90: Fixes compilation in parallel.

2009-05-19 09:40  mjv500

	* [r5447] src/include/global.h, src/states/modelmb_particles.F90: 1
	  more amp in SAFE_ALLOC and cleaner names in modelmb_part

2009-05-19 09:57  marques

	* [r5448] src/grid/mesh.F90, src/hamiltonian/hamiltonian.F90: *)
	  Number of digits in the output of the number of mesh points had
	  to be
	  increase ;) Yes, I run something with more than 100 milion mesh
	  points...
	  *) Vhartree and vxc is only allocated when not running in
	  independent
	  particles.

2009-05-19 10:00  sakko

	* [r5449] src/td/td.F90: bug fix, previously ions were not kicked
	  at all in kick_density mode (since KICK_DENSITY_MODE = 0)

2009-05-19 10:22  acastro

	* [r5450] src/opt_control/opt_control.F90,
	  testsuite/optimal_control/02-sym_doublewell.test: Fixed some
	  compilation issues in single precision.

2009-05-19 10:34  xavier

	* [r5451] src/grid/nl_operator.F90: Improved the documentation for
	  OperateDouble and OperateComplex.

2009-05-19 13:08  xavier

	* [r5452] src/grid/io_function_inc.F90, src/states/restart.F90:
	  Added profiling regions to the restart functions.

2009-05-19 16:00  marques

	* [r5453] src/grid/mesh.F90: Fixed a FIXME in the output

2009-05-19 16:23  acastro

	* [r5454] src/opt_control/opt_control.F90: Several bugs (introduced
	  when I attempted to make the OCT stuff work
	  in single precision, which is not yet working always).

2009-05-19 21:01  acastro

	* [r5455] src/opt_control/opt_control.F90: More fixes to make the
	  code compile in single precision mode.

2009-05-19 21:44  xavier

	* [r5456] src/grid/par_vec.F90, src/grid/par_vec_inc.F90,
	  src/system/Makefile.am: Added the X(vec_selective_gather)
	  function, it collects a number of
	  points of a distributed vector.

2009-05-19 22:29  xavier

	* [r5457] src/grid/par_vec.F90, src/grid/par_vec_inc.F90: Added the
	  X(vec_selective_scatter) function.

2009-05-20 12:58  xavier

	* [r5458] src/basic/mpi.F90, src/grid/submesh.F90: When running
	  parallel in domains, a submesh contains a communicator
	  with all the processes that have points in that submesh.

2009-05-20 13:31  xavier

	* [r5459] src/hamiltonian/projector_inc.F90: Now the reduce buffer
	  in project_psi_batch includes the states.

2009-05-20 14:17  xavier

	* [r5460] src/hamiltonian/projector_inc.F90: The reduction in
	  project_psi_batch can also be done by projector
	  (currently it has to be enabled in the code).

2009-05-20 14:36  mjv500

	* [r5461] src/states/modelmb_exchange_syms.F90: cleaned exchangesym
	  routine

2009-05-20 18:10  micael

	* [r5462] src/system/output_etsf.F90: Now the correct ETSF_IO
	  pointer is used to store the wave-functions.

2009-05-20 19:24  xavier

	* [r5463] src/hamiltonian/projector_inc.F90: The reduction in the
	  project_psi_batch function has to be performed
	  after all calculations.

2009-05-20 21:09  xavier

	* [r5464] src/basic/profiling.F90, src/states/restart.F90,
	  src/system/v_ks.F90, src/xc/vxc.F90: Some cleaning.

2009-05-21 01:03  dstrubbe

	* [r5465] src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90, src/sternheimer/kdotp_calc.F90,
	  src/system/pert_inc.F90: Converted k.p perturbation from d/dk to
	  -i d/dk, so that it is Hermitian. This makes a few formulae
	  simpler, but is also necessary for making a real version of k.p
	  so that real gs wfns give real k.p wfns.

2009-05-21 09:02  mjv500

	* [r5466] src/math/young.F90, src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: improved young projection output

2009-05-21 17:26  xavier

	* [r5467] configure.ac, m4/arch.m4, m4/sse.m4,
	  src/beak/Makefile.am, src/beak/beak.h, src/beak/beak_utils.c,
	  src/beak/operate_as.S, src/beak/operate_ia64.S,
	  src/beak/operate_ri_vec.c, src/grid/nl_operator_inc.F90,
	  src/states/states.F90: * I changed how the special code is
	  enabled for compilation. Now it is
	  done mostly by autoconf instead of using the C preprocessor.
	  
	  * I removed the code of the alternative malloc, all the functions
	  should
	  work with unaligned access, but I have to check it.

2009-05-21 17:48  mjv500

	* [r5468] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/system/output_states.F90: generalize antisym to more particle
	  types

2009-05-21 20:21  dstrubbe

	* [r5469] src/sternheimer/Makefile.am, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90,
	  src/sternheimer/kdotp_calc_inc.F90, src/system/pert.F90: *) As
	  Miguel suggested long ago at Mandragora, I added a real version
	  of k.p, making corresponding changes to routines using k.p wfns.
	  *) Added an error message if you try to run k.p on a finite
	  system
	  *) em_resp and k.p report whether they are using real or complex
	  wavefunctions
	  *) push_sub's in pert.F90

2009-05-21 21:08  xavier

	* [r5470] m4/arch.m4: Now sse2 is disabled by default in 32 bit
	  x86.

2009-05-21 21:23  xavier

	* [r5471] src/system/pert.F90: Fixes compilation problem.

2009-05-22 00:34  dstrubbe

	* [r5472] src/grid/multigrid_inc.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/opt_control/check_input.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90: *) Some trivial changes to
	  punctuation
	  *) Moved hyperpolarizability message to main routine, where other
	  messages are
	  *) Alphabetized modules in gauge_fields

2009-05-22 00:39  dstrubbe

	* [r5473] src/grid/multigrid_inc.F90, src/hamiltonian/epot_inc.F90:
	  Undid two changes to files I didn't mean to commit.

2009-05-22 08:52  marques

	* [r5474] src/hamiltonian/epot_inc.F90, src/species/species.F90: *)
	  In the SP6, please do not put something like "write ()
	  function_call()", as it will likely yiled the error "recursive
	  write"
	  *) The SP6 compiler does not liek some forall

2009-05-22 12:36  xavier

	* [r5475] src/grid/Makefile.am, src/grid/grid.F90,
	  src/grid/multigrid.F90, src/grid/multigrid_inc.F90,
	  src/grid/transfer_table.F90: Now the multigrid transfer tables
	  have their own module.

2009-05-22 15:50  xavier

	* [r5476] src/hamiltonian/projector_inc.F90: More fixes for xlf in
	  the SP6.

2009-05-22 15:58  xavier

	* [r5477] src/grid/multigrid_inc.F90, src/hamiltonian/epot_inc.F90,
	  src/poisson/poisson_multigrid.F90,
	  src/system/preconditioners_inc.F90: Changed the arguments for
	  some multigrid functions.

2009-05-22 17:33  xavier

	* [r5478] src/poisson/poisson_multigrid.F90: A line was too long.

2009-05-22 20:48  xavier

	* [r5479] testsuite/oct-run_regression_test.pl: Now the testsuite
	  uses the standard way of executing MPI jobs. (The
	  standard command is mpiexec and the standard flag for the number
	  of
	  processes is -n .)

2009-05-22 22:47  dstrubbe

	* [r5480] testsuite/periodic_systems/06-h2o_pol_lr.01_gs.inp,
	  testsuite/periodic_systems/06-h2o_pol_lr.02_kdotp.inp,
	  testsuite/periodic_systems/06-h2o_pol_lr.03_emresp.inp,
	  testsuite/periodic_systems/06-h2o_pol_lr.test,
	  testsuite/periodic_systems/Makefile.am: Added a test for dipole
	  and polarizability of H2O molecule in large supercell. Effective
	  masses and Born effective charges should be coming soon.

2009-05-23 08:06  xavier

	* [r5481] src/grid/mesh_init.F90, src/grid/multigrid_inc.F90,
	  src/system/preconditioners.F90: Now mesh%vol_pp has size 1 if the
	  grid is non-curvilinear. This saves
	  memory and reduces the initialization time of the mesh.

2009-05-23 08:38  xavier

	* [r5482] src/ions/simul_box.F90: A small optimization in
	  simul_box_in_box (with thousands of atoms this
	  thing become important, specially if they are serial).

2009-05-23 09:48  xavier

	* [r5483] src/grid/mesh_init.F90: Improved the way boundary points
	  are partitioned, now it is done
	  faster, using much less memory and it is a bit more balanced.

2009-05-23 16:56  acastro

	* [r5484] src/opt_control/check_input.F90,
	  src/opt_control/opt_control.F90, src/td/Makefile.am,
	  src/td/td_rti.F90, src/td/td_rti_qoct_inc.F90: Added
	  Crank-Nicholson as a possible propagator for the QOCT equation
	  with interacting electrons; it seems to behave better than the
	  only
	  one that was possible before.
	  
	  Since the td_rti.F90 file was growing too large, I separated the
	  QOCT
	  propagators.

2009-05-24 13:09  xavier

	* [r5485] src/poisson/poisson_multigrid.F90: * Multigrid now uses a
	  correction scheme instead of a full
	  approximation scheme.
	  
	  * Bugfix: Some boundary updates were missing in multigrid
	  relaxation,
	  this affected the parallel case.

2009-05-24 14:09  xavier

	* [r5486] src/poisson/poisson.F90,
	  src/poisson/poisson_multigrid.F90, src/system/v_ks.F90: *
	  Modified the default parameters for multigrid.
	  * For iterative solvers, a better starting point is given by
	  using the
	  extrapolated potential.

2009-05-24 16:07  xavier

	* [r5487] src/math/solvers_inc.F90, src/poisson/poisson_cg.F90,
	  src/poisson/poisson_corrections.F90: Optimization and cleaning of
	  the conjugated gradients poisson solver
	  and the poisson correction.

2009-05-25 12:39  marques

	* [r5488] src/basic/profiling.F90, src/grid/mesh_init.F90: A
	  variable was not nullified when using the HyperBox

2009-05-25 17:09  xavier

	* [r5489] src/grid/grid.F90, src/grid/mesh_init.F90: Rearranged
	  some loops to speed up intialization of the mesh.

2009-05-25 18:26  xavier

	* [r5490] src/grid/index.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90: Removed Lxyz_tmp and x_tmp.

2009-05-25 20:08  xavier

	* [r5491] src/grid/mesh_init.F90: Now bits are used to mark the
	  points in mesh initialization.

2009-05-25 21:31  xavier

	* [r5492] src/sternheimer/em_resp_calc_inc.F90: This file was
	  taking too long to compile, splitting a function solves
	  the problem.

2009-05-25 23:03  xavier

	* [r5493] src/grid/mesh_init.F90, src/grid/par_vec_inc.F90,
	  src/hamiltonian/projector_inc.F90: * Too long lines were causing
	  compilation with g95 and MPI to fail.

2009-05-26 06:19  sakko

	* [r5494]
	  testsuite/finite_systems_3d/25-multiresolution.01-Hatom.inp,
	  testsuite/finite_systems_3d/25-multiresolution.test,
	  testsuite/finite_systems_3d/Makefile.am: Added a test for
	  multiresolution.

2009-05-26 09:23  marques

	* [r5495] ChangeLog, libxc/ChangeLog, src/basic/profiling.F90,
	  src/grid/mesh_init.F90: *) Added a MemoryLimit variable. Octopus
	  will stop if this variable is set and if the total memory
	  depasses its value
	  *) Octopus was not compiling in 4D due to array mismatches

2009-05-26 09:24  marques

	* [r5496] src/hamiltonian/scf_tol.F90: Forgot debug statement
	  (thanks David)

2009-05-26 10:42  sakko

	* [r5497] src/grid/mesh.F90, src/grid/mesh_init.F90,
	  testsuite/finite_systems_3d/25-multiresolution.test: Implemented
	  a crude method for estimating grid point volumes in
	  multiresolution calculation.

2009-05-26 10:44  xavier

	* [r5498] src/basic/global.F90, src/hamiltonian/epot.F90,
	  src/ions/geometry.F90, src/scf/scf.F90, src/td/td.F90,
	  src/td/td_write.F90: * The interaction of ions with lasers and
	  electric fields had the
	  wrong sign.
	  
	  * Introduced the constant P_PROTON_CHARGE (=-1.0) to mark
	  explicitily where this value should be considered.
	  
	  * Now geometry_dipole returns the charge in atomic units.

2009-05-26 11:56  xavier

	* [r5499] src/basic/profiling.F90, src/grid/basins.F90,
	  src/ions/geometry.F90, src/ions/simul_box.F90, src/main/gcm.F90,
	  src/main/unocc.F90, src/states/restart.F90,
	  src/utils/phonon_spectrum.F90: Fix by Tobias Burns:
	  
	  I found huge(REAL_PRECISION) which of course does not make much
	  sense.
	  That is equivalent to huge(4) (or, equivalently, to huge(8))
	  which
	  returns the largest default-kind integer. I'm pretty sure that
	  the
	  largest 4- or 8-byte real number was intended.
	  
	  I think the cleanest way is to change it to x = huge(x)
	  alternatively
	  one can use huge(M_ONE) or M_HUGE, but I think x < huge(x) is
	  algorithmically cleaner.

2009-05-26 14:29  xavier

	* [r5500] src/grid/mesh.F90, src/main/run.F90,
	  src/states/states.F90: Some fixes to the memory runmode:
	  * For large systems it was giving negative numbers.
	  * It does not generate the ionic potential, so it is faster now.

2009-05-26 16:28  xavier

	* [r5501] src/ions/simul_box.F90: Removed the recursivity in
	  simul_box_end (if there is a memory leak,
	  please fix it in a reasonable way).

2009-05-26 20:04  xavier

	* [r5502] src/basic/profiling.F90: Now the information about
	  throughput and bandwidth are accumulative.

2009-05-26 20:39  xavier

	* [r5503] src/grid/mesh_init.F90: Removed some ' from comments.

2009-05-26 21:50  dstrubbe

	* [r5504] src/ions/geometry.F90, src/scf/scf.F90,
	  testsuite/linear_response/02-h2o_pol_lr.test,
	  testsuite/oct-run_regression_test.pl: *) Made two corrections to
	  Xavier's recent changes to dipoles, to restore the correct
	  behavior. The variable P_PROTON_CHARGE was multiplied twice in
	  the geometry_dipole routine, and the sign of the eventual dipole
	  was reversed.
	  *) Made it so you can set the path for the temporary directories
	  used in the testsuite. With this and the recent change to
	  mpiexec, I now no longer have to edit the testsuite script to run
	  make check on a Cray machine.
	  *) Added a test for dipole moment for H2O as finite system, to
	  detect future alterations to the dipole calculation.

2009-05-26 23:56  dstrubbe

	* [r5505] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/ions/geometry.F90, src/states/states.F90,
	  src/system/Makefile.am, src/system/h_sys_output.F90,
	  src/system/output_h_sys.F90: *) Renamed file output_h_sys to
	  h_sys_output to be consistent with the name of its modules and
	  functions.
	  *) Added many push_sub statements
	  *) Some modifications to variable documentation
	  *) Enabled writing geometry in XSF format, as well as XYZ. Unlike
	  XYZ, XSF includes the lattice vectors and convenient for periodic
	  systems.
	  *) XSF output now correctly uses terms for level of periodicity
	  *) Coordinates in XSF file now are in the units of UnitsOutput.

2009-05-27 00:28  dstrubbe

	* [r5506] src/grid/io_function.F90: Long line shortened.

2009-05-27 08:24  sakko

	* [r5507] src/grid/mesh_init.F90,
	  testsuite/finite_systems_3d/25-multiresolution.test: Improved
	  calculation of grid point resolutions and volumes (in
	  multiresolution).

2009-05-27 11:05  marques

	* [r5508] Small changes required to compile octopus with ifort

2009-05-27 14:07  xavier

	* [r5509] * Code format fixes.
	  * Added an operation count.

2009-05-27 16:03  xavier

	* [r5510] Fixes problems with the assembler code on Itanium.

2009-05-27 22:17  acastro

	* [r5511] Bug fix (thanks to Tobias Burnus for pointing this out).
	  Two
	  interfaces that should be equal differed (the intent(out) in one
	  place
	  was declared as intent(inout) elsewhere. I prefer to put both
	  intent(inout) since this way one makes sure that nothing is
	  undefined
	  on output).

2009-05-28 00:26  dstrubbe

	* [r5512] *) Enabled writing of file with structure and forces in
	  XCrySDen format
	  *) Fixed mistaken handling of unit conversion for cell origin in
	  XSF output
	  *) Fixed mistaken handling of aperiodic systems in XSF output
	  *) Fixed name of 1D-periodic system in XSF output

2009-05-28 09:03  sakko

	* [r5514] created a structure for multiresolution

2009-05-28 14:19  sakko

	* [r5515] Changing the input variable for defining multiresolution
	  regions, and some related changes.

2009-05-28 22:55  dstrubbe

	* [r5516] *) Corrected an insidious compiler/library-dependent bug
	  in the calculation of effective masses. If you pass a
	  multi-dimensional array to one of the mesh functions (mf_nrm2,
	  mf_dotp, etc.), and the first dimension is not the mesh points,
	  the function will ignore the multi-dimensional nature of the
	  array and calculate over a mix of the various elements in the
	  array -- with ifort and BLAS as on corvo or a cluster at LBL. But
	  with the PGI compiler on a Cray, there is no problem. A
	  cautionary tale!
	  *) Added tests for cross section, inverse effective masses (since
	  they are now correct), and Born effective charges.
	  *) Also renamed m to mesh in kdotp_calc_inc.

2009-05-29 06:31  xavier

	* [r5517] With 6000 atoms, checking if a point is inside the
	  minimum box becomes
	  an expensive task. So I added the simul_box_in_box_vec function,
	  that
	  checks simultaneously for an set of points, this is around 100
	  times
	  faster.

2009-05-29 07:11  xavier

	* [r5518] To avoid code duplication, now simul_box_in_box calls
	  simul_box_in_box_vec.

2009-05-29 07:46  xavier

	* [r5519] * Added OpenMP parallelization to
	  nl_operator_operate_batch.
	  * Removed OpenMP parallelization of blas routines.

2009-05-29 10:48  sakko

	* [r5520] Some small changes in preparation for many
	  multiresolution levels.

2009-05-29 14:39  xavier

	* [r5521] * Now when the variable StatesSaveMemory is set to yes,
	  wavefunctions
	  are allocated with size mesh%np instead of mesh%np_part. The size
	  of
	  the wave functions can be queried in the code through the logical
	  variable st%np_size. Of course, most of the code does not work in
	  this
	  mode.
	  
	  * Fixed the rmmdiis eigensolver to run with StatesSaveMemory =
	  yes.
	  
	  * Added the function batch_set, that copies the content of an
	  array to
	  a batch.

2009-05-29 15:17  sakko

	* [r5522] More small changes.

2009-05-29 15:43  xavier

	* [r5523] Now time propagation with aetrs and taylor work with np
	  size states.

2009-05-29 19:09  sakko

	* [r5524] Changed the method for calculating integrals with
	  multiresolution: now the values of the integrand are interpolated
	  to the intermediate points. A nice thing is that this needs to be
	  done only once. The upgrade should also solve the problem with
	  point volumes.

2009-05-29 19:35  xavier

	* [r5525] * The normal exponential now also works with vectors of
	  size np.

2009-05-30 08:22  xavier

	* [r5526] When possible, blas syrk/herk are used for the
	  orthogonalization.

2009-05-30 09:17  xavier

	* [r5527] * Created a separated module for mesh functions that
	  operate over a
	  batch.
	  
	  * Fixed the compilation error introduced in my a previous commit.

2009-05-30 09:59  sakko

	* [r5528] Generalizes the volume calculation to arbitrary number of
	  resolution levels.

2009-05-30 13:51  xavier

	* [r5529] Added the mesh_batch_dotp_self function, that calculates
	  the dot
	  products between all elements of a batch.

2009-05-30 19:13  sakko

	* [r5530] Three levels of resolutions are working now.

2009-05-30 20:42  xavier

	* [r5531] Replaced states_linear_combination by mesh_batch_rotate.

2009-05-31 09:16  xavier

	* [r5532] Added an x86_64 assembler version of operate (generated
	  from
	  operate_vec by gcc), this is useful for testing and for
	  optimization
	  with C compilers that do not support vectorial primitives.

2009-05-31 10:45  xavier

	* [r5533] I forgot to use the FC_FUNC_ macro in the assembler code.

2009-05-31 11:22  xavier

	* [r5534] A missing deallocation.

2009-06-01 10:32  xavier

	* [r5535] The x86_64 assembler code is causing problems, so I will
	  remove it for
	  the moment.

2009-06-01 12:32  mjv500

	* [r5536] dimensionality should always be MAX_DIM

2009-06-01 17:43  xavier

	* [r5537] Optimization of the generation of the minimum mesh: the
	  space is
	  divided in cubic cells, each one with a list of atoms. So, when
	  an
	  point has to be checked, only the list for its corresponding cell
	  is
	  used.

2009-06-01 18:01  xavier

	* [r5538] * Fixed compilation error.
	  * Increased the size of the cells.

2009-06-01 21:53  dstrubbe

	* [r5539] Removed a space to get rid of a warning when running
	  automake.

2009-06-02 08:20  xavier

	* [r5540] Now oct-vibrational reads the SpecMaxEnergy variable.

2009-06-02 09:32  sakko

	* [r5541] Arbitrary number of resolution levels.

2009-06-02 10:32  sakko

	* [r5542] Non-origin centered multiresolution region.

2009-06-02 14:53  sakko

	* [r5543] Modifications and clarification of my recent updates.

2009-06-02 16:07  xavier

	* [r5544] Bugfix: ghost update was not done by
	  nl_operator_operate_batch.

2009-06-02 16:22  xavier

	* [r5545] Bugfix: Octopus was trying to deallocate a dangling
	  pointer.

2009-06-03 09:01  sakko

	* [r5546] Error check + small changes.

2009-06-03 12:27  acastro

	* [r5547] Added the possibility of defining a species by reading a
	  file -- which
	  should have been written by octopus in a previous run. I also
	  used the
	  opportunity to clean some things in the species_m module,
	  declaring
	  the species_t as private (that is the reason for the many files
	  that I
	  change in this commit, all changes being trivial).

2009-06-03 19:32  xavier

	* [r5548] The RCB was called instead of the RIB in Zoltan.

2009-06-03 19:46  xavier

	* [r5549] The Gram-Schmidth ortogonalization now is done using a
	  Cholesky
	  decomposition.

2009-06-03 20:53  xavier

	* [r5550] Added the interface to blas_trsm.

2009-06-03 21:10  xavier

	* [r5551] * Added an interface for lapack_potrf.

2009-06-03 21:54  xavier

	* [r5552] Moved some lapack interfaces to lapack_m.

2009-06-03 22:20  xavier

	* [r5553] Added the count of operations for blas_trsm.

2009-06-03 22:45  dstrubbe

	* [r5554] *) In fact the k.p perturbation is supposed to be id/dk
	  not -id/dk, which made a sign error in the electronic
	  contribution to the Born effective charges.
	  *) Added an option for diagnostics to turn off the correction of
	  Born effective charges according to the acoustic sum rule, so you
	  can easily see what they were beforehand.
	  *) Took into account the case that both positive and negative
	  frequencies are considered, for real wavefunctions, in
	  calculating Born effective charges, which was left out before.
	  *) Corrected a typo in output.
	  *) Made some improvements to the output of Born effective
	  charges.
	  *) Removed apology in test for bad results of Born effective
	  charges, since it was not the coarse mesh but a bug that was at
	  fault. But to get vaguely reasonable values I decreased the mesh
	  slightly, and made corresponding changes to the test values.

2009-06-03 23:47  dstrubbe

	* [r5555] *) Changed svn:ignore properties to get rid of a bunch of
	  ? from svn status.
	  *) Added FromScratch = yes to some tests to remove warnings about
	  being unable to read from restart directory.
	  *) Added a Cl pseudopotential since I am using this frequently.

2009-06-04 06:34  xavier

	* [r5556] * The function lalg_cholesky is now used by the
	  orthogonalizer.
	  * Added profiling regions to lalg_cholesky.

2009-06-04 07:00  xavier

	* [r5557] The Cl pseudopotential was missing from the Makefile.

2009-06-04 11:13  marques

	* [r5558] I removed the tests for the two sse headers. In
	  principle, the sse test in m4/arch.m4 should be able to find out
	  if it is OK to compile SSE or not. I hope that this solves
	  David's problem.

2009-06-04 11:23  marques

	* [r5559] Changed a varable name in order to get rid of autoreconf
	  warnings.

2009-06-04 12:54  xavier

	* [r5560] Fixes the compilation problem.

2009-06-04 16:59  xavier

	* [r5561] If the orthogonalizer fails (because vectors are not
	  independent) it
	  gives a warning.

2009-06-04 20:11  xavier

	* [r5562] The wave functions are only randomized if LCAO is not
	  done.

2009-06-04 20:47  xavier

	* [r5563] The orthogonalization is done until nst (and not st%nst).

2009-06-05 08:25  xavier

	* [r5564] The C60 test now uses the alternative LCAO.

2009-06-05 15:17  marques

	* [r5565] Yasumitsu Suzuki is right and the documentation is wrong!

2009-06-05 19:35  xavier

	* [r5566] Added a macro to check for MPI 2. The preprocessor
	  variable associated
	  is HAVE_MPI2.

2009-06-05 20:33  xavier

	* [r5567] * Defined the MPI_IN_PLACE_OR(x) macro, that return
	  sMPI_IN_PLACE if MPI2
	  is available or x otherwise.
	  
	  * Allreductions that might involve large arrays are done in
	  place.

2009-06-05 20:56  xavier

	* [r5568] More in place allreductions.

2009-06-05 22:15  xavier

	* [r5569] Some cleaning of the lanczos exponential.

2009-06-05 22:23  dstrubbe

	* [r5570] The 'volume element' being printed after the reciprocal
	  lattice vectors is meaningless because it always has the same
	  value (1) and had a unit conversion applied to it even though it
	  was dimensionless. I removed it, and now instead the real-space
	  volume of the cell is printed.

2009-06-05 22:50  dstrubbe

	* [r5571] *) Changed m to mesh
	  *) Some corrections to documentation

2009-06-05 22:55  xavier

	* [r5572] The lalg_eigensolve routine now works in place. (The
	  reason for this
	  changes is that arrays of size st%nst**2 can be too large, so we
	  should avoid unnecessary copies).

2009-06-05 23:24  xavier

	* [r5573] Fixes an out of bounds error.

2009-06-05 23:41  xavier

	* [r5574] I forgot to change one call to lalg_eigensolve.

2009-06-06 07:14  xavier

	* [r5575] Now batch_dotp_self does not copy the output array.

2009-06-07 05:53  xavier

	* [r5576] Added the check for the size of integers in fortran
	  (taken from libxc).

2009-06-07 06:27  xavier

	* [r5577] Added a profiling region for the dense matrix
	  eigensolver.

2009-06-07 08:52  xavier

	* [r5578] * The alternative LCAO now also works for other species
	  (besides
	  pseudo-potentials).
	  * Added more messagfes to the alternative LCAO.

2009-06-07 09:34  xavier

	* [r5579] Optimized a bit the calculation of atomic orbitals for
	  user defined species.

2009-06-07 10:07  xavier

	* [r5580] Added progress bars and profiling regions to the
	  alternative LCAO.

2009-06-07 12:56  xavier

	* [r5581] The old lcao is not initialized if the new one will be
	  used.

2009-06-07 15:39  xavier

	* [r5582] * Removed some unnecessary calculation of the
	  eigenvalues.
	  
	  * Fixed a bug in v_ks_calc: eigenvalues were calculated always
	  when
	  the optional argument calc_eigenval was present, even with a
	  false
	  value.

2009-06-07 18:19  acastro

	* [r5583] The interface to loct_minimize from the geom_opt_m module
	  was wrong;
	  Tobias Burnus pointed out the problem and the solution...

2009-06-08 06:17  xavier

	* [r5584] The size of an array could become considerable for a
	  large number of
	  states.

2009-06-08 15:20  xavier

	* [r5585] * Added some debug messages.
	  * Bugfix: the v_ks_calc routine still calculated the eigenvalues
	  if
	  calc_eigenvalues was false.

2009-06-08 15:26  xavier

	* [r5586] Removed an unnecessary copy in lalg_geneigensolve.

2009-06-08 16:35  xavier

	* [r5587] The generalized eigensolver destroyed b, now is restored
	  after the run.

2009-06-08 18:29  xavier

	* [r5588] Removed some debug calls that cause a considerable
	  overhead.

2009-06-08 20:11  xavier

	* [r5589] LCAO: Inverting the loop for generating the function
	  improves performance.

2009-06-08 21:00  xavier

	* [r5590] Alternative LCAO: only sphere per atom is initialized.

2009-06-08 21:19  xavier

	* [r5591] Alternative LCAO: the maximum radius is calculated
	  directly.

2009-06-09 16:30  xavier

	* [r5592] Added a function that generates a batch as a subset of
	  other.

2009-06-09 17:18  xavier

	* [r5593] Added a batch version of dsubmesh_add_to_mesh. This is
	  useful for the
	  LCAO.

2009-06-09 17:52  xavier

	* [r5594] * Some re-organization of the LCAO.
	  * Fixed compilation problems.

2009-06-09 18:20  xavier

	* [r5595] LCAO: Now the hamiltonian is applied in blocks.

2009-06-09 21:50  xavier

	* [r5596] * Fixed compilation problem.
	  * Some improvements of the LCAO.

2009-06-10 00:03  dstrubbe

	* [r5597] *) For reasons still unclear, the QMR solver can only
	  solve the Sternheimer equation for k-points different than Gamma
	  when a standard dot product, with complex conjugation, is used.
	  This is true for Hermitian (eta = 0) or non-Hermitian (eta != 0)
	  matrices, none of which are symmetric, yet we are using the
	  complex-symmetric version of the QMR solver, and it works
	  somehow. So now dotp is used instead of dotu, but only for the
	  solve_HXeY routine, not for open boundaries. OEP uses this
	  routine too -- someone should check what the classification of
	  the matrix is there, and whether it works now, or worked before.
	  *) Added ability to call general, not symmetric, version of QMR
	  for linear solver. As yet unused.
	  *) Changed documentation to reflect the actual default linear
	  solver.
	  *) Only calculate circular dichroism for finite systems, because
	  it involves matrix elements of r which are wrong until quantum
	  theory of polarization is incorporated.
	  *) Effective mass files were never closed, causing problems for
	  large numbers of k-points.
	  *) Some improvements to documentation, and adding references
	  about solvers
	  *) Changed name "dotp" to "dotu" in qmr routines, to reflect the
	  fact that they are supposed to use dotu not dotp.
	  *) Some improvements to documentation and output for k-points
	  *) Set default to false for KPointsUseSymmetries, since this
	  doesn't seem to be treated correctly, and causes symmetry
	  breaking in the calculation.

2009-06-10 12:36  xavier

	* [r5598] The calculation of the matrix elements of the hamiltonian
	  in the LCAO
	  basis is done by blocks.

2009-06-10 13:11  xavier

	* [r5599] The configure script now checks directly for
	  MPI_IN_PLACE.

2009-06-10 13:45  xavier

	* [r5600] Removed several checks in the configure that we don't
	  use.

2009-06-10 14:21  xavier

	* [r5601] My check for MPI_IN_PLACE was wrong.

2009-06-10 14:33  xavier

	* [r5602] More changes in the configure.

2009-06-10 14:37  xavier

	* [r5603] Removed some single quotes from comments.

2009-06-13 08:44  xavier

	* [r5604] This is something I implemented some time ago. Only the
	  changes in
	  the array of neighbours are read, and they are marked by a
	  bitfield,
	  reducing the array to one third.

2009-06-13 09:29  xavier

	* [r5605] I forgot a file.

2009-06-14 09:28  xavier

	* [r5606] Fixes the scissor operator.

2009-06-15 00:31  dstrubbe

	* [r5607] *) Corrected unit conversion for cross section.
	  *) Added Born charges to the test of water as a finite system.

2009-06-15 15:40  nitsche

	* [r5608] * fixed a nasty MAX_DIM related bug, maybe this fixes
	  some of the buildbot tests

2009-06-16 11:35  nitsche

	* [r5609] * extended output for surface Green function calculation
	  * more bugfixes (allocation of arrays with size 0, probably the
	  cause for some test-suite failures)
	  * removed double saving of the wave function in the transport
	  propagator
	  * initial changes for simulating an open system with leads
	  attached to every side, not working yet
	  - added variable OpenBoundariesMaxMemCoeffs, this is useful for
	  simulating an open system with a linear scaling propagation
	  - changed interface calculations to handle a non-connected mesh
	  * updated some open boundary tests

2009-06-16 11:38  nitsche

	* [r5610] * forgot this file

2009-06-16 13:49  nitsche

	* [r5611] * a line was too long

2009-06-16 14:18  acastro

	* [r5612] Fixed a problem found by Tobias -- once again, a mismatch
	  with
	  interfaces definition. It seems that the usual compilers are not
	  picky
	  enough...

2009-06-16 14:40  acastro

	* [r5613] Fixed a bug that caused troubles with some tests (the
	  ones that used
	  jellium). The problem is related to the fact that now vol_pp has
	  only
	  one element if the curvilinear meshes are not used.

2009-06-16 20:51  helbig

	* [r5614] KSinversion working, needs improvements

2009-06-16 23:40  dstrubbe

	* [r5615] *) Enforcement of acoustic sum rule for Born charges now
	  takes into account the possibility that the system is not neutral
	  *) For 3-D periodic systems, the dielectric constant (real and
	  imaginary) is now printed in em_resp calculations, since it is
	  more meaningful than the polarizability and cross section.
	  *) Fixed arguments to X(multigrid_coarse2fine) function: now it
	  gives wrong numbers rather than NaN...

2009-06-17 10:39  xavier

	* [r5616] Changed the interface for the subspace diagonalization,
	  now the
	  wave-functions and eigenvalues have to be passed explicitly.

2009-06-17 12:38  nitsche

	* [r5617] * some more bugfixes (some arrays were indexed without
	  being allocated, allthough there were not used)
	  * more stuff added for open system

2009-06-17 12:46  xavier

	* [r5618] Too long line.

2009-06-17 14:37  nitsche

	* [r5619] * changed order of the lead numbering
	  * the interface can now hande leads in all 3 (cartesian)
	  directions

2009-06-18 13:13  nitsche

	* [r5620] * changed OpenBoundariesBiCGMaxIter and
	  OpenBoundariesBiCGTol to OpenBoundariesQMRMaxIter and
	  OpenBoundariesQMRTol as the QMR solver is used, also changed this
	  in the test-files
	  * now calc_diag and calc_offdiag can calculate the matrices of
	  the operators on any side of the simulation box (needed for open
	  systems), removed a now obsolete function
	  * the QMR solver gives slightly more information if it is not
	  converged

2009-06-19 18:53  dstrubbe

	* [r5621] Fixed compilation in parallel.

2009-06-19 22:04  dstrubbe

	* [r5622] *) Make it possible to specify a default linear solver
	  from the code
	  *) Made cg the default when eta = 0 for kdotp and em_resp, and
	  qmr the default otherwise
	  *) Removed specific reference to OpenBoundaries in QMR solver,
	  since it is called for the Sternheimer equation and OEP also.

2009-06-22 21:07  xavier

	* [r5623] Some fixes in the cubic_mesh.

2009-06-22 21:59  xavier

	* [r5624] Added fourier_kernel module.

2009-06-23 05:48  xavier

	* [r5625] A too long line.

2009-06-23 22:21  dstrubbe

	* [r5626] *) Added various flavors of the QMR solver to solve_HXeY:
	  symmetric matrices, symmetrized (A^T A) matrices, general
	  matrices, and symmetric algorithm with conjugated dot product. It
	  is still unclear why the last works, but it appears to be
	  generally the fastest and most robust solver, better even than CG
	  and BiCGSTAB.
	  *) All solvers give warning when unconverged now.
	  *) Default for solving Sternheimer equation is QMR with
	  conjugated dot product.
	  *) Removed spurious extra line in QMR not-converged warning.

2009-06-23 22:39  dstrubbe

	* [r5627] I forgot you're not supposed to compare logical types
	  with .ne. I hate -pedantic...

2009-06-24 14:15  marques

	* [r5628] *) Hartree-Fock now works with spinors (I hope)
	  *) Added Becke-Roussel Meta-GGA. This one should be working asa
	  it was tested against a piny_md.
	  *) Because of that i had to change slightly the interface to
	  libxc

2009-06-24 14:26  marques

	* [r5629] *) I made a mistake in the year of becke-roussel
	  *) hopefully it now compiles

2009-06-24 15:18  marques

	* [r5630] Added the famous new functional of Tran & Blaha. This was
	  not tested, and there is a factor of 2 that is bugging me...

2009-06-24 15:19  marques

	* [r5631] Forgot a factor.

2009-06-24 19:49  dstrubbe

	* [r5632] *) Added myself to the list of authors
	  *) Corrected documentation about finite-difference calculation.

2009-06-25 10:47  xavier

	* [r5633] Now octopus can be cross compiled. To do it,
	  he user has to pass two variables
	  to the configure script:
	  
	  FC_INTEGER_SIZE=4
	  CC_FORTRAN_INT=int
	  
	  With this change octopus compiles in a Blue Gene/P.

2009-06-25 14:34  marques

	* [r5634] Now the mggas are again implemented in the code.

2009-06-25 14:55  nitsche

	* [r5635] * fixed some warnings of valgrind (some uninitialized
	  arrays)

2009-06-25 15:43  marques

	* [r5636] One can not run the PB09 thing, but, as expected, the
	  calculation for a finite system is kind of unstable... maybe it
	  is better for a solid ;)

2009-06-25 18:09  acastro

	* [r5637] A division by zero was attempted in the
	  01-wavepacket.test, because a
	  second order equation was solved with the general formula, but in
	  the
	  case in which the second degree coefficient was null. I corrected
	  this, the test now does not crash with invalid float, but the
	  final
	  numbers still don't match. Danilo, please take a look at my fix,
	  since
	  I really cannot follow that part of the code.

2009-06-26 10:06  xavier

	* [r5638] Removed the submesh communicator, initialization seems to
	  be wrong and
	  it is not really used.

2009-06-26 10:07  xavier

	* [r5639] The OpenMP initialia

2009-06-26 14:41  nitsche

	* [r5640] * some more changes due to general open boundaries
	  * added a check if the offdiagonal in the transport calculation
	  gets zero, which should not be.

2009-06-26 16:06  xavier

	* [r5641] More changes in the new fft code.

2009-06-28 03:06  xavier

	* [r5642] Added a configure check for blue gene intrinsics.

2009-06-28 12:58  xavier

	* [r5643] Added a vectorial operator for the blue gene.

2009-06-28 13:37  xavier

	* [r5644] Forgot to commit one file.

2009-06-28 14:02  nitsche

	* [r5645] * fixed a compiler dependent bug, this should resolve the
	  problem with offdiag being zero. problem was using the same
	  parameter in calling a function, once used as intent(in), the
	  other case as intent(out). Depending on the compiler the original
	  variable was referenced or copied.

2009-06-28 20:58  xavier

	* [r5646] Small improvements in zoperate_bg.

2009-06-28 21:56  xavier

	* [r5647] The maximum size for op%ribit was not correct.

2009-06-28 22:34  xavier

	* [r5648] The serial poisson isf solver is not initialized if the
	  system is parallel in domains.

2009-06-29 04:12  xavier

	* [r5649] The C interface of fftw3 is required for cubic_mesh but
	  it is not
	  always available, so I will comment the code for the moment..

2009-06-29 06:13  nitsche

	* [r5650] * for some reason the parser does not like the variable r
	  in the input files anymore, so I replaced it (open
	  boundary-tests).

2009-06-29 07:53  nitsche

	* [r5651] * a non initialized array sometimes produced NaNs

2009-06-29 09:32  xavier

	* [r5652] Now each node prints a copy of exec/nl_operator_prof.

2009-06-29 09:46  xavier

	* [r5653] For better mpi performance receives must be started
	  before sends.

2009-06-29 09:55  marques

	* [r5654] Some more corrections to the TP09 functional. I believe
	  that it might be working now.

2009-06-29 12:25  nitsche

	* [r5655] * updated open boundary test (the last test with mpi is
	  not really working yet, there is a problem with the lopcg
	  eigensolver in parallel)
	  * removed unused variables
	  * bugfix with mpi: only the root can close files
	  * more changings due to complete open boundaries

2009-06-29 14:51  xavier

	* [r5656] The update of the ghost points is now done by manually
	  packing the
	  data instead of using derived datatypes.

2009-06-29 15:02  marques

	* [r5657] This fixes the optimal control test that was failing

2009-06-29 15:36  marques

	* [r5658] An io_close missing was stopping the
	  open_systems/04-propagate_eigenstate.test. Now a bit more of the
	  test passes, but the second input file still fails with a wrong
	  value. Danilo, itś your turn ;))

2009-06-29 16:52  xavier

	* [r5659] OpenMP parallelization of the application of the local
	  potential.

2009-06-30 09:47  marques

	* [r5660] *) First step in the dircetion of vector calling libxc in
	  order to optimize performance.

2009-06-30 11:03  marques

	* [r5661] *) now the LDA works on vectors to a very low level
	  *) Rearranged th exchange and xalpha interfaces to make them more
	  standard
	  
	  Note that libxc at the moment has a inconsistent interface. I
	  will try to fix it soon.

2009-06-30 14:06  marques

	* [r5662] With this 2 line change to projector_inc.F90, the
	  fullerene test in my machine runs 20% faster!!! It sounds really
	  impossible, no?
	  The basic line is that allocates are expensive, so let us try to
	  reduce their number as much as possible!!!

2009-06-30 14:53  xavier

	* [r5663] Made some functions thread-safe.

2009-06-30 15:46  marques

	* [r5664] I changed the order of the loops in order to make
	  project_psi_batch scale
	  better with openMP. Now it is the ist loop the outer most, and
	  the size
	  of the block is 2 times the number of threads. The routine is 3
	  times faster
	  with 4 cores, which is not too bad I guess (at least it is 3
	  times faster
	  than before ;)
	  
	  Xavier, would it be possible to completely get rid of
	  X(project_psi) so that
	  we only have one version of the routine?

2009-06-30 16:43  xavier

	* [r5665] A small fix to Miguel's commit. In OpenMP 2.5 allocated
	  allocatables
	  cannot be declared private.

2009-06-30 18:29  xavier

	* [r5666] An updated version of the threaded projector operator.
	  The two previous
	  ones did not work correctly on the Blue Gene.

2009-06-30 20:47  xavier

	* [r5667] Some more openmp parallelization.

2009-07-01 08:10  xavier

	* [r5668] The OpenMP parallelization of the generation of the
	  density was wrong.

2009-07-01 08:49  marques

	* [r5669] I got rid of the routine project_psi. Now it simply calls
	  project_psi_batch.

2009-07-01 08:59  xavier

	* [r5670] Moved the allocation out of the loops in the projector
	  operation.

2009-07-01 09:50  xavier

	* [r5671] Generalized the vector scatter and gather routines, now
	  the receive
	  the root as argument.

2009-07-01 11:10  marques

	* [r5672] I think I solved the performance hit when running
	  profiling in memory.
	  The problem is that trim was being called 8 million times for the
	  c60 test,
	  while not being really necessary. So I got rid of it. Now trim is
	  only
	  called 200 000 times ;)

2009-07-01 12:43  xavier

	* [r5673] The same packing routine is now used for all versions of
	  ghost_update.

2009-07-01 15:34  xavier

	* [r5674] The der_handle_init and der_handle_end functions are now
	  private.

2009-07-01 17:27  xavier

	* [r5675] Two new functions: derivatives_batch_start and
	  derivatives_batch_finish.

2009-07-01 20:36  xavier

	* [r5676] A batch version of ghost_update.

2009-07-01 20:53  xavier

	* [r5677] A memory leak.

2009-07-01 21:52  xavier

	* [r5678] The packing for ghost update is now multi-threaded.

2009-07-02 12:16  xavier

	* [r5679] Small bugfix.

2009-07-02 15:57  marques

	* [r5680] Several opnMP directives

2009-07-03 12:55  marques

	* [r5681] Some more omp

2009-07-03 16:15  xavier

	* [r5682] Bugfix: all boundaries were sent with a fixed tag, so in
	  principle
	  messages could mix.

2009-07-03 18:42  xavier

	* [r5683] The stupid intel compiler was passing a copy of the array
	  to
	  MPI_Irecv, so the original array was not updated.

2009-07-05 06:53  xavier

	* [r5684] To avoid problems with MPI calls we should always pass
	  the first
	  element of the array. I started changing the existing calls.

2009-07-05 08:34  xavier

	* [r5685] Changed more MPI calls.

2009-07-06 12:45  xavier

	* [r5687] Unit conversion of the coordinates was missing for the
	  plane and axis
	  output.

2009-07-06 13:10  xavier

	* [r5688] The cg "new" eigensolver was using the full
	  orthogonalization in funny
	  way.

2009-07-06 14:14  xavier

	* [r5689] * Removed the start parameter of the full gram schmidt
	  orthogonalization.
	  
	  * Removed the orthogonalization of the wave-functions after a
	  partial
	  restart read.

2009-07-06 16:03  xavier

	* [r5690] * Implemented orthogonalization by windows, it seems to
	  work
	  reasonably well even for small systems (I tried with a C60) but
	  more
	  testing is needed.

2009-07-06 21:21  nitsche

	* [r5691] * if parallel in k-points the initial random
	  wavefunctions are also have as the seed the rank
	  * the lopcg solver seems to have some problems with the square
	  potential, so changed all open boundary tests to cg_new, which
	  seems to work right now
	  * problem of the failing test was the random initial
	  wavefunction, had to change the final tolerance

2009-07-07 05:08  xavier

	* [r5692] I introduced the functions units_from_atomic and
	  units_to_atomic to
	  convert units. I think that this is much cleaner and flexible
	  than
	  multiplying or dividing by a factor.

2009-07-07 06:41  xavier

	* [r5693] Some improvements in units_m:
	  
	  * Defined the units_abbrev function.
	  * Overloaded *, / and ** for units_t.
	  * Defined unit_one.
	  
	  Now it is possible to write things like:
	  
	  g = units_to_atomic(length/time**2, g)
	  
	  or
	  
	  print*, trim(units_abbrev(length/time**2))

2009-07-07 09:01  nitsche

	* [r5694] * for some strange reason the number of points in a lead
	  unit cell was wrong with gfortran and even more strangly it was
	  correct again starting it with valgrind.

2009-07-07 12:46  xavier

	* [r5695] The alternative LCAO now works wih spin polarization
	  (spinors and k points are still missing).

2009-07-07 14:06  xavier

	* [r5696] Some unit conversions that now use the new functions.

2009-07-07 14:29  xavier

	* [r5697] I forgot to commit some changes.

2009-07-07 16:01  xavier

	* [r5698] A function that called MPI was used inside a OpenMP
	  region. This
	  can cause severe indigestion to a Blue Gene.

2009-07-08 13:23  xavier

	* [r5699] Defined an object for conversion to cm^-1.

2009-07-08 17:35  xavier

	* [r5700] Added a polymorphic interface for binary io.

2009-07-08 17:53  xavier

	* [r5701] Now the binary format supports integer values.

2009-07-08 18:46  xavier

	* [r5702] Now the lxyz file is written in .obf format.

2009-07-09 10:05  xavier

	* [r5703] Added a function to get the size of a obf file.

2009-07-10 18:00  xavier

	* [r5704] Added a macro to check for PAPI.

2009-07-10 23:09  nitsche

	* [r5705] * removed an unused array
	  * some arrays were not initialized, this could lead to strange
	  numerical issues with blas
	  * changed the default value of the small imaginary shift in the
	  green function calculation to a better value (residual is
	  smaller)
	  * added some debug info to the green function calculation

2009-07-10 23:29  nitsche

	* [r5706] * This should fix the problem with the different results
	  with different compilers. The problem is the LU factorization
	  (before the inversion), it happens that the numbers differ during
	  that process. Then the green function does not really converge. I
	  don't know exactly the reason why discretization order two
	  completly fixes this issue yet, so some more days of
	  investigation is on the way...

2009-07-11 00:15  nitsche

	* [r5707] * fixed typo (its getting late...)

2009-07-11 16:51  xavier

	* [r5708] Initial support for PAPI. It is used to count floating
	  point
	  operations.

2009-07-12 10:23  xavier

	* [r5709] A binary compiled with papi can now run if papi
	  initialization fails.

2009-07-14 10:55  acastro

	* [r5710] o Added a new variable, FFTPreparePlan, which permits to
	  choose the
	  way in which FFTW prepares the "plan" that is used to compute the
	  FFTs. Before, we only allowed the option of using the
	  "fftw_measure"
	  option, which stays as the default and is in fact usually the
	  best
	  option. It implies a slow initialization, but better plans. Now
	  we can
	  also use the "fftw_estimate" option, which is much faster to
	  initialize.
	  
	  o Removed some unnecessary restrictions for the input file
	  options in
	  the QOCT code.

2009-07-14 17:04  xavier

	* [r5711] I made a silly mistake in the papi interface. Now we get
	  more or less
	  reasonable numbers.

2009-07-14 19:47  dstrubbe

	* [r5712] *) static_pol run mode now exits with error if called for
	  periodic system
	  *) Changed some variable names for style and clarity.
	  *) Gave more information in output.
	  *) Incorporated new way of doing unit conversions.
	  *) Added output of density second derivative and
	  hyperpolarizability density.
	  *) Warning notes added that beta(ijk) is not calculated.

2009-07-14 20:13  dstrubbe

	* [r5713] *) Some corrections to documentation.
	  *) Changed POLStaticField to EMStaticField to bring it in line
	  with other variable names.
	  *) Changed "Green function" to "Green's function" in some places.

2009-07-15 00:19  dstrubbe

	* [r5714] Finite-differences electric perturbation:
	  *) Removed variable out_pol which appeared to have no effect.
	  *) Made calculations be repeated to get densities, if Output =
	  density or pol_density.
	  *) Fixed some mistakes in unit conversions.
	  *) Added calculation with another applied field, to get beta(ijk)
	  as well as density(ij) and hyperpolarizability density(ijk).
	  *) Changed names of output files to correspond more to
	  Sternheimer.
	  *) Removed warnings that ijk components weren't being calculated.
	  *) Changed test accordingly.
	  Elsewhere:
	  *) Some improvements to documentation and output and comments
	  *) Updated TPA output to use new unit conversion style.

2009-07-15 00:41  dstrubbe

	* [r5715] My nemesis, the long line, strikes again.

2009-07-15 07:50  marques

	* [r5716] Bug fix (I hope): restarting a GS calculation was
	  ignoring the occupancies block in the input file

2009-07-15 09:23  marques

	* [r5717] Now the GGas are also done in blocks. The current
	  interface is just a hack to make things work. I hope to be able
	  to fix it soon.

2009-07-15 09:46  marques

	* [r5718] Some more changes related to the interface. I am sure
	  that many of the non-standard functionals have problems, so be
	  careful.

2009-07-16 07:43  marques

	* [r5719] Added a sanity check for the total charge of the system

2009-07-16 20:38  xavier

	* [r5720] * Added a configure option to disable mpi2.
	  * Fixed compilation without mpi2.

2009-07-16 21:56  dstrubbe

	* [r5721] *) More unit conversions in new style
	  *) Fixed mistaken use of units_inp for output in circular
	  dichroism
	  *) Reorganized routines for sum-rule correction and output of
	  Born charges

2009-07-16 22:36  dstrubbe

	* [r5722] *) Changed confused line in Makefile to answer this
	  objection from make:
	  make[3]: Circular fourier_kernel.F90 <- fourier_kernel.o
	  dependency dropped.
	  *) Made both lines of warning be written
	  *) Changed single-letter variable

2009-07-17 12:52  nitsche

	* [r5723] * finally got the Umerski-scheme for the Green's function
	  working which is way faster and more stable, still Sancho's
	  method is used as a fallback and if the offdiagonal term is not
	  invertible (to be changed in near future)
	  * some bugfixes of some output (in debug mode and info)
	  * fixed a serious bug concerning higher derivative orders within
	  transport
	  * had to change one transport test as the new calculation of the
	  Green's function converges better

2009-07-17 12:52  nitsche

	* [r5724] * finally got the Umerski-scheme for the Green's function
	  working which is way faster and more stable, still Sancho's
	  method is used as a fallback and if the offdiagonal term is not
	  invertible (to be changed in near future)
	  * some bugfixes of some output (in debug mode and info)
	  * fixed a serious bug concerning higher derivative orders within
	  transport
	  * had to change one transport test as the new calculation of the
	  Green's function converges better

2009-07-17 13:20  marques

	* [r5725] Several bugs fixed. Among them:
	  *) Several is_tmp missing in io_open, so hell was open when
	  running with datasets
	  *) The initial occupation were totally wrong for solids

2009-07-17 15:20  xavier

	* [r5726] The new varinfo_option returns the numerical value that
	  correspond to a
	  certain option.

2009-07-17 20:30  xavier

	* [r5727] When Octopus is compiled in hybrid mode, MPI_Init_thread
	  is called
	  instead of MPI_Init.

2009-07-17 21:32  xavier

	* [r5728] Some cleaning.

2009-07-17 21:56  dstrubbe

	* [r5729] A few trivial changes.

2009-07-17 22:42  dstrubbe

	* [r5730] Sorry for committing all these things at once.
	  *) Reorganized use of #defined directories for restart and
	  output, and tried to make the names the same as the run mode in
	  both cases
	  *) "linear" directory now is "em_resp" (Sternheimer),
	  "em_resp_fd" (finite differences), "casida", and "vdw", since we
	  now have other linear-response routines that don't write there
	  (e.g. kdotp, vib_modes), and one of the routines writing there
	  was in fact not linear response (finite differences).
	  *) Added references in Casida routine.
	  *) Clarified documentation for Casida and changed names of
	  variables to explicitly say Casida, otherwise one might think
	  they applied to the Sternheimer approach.
	  *) New style of unit conversion in many places.
	  *) Renamed outputs of static_pol
	  *) Added and corrected push_sub's
	  *) Updated documentation of Output
	  *) Added unit conversions for DegeneracyThreshold

2009-07-19 06:18  xavier

	* [r5731] The communicator for domain parallelization can be
	  initialized with a
	  graph topology, this is controlled by the MeshUseTopology
	  variable.

2009-07-19 06:47  xavier

	* [r5732] mesh%mpi_grp is now generated with the new communicator.

2009-07-19 08:46  xavier

	* [r5733] Now the information about octopus compilation is more
	  detailed.

2009-07-19 10:02  xavier

	* [r5734] * Now octopus also prints information about the C
	  compiler and the
	  architecture.
	  
	  * If the compilers are the stupid mpicc or mpif90 wrappers, now
	  octopus
	  prints also the true compiler.

2009-07-20 10:05  marques

	* [r5735] Some more is_tmp were missing.

2009-07-20 13:53  marques

	* [r5736] A couple of bug fixes

2009-07-20 22:27  dstrubbe

	* [r5737] *) Replaced references to the restart directory 'gs' with
	  a preprocessor constant GS_DIR, to ensure these are all the same,
	  and could be changed cleanly if necessary.
	  *) More unit conversions in new style
	  *) Fixed some typos
	  *) Routine in states for some reason was writing eigenvalues vs
	  Fermi energy if spinors and periodic, otherwise absolute; now all
	  are absolute.
	  *) write_dos routine was not doing unit conversions from input to
	  atomic, and atomic to output

2009-07-21 03:32  dstrubbe

	* [r5738] *) Created Born charges module, so common things can be
	  used by different ways of calculating Born charges besides the
	  Sternheimer dF/dE approach.
	  *) Made Born charges for each frequency factor be written:
	  previously they overwrote each other.
	  *) Changed test accordingly.
	  *) Added a few hyphens.

2009-07-21 07:30  dstrubbe

	* [r5739] *) Added calculation of Born charges to
	  finite-differences electric response.
	  *) Removed unused variable from Born charges routine.
	  *) Moved Born charges module to different directory, so things
	  compile now. However there is still a seg-fault I can't track
	  down when you use it.

2009-07-21 08:56  marques

	* [r5740] This should solve the problem of David.

2009-07-21 09:13  marques

	* [r5741] This should fix the failure in the multigrid test

2009-07-21 14:14  xavier

	* [r5742] * The laplacian array in hamiltonian_apply_batch was
	  unnecessarily initialized to zero.
	  * Renamed t to time in the same function.

2009-07-21 14:37  nitsche

	* [r5743] * the memory coefficients were not recalculated if the
	  lead potential was changed
	  * some small cosmetics and rewriting

2009-07-21 18:02  xavier

	* [r5744] * Removed other useless initialization to zero.
	  * For the moment the hypercube does not work with absorbing
	  boundaries, so I added an assertion to make it fail.

2009-07-21 20:18  dstrubbe

	* [r5745] *) Fixed some bugs in finite-field calculation of Born
	  charges.
	  *) Added Born charges to Na2 test

2009-07-22 08:16  marques

	* [r5746] Changed the absorbing boundaries such that the corners of
	  the box are correctly taken into account. Abs. bound. should also
	  work now for the hypercube. Please test.

2009-07-22 08:20  marques

	* [r5747] Sorry, I missed a sqrt

2009-07-22 11:05  helbig

	* [r5748] invertks separated 2 particle and iterative cases

2009-07-22 13:08  helbig

	* [r5749] names for InvertKSmethod options added

2009-07-22 18:16  nitsche

	* [r5750] * fixed a problem with the reading of the memory
	  coefficients introduced with my last commit

2009-07-23 01:27  dstrubbe

	* [r5751] *) Changed filenames once again for finite differences
	  em_resp, to what is parallel to the Sternheimer ones
	  *) Added and corrected push_sub's
	  *) Modified io_output_tensor to let me avoid writing out the
	  isotropic average of the phase of the Born charges, which is
	  meaningless
	  *) Changed m to mesh
	  *) Changed option tol_adaptative to tol_adaptive because
	  'adaptive' is a more normal word to use

2009-07-23 13:34  marques

	* [r5752] *) Now you can replace the foralls from the code by do
	  loops by using --disable-f90-forall
	  *) some other small things to make the xlf compiler happy

2009-07-23 13:38  marques

	* [r5753] Forgot our new post-preprocessor

2009-07-23 13:41  marques

	* [r5754] Some perl versions do not like name captures.

2009-07-23 14:21  marques

	* [r5755] Fortran is crazy!

2009-07-23 15:41  marques

	* [r5756] I added the jube benchmark files for octopus. I think it
	  is good to have them outside the prace svn.

2009-07-24 00:18  acastro

	* [r5757] The progress bar was used but not initialized when using
	  the LOBPCG
	  eigensolver, which caused invalid float errors in my machine.

2009-07-24 01:54  acastro

	* [r5758] When attempting to read a netcdf function with the
	  X(input_function)
	  routine, some initial work was done without even checking if the
	  file
	  even existed. This was harmless (not very efficient, though,
	  since
	  these useless operations were always done if the code had been
	  compiled with netcdf support, even if the default "obf" format
	  was
	  used), but in some cases it even led to segfaults (some open
	  boundary
	  tests in my machine).

2009-07-24 08:46  marques

	* [r5759] Initial stuff for the Cray in Finland

2009-07-24 08:54  marques

	* [r5760] Also the execute for the XT4

2009-07-24 09:33  marques

	* [r5761] This seems to be working in Huygens

2009-07-24 10:11  marques

	* [r5762] This seems to work in the Cray

2009-07-24 13:09  xavier

	* [r5763] Corrected the generation of the virtual topology for the
	  mesh.

2009-07-24 16:16  mjv500

	* [r5764] modelmb output is for inner points only

2009-07-24 20:47  dstrubbe

	* [r5765] *) The spatially resolved polarizability density and
	  hyperpolarizability density, for linear response and finite
	  differences, now includes a minus sign for the charge of the
	  electron, so they actually integrate to the polarizability and
	  hyperpolarizability.
	  *) Renamed some single-letter variables to more helpful names.
	  *) Added check that the frequency factors input for
	  hyperpolarizability add to zero, as they must for the result to
	  be physically meaningful.

2009-07-24 23:22  xavier

	* [r5766] Changed the interface for the calculation of the density.

2009-07-25 07:05  xavier

	* [r5767] Now the density is always calculated by
	  density_accumulate_batch.

2009-07-25 07:57  xavier

	* [r5768] Starting with the changes to have the density in a finer
	  mesh.

2009-07-26 10:47  xavier

	* [r5769] Small correction for the fine mesh.

2009-07-27 12:59  nitsche

	* [r5770] * some rewriting of the surface Green's function
	  calculation => preparation for generalized hamiltonian with
	  non-constant potential in transport direction
	  * some small cleanups

2009-07-31 07:56  acastro

	* [r5771] The casida calculation were failing. The recently
	  introduced
	  "CASIDA_DIR" macro was referring to the casida restart file
	  (previously called "casida"), and it should only refer to the
	  directory where the results are placed (also called casida). Now
	  the
	  file is called "casida-restart".

2009-08-01 10:35  acastro

	* [r5772] The oct_exchange_operator_all routine was done in a very
	  inefficient
	  way, whenever more than one orbital was involved.

2009-08-03 16:45  acastro

	* [r5773] The information printed by the messages_print_var_value
	  routine was
	  printed by all nodes, instead of only by root.

2009-08-04 07:49  marques

	* [r5774] Turned on all benchmarks in the machines

2009-08-04 08:34  marques

	* [r5775] Added a small makefile to simplify our tasks

2009-08-04 20:13  acastro

	* [r5776] A bug fix; this only affected the
	  "qoct_tddft_propagator_2" evolution
	  method, which is still "experimental". In fact, I am not even
	  sure
	  that it works correctly yet.

2009-08-05 08:04  marques

	* [r5777] Initial support for compilation in MariCel

2009-08-05 08:33  marques

	* [r5778] More stuff for MariCel

2009-08-05 09:57  marques

	* [r5779] When running with datasets, restart_format was not always
	  overwritten

2009-08-05 13:27  marques

	* [r5780] We are running in MariCel ;)

2009-08-05 13:52  marques

	* [r5781] Changed to the thead safe cversion of the compiler

2009-08-05 15:04  olivares

	* [r5782] Slatec directories for new poisson-solving routine

2009-08-05 15:19  olivares

	* [r5783] In case I forgot something in root directory

2009-08-05 15:22  olivares

	* [r5784] Finally, some additions to the poisson solvers

2009-08-05 15:25  olivares

	* [r5785] One more file that was missing necessary for the new
	  poisson solver

2009-08-05 15:35  xavier

	* [r5786] A small fix in the Makefile.

2009-08-06 08:03  marques

	* [r5787] A couple more changes in huygens

2009-08-06 11:28  olivares

	* [r5788] Removed annoying writes

2009-08-06 14:11  olivares

	* [r5789] more writes that shouldn't be there due to debugging

2009-08-06 14:52  xavier

	* [r5790] * This should fix compilation problems.

2009-08-07 08:21  marques

	* [r5791] Now the code compiles and runs in the BULL of the cea

2009-08-07 08:36  marques

	* [r5792] Increased the run time in Maricel

2009-08-07 09:07  marques

	* [r5793] Small mistake in MariCel. Now it compiles

2009-08-07 13:04  olivares

	* [r5794] Took away some changes from hamiltonian/epot.F90 and
	  system/v_ks.F90 that were causing some hangs, plus some outputs
	  that were unnecessary

2009-08-07 13:29  olivares

	* [r5795] Returning epot.F90 to revision 5738; all changes in this
	  file have been fully reverted.

2009-08-08 10:00  xavier

	* [r5796] Some code cleaning of the sete poisson solver, mainly
	  remotion of
	  implicit variables. I didn't change the code too much since I
	  think Roberto has
	  uncommited changes, but this code clearly need improvement.

2009-08-09 12:14  xavier

	* [r5797] * Fixed compilation of slatec and the sete code with g95
	  (a lot of
	  variables had to be declared explicitly).
	  
	  * Removed dnrm2, daxpy, ddot, as these are blas functions.

2009-08-11 10:01  olivares

	* [r5798] Changes to poisson 9 SETE routine. This includes a change
	  in hamiltonian/epot.F90 and also in system/v_ks.F90. Inform me at
	  olivares@fas.harvard.edu if these causes problems for the
	  parallel scheme.

2009-08-11 10:19  olivares

	* [r5799] Removed Makefile in external_libs/slatec. It shouldn't
	  have been added in the first place.

2009-08-11 15:52  xavier

	* [r5800] * Added the poisson_solver_has_free_bc function, it
	  returns true if
	  the boundary conditions for the poisson solver are that V(\infty)
	  = 0.
	  This is not true for periodic boundary conditions (unless a
	  spherical
	  cutoff is used) and when SETE is used.
	  
	  * Other fixes related to SETE.

2009-08-11 16:22  xavier

	* [r5801] Appended POISSON_ to all the poisson solver names. This
	  solves the
	  compilation problem.

2009-08-11 19:00  dstrubbe

	* [r5802] *) Changed some green functions to Green's functions
	  *) Fixed citation
	  *) Set svn:ignore properties on Slatec directory
	  
	  For the Hispanic developers: would it not be more proper to refer
	  to the method of Lopez Sancho (in ob_green) as the Lopez method
	  rather than the Sancho method?

2009-08-12 09:29  xavier

	* [r5803] Some fixes and code cleaning.

2009-08-12 12:38  nitsche

	* [r5804] * lots of code rewriting within transport mode, mainly
	  due to preparation for open system simulation, now each interface
	  is a independent structure as the leads.
	  * rewriting of surface Green's function calculation to handle a
	  super lattice structure (lead potentials with periodic dependence
	  in transport direction), also reducing the size and the
	  computational needs (down to the interface size, not the size of
	  the lead unit cell)
	  * changed some ' symbols to `

2009-08-12 13:29  marques

	* [r5805] Now the batch can also access an linear array. This will
	  allow me to remove lots of duplicated code. I also removed
	  several routines in batch that we never called, or were
	  one-liners called only once.

2009-08-12 13:45  xavier

	* [r5806] An array was defined with the wring size in slatec.

2009-08-12 14:09  xavier

	* [r5807] An array was not initialized.

2009-08-12 14:31  marques

	* [r5808] nl_operator cleaned. Duplicated code removed and general
	  cleanup of the routines. Tests pass in my machines, but it would
	  be interested to see other architectures.

2009-08-12 20:41  xavier

	* [r5809] Moved the SETE code to a module.

2009-08-12 21:51  xavier

	* [r5810] * Some cleaning of the SETE code.
	  * Bugfix: PI was defined as an integer, now M_PI is used.

2009-08-13 01:55  dstrubbe

	* [r5811] *) Replaced ' which gave trouble to compiler
	  *) Finally got workaround from PGI for internal compiler error.
	  New version 9.0-4 in September should fix the issue. It occurred
	  for lines like: 'write(*,*) units_from_atomic(.., var(1:3))'.
	  *) Added header and footer to pois_sete_v1, and fixed typo

2009-08-13 10:18  marques

	* [r5812] Major cleaning of the derivatives module. Things that
	  remain to do is the cleaning of the set_bc routines and moving
	  the angular momentum stuff to a more appropriated place.

2009-08-13 10:50  marques

	* [r5813] Now also the set:bc is cleaned

2009-08-13 13:26  kkrieger

	* [r5814] Introduced new representation for the control fields in
	  the optimal control part.

2009-08-13 14:25  marques

	* [r5815] Angular momentum calculation moved to new "physics_op"
	  module that should contain the application of physics operators
	  to states

2009-08-13 15:05  xavier

	* [r5816] The two files Miguel forgot.

2009-08-13 17:11  olivares

	* [r5817] Dielectric function needed to have two more points
	  defined

2009-08-13 22:56  olivares

	* [r5818] Fixed some parts of poisson_sete code, mainly deallocate
	  calls.

2009-08-14 00:41  olivares

	* [r5819] Fixed initialization problem in SETE. The vector x in
	  mat(a) \dot vec(x)=vec(b) needs to be initialized to random
	  numbers. If initialization of this vector is zero, then system
	  will not converge at all

2009-08-14 17:06  acastro

	* [r5820] Solved some little errors in the OCT part: the updated
	  control fields
	  were not properly handled at the end points of the propagating
	  interval.
	  
	  Also, removed some useless comment lines.

2009-08-15 01:00  olivares

	* [r5821] Cleaned up some of the Poisson-SETE code. Furthermore,
	  now the poisson solver can discriminate between ions calls and
	  electron calls. In this way, the previous solution of the
	  potential can be saved for the electron case. The ion case,
	  rather, requires a fresh initialization of this array to reach
	  reasonable results

2009-08-15 12:39  acastro

	* [r5822] Added absorbing boundaries to one of the QOCT tests, to
	  make sure that
	  this feature is tested.

2009-08-16 02:13  olivares

	* [r5823] Change in pois_sete. Assigning a public variable that is
	  needed in hamiltonian/epot.

2009-08-17 14:07  acastro

	* [r5824] Changed slightly the way in which the self-consistent
	  propagating
	  steps are managed. For some QOCT runs, the way in which it was
	  done
	  before led to an error. For any other kind of runs, nothing
	  changes.

2009-08-18 19:42  acastro

	* [r5825] Little bug that affected the single-active-electron
	  calculations.

2009-08-19 09:11  xavier

	* [r5826] Cleaning of the sete code.

2009-08-19 09:31  xavier

	* [r5827] * More cleaning.
	  * Renamed pois_sete_v1.F90 to poisson_sete.F90

2009-08-19 10:57  xavier

	* [r5828] More reformating of the sete code.

2009-08-19 21:35  xavier

	* [r5829] My last commit broke the sete code so I am reverting it..

2009-08-19 22:00  acastro

	* [r5830] The "TDFreezeOrbitals" variable can now also be used for
	  optimal
	  control runs.

2009-08-20 09:03  marques

	* [r5831] First step into cleaning the kpoints. These are to be
	  located in simul_box, not in states. Now there are some
	  duplicated parts of the code that I hope to be able to remove in
	  the near future

2009-08-20 09:33  xavier

	* [r5832] Added an object for the sete poisson solver.

2009-08-20 09:36  acastro

	* [r5833] Bug corrected in the ZBR98 optimal control algorithm.

2009-08-20 10:24  xavier

	* [r5834] Rearrangements of variables in sete.

2009-08-20 10:37  xavier

	* [r5835] * Fixed compilation problem.
	  
	  * More rearrangements.

2009-08-20 14:36  xavier

	* [r5836] Yet more cleaning.

2009-08-20 15:24  xavier

	* [r5837] Yes, more cleaning. And now I got bored, there are still
	  some
	  variables to check.

2009-08-20 15:40  nitsche

	* [r5838] * Lots of rewriting due to open boundaries (now each lead
	  is independent).
	  * Fixed a bug that was triggered by this rewriting, namely the
	  reading of the lead potential, there an array was too small to
	  hold the extra points of the mesh
	  * The lead unit cell is now reduced to the the smallest possible
	  size (right now it is the stencil-extent in transport direction
	  as translational invariance is assumed). Therefore the surface
	  Green's function is reduced to that size (made possible due to
	  the downfold via matrix Moebius transformation method of
	  Umerski). This will dramatically improve the performance with
	  periodic lead potentials as it is always folded to the smallest
	  possible size, the size of the hopping matrix (the non-zero part)
	  between the center and lead.
	  * Changed of some open boundary tests to include the changes

2009-08-20 15:48  xavier

	* [r5839] Fixes compilation.

2009-08-21 09:21  marques

	* [r5840] Added the soft-Coulomb version of the 1d_csc lda

2009-08-21 09:52  marques

	* [r5841] This should fix the compilation

2009-08-21 14:21  xavier

	* [r5842] Moved the calculation of forces to its own module.

2009-08-21 19:03  dstrubbe

	* [r5843] *) Lower-cased Born charges module in a couple other
	  places for consistency
	  *) Reverted typo in license info from an earlier commit
	  *) Added a missing parenthesis (in a comment)
	  *) Removed dependency on Born_charges from epot since it was only
	  in the part now moved to the forces module

2009-08-21 21:08  nitsche

	* [r5844] * fixed the problem causing the open boundary tests to
	  fail

2009-08-21 22:19  xavier

	* [r5845] I have located the problem with the parallel version, I
	  put an
	  assertion that stops the code. The fix is not trivial and I am
	  too sleepy to do it now, so I will leave it for tomorrow.
	  
	  Miguel, you just can't avoid breaking the code, can you? ;-)

2009-08-21 22:30  dstrubbe

	* [r5846] *) Added license info to output_h
	  *) Added push_sub to output_linear_response
	  *) Moved ResponseMethod variable to em_resp instead of pert,
	  since I don't see any way it would be used elsewhere, and left
	  only options relevant to em_resp

2009-08-22 09:07  xavier

	* [r5847] Ghost update now uses the 1d array in the batch. This
	  fixes the bug
	  with the parallel version.

2009-08-22 19:46  xavier

	* [r5848] Now all octopus source files are lower case.

2009-08-22 20:32  xavier

	* [r5849] Now all fortran files that are included, instead of
	  compiled directly,
	  have the _inc suffix.

2009-08-23 19:27  xavier

	* [r5850] Moved the routine that calculates ion-ion interaction to
	  epot.F90.

2009-08-23 20:52  xavier

	* [r5851] Fixes compilation problem.

2009-08-24 09:14  marques

	* [r5852] Now the list of functionals for octopus is generated by a
	  script that should be run every time we add a functional to
	  libxc.

2009-08-24 18:50  dstrubbe

	* [r5853] *) Removed troublesome ' in comment in libxc, in the file
	  produced by the new script, as well as what I believe is the
	  source from which it arises
	  *) Made mk_functionals_list.pl refer to its actual name
	  *) Corrected spelling and punctuation in variable documentation

2009-08-25 02:10  dstrubbe

	* [r5854] *) Fixed bug for calculation of cross section that seems
	  to appear only for PGI compilers. We should not pass arrays as
	  arguments to units_from_atomic because this may be interpreted as
	  assigning the result for the first value to the entire array.
	  *) Changed name of section in variables documentation to
	  Time-Dependent
	  *) Various other improvements to documentation and comments

2009-08-25 07:16  xavier

	* [r5855] Several lines of the parallel code were too long.

2009-08-25 19:43  xavier

	* [r5856] Removed the "bit" nl operator.

2009-08-25 19:45  xavier

	* [r5857] I included these files by mistake in my last commit.

2009-08-25 22:34  xavier

	* [r5858] Storing the central point of the stencil in sequence
	  improves the
	  performance of the nl operator.

2009-08-25 22:58  dstrubbe

	* [r5859] *) Improvements to documentation and comments
	  *) push_sub's (including a place where there had been a pop_sub,
	  causing a stack underflow in debugging mode)
	  *) Using new unit functions

2009-08-26 18:33  dstrubbe

	* [r5860] *) When the default radius for minimum box shape is used,
	  the radii used for each species are printed rather than just
	  "-1".
	  *) Some formatting in variable documentation.
	  *) The cylinder Xlength has as default the radius now, rather
	  than just 1 (in whatever units we're using).

2009-08-26 19:20  dstrubbe

	* [r5861] A line was too long.

2009-08-27 00:28  dstrubbe

	* [r5862] *) Introduced function to convert direction number
	  (1,2,3) to letter (x,y,z). Higher dimensions are left as numbers:
	  those working in 4D can decide what letters they would like...
	  *) Directions of perturbation for em_resp are written as letters
	  now.
	  *) Some formatting in documentation.

2009-08-27 01:40  dstrubbe

	* [r5863] *) Corrections to documentation and comments.
	  *) Fixed syntax error from last commit, objected to by some
	  compilers.
	  *) Set default XCKernel to the same default as XCFunctional
	  (LDA). Since there are only a couple of available kernels
	  currently, it seems more helpful to make the default always be
	  something that exists.
	  *) Removed redundant default line in XCFunctional documentation.

2009-08-27 14:02  xavier

	* [r5864] The code didn't compile with gfortran.

2009-08-27 15:34  xavier

	* [r5865] * Added some checks for the size or arrays.
	  * More fixes for the fine mesh.

2009-08-27 17:47  dstrubbe

	* [r5866] *) Fixed an error in my previous formatting of variable
	  documentation.
	  *) Rearranged slightly how the directions are output, and now
	  using same for kdotp.

2009-08-28 05:16  dstrubbe

	* [r5867] *) Improvements to documentation
	  *) Added push_sub's
	  *) Fixed mistake in format statement causing testsuite failures

2009-08-28 05:33  xavier

	* [r5868] Fixed mixing for the fine mesh.

2009-08-28 10:23  marques

	* [r5869] *) Added the LDA exchange in 1D. This functional is still
	  not functional
	  *) Added the LDA correlation in 1D of Casula for a soft-Coulomb
	  interaction
	  *) Corrected the segmentation fault found by Fulvio

2009-08-28 23:24  dstrubbe

	* [r5870] Some changes to documentation, comments, and output.

2009-08-30 08:13  xavier

	* [r5871] More fixes for the fine mesh density.

2009-08-30 08:16  xavier

	* [r5872] Moved the laser test to the real time directory.

2009-08-30 08:44  xavier

	* [r5873] Removed the debug info for a subroutine that is called
	  too many times.

2009-08-30 10:47  xavier

	* [r5874] Reimplemented the coarse2fine transfer.

2009-08-30 12:58  xavier

	* [r5875] Now coarse to fine interpolation can be performed up to
	  any order.

2009-08-30 20:34  xavier

	* [r5876] Removed several unused variables.

2009-08-31 13:34  kkrieger

	* [r5877] Added some more representations for the control field in
	  the optimal control part.

2009-08-31 20:53  dstrubbe

	* [r5878] Made a note for functions that should not have debugging
	  push_sub calls because they are called too frequently, so it is
	  clear this is deliberate rather than an oversight.

2009-09-01 08:20  nitsche

	* [r5879] * Updated some comments.
	  * The memory information output for the transport run was wrong.
	  * Changed the source term to include OpenBoundariesMaxMemCoeffs,
	  a step forward to a transport scheme with linear runtime, still
	  highly experimental. But if it eventually works lots of memory
	  and calculation time is saved.
	  * sb%rlattice needed to be initialized with zero as the cross
	  product always runs in 3 dimensions, no matter what sb%dim is.

2009-09-03 23:44  dstrubbe

	* [r5880] *) Improvements to documentation, comments, and output.
	  *) Added missing push_sub and pop_sub statements (including a few
	  where a function had only one of the two!)
	  *) Made sure that where there are multiple exits from a function
	  that either no push_sub occurs, or a pop_sub is done before the
	  return.
	  *) Removed push_sub from a function called very frequently
	  (simul_box_in_box_vec had it removed, and every time it is called
	  it is from simul_box_in_box, so that shouldn't have it either).
	  *) Conversion to new unit style in one place

2009-09-04 05:42  dstrubbe

	* [r5881] *) Improvements to comments, documentation
	  *) Added push_sub's
	  *) Removed push_sub's from pure functions, which was causing
	  compilation failures, and marked them accordingly
	  *) Conversion to new units style

2009-09-04 06:04  dstrubbe

	* [r5882] Apparently elemental functions mustn't have push_sub
	  statements either.

2009-09-04 22:36  dstrubbe

	* [r5883] *) More push_sub's added, especially in multiple exit
	  points from functions
	  *) Corrections to routine names in push_sub's
	  *) push_sub removed from a routine called too frequently
	  *) Formatting and corrections in documentation
	  *) Changed routine names to 'approximately_equal' in math_inc
	  *) Various corrections to comments
	  *) Added license header and syntax-highlighting footer in Young,
	  removed redundant "implicit none" lines
	  *) New units style
	  *) Corrected default in PoissonSolver documentation, and added
	  mention of SETE -- Robert should add some description of it
	  there.
	  *) Removed ^M at line ends from parameters.F90 -- someone has
	  been using MSDOS...
	  *) Corrected some inconsistent references to variable names in
	  OCT

2009-09-05 00:08  dstrubbe

	* [r5884] *) Alphabetized module lists in some files, to make it
	  easier to see if a certain one is being used
	  *) Corrected statement about default for ParallelizationStrategy.
	  Many variables have incorrect defaults listed in the
	  documentation; if you change what is implemented in the code,
	  please be sure it is reflected in the variable documentation too.
	  *) Added more push_sub statements
	  *) More improvements to documentation, comments, and output
	  *) Actual defaults listed for Poisson solver in variable
	  documentation.
	  *) The decision as to whether to do deallocations associated with
	  the Poisson SETE solver, in a number of different routines, was
	  based on repeated (1000's) of parses of the input file, using an
	  uninitialized integer as the default. The result can be
	  frequently be incorrect because the actual default and decision
	  of which solver to use is fairly complex in the code. Now the
	  Poisson module is simply queried via a new function for which
	  solver is being used.
	  *) My attempt to remove the ^M characters before from
	  parameters.F90 actually just wiped the file clean. Now it is
	  back, with those characters removed.

2009-09-07 11:31  marques

	* [r5885] Now the 1D exchange functional seems to be working. It
	  includes both
	  spins,a nd the two forms of the interaction. I also implemented
	  Fxc.

2009-09-09 08:32  marques

	* [r5886] *) Now octopus is also aware of the 1D exchange
	  functional
	  *) Replaced the _init_exchanged and _init_correlation by a
	  simpler
	  _init_functl
	  *) Some more tests are passed in 4D. The exceptions are now the
	  open
	  systems tests and the periodic_systems/06-h2o_pol_lr.test
	  *) kpoints are now properly deallocated and the volume of the
	  unit
	  cell is also properly calculated in 1D and 2D

2009-09-09 08:38  marques

	* [r5887] Now the default XCFunctional is correct in 1D

2009-09-10 11:48  marques

	* [r5888] Several bug fixes:
	  *) One pop_sub too much in fftw3.F90
	  *) par_common has to be initialized to NULL (this solves the test
	  failure with g95)
	  *) a strange _i4 deleted from mix_inc (avoided compilation with
	  my g95)

2009-09-10 13:49  marques

	* [r5889] Several changes in order to make dist work

2009-09-10 14:29  marques

	* [r5890] I hope this solves the problem with the make distcheck
	  buildbot

2009-09-16 00:45  dstrubbe

	* [r5891] *) Removed push_sub from a function called too frequently
	  in FFTW
	  *) Three variables in kpoints were being deallocated although
	  they were never allocated, which was causing error messages to
	  appear in the testsuite. These variables were actually never
	  used, so I just deleted them.
	  *) Improvements to documentation, comments, and output
	  *) Corrected defaults in documentation
	  *) Fixes of push_sub routine names
	  *) Added push_sub statements
	  *) Alphabetized modules

2009-09-16 01:00  dstrubbe

	* [r5892] *) Removed pop_sub's before exit statements that I had
	  mistakenly added
	  *) Added missing dependency in ions
	  *) Removed ^M characters from parameters_trans_inc

2009-09-17 01:15  dstrubbe

	* [r5893] *) Alphabetized module lists
	  *) Improvements to documentation, comments, and output
	  *) Fixed spelling of "Hermitian"
	  *) Added and corrected push_sub's, including removing some
	  spurious pop_sub's in a routine that had the push_sub removed
	  *) Renamed option "2particle" in Invert KS which cannot be parsed
	  correctly
	  *) Made subroutine formatting be in our standard style
	  *) Changes to new units conversion style
	  *) Corrected defaults in documentation for restart file, and made
	  stated default actually implemented for Eigensolver.
	  *) Removed stray line of output of simulation box
	  *) Removed unnecessary duplicated variable in subroutine in
	  eigen_plan_inc that was causing a compiler warning

2009-09-17 01:25  dstrubbe

	* [r5894] *) Improvements to documentation and comments
	  *) Alphabetized modules
	  *) Added and corrected push_sub's

2009-09-18 20:53  dstrubbe

	* [r5895] *) Added and fixed push_sub's
	  *) Added license header and syntax-highlighting footer to
	  output_etsf_inc
	  *) Alphabetized module lists
	  *) Improvements to documentation, comments, and output
	  *) Conversions to new units style

2009-09-19 00:27  dstrubbe

	* [r5896] *) Lengthened the string for subroutine names in the
	  debugging stack, as many were exceeding the previous limit of 40
	  characters
	  *) Improvements to documentation and comments
	  *) Added and corrected push_sub's
	  *) Alphabetized module lists

2009-09-19 20:02  dstrubbe

	* [r5897] *) Alphabetized module lists
	  *) Added and corrected push_sub's
	  *) Combined a couple of different ways of converting direction
	  numbers to letters in the code (i.e. 1 -> x)
	  *) Improved documentation, comments, and output
	  *) Changed some single-letter variables
	  *) A few conversions to new unit style
	  *) Removed a spurious variable associated with Born charges

2009-09-22 16:30  xavier

	* [r5898] * Fixed the default value in the documentation for
	  OEP_Level.
	  * The multigrid high order interpolation was wrong.

2009-09-22 19:42  dstrubbe

	* [r5899] *) Assertion failures now identify the source node
	  *) Improvements to documentation, comments, and output
	  *) The files of the debug trace for each node are deleted at the
	  beginning of the run, rather than confusingly having new runs
	  appended to the old one.
	  *) Added and corrected push_sub's
	  *) New units style
	  *) Removed push_sub from two functions were they were causing
	  trouble
	  *) Alphabetized module lists

2009-09-22 20:26  xavier

	* [r5900] Changed the way the density in the fine mesh is
	  calculated, now the
	  wavefunctions are squared and then interpolated.

2009-09-23 14:01  marques

	* [r5901] *) Format was wrong in the vdw output.
	  *) Lowered the precision of the test so that it is passed with
	  g95

2009-09-23 14:40  marques

	* [r5902] Filename has changed

2009-09-23 15:54  xavier

	* [r5903] Changed the Hartree test to include the different poisson
	  solvers.

2009-09-23 16:07  xavier

	* [r5904] Removed the other poisson solver tests.

2009-09-23 19:15  dstrubbe

	* [r5905] *) Improvements to documentation, comments, and output
	  *) When Miguel introduced sb%rlattice_primitive recently, the
	  meaning of sb%rlattice changed, but some parts of the code did
	  not take this into account; now they are fixed.
	  *) Added and fixed push_sub's, especially in some lalg routines
	  *) Alphabetized module lists
	  *) Fixed k-points output so it doesn't produce garbage characters
	  occasionally
	  *) Restored accidentally removed line from simul_box output

2009-09-23 19:27  xavier

	* [r5906] It seems there is a problem with our atomic
	  pseudo-wavefunctions for
	  Si, the localization radius is very large so it makes the LCAO
	  very
	  slow. I put a maximum radius in the LCAO to avoid the problem,
	  but we
	  should have a look at what is happening (Micael, can you?). This
	  makes
	  the bulk silicon test much faster.

2009-09-24 02:33  dstrubbe

	* [r5907] *) Improvements to documentation and comments
	  *) Changes a while ago made it hard to get geometry.xyz since
	  OutputHow is required to be present, but it has no xyz option.
	  Now there is an xyz option.
	  *) Alphabetized module lists
	  *) Gave name headers to two variable blocks (MeshBlockSizeXY and
	  MeshBlockSizeZ) that lacked them, and therefore did not show up
	  in the documentation
	  *) Added push_sub's

2009-09-24 09:04  marques

	* [r5908] Decrease the precision of the neon test, so that it is
	  passed with g95

2009-09-24 12:47  marques

	* [r5909] *) I started changing the interface of libxc following a
	  suggestion of
	  the devlopers of ELK. Hybrids should nto work, and some
	  functionals may
	  give segmentation faults. In any case, all tests are passed in my
	  machine
	  *) Added the functional of Esa and Stefano
	  *) Corrected the builddir in mk_functionals_list.pl
	  *) Added dummy integers to mpi_debug.F90 mpi_lib.F90 so that
	  compilers
	  stop complaining
	  *) Decreased the precision of the SIC test

2009-09-24 12:54  nitsche

	* [r5910] * inreased the number of digits in some debugging output
	  * fixed a bug with the progress bar when running parallel

2009-09-24 13:42  nitsche

	* [r5911] * some generalizations to the open boundary scheme
	  * fixed some spellings

2009-09-24 18:54  dstrubbe

	* [r5912] *) Added preprocessor constant OCT_DIR for optimal
	  control directory
	  *) Alphabetized modules
	  *) Added and corrected push_sub's
	  *) Improvements to documentation, comments, and output

2009-09-24 19:58  dstrubbe

	* [r5913] Removed some changes that shouldn't have been in the last
	  commit.

2009-09-25 05:11  dstrubbe

	* [r5914] *) Improvements to documentation, comments, and output
	  *) Alphabetized module lists
	  *) Added and corrected push_sub's

2009-09-25 17:38  dstrubbe

	* [r5915] *) Added and corrected push_sub's
	  *) Improvements to documentation, comments, and output; spelling
	  of 'wavefunction' is now standardized in the code.
	  *) Alphabetized module lists
	  *) Lengthened some single-letter variables

2009-09-25 18:46  dstrubbe

	* [r5916] *) In the file xc_oep.F90, an error message is written if
	  in parallel saying "Full OEP is not allowed with the code
	  parallel in states." However, the actual condition implemented in
	  the code is whether it is parallel at all. I'm not sure if the
	  condition, or the message, is wrong and should be changed.
	  *) Improvements to documentation, comments, and output.
	  *) Added and corrected push_sub's.
	  *) Lengthened some single-letter variables.
	  *) Alphabetized module lists.
	  *) Made tests be called curvilinear instead of 'curvlinear'

2009-09-25 19:56  dstrubbe

	* [r5917] *) Improvements to documentation, comments, and output
	  *) Added push_sub's
	  *) Alphabetized module lists

2009-09-25 21:43  dstrubbe

	* [r5918] A number of issues with the LOBPCG eigensolver and
	  parallel in states:
	  *) subspace_diag_par_states failed to declare the proper array
	  bounds on psi, with st_start and st_end, so that every node other
	  than the first would either segfault or be using random garbage
	  in memory. Now it is fixed. But is there any reason why we don't
	  just use st%X(psi) directly in this function?
	  *) In X(eigensolver_lobpcg), the way values are assigned to
	  constr_start and constr_end seems to be wrong. See the FIXME
	  comment I added. However, I can't tell how it is supposed to be
	  -- someone familiar with LOBPCG please fix this.
	  *) LOBPCG kept iterating as long as any vectors were unconverged,
	  but now each node stops when all of its own eigenvectors (for
	  parallel in states) are converged. Otherwise there are errors
	  when nodes lacking unconverged vector were trying to operate on
	  empty batches.
	  *) LOBPCG is no longer tagged as DevelVersion with parallel in
	  states, which I had mistakenly added earlier
	  
	  *) Lengthened some single-letter variables
	  *) Gave more space to write out the amount of memory that failed
	  to be allocated, so we don't just get ***** for large systems.
	  *) Improvements to documentation, comments, and output
	  *) Alphabetized modules
	  *) Added push_sub's

2009-09-25 22:57  xavier

	* [r5919] * Fixed the problem with the quadratic box test in
	  parallel.

2009-09-26 07:28  xavier

	* [r5920] Now, if an octopus run finishes with an error, the tests
	  related to
	  that run automatically fail.

2009-09-29 23:58  dstrubbe

	* [r5921] A correction to dependencies in opt_control.

2009-09-30 16:49  xavier

	* [r5922] Moved the mix_m module to math/.

2009-10-01 08:30  marques

	* [r5923] This corrects the assertion failure of Fulvio

2009-10-02 14:09  xavier

	* [r5924] Multigrid transfer was not working in parallel. Fixes one
	  test.

2009-10-02 14:33  xavier

	* [r5925] A 2nd order interpolation is now used for the full
	  multigrid procedure.

2009-10-04 20:49  xavier

	* [r5926] * Renamed obsolete_variable to messages_obsolete_variable
	  and improved
	  the message that it prints.
	  
	  * Declared multi-resolution and SETE as development version.

2009-10-04 21:26  xavier

	* [r5927] * Removed the cutoff component of hamiltonian_t.
	  
	  * Some unit conversions updated.

2009-10-05 07:59  xavier

	* [r5928] I forgot to put DevelVersion = yes in the input file for
	  the
	  multiresolution test.

2009-10-07 17:34  dstrubbe

	* [r5929] Removed the option to use 'non-dispersive initialization'
	  for k.p wavefunctions, because it seems this is not really a
	  correct result. Regardless it did not prove very helpful in
	  improving convergence.

2009-10-08 09:29  fulvio

	* [r5930] I've put a threshold for the integral used to calculate c
	  in the tb
	  functional.

2009-10-08 09:46  fulvio

	* [r5931] I've changed the scheme for the generation of the
	  k-points grid
	  redefining the shift, and
	  the related variables, documentation, input values for the shift
	  in the periodic_systems\ tests

2009-10-08 12:55  fulvio

	* [r5932] I've changed the input parameters of the open_systems
	  tests for
	  consistency with the new k-points grid

2009-10-09 08:36  micael

	* [r5933] *) Fixed a couple of bugs in libxc.
	  *) Changed the initial point for the Newton-Raphton routine in
	  the Becke & Johnson functional.

2009-10-09 22:51  dstrubbe

	* [r5934] Added to documentation a useful point from Miguel's
	  explanation on the users e-mail list.

2009-10-11 04:46  dstrubbe

	* [r5935] *) Some improvements to documentation and comments: fixed
	  some defaults
	  *) Added and corrected push_sub's

2009-10-11 15:51  xavier

	* [r5936] A format string was not correct.

2009-10-11 16:04  xavier

	* [r5937] Disabled two optimal control tests since they fail on ppc
	  qith xlf.

2009-10-13 09:03  sakko

	* [r5938] Added the possibility to change the maximum number of
	  iterations for cg poisson solvers.

2009-10-13 11:53  marques

	* [r5939] Added teh asymptotic expansion fo LB94

2009-10-16 08:08  marques

	* [r5940] Cleaned up the hybrids. There is no more the specific
	  interface
	  hyb_gga_xxx, as the generic gga_xxx handles the requests.

2009-10-16 09:38  xavier

	* [r5941] Updated some unit conversions.

2009-10-16 09:56  xavier

	* [r5942] Replaced all the uses of %abbrev by units_abbrev.

2009-10-16 10:16  xavier

	* [r5943] I hope this fixes the problem with the pgi "compiler".

2009-10-16 11:13  acastro

	* [r5944] Fixed the problem in the lobpcg code that was ticketed by
	  David
	  (ticket #96).
	  
	  The problem was that in some cases the number of "constrained"
	  states
	  was zero, which could cause problems with zero-sized arrays in
	  some
	  cases/compilers. Now I think that the code is more robust.
	  
	  In the way, I also fixed another bug that prevented the
	  diagonalizer
	  from running in parallel (with states parallelization), at least
	  in my
	  machine.

2009-10-16 11:34  xavier

	* [r5945] Fixed compilation in serial.

2009-10-17 08:35  xavier

	* [r5946] More unit conversion updates.

2009-10-17 10:20  xavier

	* [r5947] * Fixed and out of bounds access when printing a plane.
	  * Added a test to check the output of octopus, currently it
	  checks for
	  axis, plane and dx.

2009-10-17 11:22  xavier

	* [r5948] Added xcrsyden output to the test.

2009-10-17 12:09  xavier

	* [r5949] Removed the output in the old plain format.

2009-10-17 14:08  xavier

	* [r5950] Now X(output_function) receives a unit_t object instead
	  of just a
	  value for unit conversion.

2009-10-17 15:15  xavier

	* [r5951] * Bugfix: Unit conversion of the function (not the
	  coordinates) was
	  wrong for xcrysden and dx.
	  
	  * X(output_function) uses the unit object internally.
	  
	  * Unit conversion functions now work also with complex values.

2009-10-17 16:25  xavier

	* [r5952] Removed the loct_ prefix from parser functions.

2009-10-17 16:58  olivares

	* [r5953] changes to poisson_sete

2009-10-17 20:53  xavier

	* [r5954] Divided the units module.

2009-10-17 21:57  xavier

	* [r5955] Now the functions to parse floats (parse_float and
	  parse_block_float)
	  can receive an extra argument with the unit of the value to be
	  read.
	  It will be used to convert the default value to the input units
	  and
	  the parsed value to atomic units.

2009-10-17 22:43  xavier

	* [r5956] Updated some unit conversions.

2009-10-18 08:21  xavier

	* [r5957] Now io_output_tensor receives a unit argument.

2009-10-18 15:05  acastro

	* [r5958] Fixed a couple of bugs:
	  
	  o in distributed_init, if a group has only one element, it should
	  be
	  handled in serial. This cause problems when there is only one
	  atom,
	  and the code attempted to distribute it in several nodes.
	  
	  o in states_calc_inc, one array was used before being allocated.
	  
	  o I removed the "FIXME" comment in eigen_lobpcg_inc. I think it
	  is OK
	  now.
	  
	  As a result, we can re-enable 21-lobpcg.test again (I think; at
	  least
	  it works in my machines).

2009-10-18 21:30  xavier

	* [r5959] Updated more unit conversions.

2009-10-19 04:55  dstrubbe

	* [r5960] *) A couple of trivial changes
	  *) Added appropriate units for the output of some functions on
	  the grid

2009-10-19 04:59  dstrubbe

	* [r5961] Fixed a small mistake in the last commit.

2009-10-19 05:39  dstrubbe

	* [r5962] *) A clarification to documentation on units
	  *) A somewhat better way of expressing the units for output
	  functions

2009-10-19 08:43  xavier

	* [r5963] More unit conversion updated. Now all the code is using
	  the
	  units_to_atomic and units_from_atomic functions. All new code
	  must
	  use them too.

2009-10-19 23:10  xavier

	* [r5964] Workarounds to fix the compilation with pgi.

2009-10-19 23:59  dstrubbe

	* [r5965] *) Alphabetized modules
	  *) Changed Xavier's recent PGI workaround for arrays and units
	  functions with a somewhat less ugly method I have found to work,
	  at least for PGI 9.0.3. (9.0.4 is supposed to have all these
	  issues fixed.)
	  *) Wrote out 'polarizability' in full for spectrum, to avoid
	  confusion with 'polarization.'

2009-10-20 00:03  dstrubbe

	* [r5966] XCrySDen output now states the units used.

2009-10-20 01:04  dstrubbe

	* [r5967] Changed a bunch of single-letter variables.

2009-10-20 02:01  dstrubbe

	* [r5968] Changed some single-letter variables.

2009-10-20 04:23  dstrubbe

	* [r5969] *) Created units for polarizability and
	  hyperpolarizability
	  *) Expressed field units more compactly as force, since e = 1
	  *) Used new units arguments to parse functions
	  *) Added correct unit conversions to output response densities
	  *) Corrected units for polarizability: they are not dependent on
	  the dimensionality of the system, nor is the cross section

2009-10-20 18:58  dstrubbe

	* [r5970] *) A bit of formatting for the documentation
	  *) Changed some single-letter variables in Casida routines
	  *) Added unit to Casida transition density: careful inspection of
	  the code indicates it is energy/volume, although I had expected
	  it would be length/volume -- did I miss something?

2009-10-20 20:34  dstrubbe

	* [r5971] *) Changed some single-letter variables
	  *) Added appropriate units to function outputs for induced
	  magnetic field, Bader Laplacian density, OCT target density, open
	  boundaries debug wavefunctions (in restart)
	  *) Put a comment for quantities that are truly dimensionless, or
	  that don't need to have unit conversion

2009-10-20 21:17  xavier

	* [r5972] A dependency was missing.

2009-10-20 21:35  xavier

	* [r5973] Declared the code for many body systems as DevelVersion.

2009-10-20 21:42  dstrubbe

	* [r5974] More unit conversions for output functions, in invert_ks,
	  and linear response, taking into account the perturbation.

2009-10-21 00:25  dstrubbe

	* [r5975] *) Reorganized how output files are named: rather than
	  just a series of numbers separated by dashes for the various
	  indices, they are now labelled as k, st, sp, etc. The general
	  scheme is explained in the documentation for Output, and need not
	  be repeated for each quantity.
	  *) Directions in filenames are given as letter (x,y,z) rather
	  than numbers.
	  *) Test updated accordingly.
	  *) Documentation now mentions all the linear-response quantities
	  available in Output.
	  *) Tagged ELF in Fourier space as only in development version,
	  since the documentation said it is EXPERIMENTAL. Also added
	  warning for trying to calculate ELF if not in 2D or 3D, the only
	  one implemented in the routine, and added an assertion in the
	  routine to be sure the dimension is correct.
	  *) Standardized index variable for sb%dim to be idir in some
	  routines. "idim" is more commonly used for st%d%dim, something
	  totally different, so we should keep them separate.

2009-10-21 01:32  dstrubbe

	* [r5976] *) Moved call of messages_devel_version for ModelMB from
	  actual call of output routine, to when Output is parsed, so the
	  user doesn't have to wait for the whole run before learning this
	  Output option won't work.
	  *) Expanded documentation of CurrentThroughPlane to explain what
	  the quantities to specify are.
	  *) Vectors for CurrentThroughPlane are now normalized, and an
	  error is written if the norm is zero.
	  *) Unit conversions are applied to the origin and spacing for
	  CurrentThroughPlane, on input and output.
	  *) Some trivial changes to comments.
	  *) Changed a couple of single-letter variables.

2009-10-21 01:37  dstrubbe

	* [r5977] Fixed a mistake in my last commit which ifort let me get
	  away with, but the other compilers object to.

2009-10-21 01:58  dstrubbe

	* [r5978] Fixed the polarizability test failures which were due to
	  a change in the definition of the polarizability unit for
	  eV/Angstrom. The unit is length / e_field = length / force =
	  length / (energy / length) = length^2 / energy. In eV/Angstrom,
	  this is clearly A^2/eV. In atomic units, it is b^2/H, but since H
	  = e^2/b, we can convert it to b^3. You cannot do this to get A^3
	  without breaking the dimensionality of the quantity, since eV !=
	  e^2/A. I have seen A^3 units used for polarizability in print,
	  but I think it is incorrect to do so.

2009-10-21 18:34  olivares

	* [r5979] change to output and assigning rho_nuc to zero

2009-10-21 19:21  dstrubbe

	* [r5980] I realized what the function D was about (part of the
	  definition of the ELF), and updated the ELF output documentation.

2009-10-21 23:40  dstrubbe

	* [r5981] Added identification of units to current-flow output
	  file, and updated tests accordingly.

2009-10-22 08:10  xavier

	* [r5982] Declared funcionals_list.F90 as a noinst header, to avoid
	  problems
	  with compilers that don't like empty files.

2009-10-22 18:10  dstrubbe

	* [r5983] Alberto convinced me that the Casida transition density
	  has units of 1/volume, since cas%mat is dimensionless. I changed
	  the code accordingly.

2009-10-24 01:29  dstrubbe

	* [r5984] One significant change and a few trivial typographical
	  ones. In the list of libraries for the linking command line,
	  LIBS_ETSF_IO has to come before LIBS_NETCDF since it ETSF_IO
	  depends on netCDF.

2009-10-24 06:34  dstrubbe

	* [r5985] *) The -I include path for netCDF should be passed with
	  FCFLAGS to the compiler. Something analogous needs to be done for
	  ETSF_IO too, but I haven't figured out exactly how it should be
	  done yet. I think these two are handled differently than other
	  libraries because they have an "includes" folder containing
	  modules we have to use in compiling, unlike, for example,
	  SPARSKIT.
	  *) Some trivial changes to sparskit_inc.F90.

2009-10-26 06:27  dstrubbe

	* [r5986] *) The Fortran 2003 C pointer stuff doesn't work with PGI
	  9.0-4 unless I remove the "only" part of the use iso_c_binding
	  statement. This is the first PGI version to include support for
	  these features at all. It seems to me that everything works with
	  ifort with this changes also, but possibly there is some reason
	  why the "only" part was present here which will cause a problem
	  under some circumstance?
	  *) Two trivial changes.

2009-10-26 22:09  dstrubbe

	* [r5987] *) Rewrote the ETSF_IO configure test by analogy to the
	  netCDF one: previously, it did not set anything in FCFLAGS for
	  ETSF_IO, which meant that while the configure script found the
	  library, the compilation would fail.
	  *) A small change to the netCDF test to avoid repetition in the
	  output.
	  *) Set svn:ignore properties for newuoa to avoid seeing the .a
	  and .mod files in svn status.

2009-10-27 06:36  olivares

	* [r5988] Changes to poisson_sete solver, most of them aesthetic.

2009-10-27 10:21  nitsche

	* [r5989] * forgot to deallocate an array
	  * modify_ot was called with a wrong parameter when reading a
	  resonance
	  * had to trim a string in a write statement

2009-10-27 14:51  olivares

	* [r5990] grid points for SETE

2009-10-27 20:04  dstrubbe

	* [r5991] *) Noted in the documentation some more run modes that
	  are development-version-only.
	  *) SPARSKIT should be capitalized.

2009-10-28 02:51  olivares

	* [r5992] Improvement of SETE grid

2009-10-28 09:45  nitsche

	* [r5993] * hm%t0 was not initialized in the case of independent
	  particles
	  * the uninitialized pointer hm%oct_fxc caused problems while
	  trying to deallocate it

2009-10-28 15:30  nitsche

	* [r5994] * fixed a problem with an write statement that valgrind
	  found.
	  * an intent(out) changed to intent(inout).
	  * due to a bug in the geev routine (during the query of the
	  working array size) the initial array has to be larger than one.
	  this was probably the cause of the failing on ppc qith xlf and
	  the strange issues I had with atlas.
	  * Therefore I enabled the disabled open boundary tests again to
	  see if it really was the cause.

2009-10-28 17:03  nitsche

	* [r5995] * Okay, that was not the problem. Disabled it again...

2009-10-28 19:52  dstrubbe

	* [r5996] The projections calculated for linear-response
	  wavefunctions are all zero since the wavefunctions solved for in
	  the Sternheimer equation are projected into the unoccupied
	  subspace. A calculation with unoccupied states could give nonzero
	  projections, but the Sternheimer routines don't seem to work with
	  unoccupied states anyway (with semiconducting smearing, at least,
	  and with other smearing the projections aren't being calculated
	  correctly). I have therefore removed the call to this routine, to
	  avoid printing files full of zeroes.
	  
	  The proper way to do these projections is to construct the
	  perturbation Hamiltonian, including the Hartree and Vxc terms,
	  and explicitly take its matrix elements, which I will implement
	  at some point.

2009-10-29 00:57  dstrubbe

	* [r5997] *) Some minor changes to comments and output
	  *) Added and corrected a few push_sub statements
	  *) Changed some single-letter variables

2009-10-29 02:21  dstrubbe

	* [r5998] Due to a misunderstanding, the XCrySDen output had one
	  more mesh point in each direction than intended. Now it is fixed,
	  and the test updated accordingly.

2009-10-29 03:07  dstrubbe

	* [r5999] *) The configure script now will not produce warnings
	  about packages not found, if they have been explicitly disabled
	  with --disable or --without, at least for GDlib, netCDF, and
	  ETSF_IO.
	  *) Changed a single-letter variable in mesh_init.
	  *) Made some improvements to the comments, output, and
	  documentation.

2009-10-29 16:34  xavier

	* [r6000] Moved magnetic.F90 and elf.F90 to system/, since they
	  depend on the
	  kinetic energy they should know about the hamiltonian.

2009-10-29 16:51  xavier

	* [r6001] My last commit had some problems (some files had fake
	  dependencies).

2009-10-29 17:35  dstrubbe

	* [r6002] *) Actually whether we have to add 1 to the number of
	  mesh points for XCrySDen depends on whether the direction is
	  periodic or not. Now it is right, I think.
	  *) Noted that XCrySDen only works for three dimensions, made
	  dimension explicitly 3 within the routine, and stopped doing a
	  pointless dynamic allocation.
	  *) Some formatting in documentation and the test.

2009-10-29 17:41  dstrubbe

	* [r6003] Added a couple of missing dependencies.

2009-10-29 23:58  dstrubbe

	* [r6004] *) Some cosmetic changes to capitalization, etc.
	  *) SPARSKIT only warns in configure script if it was not disabled
	  *) Previously in many cases --enable and --disable would have the
	  same effect. Now they actually enable and disable, for METIS,
	  GDlib, LibNBC, and NEWUOA.
	  *) METIS no longer threatens an inability to parallelize in
	  domains if it is disabled, since we have Zoltan too.
	  *) GDlib's -I flag must be passed when compiling.
	  *) Fixed the default in the documentation for
	  MeshPartitionPackage.

2009-10-30 13:34  olivares

	* [r6005] changes to sete grid and to ion energy for the sete
	  method

2009-10-30 15:33  xavier

	* [r6006] Commented the code that was causing the periodic system
	  tests to fails.

2009-10-30 16:01  micael

	* [r6007] *) Bug fixed: the LB94 functional was not working for the
	  spin-polarized case because of a couple of misplaced brackets.

2009-10-30 17:35  olivares

	* [r6008] changes to ion_interaction_not_free_bc

2009-10-31 16:09  xavier

	* [r6009] Now the preprocessed assembler code has _oct.s extension
	  to avoid
	  problems with case unsensitive toy operating systems.

2009-11-02 05:21  dstrubbe

	* [r6010] *) A few trivial changes in fft.m4 and io_binary.c
	  *) Changed argument attributes to intent(out) instead of
	  intent(in) for function in read_binary routines, as pointed out
	  by Motohiko Tanaka.
	  *) Added push_sub's to io_binary routines.

2009-11-02 14:27  xavier

	* [r6011] Some fixes for compilation on Itanium.

2009-11-03 12:30  nitsche

	* [r6012] * fixed a bug trying to write the hamiltonian and green's
	  function (within transport) when DebugLevel>0
	  * an array was too large

2009-11-03 16:41  helbig

	* [r6013] fixed Young projections

2009-11-03 16:51  micael

	* [r6014] The gradient and the laplacian of the density used to
	  compute the xc potential are now computed directly from the
	  wavefunctions.

2009-11-03 17:13  nitsche

	* [r6015] * Due to a bug in the parser (which only happens on ppc
	  nowii) I had to rewrite the potentials in some tests. The problem
	  is that adding two step functions does NOT work, multiplying them
	  works perfectly fine.
	  * Enabled the open boundaries box-like potential tests, but
	  disabled the ring potentials, as I have no work-around for them
	  yet.
	  * An array was allocated too large.
	  
	  If it is a parser or compiler issue I will check out later...

2009-11-03 19:47  micael

	* [r6016] Subroutine states_calc_tau_jp_gn is now called only once
	  when calculating vxc.

2009-11-03 20:50  xavier

	* [r6017] * Fixed a typo.
	  * Added some comments about the variables read.

2009-11-04 11:38  nitsche

	* [r6024] * disabled the 4th open boundary test as it is still
	  failing on nowii

2009-11-04 13:18  xavier

	* [r6025] Declared UPF pseudopotentials as development version.

2009-11-04 15:11  xavier

	* [r6026] * The UPF format gives the projectors multiplied by r, so
	  a division by
	  r was missing. This means UPF pseudopotentials generated by APE
	  are
	  wrong.
	  
	  * Disabled the tests that use UPF pseudopotentials, since they
	  are
	  wrong.

2009-11-04 15:41  xavier

	* [r6027] * l_max for the UPF pseudopotentials is now read from the
	  list of
	  orbitals.
	  
	  * l_max and l_local are printed for UPF pseudopotentials.
	  
	  With this fix I think that Octopus is reading UPF pseudos
	  properly,
	  but I will keep them in develversion mode until we test them a
	  bit.

2009-11-04 16:02  nitsche

	* [r6028] * actually the step function does not work at all with
	  the ppc code, therefore i changed all the stepfunctions in the
	  openboundary test to an (nearly) equivalent - the fermi function.
	  * had to adjust some values to match the different function,
	  activated again the ring-structure tests

2009-11-04 20:56  micael

	* [r6029] Found another problem with the UPF format, although this
	  one, because of an error cancelation, had no practical
	  consequences: the units of the projectors and of the KB energies
	  were not handled correctly.

2009-11-05 06:23  mjv500

	* [r6030] long lines fixed and maxdim gt 3 was broken: periodic
	  people please be careful with your vectors which are no longer
	  all in 3D

2009-11-06 07:52  marques

	* [r6032] Fixed a couple of bugs:
	  *) LB94 was not working due to two problems with the interface
	  *) oct-center-geom was segfaulting due to incorrect
	  initialization of
	  geometry

2009-11-06 09:47  marques

	* [r6033] Bug fix: some functionals were not working in 2D.

2009-11-06 13:35  xavier

	* [r6034] Updated the debian files in trunk.

2009-11-07 08:14  xavier

	* [r6036] Sometimes UPFs do not specify the energy level, only the
	  orbital type
	  (s instead of 1s). Now octopus assumes that in that case the
	  level is
	  1.

2009-11-07 08:18  xavier

	* [r6037] Now global.o depends on the Makefile, in this way, when
	  the code is
	  reconfigured with a different prefix, the binary will be updated
	  (this
	  is a common problem for users).

2009-11-07 08:55  xavier

	* [r6038] * Fixed the simul_box_copy routine.
	  
	  * Declared PoissonIncreseBox as DevelVersion (i.e. it doesn't
	  work
	  anymore).

2009-11-07 10:40  xavier

	* [r6039] Removed the restart from a different mesh, it has been
	  broken for
	  months.

2009-11-07 12:20  micael

	* [r6040] *) Put the relativistic correction to the exchange part
	  of the LDA back into libxc.
	  *) Replaced the Xe UPF pseudopotential with a correct one and
	  removed all the other UPF pseudos.
	  *) The SO coupling test is again active.

2009-11-07 12:31  micael

	* [r6041] Forgot to remove the deleted files from the Makefile.

2009-11-07 13:20  xavier

	* [r6042] A line was too long.

2009-11-07 17:05  xavier

	* [r6043] Octopus can now be compiled with metis disabled.

2009-11-07 22:21  xavier

	* [r6044] Fixed to problems with Zoltan partitioning:
	  
	  * Sometimes we were passing the component 1 of an unallocated
	  array,
	  this is fine since the array is not used in that case. But the
	  code
	  failed when compiled with check bounds.
	  
	  * For some reason I don't understand (gfortran bug?) we have to
	  initialize a value that is later initialized to avoid some NaNs.

2009-11-09 05:21  dstrubbe

	* [r6045] *) Capitalization of SPARSKIT
	  *) A u-umlaut got turned into garbage in a comment, so I replaced
	  it with "ue"

2009-11-09 09:03  marques

	* [r6046] *) Now the relativistic corrections are also present in
	  higher
	  derivatives
	  *) Corrected warning in the interface of the meta-GGAs

2009-11-09 22:55  dstrubbe

	* [r6047] Removed MPI_Barrier which was causing LOBPCG to hang when
	  parallelized over k-points. Now an open-boundaries test no longer
	  fails in parallel.

2009-11-09 23:15  dstrubbe

	* [r6048] Change to testsuite script to allow use of "ibrun"
	  command on Lonestar, which does not take an argument for number
	  of processors.

2009-11-10 13:32  fulvio

	* [r6049] Bug fixed in the calculation of the parameter c of the
	  Tran-Blaha 2009 functional

2009-11-10 14:25  micael

	* [r6050] In some situation one variable was not properly
	  initialized in the LOBPCG eigensolver.

2009-11-10 15:47  fulvio

	* [r6051] Bug fixed in the calculation of the kinetic energy
	  density
	  (in the phase of the wavefunction used)

2009-11-10 16:00  nitsche

	* [r6052] * finally fixed the problem with the step function,
	  changed a pointer from double to gsl_complex. (I guess it was a
	  problem with the byte order of ppc)
	  * reverted all changes on open boundary tests
	  
	  P.S.: it should also fix the optimal control test which was
	  failing

2009-11-10 19:48  dstrubbe

	* [r6053] *) Marked multigrid and QMR_DOTP linear solvers as
	  development version only.
	  *) Set default linear solver to the regular symmetric one when
	  the system is not periodic, in which case that seems to be the
	  best choice (and, in fact, equivalent to the QMR_DOTP). Thus when
	  not using DevelVersion = yes, the development-only solver will
	  not be default.
	  *) A slight change to the testsuite script to conform to the
	  style of the rest

2009-11-11 01:16  acastro

	* [r6054] The elf calculation was segfaulting in spin-polarized and
	  spinors
	  mode, due to some arrays being deallocated too soon.

2009-11-11 02:25  dstrubbe

	* [r6055] *) Some cosmetic changes
	  *) Removed push_sub from Ylm routine

2009-11-11 22:59  xavier

	* [r6056] * Added the lookup object, it is initilized with a list
	  points and then
	  it can be asked for the list of points that are closer from a
	  certain
	  radius of a given point. For the moment the implementation is
	  O(N)
	  butI will replace it with an O(1) one.
	  
	  * Fixed a comment in configure.ac

2009-11-11 23:20  xavier

	* [r6057] Fixed compilation problem.

2009-11-12 16:11  xavier

	* [r6058] The generation of the potential assumed that the number
	  of points in a
	  submesh is always smaller than the grid points, but for periodic
	  systems (an a wrong pseudo potential) it is not always case.

2009-11-13 11:13  xavier

	* [r6059] * Now Octopus prints the radii of the localized parts of
	  the pseudopotential.
	  * If one of the radii is larger than 6.0 it prints a warning.

2009-11-14 20:33  xavier

	* [r6060] * Renamed spec_all_e to spec_full_gaussian.
	  
	  * Removed the variable SpecAllElectronSigma, now sigma is read as
	  an
	  extra field in the Species block.
	  
	  * Added a new species, spec_full_delta. This is like
	  spec_full_gaussian, but corresponds to a delta function in the
	  closest
	  grid point to the atom.
	  
	  * The full potential test now checks both species.
	  
	  * Added a species_is_full function, that returns true is the
	  species
	  is spec_full_delta or spec_full_gaussian.

2009-11-14 21:19  xavier

	* [r6061] Improved the message printed when a block components is
	  not present.

2009-11-14 22:51  xavier

	* [r6062] * Renamed user_defined to spec_user_defined, in this way
	  all species
	  have similar names.
	  
	  * Changes the number for the other definitions of user_defined.

2009-11-15 17:24  xavier

	* [r6063] Now LCAO works for full potential species.

2009-11-15 21:32  xavier

	* [r6064] * Added a check for debian installation of atlas.
	  
	  * If mpi is enabled, mpicc is the default C compiler.
	  
	  * With these two changes, Octopus configure scripts do not need
	  parameters in a Debian system with the adequate packages
	  installed (I
	  will put them in the wiki).

2009-11-16 19:58  dstrubbe

	* [r6065] Recall that 'species' ends on an 's' in English!

2009-11-16 23:05  dstrubbe

	* [r6066] *) Added reference for circular dichroism
	  *) Revised documentation
	  *) Added push_sub's
	  *) Alphabetized module list
	  *) Renamed single-letter variables
	  *) Documented missing option from ClassicalPotential, and some
	  cleaning of parts related to ClassicalPotential.
	  *) Added warning if StaticElectricField is used in a periodic
	  direction.
	  *) Used new parse function with units for StaticElectricField.

2009-11-16 23:57  dstrubbe

	* [r6067] *) Some minor improvements to documentation.
	  *) Changed an input file to correspond to Xavier's recent changes
	  about full-potential species, and stop a test failure.

2009-11-17 08:44  marques

	* [r6068] NOw the open boundary tests works with gfortran

2009-11-17 08:46  marques

	* [r6069] Bug fixed: debug mode was not working with open
	  boundaries

2009-11-17 09:20  marques

	* [r6070] There was a lookup_end missing, whcih caused memory not
	  to be
	  deallocated. Note that if you compile with g95 you get a nice
	  error at
	  the end of your run stating the memory that was not deallocated.
	  For
	  now, the oly serious case in octopus are the open boundaries
	  stuff that
	  do not deallocate around 20 variables. Danilo, maybe you could
	  take a
	  look at
	  http://www.tddft.org/programs/octopus/buildbot/builders/corvo_x86_64_g95_build/builds/770/steps/shell_5/logs/stdio
	  where you can find the error...

2009-11-17 09:49  nitsche

	* [r6071] * forgot to deallocate some variables

2009-11-17 14:39  nitsche

	* [r6072] * some more generalizations on the way to a simpler usage
	  of open boundaries for non-transport calculations

2009-11-17 14:52  nitsche

	* [r6073] * bugfix: access to non-initialized parts of an array

2009-11-17 15:15  nitsche

	* [r6074] * more bugfixes which I introduced with my last commit

2009-11-17 19:23  dstrubbe

	* [r6075] Fixed an HTML issue in documentation.

2009-11-17 21:27  dstrubbe

	* [r6076] *) Some cosmetic changes
	  *) Added and corrected push_sub's
	  *) Removed unused variables "hermitian" in Sternheimer.

2009-11-18 09:53  marques

	* [r6077] Added a bunch of 2D GGA functionals. They are still under
	  testing, so
	  don't rush to do calculations with them...

2009-11-18 10:38  nitsche

	* [r6078] * somehow x86 gfortran does not round correctly with int,
	  so changed to nint

2009-11-18 14:41  nitsche

	* [r6079] * changed an array copy to the slow bruteforce method
	  since it crashes for larger values of kpoints

2009-11-18 15:16  xavier

	* [r6080] The multiresolution test now uses a spec_full_delta.

2009-11-19 01:08  dstrubbe

	* [r6081] Some cosmetic changes.

2009-11-19 01:58  dstrubbe

	* [r6082] *) Improvements to comments and documentation
	  *) Removed unnecessary semicolons
	  *) Added a push_sub
	  *) Specified defaults for XC functional for 1D and 2D
	  *) Noted that functionals_list.F90 is automatically generated

2009-11-19 20:49  dstrubbe

	* [r6083] A few spelling issues.

2009-11-19 21:47  dstrubbe

	* [r6084] *) Changed some variables to more meaningful names
	  *) Improved comments and output
	  *) Noted in documentation that "none" is an option for current
	  functional and regular XC functional
	  *) Added and corrected push_sub's

2009-11-19 23:33  dstrubbe

	* [r6085] *) Some improvements to documentation
	  *) Changed single-letter variables

2009-11-20 00:46  dstrubbe

	* [r6086] Some trivial changes.

2009-11-20 07:37  marques

	* [r6087] Now make clean only deletes the /tmp/octopus folders that
	  are older than
	  10 hours. I hope this stops the annoying race conditions that is
	  giving
	  us false negatives in the builbot tests.

2009-11-20 08:13  marques

	* [r6088] This should fix the 4D output test

2009-11-20 08:22  marques

	* [r6089] This fixes the periodic_systems/06-h2o_pol_lr.test when
	  running in 4D

2009-11-20 08:36  marques

	* [r6090] This fixes the 03-extended_eigenstate test when running
	  in 4D. The
	  problem was the use of "w" in the inp file, which collided with
	  the "w"
	  coordinate in 4D. Please DO NOT USE SINGLE LETTER VARIABLES IN
	  THE INPUT
	  FILE!

2009-11-20 09:27  xavier

	* [r6091] Documented the variable OutputDuringSCF.

2009-11-20 09:45  xavier

	* [r6092] Improved the output of K points to make it more readable.

2009-11-20 09:55  micael

	* [r6093] The recent change in the default linear solver was
	  causing one of the tests to take too much time, as QMR
	  symmetrized solver is extremely slow for vdW calculations
	  compared to the bicgstab solver.

2009-11-20 12:19  xavier

	* [r6094] Fixes with MAX_DIM=4:
	  
	  * The generation of K points did not work properly.
	  * Fixed an out of bounds access in the FFT.

2009-11-20 12:53  marques

	* [r6095] Format descriptor '$' is not standard fortran 90. Use
	  advance='no'
	  instead.

2009-11-20 12:57  marques

	* [r6096] Now it is impossible to redefine a reserved variable in
	  the input file.
	  This means: no more x, y, z, r, w, ot t!!!

2009-11-20 13:04  micael

	* [r6097] The bicgstab linear solver was sometimes erroneously
	  printing a warning message saying it had not converged.

2009-11-20 13:38  xavier

	* [r6098] * Removed an unused module.
	  * Removed an unused library.
	  * Fixed an operation that failed with MAX_DIM=4.

2009-11-20 13:50  marques

	* [r6099] Sorry, forgot to commit this file

2009-11-20 14:18  xavier

	* [r6100] Fixed some MAX_DIM=4 issues..

2009-11-20 14:33  xavier

	* [r6101] More fixes for MAX_DIM = 4.

2009-11-20 14:49  xavier

	* [r6102] Fixed issues with MAX_DIM=4 in the lithium test.

2009-11-20 23:18  nitsche

	* [r6103] * replaced single letter variables in the open boundary
	  tests

2009-11-21 00:08  dstrubbe

	* [r6104] *) Some minor changes to comments, documentation, output
	  *) Changed single-letter variables in species
	  *) Added units of vector potential

2009-11-22 08:29  xavier

	* [r6105] Removed duplicated variable documentation.

2009-11-22 08:31  xavier

	* [r6106] Fixed the multiresolution test with MAX_DIM=4.

2009-11-22 09:37  xavier

	* [r6107] Reverted the units for the polarizabilty to ev_angstrom
	  to angstrom^3.
	  
	  We need to write a section in Manual:Units [1] explaining the
	  units for
	  polarizability (Alberto, can you do it?).
	  
	  [1]
	  http://www.tddft.org/programs/octopus/wiki/index.php/Manual:Units

2009-11-23 08:51  micael

	* [r6108] *) Documented a couple of variables.
	  *) Marked CurrentDFT as developtment version.

2009-11-23 10:14  micael

	* [r6109] More work on the documentation of the variables.

2009-11-23 12:35  micael

	* [r6110] Fixed the documentation of the oct-cross-section
	  variables.

2009-11-23 13:48  helbig

	* [r6111] variable definition for InvertKSTargetDensity

2009-11-23 13:51  xavier

	* [r6112] The DerivativesBoundaries variable is obsolete and can be
	  removed.

2009-11-23 14:03  xavier

	* [r6113] Reverted part of Nicole's commit (there were some
	  non-solved
	  conflicts). I kept the documentation of the InvertKSmethod
	  variable.

2009-11-23 15:56  helbig

	* [r6114] bugs in invertks fixed

2009-11-23 16:08  micael

	* [r6115] Removed the variables.local file, as I believe it was not
	  really used anymore.

2009-11-23 16:20  xavier

	* [r6116] Increased the precision of the Hartree output. Probably
	  it will fail
	  in many machines, but I want to check the dispersion of the
	  results.

2009-11-23 16:46  xavier

	* [r6117] I left the same precision that the Hartree test had
	  before through
	  rounding (0.05) and now it is passed by the pathscale compiler.

2009-11-23 21:24  xavier

	* [r6118] Disabled the OCT test that fails with gfortran. With
	  this, the
	  testsuite should be passed completely. I hope we can keep it that
	  way.
	  
	  (Alberto, when you manage to fix it, please enable it back.)

2009-11-23 22:15  xavier

	* [r6120] Changed the version in trunk, to avoid confusion with
	  released
	  versions, I propose to have names for the development version.
	  The
	  names will be based on Octopus species, for example, this version
	  is
	  "octopus vulgaris" (common octopus). There is a large list [1] to
	  choose from, and there some very nice ones as octopus magnificus,
	  octopus horridus or octopus nocturnus.
	  
	  [1] http://en.wikipedia.org/wiki/Octopus_(genus)

2009-11-24 02:25  dstrubbe

	* [r6121] *) Some cleaning up to recent commits: please be sure to
	  spell names of variables correctly in the documentation.
	  *) Improvements to documentation.
	  *) Alphabetized modules
	  *) Changed single-letter variables
	  *) Used new parser call with units
	  *) Corrected some confusion between input and output units

2009-11-24 03:49  dstrubbe

	* [r6122] *) Fixed mistake in last commit, in utilities, which I
	  missed since I was only compiling in parallel.
	  *) Fixed confusion about push_sub and pop_sub in invert_ks
	  *) Some trivial changes
	  *) Corrected types of Spec variables, and specified defaults in a
	  more meaningful fashion.

2009-11-24 12:47  xavier

	* [r6126] The check for extension can give false positives if
	  linking is not done.

2009-11-24 12:51  xavier

	* [r6127] Now Octopus and libxc set the C compiler in C99 mode.

2009-11-24 13:16  xavier

	* [r6128] The macro required by C99 is not available in autoconf
	  2.59, that is
	  the one in tddft. So we will have to stay with c89 for the
	  moment.

2009-11-24 20:47  dstrubbe

	* [r6129] *) A fix for compilation with PGI 7, to keep chum happy.
	  This is the workaround for units_from_atomic on an array, for a
	  compiler bug which has been fixed in the newest versions.
	  *) Changed some single-letter variables and made some array
	  bounds explicit.
	  *) Minor changes to text in a test.

2009-11-24 22:47  dstrubbe

	* [r6130] Fixed a formatting mistake in the documentation.

2009-11-25 10:21  xavier

	* [r6133] Introduced the symm_op object.

2009-11-25 10:51  xavier

	* [r6134] Now the list of symmetry operations contains only those
	  compatible
	  with the symmetry breaking.

2009-11-25 12:11  xavier

	* [r6135] * Symmetries that involve a translation are not used for
	  the moment.
	  * Now octopus prints the number of usable symmetries found.

2009-11-25 12:41  xavier

	* [r6136] Now the symmetries are a component of simul_box.

2009-11-25 13:09  xavier

	* [r6137] Fixed some problems in my last commits.

2009-11-25 16:48  xavier

	* [r6138] Initial version of the symmetrization of the density. It
	  needs more
	  testing, but apparently it works.

2009-11-25 20:16  dstrubbe

	* [r6139] *) Added push_sub's to new routines
	  *) Improvements to comments

2009-11-25 21:04  dstrubbe

	* [r6140] I think this will fix the dist-check buildbot failure.

2009-11-25 21:36  xavier

	* [r6141] I forgot to put some files as noinst headers.

2009-11-25 22:28  xavier

	* [r6142] Symmetrization of tau for Meta-GGAs.

2009-11-26 00:52  dstrubbe

	* [r6143] Probably mentioning the file once in the Makefile is
	  sufficient.

2009-11-26 06:49  xavier

	* [r6144] The symmetrization of the laplacian of the density was
	  missing for
	  meta-GGAs.

2009-11-26 09:40  xavier

	* [r6145] * Added a routine to symmetrize vectors.
	  * Now the gradient of the density is symmetrized directly.

2009-11-26 10:05  xavier

	* [r6146] * Some comments on the symmetrization of meta-GGAs.
	  * Declared symmetrization as DevelVersion.

2009-11-26 13:41  nitsche

	* [r6147] * rewrote again some array copy statements since it
	  crashes for larger arrays

2009-11-27 16:10  nitsche

	* [r6148] * some more changes for a simpler open boundary usage
	  without (ab)using the lippmann-schwinger groundstate
	  * reduced the number of 'forall' in my recent commit

2009-11-27 16:22  nitsche

	* [r6149] * fixed a too long line...

2009-11-28 02:42  dstrubbe

	* [r6150] *) Added push_sub statements
	  *) Alphabetized module lists

2009-11-28 22:32  xavier

	* [r6151] Symmetries are now also initialized (to identity) for
	  finite systems.

2009-11-29 00:03  xavier

	* [r6152] Removed unnecessary arguments in some functions.

2009-11-29 02:54  dstrubbe

	* [r6153] The utilities "broad" and "cross-section" both apply
	  broadening to calculate a cross-section. I have renamed them to
	  "casida_spectrum" and "propagation_spectrum" to make clear what
	  they each do.

2009-11-29 04:54  dstrubbe

	* [r6154] *) Set svn:ignore properties for new utility names
	  *) Formatting and more info in documentation
	  *) Changed section names

2009-11-29 05:06  dstrubbe

	* [r6155] Renamed files.

2009-11-29 05:18  dstrubbe

	* [r6156] More changes of the utility names.

2009-11-29 05:42  dstrubbe

	* [r6157] *) Changed more things from broad to casida_spectrum
	  *) Corrected Makefile

2009-11-29 06:26  dstrubbe

	* [r6158] *) Alphabetized module lists
	  *) Changed single-letter variables
	  *) Lined up argument lists
	  *) Improvements to pod documentation
	  
	  The general state of documentation of the utilities is quite
	  lacking. Those who know about the utilities should write
	  something about them in the pod files and wiki. Nowhere, for
	  example, can I find what the harmonic-spectrum utility does, even
	  after reading the code.

2009-11-29 08:06  dstrubbe

	* [r6159] *) Renamed oct-rsf to oct-rotatory_strength, to be less
	  cryptic
	  *) Changed single-letter variables
	  *) Renamed also the file rotational_strength to
	  rotatory_strength, for consistency

2009-11-29 08:20  dstrubbe

	* [r6160] *) Renamed file phonon_spectrum to vibrational, for
	  consistency with the utility executable it creates
	  *) Renamed oct-ph.pod to oct-vibrational.pod, since some time ago
	  the utility oct-ph was renamed to oct-vibrational.
	  *) Renamed documentation file for oct-rotatory_strength.

2009-11-29 08:34  dstrubbe

	* [r6161] *) Updated variable names
	  *) Revised documentation, comments, output
	  *) Revised pod documentation for utilities

2009-11-29 08:39  dstrubbe

	* [r6162] Fixed Makefile mistake.

2009-11-29 10:30  xavier

	* [r6163] Started changing the way multigrid works. Each
	  derivatives object now
	  has pointers to the derivatives object in the coarser and finer
	  grids.

2009-11-29 11:28  xavier

	* [r6164] Changed the interface for the grid transfer functions.

2009-11-29 19:12  xavier

	* [r6165] More modifications of the multigrid code.

2009-11-29 19:49  xavier

	* [r6166] Now the poisson solver takes a derivatives object instead
	  of a grid
	  object.

2009-11-29 20:45  xavier

	* [r6167] Hamiltonian_apply and friends now receive a derivatives
	  objects
	  instead of a grid.

2009-11-29 21:40  xavier

	* [r6168] More gr -> der changes.

2009-11-30 12:03  xavier

	* [r6169] More updates for the fine mesh.

2009-11-30 22:42  xavier

	* [r6170] Some changes of gr to mesh and cleaning.

2009-11-30 23:19  dstrubbe

	* [r6171] *) Changed some single-letter variables
	  *) Fixed some missing changes in Xavier's last commit, to make
	  things compile

2009-11-30 23:51  xavier

	* [r6172] Finally, the poisson solver does not know anything about
	  grid_t.

2009-12-01 07:55  xavier

	* [r6173] I forgot to declare poisson_t as public, this causes
	  problems with
	  some compilers.

2009-12-01 09:10  marques

	* [r6174] 3 new functionals optimized to be used with the Dion et
	  al vdW
	  functional. See http://arxiv.org/abs/0910.0438

2009-12-01 09:22  marques

	* [r6175] Sorry, this file should not have been committed:
	  reverting it.

2009-12-01 21:41  xavier

	* [r6176] More changes for the density in the fine mesh.

2009-12-01 23:13  dstrubbe

	* [r6177] *) Changed parallel debug stack trace to start with
	  DebugLevel = 99 rather than 100 so that the debug levels appear
	  in ascending order in the documentation.
	  *) Improvements to documentation and comments
	  *) Corrected and added push_sub

2009-12-02 01:55  dstrubbe

	* [r6178] *) Improvements to documentation and comments
	  *) Corrected push_sub's
	  *) Changed single-letter variables
	  *) LOBPCG spinors test took too long: shortened by increasing
	  spacing.

2009-12-02 02:55  dstrubbe

	* [r6179] *) Revised documentation on linear solvers, adding info
	  from my tests
	  *) General default is now qmr_symmetric, since that seems to work
	  for OEP; the default for Sternheimer is now set by
	  sternheimer_init
	  *) Improvements to comments and output

2009-12-02 06:56  xavier

	* [r6180] * Moved all the components of the Poisson solver to
	  poisson_t, so now
	  it is possible to have multiple copies of it.
	  
	  * The xc potential can now be applied in the fine mesh.

2009-12-02 07:12  xavier

	* [r6181] There was a problem in my last commit.

2009-12-02 07:37  dstrubbe

	* [r6182] Fixed a problem in my last commit about redefinition of
	  the numbers for the linear solvers.

2009-12-02 08:07  xavier

	* [r6183] My changes had broken compilation in parallel.

2009-12-02 10:59  marques

	* [r6184] Some cleaning regarding very small densities

2009-12-02 17:16  micael

	* [r6185] More fixes regarding very small densities.

2009-12-03 01:58  dstrubbe

	* [r6186] Our testsuite runs have been plagued with (meaningless)
	  error messages such as "tail: write error" and "tail: Broken
	  pipe". I don't know why they appear randomly as they do, but I
	  have banished them by reimplementing the matches in the Perl
	  script via awk instead of tail.
	  
	  Note that while some tests will fail with this revision, it is
	  due to changes introduced in r6184 and r6185, not this change of
	  the script, which gives identical results to the old way with
	  r6183 (when all tests passed), as well as r6184 and r6185.

2009-12-03 03:16  dstrubbe

	* [r6187] Changed the handling of the projector in Sternheimer, in
	  preparation for the second-order equation which needs the whole
	  wavefunction.

2009-12-03 15:25  nitsche

	* [r6188] * finally open boundaries work with 1 up to 4 leads in 2D
	  (have not checked 3D yet), without doing a useless
	  Lippmann-Schwinger-ground state calculation. Therefore now the gs
	  simulation box has the same size as the td box.
	  * fixed a few bugs which were never triggered as long the leads
	  had the same size
	  * the k-weights for open boundaries were not correctly read from
	  the file
	  * changed criterium for an state being occupied (now it works for
	  more than 1 state), also changed states_look to handle this
	  correctly.
	  * because of the now correct handling of the kpoint weights some
	  testsuites values changed

2009-12-03 16:00  joseba

	* [r6189] Enable compiling with the --disable-f90-forall. Otherwise
	  the preproccess.pl script was unable to translate the forall to
	  do structure

2009-12-03 20:17  marques

	* [r6190] Bug fixed: this was triggered by the changing of the
	  thresholds, but it
	  was there for a long time. Now the tests should pass.

2009-12-03 20:38  acastro

	* [r6191] The ionization target in OCT was broken.

2009-12-03 23:02  dstrubbe

	* [r6193] *) Added timing to testsuite script, to see which tests
	  take longest, and for possible use in comparing performance
	  *) Some trivial changes

2009-12-07 08:41  xavier

	* [r6194] * Redirected the stderr of the `which` command in
	  oct-run_regression_test.pl, this avoids warnings messages about
	  mpiexec not found (even when running in serial).
	  
	  * The test for etsf_io was passing -letsf_io at the beginning of
	  the
	  compilation line, now it is passed at the end as it should be.

2009-12-07 21:37  dstrubbe

	* [r6195] *) Alphabetized modules
	  *) A correction of terminology of "local" vs "localized"
	  *) The testsuite shouldn't pretend everything is OK when all
	  tests are skipped.

2009-12-07 22:42  dstrubbe

	* [r6196] Some small fixes to formatting in output.

2009-12-08 09:02  dstrubbe

	* [r6197] *) The kdotp run mode now prints out band velocities,
	  which in fact needs only the perturbation Hamiltonian and not the
	  perturbed wavefunctions.
	  *) Broke up kdotp_output into kdotp_write_degeneracies and
	  kdotp_write_eff_mass
	  *) A couple typographical things in LDA C PZ.

2009-12-08 13:17  marques

	* [r6198] *) Bug fix when calculating v2rho2 in mixed GGAs
	  *) The optPBE_vdW functional was wrong
	  *) Now xc-reference.pl knows about build directories

2009-12-08 16:04  marques

	* [r6199] This should fix the kdotp test. Octopus was trying to
	  write a file
	  before creating the directory.

2009-12-08 21:31  dstrubbe

	* [r6200] *) Revised output of pseudopotential radii
	  *) Added a blank line to k-point output

2009-12-09 03:27  dstrubbe

	* [r6201] Improvement to output for band velocities.

2009-12-09 11:00  marques

	* [r6202] The value of this test changed after I changed the
	  thresholds in libxc
	  (changeset 6184). The problem is probably one of convergence. As
	  the EXX
	  calculation starts from the LDA, and the LDA changed slightly due
	  to the
	  different thresholds.

2009-12-09 15:40  fulvio

	* [r6203] corrected the documentation concerning the variables
	  ConvAbsEv and
	  ConvRelEv

2009-12-09 19:13  nitsche

	* [r6204] * fixed a typo in the documentation
	  * rewrote the lead initialization to handle 3D systems without
	  trying to allocate a huge array (which is then shrinked anyway)

2009-12-09 19:56  dstrubbe

	* [r6205] My use of the minimal projector Pn' in Sternheimer does
	  not work for metals, which was making the Na2 polarizability test
	  fail. Now it is only applied in the case of semiconducting
	  smearing to restore the previous behavior for metals.

2009-12-09 20:18  xavier

	* [r6206] * Now the xc potential is properly calculated with the
	  density in the
	  fine mesh.

2009-12-09 20:41  xavier

	* [r6207] The Hartree and XC potentials are now transferred by
	  injection, since
	  we do not always have the proper boundary conditions (so we
	  cannot use
	  restriction).

2009-12-10 02:23  olivares

	* [r6208] Pending changes for sete mesh and nuclear energy
	  calculation for complex boundary condition solver (sete)

2009-12-10 08:43  joseba

	* [r6209] Added Doxyfile to generate documentation. To generate
	  documentation you have to have installed doxygen and run it in
	  the root directory of Octopus, it takes long, about 2 hours. You
	  also have to have installed dot to generate images. I will make
	  little changes in the comments to generate more documentation.

2009-12-10 13:43  joseba

	* [r6210] added doxygen comments to these files

2009-12-10 14:15  joseba

	* [r6211] Tunned Doxyfile to our needs

2009-12-10 16:30  xavier

	* [r6212] * Removed the projectors on the fine grid, they were not
	  really used and
	  I don't think they are necessary.
	  
	  * Spec_get_density now receives a mesh_t argument and not a
	  grid_t one.

2009-12-11 06:04  xavier

	* [r6213] Now epot_local_potential does not receive a grid
	  argument.

2009-12-11 06:36  xavier

	* [r6214] Removed push/pop_subs from profiling functions, these
	  routines should
	  be as small as possible to produce accurate results.

2009-12-11 06:49  xavier

	* [r6215] * The one shot mode was assuming a DFT calculation, so it
	  failed for
	  independent_particles. Now it works for independent particles
	  (and
	  DFT, of course) and stops with and error message for other theory
	  levels.
	  
	  * Some small fixes related to the fine grid.

2009-12-11 14:05  xavier

	* [r6216] The one_shot now works with the fine mesh.

2009-12-12 08:28  xavier

	* [r6217] Added a short test for several XC functionals using the
	  one_shot run mode.
	  
	  There is something we should check: gga_c_pw91 and gga_xc_lb give
	  zero energy.

2009-12-13 10:04  xavier

	* [r6218] * Added a directory tests of the functionals.
	  * Added a test for the 1d XC functionals.

2009-12-13 13:57  xavier

	* [r6219] Moved other functional tests to the functionals/
	  directory.
	  
	  I am investigating the cause of the test failures (it seems to be
	  a
	  problem of Hartree-Fock).

2009-12-13 14:11  xavier

	* [r6220] * Fixed the xc-1d test, it was necessary to start with an
	  lda
	  calculation to converge Hartree-Fock properly.
	  
	  * A typo in the Makefile.am caused problems with the autotools.

2009-12-13 20:18  xavier

	* [r6221] Disabled for the moment de XC Functionals tests. I will
	  try first to
	  figure out the problem with the 1d one first.

2009-12-14 13:10  xavier

	* [r6222] Now all octopus commands can take the --version argument.

2009-12-15 10:51  joseba

	* [r6223] changed the documentation

2009-12-15 11:40  joseba

	* [r6224] comments changed

2009-12-15 12:12  marques

	* [r6225] Bug fix in Pulay mixing: a range was wrong in an
	  allocation
	  Bug fix in 1D CSC functional: variables were not deallocated

2009-12-15 14:37  marques

	* [r6226] Bug fix: there was a "-1" missing in an index which
	  caused some
	  compilers to return garbage (which was the correct answer). This
	  should
	  fix the 1D test that is currently failing. Please 1D people check
	  your
	  calculations!!!!

2009-12-15 15:52  marques

	* [r6227] Turned on the 3D functionals test to see what is going
	  on...

2009-12-15 16:42  xavier

	* [r6228] When I moved the xc test I replaced all 26 by 03, without
	  realising
	  that some reference values were changed.

2009-12-15 17:36  xavier

	* [r6229] Moved the Hartree-Fock test as the initial calculation
	  for the XC 2D
	  test.

2009-12-15 18:13  xavier

	* [r6230] * Added tests for all 2d XC functionals.
	  
	  * Octopus didn't know about some of them (Miguel, the
	  dimensionality
	  is other attribute that the functional has at that libxc should
	  inform
	  somehow).

2009-12-16 09:38  helbig

	* [r6233] KS inversion modified, still under developement

2009-12-16 11:02  xavier

	* [r6235] Fixed compilation problem in Nicole's commit.

2009-12-16 16:27  fulvio

	* [r6236] Changed an allocation that referred to the global number
	  of k
	  points instead of the local one

2009-12-17 12:09  xavier

	* [r6237] Now all the LDA functionals are tested.

2009-12-17 13:58  xavier

	* [r6238] * The phases in the projector are only initialized for
	  the kpoints in
	  the node.
	  
	  * Enabled the XC test for the parallel binary.

2009-12-18 09:37  olivares

	* [r6239] changes to poisson_sete code. Changes to grid setup, and
	  initial guess of the array containing the potential.

2009-12-18 11:01  xavier

	* [r6240] * Some commented SAFE_DEALLOCATE caused problems with
	  g95.

2009-12-18 11:32  xavier

	* [r6241] Modified the XC test so the systems is not completely
	  spin polarized.

2009-12-18 17:10  xavier

	* [r6242] Added tests for all GGAs.
	  
	  There are some things to check: 8 functionals (including
	  gga_c_lyp)
	  fail with segmentation fault and several (including gga_xc_lb)
	  give
	  zero energy.

2009-12-18 17:16  xavier

	* [r6243] Changed the labels for the lda tests.

2009-12-18 19:26  xavier

	* [r6244] A fix in the XC test: I was checking for correlation
	  instead of
	  exchange for some exchange functionals.

2009-12-18 23:15  xavier

	* [r6245] * When using the fine mesh, the vxc potential must be
	  initialized to
	  zero. With this fix the fine mesh appears to be working for
	  ground
	  state calculations. (But probably many parts of the code will not
	  work
	  with it).
	  
	  * Improved the output for the fine mesh.

2009-12-19 08:53  xavier

	* [r6246] Now the number of repetitions for meausring the
	  throughput of the
	  laplacian is set dynamically.

2009-12-20 13:20  xavier

	* [r6247] Renamed %h to %spacing.

2009-12-20 14:23  xavier

	* [r6248] * Moved lead_unit_cell_extent to ob_interface_m.
	  * Removed some unnecessary parameters to interface_init.

2009-12-20 16:24  xavier

	* [r6249] The spacing is not longer needed to calculate the point
	  position for
	  the image box.

2009-12-20 21:27  xavier

	* [r6250] Changed the order of initialization, as der%mesh was not
	  associated
	  when calling interface_init.

2009-12-21 20:58  olivares

	* [r6251] Changes to the SETE grid

2009-12-21 21:44  xavier

	* [r6252] Removed the spacing from simul_box_t.

2009-12-21 22:33  xavier

	* [r6253] * Fixed some errors in my previous commit.
	  * Changed the order of the argument for some v_ks_* functions.

2009-12-23 06:25  olivares

	* [r6254] Changes to the way the memory is allocated for
	  determining the SETE ionic and electronic potentials

2009-12-25 22:31  xavier

	* [r6255] Some code cleaning.

2009-12-25 23:53  xavier

	* [r6256] More code cleaning.

2009-12-26 01:13  xavier

	* [r6257] * The exponential routines now receive a derivatives
	  object instead of
	  a grid one.
	  
	  * More cleaning.

2009-12-26 20:07  xavier

	* [r6258] More changes grid_t -> derivatives_t and cleaning.

2009-12-27 09:59  xavier

	* [r6259] Now pert_apply receives wave-functions with spinor index
	  (but the
	  implementation for spinors is missing inside).

2010-01-07 16:38  dstrubbe

	* [r6260] A few trivial changes.

2010-01-08 20:12  nitsche

	* [r6261] * some more changes to get the open boundary scheme
	  working compatible with the transport mode
	  * some rewriting (uses forall)
	  * fixed a small bug creating a directory (wrong loct_mkdir ->
	  io_mkdir)

2010-01-08 20:22  dstrubbe

	* [r6262] *) A minor change to capitalization
	  *) A change of the name of the spacing variable that was missed
	  before

2010-01-09 08:49  nitsche

	* [r6263] * removed the check for MeshblockSize as it works now for
	  any blocks
	  * removed Meshblock from the testfiles

2010-01-11 09:45  sakko

	* [r6264] Adds the possibility to use exp(iq.r)-type external
	  fields that are needed to calculate dynamic structure factor
	  (energy loss spectrum) with time propagation.

2010-01-19 11:29  marques

	* [r6265] Several fixes for the bugs found by Xavier while setting
	  up the xc test.
	  Fairly trivial things, but anyway quite annoying...

2010-01-19 12:59  nitsche

	* [r6266] * reverted my commit: problem is not solved yet, the test
	  files running without errors, but the output (e.g. density) is
	  distorted. The problem is also more severe than I thought. This
	  will be fixed in the modularized version of the transport
	  algorithm.

2010-01-19 13:28  marques

	* [r6267] Tobias patch. Sorry Tobias, we were all until recently in
	  Benasque...

2010-01-19 14:00  joseba

	* [r6268] Changes in the comments to generate more documentation

2010-01-20 00:26  acastro

	* [r6269] o One line in io_function_inc.F90 was too long for the
	  Fortran 90 standard.
	  
	  o Added a check to make sure that the polarization vector of the
	  external
	  field is not complex, for QOCT runs.

2010-01-20 17:01  nitsche

	* [r6270] * changed a bit the convergence test of the qmr solver
	  * fixed a debug info output
	  * added debug info to the transport propagator

2010-01-22 00:51  dstrubbe

	* [r6271] *) Duplicated variable documentation in InvertKS removed,
	  which was messing up the variable-reference page.
	  *) Some improvements to formatting.

2010-01-22 01:24  dstrubbe

	* [r6272] *) Changed some single-letter variables, to longer/more
	  meaningful names.
	  *) Improvements to documentation, comments, and output.
	  *) Added push_sub's.

2010-01-22 02:00  dstrubbe

	* [r6273] *) Changed single-letter variables and others to more
	  meaningful names.
	  *) Improvements to comments.

2010-01-22 02:53  dstrubbe

	* [r6274] I think this was causing the test failure.

2010-01-22 03:01  dstrubbe

	* [r6275] *) Added push_sub's.
	  *) Improvements to documentation and comments.
	  *) Changed single-letter variables.

2010-01-25 19:59  dstrubbe

	* [r6276] *) Changed single-letter variables
	  *) Improvements to comments, output
	  *) Fixed dim=4 bug in td_write from Arto's recent commit
	  *) Inserted units for vector potential.

2010-01-25 22:17  dstrubbe

	* [r6277] *) Improvements to comments
	  *) Changed single-letter variables

2010-01-25 23:55  dstrubbe

	* [r6278] A fix of a mistake in my previous commit.

2010-01-26 23:36  dstrubbe

	* [r6279] *) Improvements to comments, formatting, documentation,
	  output
	  *) Changed single-letter variables
	  *) Added push_sub statements

2010-01-27 00:19  dstrubbe

	* [r6280] A workaround for a PGI compiler bug in 7.2-5, the dreaded
	  
	  PGF90-F-0000-Internal compiler error. rewrite_sub_args: can't
	  find array 9544 (../../../src/td/td_write.F90: 1304)
	  PGF90/x86-64 Linux 7.2-5: compilation aborted
	  
	  which occurs when passing an array to units_from_atomic.

2010-01-27 03:09  dstrubbe

	* [r6281] *) Changed singe-letter variables
	  *) Improvements to comments

2010-01-27 21:12  dstrubbe

	* [r6282] *) Changed more single-letter variables.
	  *) Improvements to formatting, comments
	  *) Added push_sub's

2010-01-28 02:17  dstrubbe

	* [r6283] *) Some changes to comments.
	  *) Fixed a mistake in previous commit that caused test failure.

2010-01-28 15:59  mjv500

	* [r6284] pop_subs missing everywhere

2010-01-28 20:33  dstrubbe

	* [r6285] *) Removed spurious blank line from par_vec
	  *) Changed more single-letter variables
	  *) Improved formatting and comments

2010-01-29 01:31  dstrubbe

	* [r6286] *) Changed single-letter variables
	  *) Added and corrected push_sub's
	  *) Improvements to comments, formatting, documentation

2010-01-29 04:35  dstrubbe

	* [r6287] Broke up two excessively long lines.

2010-01-29 05:19  dstrubbe

	* [r6288] Maybe this will fix the problem.

2010-01-29 19:35  dstrubbe

	* [r6289] I hope this will fix the compilation problem finally.

2010-01-30 02:27  dstrubbe

	* [r6290] *) Changed "linear response" to just "response" for the
	  time-propagation method of getting spectra, since it is not in
	  fact linear.
	  *) Improvements to documentation, comments, formatting.
	  *) Changed single-letter and other variables to more meaningful
	  names.

2010-01-30 08:11  dstrubbe

	* [r6291] *) Improvements to comments, formatting, documentation,
	  and output
	  *) Changed singe-letter variables
	  *) Added push_sub's
	  *) Fixed a too-long line in my last commit

2010-01-30 08:31  dstrubbe

	* [r6292] Fixed too-long line.

2010-01-31 04:06  olivares

	* [r6293] complex boundary condition changes.

2010-01-31 04:26  olivares

	* [r6294] Correcting compilation errors.

2010-02-01 09:27  micael

	* [r6295] *) The calculation of the laplacian of the density was
	  wrong in the spin-polarized case.
	  *) A variable was not initialized in libxc for the MGGAs when the
	  density was bellow the threshold.
	  *) Some small fixes to the etsf_io output.

2010-02-01 15:57  mjv500

	* [r6296] need a runtime test on exponential divergence

2010-02-01 21:37  dstrubbe

	* [r6297] *) Changed single-letter variables
	  *) Added push_sub's
	  *) Improved comments and formatting

2010-02-02 00:33  acastro

	* [r6298] Changed "OCTExcludeStates", which was an integer, by
	  "OCTExcludedStates", which is now a string that is supposed to
	  contain
	  a string of numbers. This way it allows for more flexibility in
	  the
	  definition of which states are to be excluded.

2010-02-03 04:40  acastro

	* [r6299] Fixed a problem with one of the optimal control tests,
	  which was
	  disabled because of it.
	  
	  The problem can be traced back to a LAPACK issue: there is no
	  guarantee that the eigenvectors computed on different platforms
	  for
	  the same matrix will be the same: they might have different sign.
	  This
	  is usually irrelevant, but not for this particular case.
	  
	  I re-enabled the test.

2010-02-03 12:30  joseba

	* [r6300] More comments to documentation

2010-02-03 15:58  marques

	* [r6301] I finished cleaning the interface of libxc. The release
	  of 1.0beta will
	  follow in the next days.

2010-02-04 10:11  marques

	* [r6302] Small correction pointed out by Damien Caliste.

2010-02-06 10:46  acastro

	* [r6303] The OpenDX script "mf.net" was not working properly: it
	  started
	  issuing several errors.

2010-02-08 13:04  xavier

	* [r6304] * Added a (very basic) checksum function.
	  * The checksum of the lxyz array is now calculated and written in
	  the
	  restart information.

2010-02-08 13:38  xavier

	* [r6305] Fixed a compilation problem in my last commit (I used
	  FC_FUNC instead
	  of FC_FUNC_).

2010-02-08 14:11  marques

	* [r6306] Initial implementation of the Proynov and Salahub 94 LDA.
	  The energy is
	  working and giving the right results. Now it is time to optimize
	  and to
	  compute the derivatives.
	  
	  Yes, I was also surprised that there are even more LDA
	  functionals. This
	  one is anyway different, as it is not a parametrization of the CA
	  Monte-Carlo data, but uses a quite different approach.

2010-02-08 15:12  marques

	* [r6307] Sorry, there was a semi-colon missing

2010-02-09 09:27  marques

	* [r6308] Now also vxc is working for this functional. I will leave
	  fxc and kxc
	  for the future ;)

2010-02-09 09:40  marques

	* [r6309] Renamed the PS94 functional to the name given in the
	  original article,
	  and added a second version of the functional

2010-02-09 22:08  acastro

	* [r6310] Bug fix: a variable was initialized with itself.

2010-02-10 03:13  dstrubbe

	* [r6311] I think it is more logical to speak of deallocation in
	  error messages than allocation of a negative size.

2010-02-12 15:01  marques

	* [r6312] I added the possibility to turn off the subspace
	  diagonalization that
	  was completely destroying my calculations...

2010-02-16 13:56  joseba

	* [r6313] Comments changed to fit the documentation

2010-02-16 19:52  dstrubbe

	* [r6314] Made some type conversions explicit to suppress compiler
	  warnings.

2010-02-23 03:33  dstrubbe

	* [r6315] Removed some excessive white space in variable
	  documentation, and rephrased a sentence.

2010-02-23 16:38  fnog

	* [r6316] The LCAOStart default value is lcao_full, but the
	  documentation mentions lcao_states.

2010-02-23 19:27  dstrubbe

	* [r6317] Specified the full criteria for the default for LCAO, as
	  given in the code.

2010-02-24 03:14  dstrubbe

	* [r6318] *) Changed single-letter variables
	  *) Changed real(8) to REAL_DOUBLE: should all the real(8)'s be
	  REAL_DOUBLE?
	  *) Generalized geometry optimization to N dimensions
	  *) Improved some formatting and documentation

2010-02-24 20:40  dstrubbe

	* [r6319] *) Improvements to output, code formatting, comments
	  *) Alphabetized modules
	  *) Changed single-letter variables

2010-02-24 21:32  dstrubbe

	* [r6320] *) Changed variables to more meaningful/standard names
	  *) Improved formatting and comment

2010-02-25 22:46  dstrubbe

	* [r6321] *) gs, go, and unocc run modes each had their own very
	  similar code for LCAO runs. They are now consolidated into a
	  single routine lcao_run.
	  *) lcao_end was not always called; now it is, so the variables
	  are properly deallocated.
	  *) Standardization of messages printed from LCAO.
	  *) LCAO for go made like gs, as there was no clear reason for the
	  difference.
	  *) Initialization for open boundaries now always occurs in
	  lcao_run, as could conceivably be useful for run modes other than
	  gs.
	  *) No random wavefunctions are generated if they are being
	  replaced by LCAO anyway.
	  *) Small improvements to documentation, output, formatting
	  *) Alphabetized module list
	  *) Changed integer lcao%state to logical lcao%initialized, for
	  clarity

2010-02-26 03:57  dstrubbe

	* [r6322] A few trivial changes.

2010-02-26 14:01  marques

	* [r6323] Added the option to compile libxc dynamically, and a
	  target to create
	  libxc.rpm
	  
	  I had to use libtool, which led to some problem. Let's see if all
	  the
	  architectures are happy with them...

2010-02-26 15:42  marques

	* [r6324] Let's see if this fixes the compilations issues. Needless
	  to say that it
	  compiles without problem in my machine... I hate the autotools!

2010-02-26 16:22  marques

	* [r6325] Stupid hack to go around buggy libtool/automake. This
	  works in tddft.org, let's see the others now.

2010-02-26 16:37  marques

	* [r6326] Libtools puts libxc.a in a different place...

2010-03-01 20:44  helbig

	* [r6327] replaced calls to scf with calls to eigensolver, fixed
	  laplacian calculation in 2 particle case

2010-03-01 20:48  dstrubbe

	* [r6328] *) Finite-difference em_resp calculations can now start
	  each SCF with either the zero-field density, or a LCAO
	  calculation, which should help convergence in some cases.
	  Previously the start density was the density of the previous
	  calculation.
	  *) Some improvements to formatting, comments
	  *) Restart dipole file is overwritten when starting from scratch,
	  so rather than appending, which made it inaccurate.
	  *) Naming of output files for diagonal components updated.

2010-03-02 00:21  dstrubbe

	* [r6329] Set svn:ignore for new files being created in libxc.

2010-03-02 00:26  dstrubbe

	* [r6330] *) Tweaks to warning messages
	  *) Restoring the lcao_done variable: it makes sure that there is
	  some initialization when LCAO was tried but not available. This
	  was causing the test failures.

2010-03-02 00:37  dstrubbe

	* [r6331] *) For more information to the user, finite differences
	  em_resp prints the (total) dipole moment for each step in the
	  output file, as well as saving it in the restart directory.
	  *) An improvement to formatting of the dipole moment

2010-03-02 00:40  dstrubbe

	* [r6332] Setting svn:ignore for directories generated if you
	  install into the trunk directory.

2010-03-02 07:33  dstrubbe

	* [r6333] Removed some variables now unused after my reorganization
	  of LCAO calls.

2010-03-02 15:55  marques

	* [r6334] This is an overkill hack in order for libxc to compile
	  with different versions of libtool. Let's see what I broke now...

2010-03-02 23:12  dstrubbe

	* [r6335] *) The zero-field dipole is now written in
	  restart/em_resp_fd/dipoles for convenience in checking results,
	  but is ignored on restart.
	  *) The mixing is restarted for each calculation in
	  finite-difference calculations, so we are not mixing with
	  densities from previous calculations, which may hinder
	  convergence.

2010-03-03 00:10  dstrubbe

	* [r6336] *) Improvements to formatting and comments
	  *) Changed variable 'EMStaticField' to 'EMStaticElectricField' to
	  be more explicit, and even put in the
	  'messages_obsolete_variable' this time...
	  *) Fixed a problem with unocc calculation that was causing test
	  failures after my reorganization of LCAO: wavefunctions should
	  not be initialized randomly in the unocc case because the right
	  ones are already present.

2010-03-03 01:13  dstrubbe

	* [r6337] *) Improvements to comments, formatting, output
	  *) Removed debugging output accidentally left in
	  *) Added MPI_Barrier to static_pol, as ground_state has
	  *) I'm pretty sure printing the recipe doesn't FFT's
	  *) Changed single-letter variables
	  *) Removed FIXME calling for vhxc not to be allocated for
	  independent_particles: vhxc is used in many subroutines without
	  checking whether independent_particles or not, so it must be
	  allocated regardless.
	  *) Updated to new styles for units in parsing variables
	  *) Added tests for first two stages of
	  finite_systems_2d/06-tdmagnetic, to reveal whether is gs or unocc
	  at fault rather than td.

2010-03-03 02:34  dstrubbe

	* [r6338] *) Previous commit forgot to mention two changes:
	  1) The variable StaticElectricField seemed to be applying the
	  field with an incorrect sign. Now it does it the same way as
	  EMStaticElectricField.
	  2) Some calls to total_energy in LCAO which seemed unnecessary
	  have been removed.
	  *) Improvements to formatting

2010-03-03 06:21  dstrubbe

	* [r6339] Fixed a mistake in test.

2010-03-03 18:04  helbig

	* [r6340] modified call to KS iteration to allow future use in td

2010-03-03 21:08  dstrubbe

	* [r6341] *) Improvements to formatting, comments, output,
	  documentation
	  *) Changed single-letter variables
	  *) Added and corrected push_sub's
	  *) Updated parsing calls with units

2010-03-04 01:25  dstrubbe

	* [r6342] *) Added missing dependencies
	  *) Removed unused parameter of rmmdiis_start to suppress a
	  compiler warning
	  *) Improved formatting

2010-03-05 21:42  dstrubbe

	* [r6343] The (y + z) field calculation can now be omitted in
	  finite difference calculations, which is often not needed due to
	  symmetry, and can be harder to converge since it is a larger
	  field magnitude than the others.

2010-03-06 03:38  dstrubbe

	* [r6344] *) Improved formatting and comments
	  *) Added push_sub's, and removed one that appeared an excessive
	  number of times in the debugging stack trace
	  *) Set svn:ignore properties for libxc files generated by libtool
	  2

2010-03-06 04:57  dstrubbe

	* [r6345] *) Improved formatting
	  *) Added push_sub's
	  *) Fixed intent's to suppress compiler warning
	  *) Removed push_sub from function called too frequently

2010-03-08 22:05  acastro

	* [r6346] o Removed the special handling of global.F90 in
	  src/basic/Makefile.am. Now the preprocessor macros that need to
	  be
	  passed to that file are included in config.h, and therefore
	  accessible
	  to all other files, too. The values of those macros are obtained
	  at
	  configure time, and for that I made an
	  "octopus_compilation_info.m4"
	  file that contains the autoconf macro that generates them (all of
	  them
	  except the SHARE_OCTOPUS one. Due to the uber-bizarreness of the
	  autotools this seems to be impossible).
	  
	  o Changed (and commented) the command_line_m module. Now, all
	  octopus
	  programs use the getopt library, even if in most cases it is for
	  the
	  moment not so useful (but at least we can do "oct-bla --version"
	  or
	  "oct-bla --help" with all utilities. I should add some content to
	  the
	  help option, in order for this to be useful, but that is boring).
	  
	  [Note that access to command line arguments is not standard in
	  Fortran
	  95 (even though most compilers have it by now), and therefore in
	  some
	  systems, these features will not be present at all. Also, "long
	  options" (--version instead of -v) is not standard C, and
	  therefore in
	  some cases one cannot use them.]
	  
	  Now, the "oct-help" program is invoked as "oct-help --search
	  bla", or
	  "oct-help -s bla", and not "oct-help search bla" as before.

2010-03-08 22:28  dstrubbe

	* [r6347] *) Improved formatting
	  *) Added push_sub's
	  *) Changed single-letter variable
	  *) Set svn:ignore on another automatically generated file in
	  libxc

2010-03-09 03:12  dstrubbe

	* [r6348] Some trivial capitalization and hyphenation.

2010-03-09 21:38  dstrubbe

	* [r6349] *) Finite-difference em_resp calculations can now restart
	  from stored densities, rather than just stored dipoles.
	  *) Improvements to formatting.

2010-03-11 16:00  fulvio

	* [r6350] I modified the k-points grid generation scheme: now the
	  (full) k-p. grid is
	  the same generated by Abinit.

2010-03-11 20:01  dstrubbe

	* [r6351] *) Added option for verbose SCF output from
	  finite-difference calculation.
	  *) Corrected condition for redoing all dipoles given requested
	  output.
	  *) Added missing deallocation.

2010-03-12 13:20  fulvio

	* [r6352] I forgot to erase a useless print

2010-03-16 15:56  nitsche

	* [r6353] Rewrote much of the transport code to simplify the
	  modularization (as the next step).
	  Due to some algorithmic changes most of the complicated restart
	  procedure is not neccessary anymore and is replaced by standard
	  routines.
	  
	  * removed the symmetric version of the interface matrix vector
	  multiplication
	  * the central region is no more enlarged
	  * the Lippmann-Schwinger calculation now shows a progress bar
	  * now a magnetic groundstate is also supported
	  * removed some push/pop in the left hand side Lippmann-Schwinger
	  subroutine as these are called many times during a magnetic gs
	  calculation
	  * The projected part of the lead wave function is now written to
	  a file and then read by the td run.
	  * the self energy is now directly calculated and stored instead
	  of the surface Green's function
	  * improved debugging output for the surface Green's function
	  * Most of the reading part for the extended central region is now
	  obsolete.
	  * The subroutine restart_read now correctly reads the weights of
	  the kpoints.
	  * The INNER/OUTER logic of the interface wave function now is
	  obsolete.
	  * The progress of the convergence of the Crank-Nicholson solver
	  is shown in the debug mode.
	  * The zeroth source term now uses the lead wave function
	  calculated via the self energy.
	  * removed an apostroph which caused a compiler warning
	  * The transport td run does not need a special open boundary gs
	  calculation anymore, a normal gs would also be sufficient
	  (although not recommended for the transport mode).
	  * one test of the open boundary testsuite failed because energy
	  was the matching criteria. Since the central region is not
	  artificially enlarged anymore the resulting energy for this
	  region is also different.
	  * adjusted some tests as the values coming from the new algorithm
	  slightly changed

2010-03-16 17:27  nitsche

	* [r6354] * only the mpi root can create a directory (I hope this
	  fixes the mpi problem)

2010-03-16 18:25  nitsche

	* [r6355] * removed the mpi test until i can check the problem

2010-03-17 15:13  nitsche

	* [r6356] * fixed the problem with MPI (sliced array)
	  * enabled the MPI tests

2010-03-19 01:11  xavier

	* [r6357] * Replaced st%wfs_type == ... by calls to states_are_real
	  and
	  states_are_complex.

2010-03-20 15:14  xavier

	* [r6358] Now wfs_type is a private component of states_t (since
	  Fortran cannot
	  have private and public components at the same time I created a
	  states_priv_t type that goes inside states_t).

2010-03-20 19:12  xavier

	* [r6359] * Now libxc installs the Fortran modules.
	  * Added a macro to detect the module extension.

2010-03-21 00:37  xavier

	* [r6360] Now octopus does not compile libxc, it attemps to find an
	  installed
	  version (the location can be specified using the
	  --with-libxc-prefix
	  argument).
	  
	  I kept the libxc directory until it is moved to its own
	  repository.

2010-03-21 01:43  xavier

	* [r6361] Fixed a problem in the libxc marco.

2010-03-21 11:06  xavier

	* [r6362] Now libxc can deal with compilers that use uppercase
	  filenames for
	  modules.

2010-03-21 13:25  xavier

	* [r6363] Now the libxc macro uses the correct module inclusion
	  flag for the
	  compiler.

2010-03-21 19:20  xavier

	* [r6364] Now octopus checks that the mesh hasn't changed before
	  restarting.

2010-03-21 23:31  xavier

	* [r6365] Removed the option of writing netcdf restart files. This
	  functionality is not used much (AFAIK) and is not being tested.

2010-03-22 10:59  mjv500

	* [r6366] corrected push pop subs identified with a script. Should
	  be made systematic

2010-03-22 15:27  walkenho

	* [r6367] Fixed the initialization of the wavevector step dw

2010-03-22 15:36  acastro

	* [r6368] Eliminated the variable VibrationalSpectrumType, in
	  favour of a
	  command line option.

2010-03-22 15:49  walkenho

	* [r6369] Completed the unit conversion, now vibrational works
	  properly in both unit systems (vibrational reads the coordinates
	  file, but until now was not taking into account, that the
	  coordinates file can be either in au or in eV_A)

2010-03-22 16:12  walkenho

	* [r6370] Fixed the last unit conversions (atomic to output) and
	  added some & in linebreaks

2010-03-22 16:18  walkenho

	* [r6371] Added headers for the files vibrational_spectrum and
	  velocity_autocorrelation

2010-03-22 16:46  xavier

	* [r6372] Fixed some autotools warnings in libxc.

2010-03-23 00:52  xavier

	* [r6373] * Now octopus can restart calculations from a different
	  mesh, only the
	  integral coordinates are considered so no interpolation is done
	  if the
	  spacing changes.
	  
	  * I had to change the format of lxyz.fingerprint file, so the
	  restart
	  will fail in some cases (from calculations done with the
	  development
	  version in the last month). I will try to solve this issue, but
	  for
	  the moment you can just simply delete the
	  restart/*/lxyz.fingerprint
	  file.

2010-03-23 12:01  xavier

	* [r6374] * Now restart directories previous to my last changes can
	  be read
	  without problems.
	  
	  * Added some safety checks.

2010-03-23 14:10  xavier

	* [r6375] Changed the checksum routine used for the grid. Now if
	  the ordering of
	  the points changes, the checksum will change.

2010-03-23 14:18  joseba

	* [r6376] Adding documentation comments

2010-03-23 16:34  xavier

	* [r6377] * A workaround for the PGI bug.

2010-03-23 17:36  xavier

	* [r6378] A hack to fix the dependencies in libxc.

2010-03-23 18:14  xavier

	* [r6379] My "fix" for libxc makes things worse. Someone knows how
	  to fix this?

2010-03-23 18:34  xavier

	* [r6380] Another attempt to get dependencies right.

2010-03-23 18:34  xavier

	* [r6381] This should fix parallel runs.

2010-03-24 00:47  xavier

	* [r6382] * Fixed some compiler warnings.
	  * Some functions in ob_lippmann_schwinger.F90 received the same
	  variable as input and output.

2010-03-24 08:27  marques

	* [r6383] I believe this is the correct way of handling the
	  dependencies. Sorry, I
	  had this lingering around already for a couple of weeks, but I
	  forgot to
	  commit it.

2010-03-24 12:21  xavier

	* [r6384] Continuation lines cannot be used in forall loops.

2010-03-24 19:52  dstrubbe

	* [r6385] Let's take the advice produced by "make install" on
	  libxc, and put the required linker flag in that lets the shared
	  object be found by the octopus executable.

2010-03-24 20:57  dstrubbe

	* [r6386] Evidently sunf90 needs --rpath not -rpath, so we check
	  both.

2010-03-24 22:18  dstrubbe

	* [r6387] sunf90 doesn't like even the --rpath it recommends, so if
	  -rpath doesn't work, we remove those linker flags entirely.

2010-03-25 02:58  dstrubbe

	* [r6388] There are many variations in the linker flags recommended
	  by "make install" in libxc, so it is better not to hard-code
	  something as I did. There must be a way to query libxc and find
	  out the appropriate linker flag, but I don't know what it is, so
	  my changes to libxc.m4 have been reverted.

2010-03-25 08:15  appel

	* [r6389] Adding KS inversion as a new family of functionals
	  in a spirit similar to OEP. There is now a new module
	  xc_ks_inversion_m that contains most of the inversion
	  code. I have adapted the 'old' runmode invert_ks to
	  use this new infrastructure.
	  
	  To deal with dependencies I had to move the eigensolver
	  module from scf to system (as suggested by Miguel). This
	  is analogous to the linear solver in the case of OEP.
	  
	  Not all things are in place yet to use the functional
	  family in the general case, however the old runmode
	  should work as before.

2010-03-25 10:48  xavier

	* [r6390] Moved the definition of XC_FAMILY_KS_INVERSION to
	  octopus. Since libxc
	  is an independent library we should keep it separated from
	  octopus
	  specific variables. Anyway we should find a better way to deal
	  with
	  this situation.

2010-03-25 10:53  xavier

	* [r6391] The mesh_r function should not have push_sub/pop_sub.

2010-03-25 11:57  xavier

	* [r6392] This should fix the problem with oct-test.

2010-03-25 19:03  dstrubbe

	* [r6393] Wherever we have determined there shouldn't be a
	  push_sub, a comment should note that it wasn't just an oversight
	  not to put one there.

2010-03-25 19:23  appel

	* [r6394] Adding the missing conditional for xc_ks_inversion_end
	  (xc_ks_inversion_init had one already).

2010-03-26 00:02  xavier

	* [r6395] Now restart_read has an optional argument, exact, that
	  forces it to fail in
	  case the functions are partially read or from a different mesh.

2010-03-26 08:51  mjv500

	* [r6396] sub name added to pop_sub everywhere. Tests pass on my
	  machine except finite_systems_3d/15-hartree which gives an
	  unallocated free.

2010-03-26 12:10  xavier

	* [r6397] In the hypercube case, the code to restart from a
	  different mesh
	  cannot be used (for the moment).

2010-03-26 18:36  xavier

	* [r6398] * Implemented an alternative orthogonalization based on a
	  QR
	  decomposition perfomed directly by Lapack. This is slower than
	  Gram-Schmidt, but at least does not require a temporary array of
	  size
	  nst^2. Unfortunately the routine only works in serial for the
	  moment
	  and will require scalapack or something equivalent to parallelize
	  it.
	  
	  * The orthogonalization method is now selected by the variable
	  StatesOrthogonalization, gram_schmidt is the default.

2010-03-26 20:22  xavier

	* [r6399] Renamed states_gram_schmidt* to states_orthogonalizaton*.

2010-03-26 23:00  xavier

	* [r6400] Added a modified Gram Schmidt ortogonalizer, is slower
	  but does not
	  require additional memory and work with domain parallelization.

2010-03-26 23:49  dstrubbe

	* [r6401] Some cleaning of single-letter variables, formatting,
	  etc. in messages.

2010-03-28 15:48  xavier

	* [r6402] Removed the Visscher propagator. I implemented this
	  sometime ago, but
	  it is not really useful.

2010-03-28 17:30  xavier

	* [r6403] Renamed 'td_rti' to 'propagator'.

2010-03-28 18:01  xavier

	* [r6404] Removed the split and Suzuki exponentials/propagators.
	  They stopped
	  working a long time ago, so I guess nobody is interested in them
	  (except users in the mailing list).

2010-03-28 18:13  xavier

	* [r6405] Renamed ob_rti to ob_propagator.

2010-03-29 11:51  marques

	* [r6406] A couple of push/pops were called recursively in debug
	  mode which lead
	  to disaster!

2010-03-29 19:59  dstrubbe

	* [r6407] A common problem with GDlib, according to various
	  websites, is that its installation leads to a spurious
	  @LIBINCONV@ in the output of gdlib-config --lib, causing a
	  failure at the linking stage. Since this link line is used to
	  replace GD_LIBS, it is not substituted again by m4, and the
	  @LIBICONV@ remains in the Makefile. Therefore I have explicitly
	  removed it in the m4 macro if it occurs.

2010-03-29 23:40  acastro

	* [r6408] Corrected a little misbehaviour of the help utility.

2010-03-30 10:13  xavier

	* [r6409] Renamed the constants associated with the exponential
	  operators.

2010-03-30 10:53  xavier

	* [r6410] Renamed em_field_m to hamiltonian_base. The idea is to
	  move here the
	  routine that calculates the hamiltonian.

2010-03-30 11:55  xavier

	* [r6411] * Now the hamiltonian only contains a hm_base object
	  instead of one per
	  spin channel.
	  
	  * This should fix compilation problems.

2010-03-30 14:24  xavier

	* [r6412] More changes to the hamiltonian.

2010-03-30 16:47  xavier

	* [r6413] More updates to the hamiltonian.

2010-03-30 19:43  xavier

	* [r6414] Removed all this functions that return parts of the
	  Hamiltonian,
	  instead hamiltonian_apply now can receive flags indicating which
	  terms
	  should be calculated.

2010-03-30 21:22  nitsche

	* [r6415] * a pop_sub was not correctly called in serial mode

2010-03-30 23:09  dstrubbe

	* [r6416] *) Put in a few push_sub's.
	  *) Formatting.
	  *) Alphabetized modules.

2010-03-31 00:18  xavier

	* [r6417] * Moved more code to hamiltonian_base_m.

2010-03-31 00:27  nitsche

	* [r6418] * fixed the sternheimer calculation for the compiler
	  optimization flag -O3
	  (again this was some issue with copying an array --> it is better
	  to use forall for large arrays)

2010-03-31 01:10  appel

	* [r6419] Adding calls to invert*_iter, removing _inc.F90 file
	  and updating a case where the old density was used
	  for file output.

2010-03-31 08:07  marques

	* [r6420] Bug fix: if there were x eigenvalues converged in an
	  unoccupied run, then the next step would start from eigenvalue
	  X+1. This was a problem when the eigenvalues that were converged
	  were not contiguous. I only fixed it for the _cg eigensolver.
	  maybe this bug exists in other eigensolvers.

2010-03-31 11:52  xavier

	* [r6421] A variable name was too long.

2010-04-01 02:30  dstrubbe

	* [r6422] gdlib-config, as used in the configure script to figure
	  out how to link it, is not very robust. Therefore we now allow
	  overriding its output for GD_CFLAGS and GD_LIBS, and also check
	  that what was provided actually can be linked successfully.

2010-04-01 11:32  xavier

	* [r6423] * Our preprocessor now prints a comment where a forall
	  has been processed.
	  
	  * Since the forall preprocessor follows the order of declaration
	  when
	  generating the do loops, the longest loop must be last one.

2010-04-01 12:57  xavier

	* [r6424] Renamed external_pot_m to epot_m, to match the file and
	  function names.

2010-04-01 16:08  xavier

	* [r6425] Added a test for static magnetic fields.

2010-04-01 17:48  xavier

	* [r6426] * Moved the static magnetic field to a short run test for
	  a while, to
	  check that it runs properly in all buildbots.

2010-04-01 19:01  xavier

	* [r6427] * Moved the application of the magnetic fields to
	  hamiltonian_base.
	  
	  * I didn't reimplement the CDFT terms since they are not used and
	  I
	  cannot test them.

2010-04-01 19:42  xavier

	* [r6428] Some fixes to my previous commit.

2010-04-02 00:35  xavier

	* [r6429] Bugfix: The vector potential term in the Hamiltonian had
	  the wrong
	  sign (Can someone verify it?).
	  
	  The results of the tests didn't change. I think this is because
	  for
	  the gs this only changes the phase of the orbitals.

2010-04-02 01:17  xavier

	* [r6430] Moved the generation of the pseudo-potential phases to
	  hamiltonian_update_potential.

2010-04-02 10:27  xavier

	* [r6431] * Fixes more bugs in the magnetic terms of
	  hamiltonian_base_m.

2010-04-02 11:44  xavier

	* [r6432] The vector potential for a static magnetic field was
	  defined with a
	  minus sign. This is why the terms I corrected yesterday had the
	  wrong
	  sign.

2010-04-02 16:11  xavier

	* [r6433] Moved the initialization of the gauge field to td_run. In
	  this way it
	  will be ignored by other run modes.

2010-04-02 17:24  xavier

	* [r6434] Rearranged initialization of the gauge field.

2010-04-02 20:17  xavier

	* [r6435] More updates to hamiltonian_base.

2010-04-02 22:09  xavier

	* [r6436] Now the gauge field is applied by
	  hamiltonian_base_magnetic.

2010-04-03 09:39  xavier

	* [r6437] This should fix the failing tests.

2010-04-03 10:49  xavier

	* [r6438] Vector potentials (uniform and non-uniform) are added in
	  case both are present.

2010-04-03 16:14  xavier

	* [r6439] Added a test for diamond with the MGGA TB09 functional.

2010-04-03 18:49  xavier

	* [r6440] Parallelization in K points is now enabled by default for
	  the ground
	  state calculations. This should fix the test that failed.

2010-04-03 23:00  xavier

	* [r6441] * It seems that enabling K point parallelization causes
	  some tests to
	  fail, I haven't been able to reproduce the problem, so I will
	  revert
	  the change for the moment.
	  
	  * Enabled K point parallelization for the specific tests.

2010-04-04 09:59  xavier

	* [r6442] Moved a few tests to the long testsuite. This reduces
	  almost by a half
	  the time to run `make check`.

2010-04-04 19:00  xavier

	* [r6443] Removed push_sub/pop_sub from some frequently used
	  functions.

2010-04-04 19:41  xavier

	* [r6444] Now hamiltonian_update_potential takes a time argument.

2010-04-04 22:11  xavier

	* [r6445] Changed the way that the ionic time scale is handled.

2010-04-04 23:29  xavier

	* [r6446] * Added the time to some calls to
	  hamiltonian_update_potential.
	  
	  * The file propagator_qoct_inc.F90 didn't appear as a dependency
	  to
	  propagator.F90.

2010-04-05 00:46  xavier

	* [r6447] Added the time to hamiltonian_update_potential in the
	  Crank-Nicholson
	  propagator. It seems the time was wrong for the Hamiltonian calls
	  in
	  this solver, so I fixed. But it would be nice if someone
	  (Alberto,
	  Danilo?) could check it.

2010-04-05 12:59  xavier

	* [r6448] Changed the interface for the basic functions of the
	  laser fields.

2010-04-05 14:39  xavier

	* [r6449] The potential for the laser is applied through
	  hamiltonian_base.

2010-04-05 16:42  xavier

	* [r6450] Cleaned and reorganized hamiltonian_update_potential.

2010-04-05 19:04  xavier

	* [r6451] Now all lasers are applied from hamiltonian_base.

2010-04-06 03:33  dstrubbe

	* [r6452] Another improvement to the GDlib macro: it seems
	  --ldflags does not include the one needed for GDlib itself, so we
	  need --libdir to give the location of libgd.a or libgd.so.

2010-04-06 09:17  xavier

	* [r6453] Now the testsuite can run in parallel. The number of
	  processes is
	  given by the OCT_TEST_NPROCS variable (1 by default).
	  Parallelization
	  is far from perfect (retirement is done in order), so you need to
	  put more processes than processors. With 16 processes I got an
	  almost
	  linear reduction in time in a quad core machine.

2010-04-06 11:06  xavier

	* [r6454] The report of the testsuite was not correct in parallel.

2010-04-06 16:37  xavier

	* [r6455] Oct-run_testsuite now traps signals to kill child
	  processes before dying.

2010-04-06 17:16  xavier

	* [r6456] Bugfix: The gradient was calculated even if not needed.

2010-04-06 18:43  xavier

	* [r6457] Added a workaround for some ifort versions in the double
	  grid code.

2010-04-06 23:37  dstrubbe

	* [r6458] The GDlib test now uses something that Octopus actually
	  uses.

2010-04-07 08:36  xavier

	* [r6459] This should fix the problem with openmp and double grid
	  that caused
	  one test to fail.

2010-04-07 12:03  nitsche

	* [r6460] * fixed a push_sub name

2010-04-07 18:10  helbig

	* [r6461] modified inversion, interchanged order of calculating
	  Hartree and xc potentials

2010-04-07 20:45  xavier

	* [r6462] Added a test for modelmb.

2010-04-07 22:34  nitsche

	* [r6463] * rewriting lots of the transport stuff (one step more
	  towards modularization)

2010-04-07 22:51  nitsche

	* [r6464] * forgot to commit 1 file

2010-04-08 10:00  xavier

	* [r6465] Please do not put push/pop_sub calls in functions that
	  are called by
	  several threads.

2010-04-08 12:51  xavier

	* [r6466] Workarounds for a bug in ifort 11.1.069.

2010-04-08 21:01  xavier

	* [r6467] Removed 's from comments.

2010-04-08 22:33  xavier

	* [r6468] Some rearrangement of the double grid code.

2010-04-08 22:45  xavier

	* [r6469] * A profiling_out call was missing.
	  * I forgot to declare a profile_t variable as save.

2010-04-08 23:08  xavier

	* [r6470] Renamed nl_operator_t::m to nl_operator_t::mesh .

2010-04-08 23:25  nitsche

	* [r6471] * removed the lead mesh from the mesh, now it uses the
	  one of the ob_grid

2010-04-08 23:33  xavier

	* [r6472] For curvilinear coordinates, now the number of neighbours
	  in the
	  non-local operator can change.

2010-04-09 01:22  dstrubbe

	* [r6473] As requested by Matthieu, I have added a test to the
	  configure script that checks whether the zdotc routine of BLAS
	  works correctly. A preprocessor variable ZDOTC_BAD is set if
	  there is a problem. Nothing is actually done in the code yet: I
	  am not quite sure what I should do to replace the BLAS routine,
	  given all the complicated layers of interfaces over this
	  function.
	  
	  Currently the actual result of the test is written; this is
	  temporary, to see what variation occurs between machines and
	  libraries of the number, so the threshold can be set
	  appropriately. Matthieu, please confirm that the test fails with
	  your problematic libraries.

2010-04-09 08:40  xavier

	* [r6474] A small change in the generation of the non-local
	  operator, required
	  for variable stencil sizes.

2010-04-09 09:32  helbig

	* [r6475] fixed bug in 1D Poisson solver, modified initial settings
	  for iterative KS inversion

2010-04-09 10:32  xavier

	* [r6476] The calculation of the gauge-field force was not correct
	  for K point
	  parallelization.

2010-04-09 10:48  xavier

	* [r6477] A line was too long.

2010-04-09 10:51  xavier

	* [r6478] Reverts unintended changes to other file in my last
	  commit.

2010-04-09 11:29  xavier

	* [r6479] Configuration now fails if zdotc does not work.

2010-04-09 14:10  xavier

	* [r6480] Added some profiling regions.

2010-04-09 17:21  xavier

	* [r6481] Fixed a possible bug in the generation of the non-local
	  operator.

2010-04-09 23:48  dstrubbe

	* [r6482] All buildslaves and other systems I checked gave results
	  from the zdotc test of 1e-6 or less, so that is now the threshold
	  for failure of the test. The numerical result is no longer
	  printed.

2010-04-10 00:08  dstrubbe

	* [r6483] *) Some improvements to formatting
	  *) Changed single-letter variable
	  *) Added push_sub

2010-04-10 00:14  dstrubbe

	* [r6484] *) Improvements to formatting
	  *) Fixed typo

2010-04-10 01:13  dstrubbe

	* [r6485] A line was too long.

2010-04-10 09:03  xavier

	* [r6486] * Projector_commute_r now considers the spinor index of
	  the input
	  vector.
	  
	  * The magnetic and kdotp perturbations should work with spinors.

2010-04-10 09:28  xavier

	* [r6487] * Added a profiling region to the calculation of [r,
	  V_nl].
	  
	  * Increased the magnitude of the gauge field in the test.

2010-04-10 09:54  xavier

	* [r6488] A line was too long.

2010-04-10 14:59  xavier

	* [r6489] * Now a uniform vector potential is applied as a phase to
	  the orbitals
	  (just like kpoints). This avoids the calculation of the gradients
	  in
	  the application of the hamiltonian.
	  
	  * Test results changed a bit.

2010-04-10 16:42  xavier

	* [r6490] Added a test for time-dependent angular momentum.

2010-04-10 22:08  xavier

	* [r6491] Now projector_commute_r sums the result to the output
	  vector.

2010-04-12 08:10  xavier

	* [r6492] Disabled the calculation of the expectation value of L^2.
	  This value
	  is not used and lacks gauge corrections.

2010-04-12 08:20  xavier

	* [r6493] The oct-rotatory_strength utility was broken since
	  [6290]. This shows
	  that we must test the utilities somehow.

2010-04-12 08:42  xavier

	* [r6494] A small optimization in the calculation of the kdotp
	  perturbation.

2010-04-12 17:54  xavier

	* [r6495] Removed the calculation of the degeneracy matrix, as it
	  requires
	  insane amounts of memory when there are thousands of K points.

2010-04-12 20:31  xavier

	* [r6496] Removed the cuda fft interface.

2010-04-12 20:54  xavier

	* [r6497] Since fftw3 is the only fft library we use, the code can
	  be simplified
	  a bit.

2010-04-12 21:58  xavier

	* [r6498] Fixes an error in my previous commit.

2010-04-13 00:31  xavier

	* [r6499] Basic OpenCL support. This commit only implements the
	  configure part
	  and basic initialization routines. The objective is to integrate
	  the
	  work of Nestor Suberviola who is developing an opencl version of
	  the
	  non-local operator for Octopus as his degree project.

2010-04-13 01:34  dstrubbe

	* [r6500] *) For perturbation, apply phases due to gauge as well
	  *) Removed variable no longer used
	  *) A bit of improvement to formatting
	  *) Added a push_sub

2010-04-13 14:18  nitsche

	* [r6501] * changed the Eigensolver in the transport testsuite to
	  plan, which is much more stable for larger number of kpoints

2010-04-13 14:25  nitsche

	* [r6502] * now the iteration step is also printed after each scf
	  step, as for a large number of kpoints this was not visible any
	  more

2010-04-13 15:30  mjv500

	* [r6503] error in indexing for hypercube

2010-04-13 22:06  nitsche

	* [r6504] * the td tests of open boundaries were not called
	  (somehow a small case yes at 'Enabled' leads to strange behavior
	  stating a succesfull test even though it is not executed at all)
	  * fixed a bug in allocating the interface wavefunction

2010-04-14 00:16  dstrubbe

	* [r6505] Fixed the problem Danilo noted about disabling tests.

2010-04-14 21:17  xavier

	* [r6506] * Updated the initialization to follow the interface
	  change in OpenCL.
	  * Other improvements of opencl initialization.

2010-04-14 22:20  xavier

	* [r6507] The interface for opencl_init and opencl_end was wrong.

2010-04-15 03:01  dstrubbe

	* [r6508] Now phases are not created for Gamma-only periodic
	  calculations (unless there is a gauge field), saving some time in
	  this case.

2010-04-15 07:29  xavier

	* [r6509] Added the opencl code to compile the kernel for the
	  non-local operator
	  (the actual OpenCL code is still not included).

2010-04-15 08:06  xavier

	* [r6510] The extension of a file was wrong in my last commit.

2010-04-15 17:24  xavier

	* [r6511] The time in the BOMD calculation was not consistent, the
	  orbitals were
	  calculated with a retardation of dt.

2010-04-16 10:59  xavier

	* [r6512] Added a directory for the opencl source files (for the
	  moment the
	  source file is empty). In OpenCL the kernels (functions that are
	  executed by the co-processor) come in source form and are
	  compiled at
	  run time, so we must distribute the opencl source code as data
	  files.

2010-04-16 14:12  xavier

	* [r6513] The complex version of the symmetrizer was wrong.

2010-04-16 21:48  xavier

	* [r6514] Added a test for Born-Oppenheimer molecular dynamics.

2010-04-16 22:17  xavier

	* [r6515] * Disabled the preconditioner for periodic systems, for
	  some reason it
	  doesn't work and prevents full convergence.
	  
	  * Running the symmetrization with domain parallelization results
	  in
	  fatal error.

2010-04-17 16:26  xavier

	* [r6516] Added a function that returns a random number with flat
	  probability..

2010-04-18 13:03  xavier

	* [r6517] Defined the INCR(x,y) macro, that does x = x + y.

2010-04-18 15:20  xavier

	* [r6518] Some checks for parallelization in domains were missing.
	  I suspect this
	  causes the fail of the hybrid test.

2010-04-18 18:25  xavier

	* [r6519] Added an experimental grid partitioner based on a genetic
	  algorithm
	  optimization. It still needs some work to be competitive,
	  specially on
	  speed.

2010-04-18 22:40  xavier

	* [r6520] Fixes compilation problems in my last commit.

2010-04-18 23:31  xavier

	* [r6521] A line was too long.

2010-04-21 10:22  nitsche

	* [r6522] * the laser field was not initialized during the
	  calculation of forces

2010-04-21 18:00  nitsche

	* [r6523] * Hartree does not use exchange
	  * cosmetics

2010-04-21 18:17  xavier

	* [r6524] * Hartree does use exchange.

2010-04-22 08:29  xavier

	* [r6525] Added a test for the Hartree theory level.

2010-04-22 10:10  sakko

	* [r6526] Added the possibility to calculate energy loss spectra
	  (dynamic structure factor) with Casida method.

2010-04-22 13:31  kkrieger

	* [r6527] * added new optimal control target: ionic velocity
	  optimization
	  * works up to now only for the "direct optimization"
	  * includes 2 new variables for the inp file:
	  "OCTVelocityTarget" and "OCTMoveIons"

2010-04-22 13:57  nitsche

	* [r6528] * fixed: changed function from integer to logical

2010-04-23 16:30  kkrieger

	* [r6529] added some faulty checks for oct velocity optimization

2010-04-23 17:19  kkrieger

	* [r6530] oct - added one optional parameter to j1_functional(),
	  necessary
	  for newuoa optimaztion

2010-04-23 18:44  dstrubbe

	* [r6531] *) Some formatting
	  *) Changed single-letter variables
	  *) Added and corrected push_sub's
	  *) Alphabetized modules
	  *) Set svn:ignore property on new directory

2010-04-23 20:30  xavier

	* [r6532] * Removed the column of the Coordinates block that
	  species if the atoms
	  should be moved or not. This is not necessary and can cause
	  confusion
	  to users.
	  
	  * Removed the DebugLevel variable from test input files.

2010-04-24 02:22  dstrubbe

	* [r6533] It is distracting to get a fatal error from every node
	  about a feature being in the development version or not
	  implemented, since these are true for one node, they are true for
	  every node. Now only root will write the error message.

2010-04-24 23:09  xavier

	* [r6534] Now the opencl_t object contains the path to the opencl
	  source files.

2010-04-25 09:15  xavier

	* [r6535] * Reorganization of the opencl interface.
	  * Added functions to create and destroy opencl kernels.

2010-04-25 09:26  xavier

	* [r6536] Forgot one file.

2010-04-25 10:09  xavier

	* [r6537] * Now make check copies the opencl source files.
	  * A small change in opencl interface.

2010-04-25 14:27  xavier

	* [r6538] More updates on the OpenCL interface.

2010-04-25 15:31  xavier

	* [r6539] * Added a module with constants to identify types.
	  
	  * A file was missing in my last commit.

2010-04-25 16:51  xavier

	* [r6540] Replaced M_REAL/M_CMPLX by TYPE_FLOAT/TYPE_CMPLX.

2010-04-25 20:11  xavier

	* [r6541] Added a function that copies a batch into opencl buffers.

2010-04-25 22:23  xavier

	* [r6542] Added functions to read from an opencl buffer.

2010-04-26 08:19  xavier

	* [r6543] A new change in the opencl interface: the opencl
	  enviromnent is now a
	  global property.

2010-04-26 09:14  xavier

	* [r6544] Moved opencl files to src/basic/.

2010-04-26 09:23  xavier

	* [r6545] A types_m module already existed for internal use of
	  c_pointer_m. This
	  probably causes the compilation problems with pgi.

2010-04-26 09:49  xavier

	* [r6546] This should fix the problem with distcheck.

2010-04-26 09:52  xavier

	* [r6547] * Removed the recl parameter when reading the coordinates
	  files. This
	  should fix the problem with the g95 tests.

2010-04-26 13:49  xavier

	* [r6548] * Implemented an interface to clFinish.
	  * Moved periodic_table.F90 from src/basic/ to src/species/.

2010-04-26 21:48  xavier

	* [r6549] * Added calls to set kernel arguments and execute
	  kernels.
	  * OpenCL is used to apply the local potential.

2010-04-26 23:42  xavier

	* [r6550] * Now padding for OpenCL buffers works correctly.
	  
	  * OpenCL objects are deallocated.

2010-04-27 09:45  xavier

	* [r6551] Added profiling regions for opencl calls.

2010-04-27 13:06  sakko

	* [r6552] Directional averaging of q-vectors in the calculation of
	  dynamic structure factor.

2010-04-27 20:19  xavier

	* [r6553] Some cleaning of the OpenCL code.

2010-04-27 22:23  xavier

	* [r6554] More changes in the opencl interface: kernels and
	  programs are built
	  by different functions.

2010-04-28 11:52  xavier

	* [r6555] Now the application of the non-local potential is done
	  using
	  matrix-matrix multiplication. For the moment this is only or KB
	  projectors.

2010-04-28 15:34  walkenho

	* [r6556] Changed the method to calculate the velocity
	  autocorrelation function

2010-04-28 16:13  xavier

	* [r6557] Fixes a small error in my last commit.

2010-04-28 16:36  xavier

	* [r6558] Removed a one line forall with continuation lines.

2010-04-28 17:39  walkenho

	* [r6559] deleted an unnessesary variable

2010-04-28 17:43  walkenho

	* [r6560] deleted a comment-sign that was too much in my last
	  commit and edited some comments

2010-04-28 18:24  walkenho

	* [r6561] the norm needed to calculate the vaf is now calculated
	  outside the timeloop

2010-04-28 19:39  nitsche

	* [r6562] * a line was too long

2010-04-28 22:31  xavier

	* [r6563] Some optimization and profiling of the new projector
	  code.

2010-04-29 00:20  dstrubbe

	* [r6564] *) A few cases for only root writes added.
	  *) Added and corrected push_sub's.
	  *) Improvements to formatting and output.

2010-04-29 07:54  xavier

	* [r6565] The new projector code did not consider the case when
	  there are zero
	  points.

2010-04-29 20:01  xavier

	* [r6566] Implemented the OpenCL application of the potential for
	  spin polarized
	  and spinor calculations.

2010-04-29 22:33  xavier

	* [r6567] Added OpenCL interfaces to get workgroup sizes.

2010-04-30 11:47  xavier

	* [r6568] The OpenCL vpsi kernels now use a different array for
	  output.

2010-05-01 00:36  xavier

	* [r6569] Now batches are aware of OpenCL, they can be moved to
	  device memory
	  and back.

2010-05-01 08:54  xavier

	* [r6570] Some compilers don't like #ifdefs inside continuation
	  lines.

2010-05-01 10:50  xavier

	* [r6571] * Added a function to set a whole batch to zero, this is
	  done by
	  opencl in case the batch is in device memory.

2010-05-01 16:32  xavier

	* [r6572] Boundary conditions for finite systems can be set using
	  opencl.

2010-05-02 00:01  xavier

	* [r6573] A small fix to batch_set_zero.

2010-05-02 00:46  xavier

	* [r6574] Bugfix: Initialization of a batch in the Hamiltonian was
	  not correct.
	  This bug caused memory corruption and developers to stay up late
	  at
	  night trying to find it.

2010-05-02 00:49  xavier

	* [r6575] Initial version of the non-local operator in OpenCL.

2010-05-02 01:14  xavier

	* [r6576] Now the data required for the non-local operator is kept
	  in device
	  memory.

2010-05-02 10:22  xavier

	* [r6577] * Now hamiltonian_apply moves the states to an opencl
	  buffer for the
	  application of the laplacian and the local potential.

2010-05-02 12:25  xavier

	* [r6578] Added a batch_axpy function.

2010-05-02 18:41  xavier

	* [r6579] Now opencl can be disabled.

2010-05-02 19:30  xavier

	* [r6580] * OpenCL was disabled by default.
	  * A build dependency was missing.
	  * Added OpenCL to the configuration information.

2010-05-03 09:26  xavier

	* [r6581] Now batch_axpy can be done in opencl.

2010-05-03 16:47  xavier

	* [r6582] Added a derivatives test to oct-test.

2010-05-03 17:25  xavier

	* [r6583] Too long line.

2010-05-03 18:22  xavier

	* [r6584] Created a new directory for tests that run oct-test.

2010-05-03 22:33  xavier

	* [r6585] A small optimization of the opencl operate kernel.

2010-05-04 04:06  xavier

	* [r6586] Added an interface to set a local memory array as kernel
	  argument.

2010-05-04 09:36  xavier

	* [r6587] Updated the reference values for the LOBPCG test.

2010-05-04 10:10  xavier

	* [r6588] * Now the -v option of oct-run_regression_test.pl prints
	  the results
	  instead of the command to get them.
	  
	  * Improved the format of the output.

2010-05-04 14:28  xavier

	* [r6589] Added a test for derivatives in 1d.

2010-05-04 15:29  xavier

	* [r6590] Decreased the required precision for the derivatives
	  test.

2010-05-04 15:35  xavier

	* [r6591] Precision should be increased, not decreased ;-) Sorry.

2010-05-04 16:02  nitsche

	* [r6592] * the lattice was not updated after the simulation box
	  was enlarged (within transport mode)

2010-05-04 18:08  xavier

	* [r6593] This precision should be large enough for all test bots
	  to pass.

2010-05-04 18:09  xavier

	* [r6594] Putting the array of weights in constant memory improves
	  quite a bit
	  the performance of the OpenCL non local operator.

2010-05-04 20:41  xavier

	* [r6595] The array of addresses is copied into local memory.

2010-05-04 23:54  xavier

	* [r6596] Opencl gathering and scattering of the points needed for
	  the
	  projectors.

2010-05-05 00:11  xavier

	* [r6597] Decreased the precision also for the gradient test.

2010-05-05 09:44  xavier

	* [r6598] When stored in the opencl buffer, the orbitals are
	  transposed, with
	  the state index first and the point index second. This is to work
	  more
	  efficiently with several orbitals at once.

2010-05-05 13:31  xavier

	* [r6599] Cleaning of the OpenCL batch code.

2010-05-05 14:42  xavier

	* [r6600] * The OpenCL buffer is padded in both directions: the
	  number of states
	  is approximated to the next power of 2.
	  
	  * Optimized the application of the local potential.

2010-05-05 15:25  olivares

	* [r6601] updates on the electrostatic boundary conditions

2010-05-05 15:32  kkrieger

	* [r6602] oct: added conjugate gradient scheme for velocity
	  optimization

2010-05-05 16:19  olivares

	* [r6603] Correcting broken compilation

2010-05-05 19:09  olivares

	* [r6604] Returned INSTALL to its original configuration

2010-05-05 20:24  xavier

	* [r6605] * Modified the axpy and operate routine to profit from
	  the new array
	  order.
	  
	  * Added some profiling regions.

2010-05-06 16:26  helbig

	* [r6606] fixed bug in 2particle KS inversion

2010-05-06 17:17  xavier

	* [r6607] Added a log2 function.

2010-05-06 17:18  xavier

	* [r6608] Optimization of OpenCL operate.

2010-05-07 06:47  xavier

	* [r6609] This should fix the compilation problem (¡Nicole mala!).

2010-05-07 15:37  xavier

	* [r6610] * The derivatives test now works with a batch and it uses
	  opencl when
	  available.
	  
	  * The profiler now works with oct-test.

2010-05-08 16:36  xavier

	* [r6611] Some fixes to compilation in single precision.

2010-05-09 00:27  xavier

	* [r6612] * Now the derivatives test uses StatesBlockSize.

2010-05-09 00:29  xavier

	* [r6613] * Added a new and faster operate version for OpenCL.
	  * Now nl_operator_m contains the operate kernels.

2010-05-09 16:04  xavier

	* [r6614] An optimized version of the "map" operator.

2010-05-09 17:15  xavier

	* [r6615] Unified the real and complex versions of the "invmap"
	  non-local
	  operator.

2010-05-09 19:36  xavier

	* [r6616] Now the variable TestDerivatives allows to select the
	  test of the
	  derivatives that will be performed.

2010-05-09 21:54  xavier

	* [r6617] * The application of the local potential is now done by
	  the same kernel
	  for real and complex functions.

2010-05-10 22:34  xavier

	* [r6618] Fixed set zero boundary conditions in OpenCL.

2010-05-11 21:07  xavier

	* [r6619] Merged the daxpy and dzaxpy OpenCL routines.

2010-05-11 22:14  xavier

	* [r6620] * Moved the OpenCL interface to a separate file.
	  
	  * Added a function to print opencl errors.

2010-05-11 22:40  xavier

	* [r6621] Moved the error verification to Fortran for some opencl
	  functions.

2010-05-12 02:47  dstrubbe

	* [r6622] Formatting and single-letter variables.

2010-05-12 22:21  xavier

	* [r6623] * Bugfix: mixing C and Fortran causes some confusions. I
	  had used /=
	  instead of !=, causing a floating point exception.
	  
	  * Now the routine calling hamiltonian_apply_batch is responsible
	  for
	  passing batches that are in the OpenCL buffer. For the moment the
	  taylor exponential is the only one doing it.

2010-05-13 00:22  dstrubbe

	* [r6624] Set some svn:ignore properties.

2010-05-13 07:48  xavier

	* [r6625] * Now the whole taylor exponential can be calculated in
	  opencl.

2010-05-13 08:02  xavier

	* [r6626] Forgot one file.

2010-05-13 23:03  xavier

	* [r6627] * In hamiltonian_apply_batch the laplacian is now
	  directly applied over hpsi.

2010-05-14 06:24  xavier

	* [r6628] Some deallocations were missing in my last commit.

2010-05-14 15:57  xavier

	* [r6629] Fixed compilation problems with opencl and openmp.

2010-05-14 18:15  acastro

	* [r6630] Fixed a bug in the poisson_isf library that apparently,
	  only affected
	  me. But it is an illegal use of the MPI_ALLGATHERV function, in
	  which
	  send and receive memory spaces overlap.

2010-05-15 12:49  xavier

	* [r6631] The non-local potential can now be applied using opencl.

2010-05-15 15:14  xavier

	* [r6632] The objects associated with the non-local potential are
	  kept in device
	  memory.

2010-05-15 15:29  xavier

	* [r6633] Fix compilation problems when opencl is not used.

2010-05-15 17:42  acastro

	* [r6634] The vhxc component of the Hamiltonian was not initialized
	  to zero for
	  the independent particles case, which caused trouble in some
	  case.

2010-05-15 23:33  xavier

	* [r6635] Improved the OpenCL parallelization of the projector_bra
	  routine.

2010-05-16 08:45  xavier

	* [r6636] * Fixed a problem with projector.cl and ATI OpenCL.
	  * cl_finish now returns the error code.

2010-05-16 18:34  xavier

	* [r6637] * Some opencl related improvements.
	  
	  * Removed push/pop_sub from a one line function (ex-three-line
	  function) that was called too often.

2010-05-16 19:33  xavier

	* [r6638] Improvements in the OpenCL interface.

2010-05-16 20:38  xavier

	* [r6639] Renamed the functions and constants associated to the
	  etrs and aetrs
	  to more intuitive names.

2010-05-16 21:03  xavier

	* [r6640] Reverted some changes in the projector kernel that were
	  not correct.

2010-05-17 06:01  dstrubbe

	* [r6641] *) Broke some semicolon-separated statements into
	  multiple lines.
	  *) Commented on the lack of push_sub where Xavier just removed
	  it.

2010-05-17 09:24  xavier

	* [r6642] Now the hamiltonian is always applied using opencl (if
	  enabled).

2010-05-17 21:17  xavier

	* [r6643] Now the OpenCL device to use can be selected with the
	  OpenCLDevice
	  variable.

2010-05-18 01:51  dstrubbe

	* [r6644] *) For testing purposes, you can now do MaximumIter = 0.
	  Use a negative number for unlimited SCF iterations.
	  *) Changed a single-letter variable.

2010-05-18 02:23  dstrubbe

	* [r6645] *) Added proper units to mesh_index and text function
	  output.
	  *) Fixed a bug in XCrySDen output which caused the spacing to be
	  wrong if the variable lsize was not an integer multiple of the
	  spacing, as would be generally be the case in non-periodic
	  directions.

2010-05-19 06:13  xavier

	* [r6647] More changes in the OpenCL interface.

2010-05-19 06:20  dstrubbe

	* [r6648] Fixed an error in documentation.

2010-05-19 08:32  xavier

	* [r6649] Improvements of the opencl interface.

2010-05-19 20:08  dstrubbe

	* [r6650] *) Simplified filenames for output, so that spin and
	  k-points are only mentioned if there is more than one.
	  *) Changed output test accordingly.
	  *) If the states are real, no current density is output, but now
	  a warning is additionally written to let the user know why it
	  wasn't written.
	  *) A bit of formatting.

2010-05-21 08:28  xavier

	* [r6651] Fixed the problem with periodic systems and the filter
	  preconditioner:
	  the filter must be applied with the phase included. Now it works
	  correctly.

2010-05-21 16:52  xavier

	* [r6652] Some reorganization of the application of the projectors.
	  Now blas can
	  also be used for complex wave-functions.

2010-05-21 22:22  xavier

	* [r6653] The projections are now stored and reduced in a single
	  array for all
	  projectors.

2010-05-22 06:13  xavier

	* [r6654] Split the application of the projectors in two parts.

2010-05-23 07:34  xavier

	* [r6655] * Now the initial part of the projection is done before
	  the end of the
	  calculation of the laplacian.
	  
	  * Fixed the opencl version of the projection.

2010-05-24 16:51  xavier

	* [r6656] A line was too long.

2010-05-26 07:28  xavier

	* [r6657] Added more tests for the derivatives.

2010-05-26 07:58  marques

	* [r6658] Added the parametrization of the CSC functional for the
	  soft Coulomb interaction and a=0.5

2010-05-26 08:02  marques

	* [r6659] Forgot an else

2010-05-26 10:38  xavier

	* [r6660] The precision value for some matches was not correct.

2010-05-26 11:21  xavier

	* [r6661] * Renamed the variable What2Mix to MixField.
	  
	  * Added the option of not mixing (MixField = none).
	  
	  * The default of MixField depends on the TheoryLevel and XC
	  Functional: 'none' for independent particles, 'potential' for OEP
	  and
	  MGGA, and 'density' for the rest (is there an advantage in mixing
	  the
	  density?).
	  
	  * Updated test input files, including the ones that emulated no
	  mixing
	  by using linear mixing with "Mixing = 1.0".

2010-05-26 13:28  joseba

	* [r6662] Changed the configuration file to allow cross compiling.
	  It was failing on Jugene and now works.

2010-05-26 19:31  dstrubbe

	* [r6663] Modifications to avoid the following compiler warnings:
	  
	  zoltan_low.c(150): warning #186: pointless comparison of unsigned
	  integer with zero
	  assert(nbor_global_id[ii] >= 0);
	  ^
	  zoltan_low.c(215): warning #167: argument of type "char (*)[12]"
	  is incompatible with parameter of type "char **"
	  Zoltan_Initialize(1, &argv, &version);
	  ^
	  cubic_mesh_low.c(137): warning #266: function "printf" declared
	  implicitly
	  printf("aa %d %d %d\n", aa[0]->nx, aa[0]->ny, aa[0]->nz);
	  ^
	  cubic_mesh_fft.c(35): warning #266: function "printf" declared
	  implicitly
	  printf("Init fourier %d %d %d\n", this[0]->nx, this[0]->ny,
	  this[0]->nz);
	  ^
	  fortcom: Warning: mpi.F90, line 102: A dummy argument with an
	  explicit INTENT(OUT) declaration is not given an explicit value.
	  [MPI_GRP_OUT]
	  subroutine mpi_grp_copy_equal(mpi_grp_out, mpi_grp_in)
	  write_iter_low.c(150): warning #181: argument is incompatible
	  with corresponding format string conversion
	  sprintf(w->buf+w->pos, "%8u%20.12e", w->iter, w->iter*w->dt);
	  w->pos+=8+20;
	  ^

2010-05-26 21:12  xavier

	* [r6664] * Rearranged some tests.
	  * Added a test for 3d derivatives.
	  

2010-05-27 21:58  xavier

	* [r6665] Improved the numerical accuracy of the non-linear solver
	  in the BR89
	  class of MGGAs. This means that the equation converges for all
	  values
	  of the rhs and the bisection is no longer needed.

2010-05-27 22:40  xavier

	* [r6666] Now opencl_finish has to be called explicitly after a
	  kernel has been
	  executed.

2010-05-31 10:12  acastro

	* [r6667] A couple of bugs in the documentation and in the
	  application of local
	  targets, in the OCT part of the code.

2010-06-02 17:14  acastro

	* [r6668] The OCT runs were not behaving properly when OCTMaxIter =
	  0.

2010-06-03 13:55  kkrieger

	* [r6669] OCT: now a velocity output file is written during the
	  velocity optimization

2010-06-03 14:32  kkrieger

	* [r6670] just fixed the problem from the previous commit

2010-06-03 16:50  xavier

	* [r6671] Removed the option number from the html/texinfo
	  documentation. This
	  should avoid users from using numbers instead of names in the
	  input file.

2010-06-04 07:18  xavier

	* [r6672] Now batch_move_to_buffer (and batch_move_from_buffer) can
	  be called
	  even when the batch is already in buffer.

2010-06-04 08:26  xavier

	* [r6673] Fixes the problem with non-opencl compilations.

2010-06-04 08:57  xavier

	* [r6674] For batches of size one, we can simplfy the copy to
	  buffer.

2010-06-04 11:05  xavier

	* [r6675] Added profiling for packing/unpacking in the OpenCL
	  buffer.

2010-06-04 11:49  xavier

	* [r6676] The opencl_m module is always built.

2010-06-04 14:34  xavier

	* [r6677] Renamed some functions from batch_m.

2010-06-04 15:22  xavier

	* [r6678] The alternative LCAO didn't work properly when the number
	  of basis
	  functions is smaller than the number of states.

2010-06-04 15:55  xavier

	* [r6679] Moved the mesh partition routines to its own module.

2010-06-04 19:22  dstrubbe

	* [r6680] *) Corrections to documentation.
	  *) CasidaKohnShamStates as default now goes up to the total
	  number of states, not the arbitrary value 1024.
	  *) Casida writes number of e-h pairs in basis.
	  *) Corrections to push/pop_subs.
	  *) Typos in casida test.

2010-06-05 06:21  dstrubbe

	* [r6681] *) The eps-diff and Petersilka results of Casida now give
	  the spin of the excitation.
	  *) Replaced some single-letter variables.
	  *) Formatting of the code.
	  *) A clarification to documentation.
	  *) Corrected push/pop_sub's.

2010-06-05 10:37  xavier

	* [r6682] Now the mesh partition is stored in disk, so octopus
	  doesn't have to
	  re-calculate it.

2010-06-05 11:37  xavier

	* [r6683] Fixes compilation error with PGI: zoltan_partition is
	  only available when compiled with MPI.

2010-06-05 12:30  xavier

	* [r6684] Bugfix: mesh_partition_read could read a wrong partition
	  in some cases.

2010-06-06 00:32  dstrubbe

	* [r6685] *) Alphabetized modules.
	  *) Formatting of code.
	  *) Added warning for negative KS eigenvalue differences in
	  Casida, and made criterion for this and negative excitations be
	  -M_EPSILON not M_ZERO to avoid flagging zero.
	  *) SAFE_DEALLOCATE nullifies, so no additional nullification is
	  required.
	  *) Replaced single-letter variables.

2010-06-06 18:52  xavier

	* [r6686] The LCAO can now use an extra set of orbitals (generated
	  by the
	  derivative of the radial function).

2010-06-06 20:38  xavier

	* [r6687] Added some output to the alternative LCAO.

2010-06-06 21:35  xavier

	* [r6688] Added a pack_t type to hold the information of a packed
	  batch.

2010-06-06 21:50  xavier

	* [r6689] Fixes compilation problem.

2010-06-07 17:32  xavier

	* [r6690] * Added a profiling region for the reduction in the
	  non-local potential.
	  * The bg operator was missing from the input variable
	  description.

2010-06-07 21:29  xavier

	* [r6691] A batch can now be packed without opencl.

2010-06-07 22:28  xavier

	* [r6692] Removed the automatic detection of the best operate
	  function. Now it is
	  selected statically.

2010-06-08 09:19  xavier

	* [r6693] If the debug trace is written to a file (DebugLevel >
	  100) then it is
	  not printed to the standard output.

2010-06-08 10:26  xavier

	* [r6694] A non-present optional argument was accessed in
	  write_fatal, causing a
	  segmentation fault.

2010-06-08 15:22  xavier

	* [r6695] Fixed a deadlock in mesh_partition_read.

2010-06-08 15:25  xavier

	* [r6696] Renamed hamiltonian_update_potential to
	  hamiltonian_update.

2010-06-09 22:15  dstrubbe

	* [r6697] *) Fixed separator lines
	  *) Fixed push/pop_sub's.

2010-06-09 22:25  fnog

	* [r6698] Syncing JuBE files with PRACE trac server.

2010-06-09 22:27  fnog

	* [r6699] Syncing JuBE files with PRACE trac server - files not
	  needed anymore.

2010-06-10 00:43  dstrubbe

	* [r6700] *) Fixed a bug in band velocity
	  *) Comments

2010-06-10 02:14  dstrubbe

	* [r6701] A line seems to have been too long.

2010-06-10 02:18  dstrubbe

	* [r6702] *) Formatting.
	  *) Changed single-letter variable.
	  *) The possibility of multiple datasets was not mentioned in the
	  documentation for CalculationMode. Now it is described.
	  *) Several run modes opened directories in a way that doesn't
	  work with multiple datasets. Also, it seems safer to only ask the
	  root node to do this.

2010-06-10 05:04  dstrubbe

	* [r6703] No, a line was not too long, it's just that you can't
	  break up the argument to a preprocessor macro into multiple
	  lines.

2010-06-10 11:20  sakko

	* [r6704] Added a new kind of q-dependent kick for time-propagation
	  runs, this should be useful for directional averaging with finite
	  momentum transfers.

2010-06-11 00:42  dstrubbe

	* [r6705] In fact, band velocities are always zero for real
	  wavefunctions, so it is pointless to calculate them unless
	  wavefunctions are complex.

2010-06-11 05:42  xavier

	* [r6706] Removed the single precision SSE2 version of the operate.

2010-06-11 06:39  xavier

	* [r6707] * Added an interface to vector builtin functions.
	  * Converted the SSE2 routines to the new interface.

2010-06-11 11:11  xavier

	* [r6708] Enabled the new unified vectorial interface in the blue
	  gene.

2010-06-11 12:01  xavier

	* [r6709] The configure script now prints the type of vectorial
	  instructions.

2010-06-11 12:59  acastro

	* [r6710] Created a grid_init_stage_0, to put some initializations
	  that were made
	  directly in system_init (open boundaries stuff).
	  
	  Added a group "open-systems", to test the open-systems tests
	  only.

2010-06-11 22:23  xavier

	* [r6711] Optimized operate_vec for the blue gene.

2010-06-11 22:27  xavier

	* [r6712] bugfix: The finite q kick was enabled or disabled by an
	  non-initialized variable. This fixes some of the failures with
	  open64/pathscale. A problem with optimal control remains.

2010-06-11 22:33  xavier

	* [r6713] Fixed some compilation problems in my last commit.

2010-06-12 06:41  xavier

	* [r6714] Removed the BG version of operate. (It has been replaced
	  by the vec
	  version.)

2010-06-12 12:01  xavier

	* [r6715] The "vectorial" version of operate now can also be
	  compiled without
	  vector support.

2010-06-13 07:03  xavier

	* [r6716] Information about vectorial extensions is now printed.

2010-06-13 07:05  xavier

	* [r6717] Removed the assembler implementation of operate. If
	  necessary, I will
	  replace it by an improved version latter.

2010-06-13 08:19  xavier

	* [r6718] Fixed problem with operate_vec and non-aligned memory.

2010-06-13 08:20  xavier

	* [r6719] Fixed problem with OpenMP compilation.

2010-06-13 09:29  xavier

	* [r6720] Removed the plain C version of operate.

2010-06-13 09:53  acastro

	* [r6721] Moved all the "messages_obsolete_variables" calls from
	  wherever they
	  were, clooging the code, to a routine in the messages module.

2010-06-13 12:44  acastro

	* [r6722] Roll back to previous version (6720), since the idea of
	  moving the
	  obsolete variables to one place was not so good...

2010-06-15 18:35  dstrubbe

	* [r6723] *) Improvements to documentation, formatting
	  *) Corrections to push/pop_sub's (including a mistaken push_sub
	  at the end of a routine) and adding where missing.
	  *) Dipole now writes x,y,z instead of x1,x2,x3.
	  *) Alphabetized modules.
	  *) Changed single-letter variables.

2010-06-15 19:00  dstrubbe

	* [r6724] Changed notation for dipole in two tests in accordance
	  with recent commit.

2010-06-15 19:49  dstrubbe

	* [r6725] *) Improvements to comments and formatting
	  *) Changed single-letter variable

2010-06-15 20:13  dstrubbe

	* [r6726] *) Corrected 'self energy' to 'self-energy'.
	  *) Improvements to formatting.
	  *) Changed single-letter variables.

2010-06-15 20:22  dstrubbe

	* [r6727] *) Changed single-letter variables.
	  *) Corrected push/pop_sub's and error messages to the correct
	  routine names.
	  *) Improved formatting.

2010-06-15 20:49  dstrubbe

	* [r6728] *) More changes of 'self energy' to 'self-energy'.
	  *) Removed some unnecessary semicolons.
	  *) Changed single-letter variables.
	  *) Output of eigenvalues no longer repeats the header for every
	  k-point, to make it less cluttered. Tests changed accordingly.
	  *) Formatting.

2010-06-15 20:55  dstrubbe

	* [r6729] Fixed uses of the word "nor."

2010-06-15 21:01  dstrubbe

	* [r6730] *) Changed single-letter variables.
	  *) Modified loops in sternheimer for parallel over k or states.
	  *) Clarification to output message.

2010-06-15 21:05  dstrubbe

	* [r6731] Now band velocities can be calculated parallel in k or
	  states.

2010-06-15 21:19  dstrubbe

	* [r6732] *) Improvements to formatting.
	  *) Calculation of effective masses can now be parallel in k and
	  states.
	  *) Supports spinors also.
	  *) Added some missing deallocations.

2010-06-15 21:38  dstrubbe

	* [r6733] *) Avoided repeated allocation of an array by moving it
	  outside a loop.
	  *) Formatting.
	  *) Fixed push_sub's to correspond to actual names of routines.
	  *) Removed unnecessary declarations of variables.

2010-06-15 21:55  xavier

	* [r6734] Now the aligned and unaligned versions of zoperate use
	  the same code.

2010-06-15 22:10  dstrubbe

	* [r6735] *) Formatting.
	  *) Added second-order contribution to effective masses from
	  [r,[r,Vnl]]. Still need to implement applying proper bc's for
	  evaluating.

2010-06-15 22:35  dstrubbe

	* [r6736] *) Now boundary conditions are properly applied for
	  second-order perturbation.
	  *) delta_ij term removed from effective mass calculation since it
	  is now taken care of by the second-order perturbation.

2010-06-15 22:39  xavier

	* [r6737] Now doperate shares the code with zoperate.

2010-06-15 22:51  dstrubbe

	* [r6738] *) Now the phases are applied as necessary for
	  second-order perturbations.
	  *) A little more formatting.

2010-06-15 22:54  xavier

	* [r6739] Renamed --enable-sse2 and --disable-sse2 to
	  --enable-vectors
	  and --disable-vectors.

2010-06-15 23:21  dstrubbe

	* [r6740] Added a test for band velocities and effective masses in
	  Si.

2010-06-16 20:11  dstrubbe

	* [r6741] *) Parallel in k and states for polarizability.
	  *) Changed single-letter variables.
	  *) Formatting.
	  *) Added some caveats for kdotp.

2010-06-17 00:01  dstrubbe

	* [r6742] *) Formatting.
	  *) Changed single-letter variables.
	  *) Added a warning that KPointsUseSymmetries shouldn't be used
	  with perturbations since they may break some symmetries, and
	  removed a contradictory statement about the default.
	  *) Changed idim to idir for consistency.
	  *) Removed two kdotp matches since they seem to be numerically
	  ill-conditioned because of degeneracies.

2010-06-17 01:38  dstrubbe

	* [r6743] *) A beginning at the second-order Sternheimer equation.
	  *) Removed an unnecessary module inclusion and some blank lines.
	  *) Corrected a bizarre typo.

2010-06-18 11:34  fulvio

	* [r6744] Change a wrong minus sign in the calculation of tau

2010-06-18 14:22  fulvio

	* [r6745] Added to the paramagnetic current the k point dependence

2010-06-21 09:13  dstrubbe

	* [r6746] Bug fix from Feng Wang, which fortunately does not affect
	  many things.

2010-06-21 13:06  dstrubbe

	* [r6747] Apparently the bug in normalization was affecting results
	  for open-boundaries tests.

2010-06-21 14:42  dstrubbe

	* [r6748] Fix to warning condition.

2010-06-21 16:13  dstrubbe

	* [r6749] Widened tolerance a little for effective mass test,
	  seeing the variation once the other buildbots come back online.

2010-06-21 16:28  dstrubbe

	* [r6750] Copies before set_bc don't need to be over np_part.

2010-06-22 08:45  marques

	* [r6751] Bug fix: when restarting linear response when should nto
	  read the occupations file, otherwise the fermi energy gets
	  totally skewed up

2010-06-22 08:58  marques

	* [r6752] Sorry, the previous fix was wrong. Now it should be OK

2010-06-22 09:34  dstrubbe

	* [r6753] Updated test file in accordance with change r6728.

2010-06-22 10:34  xavier

	* [r6754] Fixed the calculation of the polarizability for periodic
	  systems.

2010-06-23 09:23  marques

	* [r6755] *) Added functions atan2 and log_b to the parser
	  *) Now the parser checks if the number of arguments given to a
	  function is correct

2010-06-23 20:42  xavier

	* [r6756] I started to clean the k-points code: now kpoints_m
	  generates also the
	  k-points and performs the reduction with symmetries.

2010-06-23 22:49  xavier

	* [r6757] Now Octopus uses the k-points generated by kpoints_m.

2010-06-23 22:59  xavier

	* [r6758] Removed the crystal_m module.

2010-06-23 23:41  xavier

	* [r6759] Removed the states_kpoints_inc file, moved the functions
	  to kpoints.F90.

2010-06-24 09:16  xavier

	* [r6760] Removed the kpoints array from states_dim_t. This commit
	  breaks the
	  open boundary code, there is an assertion in the point where the
	  problem is. I will try to fix it soon, but some help would be
	  welcome.

2010-06-24 16:36  dstrubbe

	* [r6761] A file was entirely missing push_sub's.

2010-06-24 22:59  xavier

	* [r6762] The periodic 1D tests now have separated input files for
	  gs and unocc.

2010-06-25 15:16  dstrubbe

	* [r6763] Nodes without any part of a submesh have some dangerous
	  1:0 array references that may cause trouble on some compilers,
	  e.g. PGI with -Mbounds. Now I have fixed them. Hopefully they
	  never actually made a difference to the results.

2010-06-26 08:43  xavier

	* [r6764] Added some verbosity to the testsuite.

2010-06-26 10:06  xavier

	* [r6765] Now k-points are generated both for periodic and open
	  boundaries
	  systems.

2010-06-27 16:19  xavier

	* [r6766] The klattice was not initialized correctly for
	  non-periodic systems.
	  This caused one of the open boundaries tests to fail.

2010-06-28 16:30  xavier

	* [r6767] Packing for complex functions is done in a complex
	  variable.

2010-06-28 16:43  xavier

	* [r6768] The non-local part of the potential can now be applied to
	  packed
	  batches.

2010-06-28 17:47  xavier

	* [r6769] The local potential can also be applied over packed
	  batches.

2010-06-28 17:55  xavier

	* [r6770] Removed the scissor operator. It was implemented sometime
	  ago to test
	  something that didn't work.

2010-06-28 21:33  xavier

	* [r6771] More operations that now can be done with packed batches.

2010-06-29 08:05  xavier

	* [r6772] Now axpy can also be applied to a packed batch.

2010-06-29 08:18  xavier

	* [r6773] I forgot the changes to one file in my last commit.

2010-06-29 11:11  fulvio

	* [r6774] added the possibility to include a term dependent on the
	  paramagnetic current in the calculation of the kinetic energy
	  density (tau)

2010-07-01 16:44  fulvio

	* [r6775] Corrected a mistake that I did in the subroutine that
	  calculates the kinetic energy density and changed the names of
	  some variables

2010-07-02 10:16  xavier

	* [r6776] Now the non-local operator can be applied to packed
	  batches.

2010-07-04 09:01  xavier

	* [r6777] The operate_ri_vec function now works with complex and
	  real arrays.

2010-07-04 22:03  xavier

	* [r6778] An optimized version of the non-local operator.

2010-07-04 23:54  xavier

	* [r6779] Some optimization of the Hamiltonian for packed batches.

2010-07-05 15:03  xavier

	* [r6780] Added a status variable to batch_t.

2010-07-06 12:02  marques

	* [r6781] Added another functional to the PBE family of
	  functionals. Another one from Scuseria, the RGE2, both the
	  exchange and the correlation part.

2010-07-06 15:22  xavier

	* [r6782] * Renamed states_calc_tau_jp_... to
	  states_calc_quantities.
	  
	  * Renamed the parameters so they have more meaningful names.
	  
	  * Added a new parameter, gi_kinetic_energy_density (gi means
	  gauge-invariant). This quantity contains the squared current
	  correction while kinetic_energy_density doesn't.
	  
	  * For the moment I kept the CurrentInTau variable, since Fulvio
	  is
	  using it. But this should be moved to XC.

2010-07-07 14:30  xavier

	* [r6783] * Openmp parallelization of some routines.
	  * Removed some continuation lines of "single-line" foralls.

2010-07-07 14:37  xavier

	* [r6784] Renamed the USE_OMP macro to HAVE_OPENMP.

2010-07-07 15:51  xavier

	* [r6785] * Some cleaning of batch_copy_data and batch_axpy.
	  * Implemented set_bc_batch for zero boundary conditions and
	  packed batches.

2010-07-07 21:45  xavier

	* [r6786] Added X(subarray_gather_batch) functions.

2010-07-07 22:55  xavier

	* [r6787] * Now subarray_gather_batch is used by ghost_update.
	  * Packing is not used for domain parallelization.

2010-07-07 23:41  xavier

	* [r6788] Removed the libnbc version of ghost update.

2010-07-07 23:43  xavier

	* [r6789] Added a version for packed batches of
	  subarrat_gather_batch.

2010-07-07 23:56  xavier

	* [r6790] Removed libnbc, it was not used since a long time and at
	  the end it is
	  not practical.

2010-07-08 07:17  xavier

	* [r6791] Removed the unused function X(vec_ighost_update).

2010-07-08 08:06  xavier

	* [r6792] Moved the ghost_update functions to a new module:
	  boundaries_m.

2010-07-08 08:53  xavier

	* [r6793] A line was too long.

2010-07-08 08:54  xavier

	* [r6794] Now ghost points can also be updated in packed batches.

2010-07-08 09:40  xavier

	* [r6795] Removed libnbc from the copying file.

2010-07-08 11:21  xavier

	* [r6796] The new variable StatesPack controls whether octopus
	  packs or not the
	  vectors when applying the hamiltonian. The default is yes.

2010-07-08 18:49  dstrubbe

	* [r6797] Two typos.

2010-07-09 09:37  marques

	* [r6798] Added the gaussian cube format to the output
	  possibilities. This allows the use of, e.g. paraview to visualize
	  stuff.
	  I am not familiar with paraview, so can someone try it out and
	  let me know if it is working properly?

2010-07-09 09:47  marques

	* [r6799] Bug fixed: the SOS solver was not working. Now it is, and
	  it does give a good alternative solution to the sternheimer
	  equation.

2010-07-09 11:20  xavier

	* [r6800] The derivatives test now uses the StatesPack variable.

2010-07-09 12:43  marques

	* [r6801] Changed the version number to 1.0

2010-07-09 12:49  marques

	* [r6804] As octopus is vulgaris, then libxc can be ordinarius

2010-07-09 12:58  marques

	* [r6805] A field was missing in the cube format.

2010-07-09 18:54  xavier

	* [r6806] The BATCH_PACK and BATCH_PACK regions now only count when
	  a copy is
	  made.

2010-07-09 18:57  xavier

	* [r6807] Some optimizations for the blue gene.

2010-07-10 09:00  xavier

	* [r6808] Removed the beak directory.

2010-07-10 20:41  dstrubbe

	* [r6809] Added a warning to keep users from trying to use smearing
	  without extra states.

2010-07-10 21:09  xavier

	* [r6810] Some improvements of the OpenCL code.
	  
	  For time-propagation, currently Octopus runs 3 times faster on a
	  GPU
	  (GeForce GTX 480) than on a CPU (Core i7 3.3 GHz), and there is
	  still
	  room for improvements.

2010-07-10 21:57  xavier

	* [r6811] Remove the StatesSaveMemory variable. It was not used and
	  was not working.

2010-07-10 22:36  xavier

	* [r6812] Removed the StatesWindowSize variable and associated
	  functionality. It
	  never worked properly.

2010-07-11 00:37  xavier

	* [r6813] Removed several unused variables.

2010-07-11 15:08  xavier

	* [r6814] * Now the states_t object contains psib(:), an array of
	  wave-function
	  batches. The idea is that we use this batches instead of the
	  X(psi),
	  so in the future we could eliminate X(psi) to be more flexible to
	  allocate and deallocate wave-functions.

2010-07-12 07:51  xavier

	* [r6815] Now the energy in a td propagation is re-calculated after
	  a certain
	  number of iterations. The number of iterations is controlled by
	  the
	  TDEnergyUpdateIter function, the default is 10.
	  This is for performance reasons, the calculation of the
	  eigenvalues
	  requires a non-negligible amount of computer time.

2010-07-13 09:54  xavier

	* [r6816] Added some primitive checking of OpenCL to the configure
	  script.

2010-07-14 10:12  acastro

	* [r6817] Fixed a bug reported by Juho Ojajarvi: the variable
	  spec%niwfs is not
	  initialized when using the species_from_file option.

2010-07-14 19:04  dstrubbe

	* [r6819] autoconf on libxc is failing on some systems and
	  demanding this line.

2010-07-14 20:02  dstrubbe

	* [r6820] *) xyz geometry files now state the unit in the comment
	  line.
	  *) Alphabetized module list.

2010-07-15 00:20  dstrubbe

	* [r6821] Our formula for hyperpolarizability seems to be valid
	  only if the projection of LR wavefunctions in the occupied
	  subspace has been removed, so pending possible modification of
	  that formula, the wavefunctions should be projected again.

2010-07-17 22:00  dstrubbe

	* [r6822] *) A fix to the handling of arrays 1:ns when ns = 0. My
	  previous attempt at the this resulted in MPI_Allreduce errors
	  sometimes because not all nodes entered the function at all.
	  *) Clarification to output message from restart.

2010-07-18 00:26  dstrubbe

	* [r6823] Provided there is no smearing, we can calculate the full
	  response of the wavefunctions in the Sternheimer equation in the
	  last step, and then use a similar and more efficient formula to
	  calculate the hyperpolarizability.

2010-07-18 21:39  dstrubbe

	* [r6824] *) Most of the variables for controlling the tolerance of
	  the linear solver had a discrepancy between their names as stated
	  in the documentation and the names actually read by the parser,
	  making them unusable. Please be careful to avoid typos in these
	  places!!
	  *) Some formatting to documentation.

2010-07-19 00:07  dstrubbe

	* [r6825] *) When calculating occupied response, only needed matrix
	  elements are generated for beta.
	  *) A variable controls whether to do occupied response in
	  em_resp.
	  *) Changed ndim to ndir for consistency in beta calculation.

2010-07-19 06:57  dstrubbe

	* [r6826] Implemented correct orthogonalization for Sternheimer in
	  the case of fixed partial occupations.

2010-07-19 16:13  acastro

	* [r6827] Changed the names of some variables and modules, so that
	  they reflect
	  better what they really are. Also, changed some documentation.

2010-07-19 20:37  dstrubbe

	* [r6828] *) Occupations, not smear%el_per_state, are needed in
	  sums whenever we are not dealing with linear response
	  wavefunctions (which include the occupation).
	  *) A small fix to orthogonalization for fixed occupations.
	  Actually I am only sure it works for integer occupations right
	  now.

2010-07-19 21:37  dstrubbe

	* [r6829] *) fixed_occ is now a type of smearing, to avoid the
	  oddity of supposedly having both fixed occupations and a certain
	  kind of smearing.
	  *) Added some missing dependencies.

2010-07-20 00:13  dstrubbe

	* [r6830] *) Quantities depending only on a single frequency factor
	  are written out after each frequency calculation now in em_resp,
	  rather than waiting till all are done.
	  *) Added push_sub's.

2010-07-20 00:34  dstrubbe

	* [r6831] Reverted an unintentional commit.

2010-07-20 01:16  dstrubbe

	* [r6832] Fix of bug due to my use of C++ commands in Fortran...

2010-07-20 12:26  xavier

	* [r6833] Added a new propagator: caetrs. This is a modification of
	  aetrs that
	  gives similar results to etrs and that allows for task
	  parallelism.

2010-07-20 18:37  dstrubbe

	* [r6834] Undid a mistaken change about occupations in
	  pert_expectation_density, and explained the situation in
	  comments. This will fix the Na polarizability test.

2010-07-20 18:53  dstrubbe

	* [r6835] *) Updated an option in a testsuite input file forgotten
	  in Alberto's renaming, to fix a failing test.
	  *) Since we advise users not to use explicit numerical values for
	  input options, the defaults should not be stated that way either.

2010-07-20 19:12  dstrubbe

	* [r6836] *) Clarified the condition for the warning about smearing
	  without unoccupied states so because it was being triggered in
	  many reasonable cases in the testsuite.
	  *) LCAO now gives a little more info when it isn't able to run,
	  for diagnostic purposes.

2010-07-20 19:35  dstrubbe

	* [r6837] *) A QOCT test was giving the warning "Atom 1 is outside
	  the box." I redefined the coordinate system to make the Morse
	  potential's origin be the minimum and lie inside the box. Results
	  are identical.
	  *) Added tests for the ground state in that QOCT test.

2010-07-20 19:57  nitsche

	* [r6838] * replaced forall loops in ob_grid with do loops, just
	  want to see if this fixes the problem on hbar

2010-07-20 21:47  dstrubbe

	* [r6839] Workaround for bizarre issue with ifort 11.072: if
	  compiling with MPI2, mpi_m must be listed before parser_m, or
	  else MPI_IN_PLACE is not defined (which comes ultimately from
	  mpif-common.h). I think this is a compiler bug, because I have no
	  idea otherwise how this could be the case.

2010-07-20 22:36  dstrubbe

	* [r6840] De Gironcoli's alpha parameter for smearing in linear
	  response is now a function, so that it is not duplicated three
	  times in the code.

2010-07-21 01:57  dstrubbe

	* [r6841] *) Implemented Fermi-Dirac entropy for arbitrary
	  occupations. Note that this is not quite the same as the
	  appropriate entropy for other smearing schemes, but there is no
	  other way to do it knowing only the occupations.
	  *) The entropy as well as -TS are now written out in static/info.
	  *) The object called entropy is now actually S, not -TS.
	  *) Some clarifications to documentation.
	  *) Errors if certain smearing functions are called on
	  SMEAR_FIXED_OCC.

2010-07-21 02:23  dstrubbe

	* [r6842] clean_stop now works for sternheimer. There was no
	  mention of this useful feature anywhere, but now I put it on the
	  wiki. I am not sure whether these run modes support clean_stop:
	  gcm, invert_ks, casida, td_transport, one_shot.

2010-07-21 07:05  nitsche

	* [r6843] * removed the commented forall lines of my previous
	  commit (there really is an issue with forall within pgi)

2010-07-22 00:29  dstrubbe

	* [r6844] *) Let's test the free energy also, to make sure entropy
	  is calculated right.
	  *) Revised again the condition for the smearing/extra states
	  warning.

2010-07-22 18:36  dstrubbe

	* [r6845] A further refinement to the warning about smearing and
	  extra states: it is not triggered now for fixed occupations, to
	  avoid it being written always for open boundaries.

2010-07-22 20:52  dstrubbe

	* [r6846] Now Sternheimer for fixed arbitrary occupations is
	  correctly implemented. The Na em_resp test can be calculated via
	  the Occupations block to emulate semiconducting, spline, or
	  Methfessel-Paxton smearing, giving identical results, and even a
	  speed-up of a factor of 5 in the MP case. Some differences from
	  the standard approach:
	  *) For fixed_occ we use a different alpha function than De
	  Gironcoli, which is arbitrary anyway, since the smearing width is
	  not defined.
	  *) fixed_occ uses the projector onto valence orbitals on the LHS,
	  unlike the semiconductor case where this is replaced by explicit
	  orthogonalizations.
	  *) theta_Fi is now directly assigned the occupations, rather than
	  calculating the (equivalent) step function again.
	  *) We generalize the theta_ij to use only the occupations.
	  *) beta_ij is set by hand to zero if i or j is unoccupied.
	  *) The term with the delta function if eig(i) = eig(j) is just
	  ignored.

2010-07-23 00:38  dstrubbe

	* [r6847] If smearing is used, the Fermi energy is now written in
	  each SCF iteration as well as the static/info file.

2010-07-23 01:29  dstrubbe

	* [r6848] If occupations are fixed, but all levels are full or
	  empty, then the same methods are used for Sternheimer as in the
	  semiconducting case, namely not using the LHS projector on the
	  valence states, and using preorthogonalization by default.

2010-07-23 18:04  dstrubbe

	* [r6849] *) Max l considered for pseudopotentials is now written
	  out. Mistakenly setting this low in the species block can cause
	  trouble.
	  *) Formatting.

2010-07-23 18:18  dstrubbe

	* [r6850] Forgot a 'trim'.

2010-07-23 18:41  dstrubbe

	* [r6851] Removed messages saying "Done" from pseudowfn
	  calculation. This is so quick that I don't think anyone is
	  waiting around wondering if it has finished yet.

2010-07-24 14:00  xavier

	* [r6852] Added a test for the caetrs propagator.

2010-07-24 14:19  xavier

	* [r6853] A file was missing in my last commit.

2010-07-25 18:19  xavier

	* [r6854] Fixed some pop_subs.

2010-07-25 19:55  xavier

	* [r6855] Fixed a bug in full orthogonalization with spinors.

2010-07-25 22:24  dstrubbe

	* [r6856] *) Renamed variable MaximumIter (when used for
	  CalculationMode = unocc) to UnoccMaximumIter, because it is not
	  the same thing as MaximumIter for SCF, and the documentation
	  should reflect that.
	  *) -1 can be given for unlimited iterations.
	  *) Set default to 50 instead of 20, since 20 seems never to be
	  enough for convergence.

2010-07-25 22:39  xavier

	* [r6857] * Fixed a bug in hamiltonian apply for non-contiguous
	  batches.
	  * The rmmdiis eigensolver is not "develversion" any more.

2010-07-26 05:28  dstrubbe

	* [r6858] *) Updated variable UnoccMaximumIter in a test.
	  *) Improvements to messages.
	  *) Only root node should write about clean stop, to avoid a huge
	  amount of output.

2010-07-26 08:30  marques

	* [r6859] Bug fix in the Fortran interface of f90_hyb_gga_exx_coef.
	  Thanks to Tyrel M. McQueen and John Kay Dewhurst for this one ;)

2010-07-26 09:39  marques

	* [r6861] There was a space missing in Calculation Modes that was
	  make distcheckclean fail

2010-07-26 13:05  juho

	* [r6862] Support for .csv (comma separated values i.e. ascii
	  matrix) files for use with species_from_file. File format
	  described in the starting comments of file io_csv.c .

2010-07-27 02:44  dstrubbe

	* [r6863] *) Added push_sub's.
	  *) Added another accessor function to scf_tol.

2010-07-27 04:08  dstrubbe

	* [r6864] On Cray XT4 Franklin with PGI 10.0.0, the magnetic
	  moments in this test are off by more than the tolerance, so I
	  increased the tolerance a little bit. Lowering ConvRelDens does
	  not make any difference to the discrepancy.

2010-07-27 06:10  dstrubbe

	* [r6865] Improvements to ability to use restart information from
	  other frequencies in em_resp, for use in calculating spectra:
	  *) Saved densities of the negative frequency are searched for
	  too.
	  *) In a case like em_vars%factor(3) * em_vars%omega(1) = +/-
	  em_vars%factor(1) * em_vars%omega(2), the wavefunctions are
	  copied over.
	  *) If restart info is for the negative frequency, wavefunctions
	  and densities are swapped between sigma's.
	  *) Some tests of == M_ZERO are replaced with inequalities against
	  M_EPSILON.
	  *) No need to check for density of identical frequency separately
	  from search for closest frequency.
	  *) If some omega's are negative, sigma's are swapped when using
	  an opposite one for starting guess (there is probably no good
	  reason to have negative omega's specified...)
	  *) If the restart density is for the identical frequency, then
	  the first SCF iteration uses the final tolerance, so that if it
	  is close to convergence, bad starting wfns don't mess up a good
	  starting density.
	  *) All frequencies are saved as positive in the restart
	  directory.
	  *) Improvements to formatting, comments, output.

2010-07-27 08:20  dstrubbe

	* [r6866] *) A line was too long.
	  *) A few other things the pedantic g95 was whining about.

2010-07-27 08:41  dstrubbe

	* [r6867] *) Some more pedantic stuff.
	  *) A mistake in the arguments of get_info_csv, it seems.

2010-07-27 14:47  xavier

	* [r6868] * A build dependency was missing.
	  * Fixed an out-of-bounds access.

2010-07-27 21:42  xavier

	* [r6869] Improved the generation of the periodic copies.

2010-07-28 00:19  dstrubbe

	* [r6870] *) In em_resp, you can now use restart densities, but not
	  restart wavefunctions, via a new variable
	  EMWavefunctionsFromScratch.
	  *) The full solution for wfns if working from restart density is
	  not working very well. I'm trying increasing the tolerance by a
	  factor of ten.
	  *) If not all states are converged, the SCF iterations continue.
	  *) More fixes to documentation about scf_tol.

2010-07-28 14:07  xavier

	* [r6871] Improved the messages for the alternative LCAO.

2010-07-28 16:32  joseba

	* [r6872] Too long lines

2010-07-28 19:14  dstrubbe

	* [r6873] *) Corrected an overzealous generalization to dim>3:
	  hyperpolarizabilities (and freq_factor) need three frequencies,
	  regardless of dimensionality.
	  *) Added a reference for the beta tensor combinations.
	  *) The beta output file now identifies the frequency factors
	  used. The last is the frequency of the directory in which it was
	  written.
	  *) Changed single-letter variables.

2010-07-28 19:41  dstrubbe

	* [r6874] *) Corresponding update to static_pol from last commit.
	  *) For good measure, make freq_factor an array of definite size
	  when passing.

2010-07-28 23:14  xavier

	* [r6875] Added a new module: mesh_alltoall. This module will take
	  care of all
	  situations when need to collect points from other nodes
	  (ghost-points
	  updates, pbc, symmetrization, etc.) For the moment it is not
	  used, so
	  it has not been tested.

2010-07-29 00:56  acastro

	* [r6876] The number of atomic orbitals was not handled properly
	  when a HGH
	  pseudopotential was used.

2010-07-29 01:30  acastro

	* [r6877] Forgot a & in my last commit.

2010-07-29 07:42  xavier

	* [r6878] Added the boundaries_t object, that contains the data
	  necessary for
	  setting boundary conditions.

2010-07-29 11:01  joseba

	* [r6879] Changed the Poisson solver to let user decide the number
	  of nodes in which has to be executed, as we found that this
	  function is the bottleneck starting from 2-4K nodes

2010-07-29 14:10  marques

	* [r6880] Added reference to Slater's Xalpha method.

2010-07-29 15:38  joseba

	* [r6881] *) Remove the basque comment (sorry, I didn't realize
	  that was there).
	  *) Changed the variables names, so they don't conflict each
	  other.
	  
	  Some other improvements are needed, I'm working in that.
	  
	  Sorry for the wrong indentation in before commit.

2010-07-29 17:40  acastro

	* [r6882] Added the possibility of using a gauge for the vector
	  potential that
	  is periodic in the x direction (when doing 2D calculations).
	  
	  This is a patch submitted by Juho Ojajarvi a couple of months
	  ago.

2010-07-30 07:51  acastro

	* [r6883] Just some name changes.

2010-07-30 13:05  xavier

	* [r6884] Now the matrices for the application of the projectors
	  with OpenCL
	  are stored in a single array.

2010-07-30 13:40  xavier

	* [r6885] This should fix the compilation problem with ifort.

2010-07-30 13:41  xavier

	* [r6886] Now a single buffer is allocated for all OpenCL
	  projectors data.

2010-07-30 14:56  xavier

	* [r6887] Now all projectors are applied by a single opencl kernel.
	  This speeds
	  up the application of the non-local potential by a factor of 10.

2010-07-30 15:10  acastro

	* [r6888] Added a new module to hold an "optimal control state"
	  data type. This
	  is the first step to do optimal control simultaneously for th
	  electrons and nuclei.

2010-07-30 23:00  xavier

	* [r6889] Improved the parallelization of the opencl projectors.

2010-07-31 07:26  xavier

	* [r6890] Restricted the number of threads for the opencl
	  application of the
	  projectors.

2010-07-31 18:22  xavier

	* [r6891] Added operation count for the opencl projector
	  application.

2010-08-02 07:39  xavier

	* [r6892] Added a function to check whether two submeshes overlap.

2010-08-02 07:41  xavier

	* [r6893] Optimized the packing/unpacking of the wave-functions in
	  opencl.

2010-08-02 07:42  xavier

	* [r6894] Added a function that calculates the dot product between
	  two batches.

2010-08-02 07:43  xavier

	* [r6895] Modified the rmmdiis eigensolver to use the new
	  mesh_batch_dotp_vector
	  function.

2010-08-02 12:42  xavier

	* [r6896] Fixed a problem with non-domain parallelization and
	  periodic boundaries.

2010-08-02 20:04  xavier

	* [r6897] * The XC potential for BR89 class of functionals is not
	  set to zero
	  for low density and tau. This fixes the problem with the cusp.
	  The
	  problem for low densities remains.
	  
	  * The solution of the non-linear equation in the BR89 functionals
	  works properly for small positive values.

2010-08-02 23:26  xavier

	* [r6898] * Removed some debugging output.
	  

2010-08-03 16:52  xavier

	* [r6899] Fulvio and I implemented a scheme to correct the tail of
	  the XC
	  potential for MGGAs. What it does is to calculate "XC density":
	  the
	  Laplacian of the XC potential. As this XC density is localized we
	  can
	  set it to zero for small density values. Then re-calculate the XC
	  potential by solving the poisson equation.

2010-08-04 10:29  xavier

	* [r6900] The tail correction can also be applied to the XC
	  potential generated
	  by OEP.

2010-08-06 23:15  xavier

	* [r6901] Fixed compilation with max-dim != 3.
	  x

2010-08-08 08:47  xavier

	* [r6902] Optimized the packing/unpacking of batches.

2010-08-09 06:45  xavier

	* [r6903] Optimized packing/unpacking for the blue gene.

2010-08-10 20:36  dstrubbe

	* [r6904] A clean-up of some variable documentation. I removed the
	  "option" formatting of PoissonSolverNodes since in fact there is
	  not a limited set of options that can be given, but any pisitive
	  integer is acceptable.
	  
	  Joseba, a couple of comments on this variable:
	  1) It looks to me like for PoissonSolverNodes, all values < 1
	  give the same result, despite the documentation, so either the
	  code or the documentation should change.
	  2) Is there a purpose in the -1 (serial_nodes) value? Isn't it
	  equivalent to 1?
	  3) There should be a check that the number does not exceed the
	  total number of nodes.

2010-08-10 21:26  xavier

	* [r6905] Now octopus prints the number of states in each group.

2010-08-10 23:18  dstrubbe

	* [r6906] *) Improvement to documentation formatting.
	  *) Alphabetized module list.
	  *) Replaced a MPI_DOUBLE_PRECISION that should be MPI_FLOAT in
	  case the compilation is in single precision.
	  *) Fixed another place freq_factor was mistakenly dimensioned as
	  MAX_DIM.

2010-08-11 02:27  dstrubbe

	* [r6907] *) Restart density is no longer written for non-SCF
	  Sternheimer calculations, since it is identically zero anyway.
	  *) Removed now useless function kdotp_rho_tag.
	  *) wfs_tag functions now give clues about what the sequence of
	  numbers is -- note that this makes your old restart wfs files
	  incompatible unless you change the directory names.
	  *) Made new function to add sigma to wfs_tag's, using +,- instead
	  of 1,2.
	  *) Alphabetized modules.
	  *) Added delimiter lines.

2010-08-11 02:44  dstrubbe

	* [r6908] Somehow it appears a change in r6874 led to an
	  MPI_Allreduce error in the testsuite, for reasons I cannot
	  fathom, so I am reverting it.

2010-08-11 05:50  dstrubbe

	* [r6909] Fixed format error with PGI compiler.

2010-08-11 20:07  dstrubbe

	* [r6910] Capitalization.

2010-08-11 20:17  dstrubbe

	* [r6911] kdotp now only operates on periodic dimensions, so that
	  it can be used in systems with periodic and finite directions.

2010-08-11 20:25  dstrubbe

	* [r6912] *) wfs output default is now all states, not just the
	  arbitrary value 1-1024.
	  *) Fixed push_sub's.
	  *) Added delimiter lines.
	  *) Formatting, documentation, output.

2010-08-11 20:45  dstrubbe

	* [r6913] A line too long.

2010-08-11 21:22  dstrubbe

	* [r6914] *) Noted that magnetic susceptibility in periodic system
	  is not implemented.
	  *) Some generalization to non-3D cases for em_resp.
	  *) Changed single-letter variables.
	  *) Shortened gr%mesh%sb to gr%sb in some places.

2010-08-11 23:24  dstrubbe

	* [r6915] A more robust way to test. The effective-mass test was
	  failing due to an extra line in the file saying it wasn't
	  converged.

2010-08-11 23:25  dstrubbe

	* [r6916] *) Formatting.
	  *) Added push_sub's.
	  *) Gave a value to ff to suppress a warning about not
	  initializing something intent(out).
	  *) kdotp never has restart_rho.

2010-08-12 17:49  dstrubbe

	* [r6917] *) Removed unnecessary module inclusion.
	  *) Alphabetized modules.
	  *) Formatting.
	  *) Fixed push_sub's.
	  *) Removed unused routine in math, duplicated from utils.

2010-08-12 20:26  dstrubbe

	* [r6918] *) Moved index2axis, output_tensor, and output_dipole to
	  utils_m from io_function_m so they can be used by functions
	  compiled before grid/
	  *) Updated module usages and function names accordingly.
	  *) Changed dependencies accordingly.
	  *) Changed single-letter variables.
	  *) Formatting.
	  *) Removed unneeded module usages of io_function_m.

2010-08-12 20:57  dstrubbe

	* [r6919] *) parser_m has been systematically appearing before
	  mpi_m. Since this has triggered compiler bugs in some cases, I
	  put it in the right place.
	  *) Some other alphabetization.

2010-08-14 01:58  dstrubbe

	* [r6920] *) Generalized kpoint routines for dim != 3. Previously
	  the k-points had dimension MAX_DIM regardless of the dimension
	  actually being used, which caused uninitialized garbage to be
	  written out, and probably even used, in some places. I think
	  there should probably be no place in the code where MAX_DIM is
	  used in a dynamic allocation. In other places, dim = 3 was still
	  assumed.
	  *) kpoint structure and routines now know the number of
	  dimensions.
	  *) Formatting, push_sub's.
	  *) Replaced use of real(..,REAL_PRECISION) with M_ONE etc.
	  *) Tried to clean up use of mysterious variable 'verbose_limit'.

2010-08-14 19:26  dstrubbe

	* [r6921] Accidentally writing garbage out that made files seem
	  like binary and caused some test failures.

2010-08-14 19:43  dstrubbe

	* [r6922] Fixed a write statement to string, since it gave trouble
	  with PGI for some reason.

2010-08-15 05:57  dstrubbe

	* [r6923] *) Improvements to comments.
	  *) Added a ground-state match so we know if it is gs or actually
	  the spin precession at fault when the test fails.

2010-08-15 06:07  dstrubbe

	* [r6924] *) More generalizing output for kpoints with dim != 3
	  *) Only assign to kpoint(1:dim) not whole thing.
	  *) Formatting.

2010-08-15 06:41  dstrubbe

	* [r6925] *) More generalization of output for dim != 3.
	  *) More explicit assignments kpoint(1:dim).
	  *) Changed some gr%mesh%sb to gr%sb for brevity.
	  *) restart/gs/occ file is now read and written without assuming
	  dim = 3.
	  *) Formatting.
	  *) degeneracy_matrix and bands output generalized to dim != 3.

2010-08-16 02:10  dstrubbe

	* [r6926] Maybe this will keep some compilers happy.

2010-08-16 04:24  dstrubbe

	* [r6927] Apparently I was not using the standard Fortran way of
	  i/o implied loops.

2010-08-16 04:38  dstrubbe

	* [r6928] *) A line was too long.
	  *) Other formatting.

2010-08-16 05:43  dstrubbe

	* [r6929] *) Some generalization of FFT and simul_box routines for
	  dim != 3, with warning that for dim > 3 FFT is not implemented .
	  *) Formatting, comments
	  *) Changed single-letter variables.

2010-08-16 06:07  dstrubbe

	* [r6930] Fixing non-standard write statement syntax.

2010-08-16 06:32  dstrubbe

	* [r6931] Another too-long line.

2010-08-16 06:55  dstrubbe

	* [r6932] *) Added filenames of band-structure files to
	  documentation.
	  *) Shortened gr%mesh%sb to gr%sb in a few places.
	  *) Force header prints variable number of dimensions.

2010-08-16 11:01  juho

	* [r6933] PRHG10 2D exchange functional along with optional PRP10
	  exchange correction. See:
	  http://prb.aps.org/abstract/PRB/v76/i23/e235314 and
	  http://prb.aps.org/abstract/PRB/v81/i11/e115108

2010-08-16 11:54  juho

	* [r6934] Corrected the sign of the PRP10 correction

2010-08-16 18:50  dstrubbe

	* [r6935] *) n(3) -> n(MAX_DIM) to fix dim=4 compiler error.
	  *) Alphabetized modules.
	  *) Formatting, comments, documentation.
	  *) Changed single-letter variables.
	  *) Removed unnecessary REAL_PRECISION.

2010-08-17 00:39  dstrubbe

	* [r6936] This ain't C.

2010-08-17 06:27  dstrubbe

	* [r6937] *) Fatal error for magnetic field in dim > 3.
	  *) Changed some gr%mesh%sb to gr%sb.
	  *) Changed single-letter variables.
	  *) Formatting, documentation.
	  *) Coordinates input/output, reciprocal lattice, other simul_box
	  things for dim != 3.
	  *) Removed meaningless 3D coords, spacing, length, offset,
	  kpoints for 1D and 2D tests.

2010-08-17 07:14  juho

	* [r6938] Wrong sign (the equation is solvable down to -1), wrong
	  return value. Returning zero gives us an effective lda
	  approximation. See PRB 76, 235314, page 4.

2010-08-17 17:57  dstrubbe

	* [r6939] *) Made two tests run for MPI as well as serial. There
	  doesn't seem to be any reason they shouldn't be run in parallel.
	  *) Updated Coordinates block to only have the appropriate number
	  of dimensions in these tests.
	  *) Typo.

2010-08-17 18:50  dstrubbe

	* [r6940] A file noting the imaginary part of the frequency used in
	  written in each em_resp/freq* directory now.

2010-08-17 19:43  dstrubbe

	* [r6941] *) More generalization for dim != 3. Angular momentum
	  however remains limited to dim = 2 or 3.
	  *) Single-letter variables, formatting.
	  *) Fixed mismatched variable name in documentation and parser
	  call.

2010-08-18 05:48  dstrubbe

	* [r6942] More changes of Coordinates block in tests to only have
	  the appropriate dimensions.

2010-08-18 19:41  dstrubbe

	* [r6943] *) In some cases a directory was not made before trying
	  to write the hyperpolarizability into it.
	  *) Punctuation.

2010-08-19 19:08  dstrubbe

	* [r6944] If from scratch, a variable was not being initialized.

2010-08-19 19:20  dstrubbe

	* [r6945] *) Corrections and improvements to documentation.
	  *) Corrected push_sub's.

2010-08-19 19:39  mjv500

	* [r6946] fix bug in modelmb: if no particle is symetrized the norm
	  of the wf was not initialized

2010-08-19 21:03  dstrubbe

	* [r6947] *) Fixed and added push_sub's.
	  *) Changed single-letter variables.
	  *) Formatting.

2010-08-19 21:11  dstrubbe

	* [r6948] *) Fixed missing X's in push_sub's.
	  *) Changed single-letter variables.

2010-08-19 21:20  dstrubbe

	* [r6949] *) Missing push_sub X's.
	  *) Single-letter variables.
	  *) Documentation, formatting.

2010-08-19 22:19  dstrubbe

	* [r6950] New form for push_sub/pop_sub. Doing it via a
	  preprocessor macro lets the filename be inseerted automatically,
	  avoiding any discrepancies, and also lets the "X" of the
	  real/complex versions of functions be resolved, so that the debug
	  trace shows which version was called.

2010-08-19 22:43  dstrubbe

	* [r6951] Forgot to update the math directory with new
	  push/pop_sub's.

2010-08-21 11:09  xavier

	* [r6952] The PUSH_SUB/POP_SUB macros now only call the respective
	  functions
	  when in debug mode.

2010-08-22 16:58  xavier

	* [r6953] Removed the unnecessary symmetrization of the subspace
	  hamiltonian.

2010-08-23 08:08  xavier

	* [r6954] Added profiling regions to the dense hermitian
	  eigensolvers.

2010-08-23 10:45  xavier

	* [r6955] An array in partition_build was blowing up the memory for
	  large
	  parallel calculations.

2010-08-24 09:53  xavier

	* [r6956] Some bug fixes in the calculation of the dipole
	  acceleration (by Ali
	  Akbari).

2010-08-24 14:25  xavier

	* [r6957] Bugfix: xsf geometry output did not have the proper
	  offset.

2010-08-24 17:53  xavier

	* [r6958] Fixed the test match for the xsf geometry output.

2010-08-24 23:52  xavier

	* [r6959] Added a function that calculates the total atomic mass of
	  the system.

2010-08-25 00:23  xavier

	* [r6960] Added a utility to generate coordinates for liquids
	  starting from
	  molecular coordinates. It still needs some work, but the basic
	  functionality is there.

2010-08-25 07:46  xavier

	* [r6961] Some too long lines.

2010-08-25 08:32  xavier

	* [r6962] * Now oct-liquid gives a random orientation to the
	  molecules.
	  * All the atoms are force to be inside the cell.

2010-08-25 09:10  xavier

	* [r6963] * Converted geometry_min_distance to a fortran function.
	  * oct-liquid prints the minimum distance between atoms.

2010-08-25 15:35  xavier

	* [r6964] Some improvements in oct-liquid:
	  
	  * It avoids putting molecules too close.
	  * Minimum distance calculation includes periodic copies.
	  * Molecules can be compressed.

2010-08-25 18:52  dstrubbe

	* [r6965] *) Module alphabetization.
	  *) Single-letter variable.
	  *) Formatting.
	  *) Typos.
	  *) Updated program name for liquid utility.

2010-08-26 00:58  dstrubbe

	* [r6966] *) Let's do these tests in parallel too.
	  *) Formatting.

2010-08-26 01:20  dstrubbe

	* [r6967] Oops, semicolons rather than commas are supposed to be
	  used.

2010-08-26 01:50  dstrubbe

	* [r6968] Corrected a long-standing bug in the calculation of
	  hyperpolarizability. In two matrix elements, the imaginary part
	  of the kernel was being thrown away, which prevented beta from
	  ever having an imaginary part. I added a test for Im beta. Re
	  beta changed slightly in the dynamic case with eta != 0, since
	  the imaginary part of the kernel can contribute to that too. Now
	  it is possible to see peak in Im beta for two-photon resonances.

2010-08-26 05:54  dstrubbe

	* [r6969] Evidently there was a good reason these tests were not
	  being done in parallel, since they fail and give warnings.

2010-08-26 06:19  dstrubbe

	* [r6970] *) Enabled calculation of frequencies in non-increasing
	  order. Being able to work in decreasing order too is useful.
	  *) Added notes to documentation.
	  *) Formatting.

2010-08-26 09:12  acastro

	* [r6971] Bug fixe: geometry optimization was broken. The bug only
	  affected
	  systems with non-local components in the pseudopotential, so it
	  was
	  not caught by the test.

2010-08-26 19:10  dstrubbe

	* [r6973] When trying to determine if we are restarting from a
	  density of the exact same frequency in em_resp, we should only
	  look for agreement within the precision to which the numbers of
	  rounded in the filenames.

2010-08-27 23:14  xavier

	* [r6974] The distributed object now prints the number of elements
	  in each partition.

2010-08-28 05:54  dstrubbe

	* [r6975] *) Set ignore property for new utility.
	  *) Removed unnecessary semicolons.

2010-08-29 16:39  xavier

	* [r6976] Some improvements to multicomm_divide_range:
	  
	  * Now it works properly when the number of processors is larger
	  than
	  the number of elements to divide.
	  
	  * The lsize argument is optional.

2010-08-29 17:46  xavier

	* [r6977] Part of the mesh initialization now is done in parallel.

2010-08-30 21:39  dstrubbe

	* [r6978] The mixer object in Sternheimer was being created and
	  destroyed for each calculation, which was unnecessary. Now it is
	  retained between calls to sternheimer_solve, and merely cleared
	  each time.

2010-08-31 00:24  dstrubbe

	* [r6979] Print the maximum absolute-value of force in each
	  direction, to gauge closeness to structural equilibrium.

2010-08-31 00:50  dstrubbe

	* [r6980] *) Write total force too, as a gauge on 'eggbox' errors.
	  *) Fixed a dynamic allocation with MAX_DIM.

2010-08-31 01:11  dstrubbe

	* [r6981] Corrected an error in last two commits.

2010-08-31 04:52  dstrubbe

	* [r6982] A fix to a problem due to ignoring the peculiar
	  dimensionality of magnetic fields.

2010-08-31 11:29  acastro

	* [r6983] Bug fix: the calc_dim global variable was not set in the
	  oct-xyz-anim
	  utility.

2010-08-31 19:29  dstrubbe

	* [r6984] Created a variable to decide whether to calculate
	  rotatory response, off by default. It can take a significant
	  amount of time for big systems, and if they are not chiral, it is
	  identically zero anyway.

2010-08-31 23:51  dstrubbe

	* [r6985] Changed single-letter variable.

2010-09-01 00:12  dstrubbe

	* [r6986] Took out some semicolons.

2010-09-01 06:13  dstrubbe

	* [r6987] A further attempt to fix dimensionality of magnetic
	  moments.

2010-09-02 21:08  dstrubbe

	* [r6988] *) Fixed a run-time error with PGI and check bounds in
	  derivatives_inc.
	  *) Removed variable TDGauge whose only function seemed to be to
	  generate an error.

2010-09-03 05:56  dstrubbe

	* [r6989] *) The cutoff is now printed in Ry as well as eV/Ha since
	  it is often quoted this way for plane-wave codes for historical
	  reasons. It is also now uses the function mesh_gcutoff.
	  *) Simplified two redundant warnings that began with "Warning".
	  *) Added an extra info line when LCAO = none.
	  *) push/pop and formatting.

2010-09-08 05:48  dstrubbe

	* [r6990] *) OEP and KS inversion routines are now only called if
	  necessary.
	  *) Moved use of module xc_functl_m to the module overall rather
	  than specific functions, to conform to our standard.
	  *) Some formatting and single-letter variables.

2010-09-08 16:26  acastro

	* [r6991] Introduced a new variable, IgnoreExternalIons, that
	  permits to ignore
	  the forces and potentials created or received by atoms that are
	  outside the simulation box.
	  
	  The reason is that in some calculations, an atom may leave the
	  simulation box taking away some electrons with it. The electrons
	  do
	  disappear from the calculation, but the nucleus does not, and the
	  system inside the simulation box feels its influence. The user
	  may
	  prefer to have a model in which both positive and negative
	  charges
	  disappear.

2010-09-09 18:31  dstrubbe

	* [r6992] *) Formatting.
	  *) Replaced MAX_DIM with calc_dim in many places to avoid
	  allocation and computation of meaningless vector components.

2010-09-09 19:24  dstrubbe

	* [r6993] Thanks to the magic of preprocessor macros, we can state
	  the actual name of the LAPACK routine in case of error. Some of
	  them were listed wrongly too, and they are now corrected.

2010-09-09 20:29  dstrubbe

	* [r6994] r6991 has the effect of removing the warning that some
	  atoms are outside the box when first setting up the system, which
	  nearly always will indicate an error in setting up the input
	  file. Now a warning will be written when initializing, but not
	  when moving ions at each time step, which I think still satisfies
	  Alberto's intention.

2010-09-10 06:00  dstrubbe

	* [r6995] Fixed misplaced PUSH_SUB.

2010-09-12 07:07  dstrubbe

	* [r6996] The linear-response formalism for magnetic fields
	  implemented in the code is only appropriate in the static case,
	  so dynamical calculations should be blocked.

2010-09-12 07:49  dstrubbe

	* [r6997] Typo.

2010-09-13 03:41  dstrubbe

	* [r6998] *) Uninitialized optional variables were being passed
	  into hamiltonian_apply_batch.
	  *) Formatting.

2010-09-14 19:25  xavier

	* [r6999] A variable sized array is used to generate the list of
	  nodes for the
	  poisson solver.

2010-09-14 21:54  xavier

	* [r7000] Added a check for the new AVX instructions.

2010-09-14 22:47  xavier

	* [r7001] Added support for AVX extensions.

2010-09-14 22:56  dstrubbe

	* [r7002] The derivatives routines were full of calls using
	  optional variables without checking whether they were present,
	  which may cause seg faults or undefined behavior.

2010-09-15 00:45  dstrubbe

	* [r7003] Added push/pop's.

2010-09-15 01:10  dstrubbe

	* [r7004] *) More push/pop.
	  *) Improvements to documentation, output, formatting.

2010-09-15 01:43  dstrubbe

	* [r7005] The push/pop statements have grown long enough to need
	  the long-line treatment.

2010-09-15 02:01  dstrubbe

	* [r7006] *) Apparently the derivatives tests were relying on the
	  mysterious behavior of the routines with unitialized optional
	  variables. Now it is explicit.
	  *) Formatting, single-letter variable.

2010-09-15 02:05  dstrubbe

	* [r7007] Expansion of PUSH/POP with newlines inside a commented
	  routine caused trouble.

2010-09-15 02:20  dstrubbe

	* [r7008] *) A couple more commented PUSH_SUB's being expanded.
	  *) An extra space removed.

2010-09-15 02:36  dstrubbe

	* [r7009] *) A fix for a call to derivatives_grad with a mistaken
	  idea of the default for ghost_udpate.
	  *) Killed some more commented PUSH/POP's.
	  *) Formatting.

2010-09-15 07:18  dstrubbe

	* [r7010] Undid earlier changes regarding optional arguments to
	  derivatives routines that broke much of the code. It seems the
	  code only works because of compilers initializing undefined
	  logicals to .false., rather than passing along the
	  presence/absence of the arguments. This tangle of optionals will
	  have to be sorted out more carefully than I did, so I am putting
	  it back as it was.

2010-09-15 08:32  juho

	* [r7011] I noticed a bad memory leak in Octopus when running OCT
	  calculations. This was confirmed and pinpointed by a Valgrind run
	  to be in states.F90 . It was due to block-related datatypes
	  inside states_t not being freed even after states_end.

2010-09-15 17:56  dstrubbe

	* [r7012] *) More PUSH_SUB's.
	  *) Improvements to documentation and formatting.

2010-09-19 13:43  xavier

	* [r7013] Removed the calc_dim global variable. Added a space_t
	  object that
	  contains the dimensions of space.

2010-09-19 13:55  xavier

	* [r7014] Removed a file that was not being compiled.

2010-09-19 16:59  xavier

	* [r7015] Fixed deallocation of the poisson_isf communicator.

2010-09-20 05:07  xavier

	* [r7016] When not all nodes are used for the poisson solver, we
	  need to copy
	  the potential to the root of all partitions.

2010-09-21 21:18  dstrubbe

	* [r7017] It is possible to have a compiler that supports AVX but
	  not be running on hardware that supports AVX. Now it can be
	  explicitly turned off, while still using SSE2, via --disable-avx.

2010-09-21 22:02  xavier

	* [r7018] The calculation of ion-ion interaction was around 300
	  times slower due
	  to the check for atoms outside the box. This is an optimized
	  version
	  that restores the original performance.

2010-09-22 00:02  dstrubbe

	* [r7019] *) Now the configure script checks that the hardware
	  actually supports AVX instructions.
	  *) Removed some unnecessary semicolons.

2010-09-22 02:31  dstrubbe

	* [r7020] *) Missing syntax highlight block.
	  *) Subroutine separators.

2010-09-22 07:09  dstrubbe

	* [r7021] Fixed an array out-of-bounds access that could occur for
	  large numbers of processors.

2010-09-28 16:34  micael

	* [r7022] The exchange potential of the Becke-Johnson MGGA type
	  should be zero if the density is zero in order to avoid getting
	  some NaN.

2010-10-05 12:42  marques

	* [r7023] Added a new functional: a reparemetrization of PW86 to be
	  used in vdW calculations.

2010-10-06 02:25  dstrubbe

	* [r7024] Standardizing spelling so the subsection of the variable
	  documentation all appears together.

2010-10-07 04:53  dstrubbe

	* [r7025] Suppress warning about lack of SCF convergence when doing
	  zero iterations.

2010-10-11 13:42  helbig

	* [r7026] fixed some dimensionality problems when compiling
	  with-max-dim=4

2010-10-11 22:47  dstrubbe

	* [r7027] Recent changes to use dim instead of MAX_DIM in fftw3 did
	  not take into account the fact that n(1),n(2),n(3) are used in
	  many other parts of the file, and so all must be initialized,
	  regardless of system dimensionality. This should fix the test
	  failures.

2010-10-12 09:59  fulvio

	* [r7028] A spin index in the XC density was missing

2010-10-14 12:27  marques

	* [r7029] Added two new functionals, Keal and Tozer version 1 and
	  2.

2010-10-14 14:14  marques

	* [r7030] Added the Thomas-Fermi functional for the kinetic energy
	  density.

2010-10-14 14:19  marques

	* [r7031] Updated the citations. Thanks Tobias!

2010-10-14 15:10  marques

	* [r7032] Added the second-order gradient expansion of the kinetic
	  energy functional.

2010-10-14 22:12  dstrubbe

	* [r7033] SAFE_DEALLOCATE_P automatically nullifies pointers, so we
	  don't need to do so explicitly after the call.

2010-10-18 14:40  marques

	* [r7034] Now the 1D CSC for beta=1 has a spin dependence

2010-10-19 06:53  sakko

	* [r7035] Some changes in writing the output of S(q, omega)
	  calculation.

2010-10-19 08:44  marques

	* [r7036] Fixed the test of the 1D LDA. As now there is spin for
	  beta=1, the results of the test had to be changed.
	  Compilation is now OK with gfortran

2010-10-19 14:08  marques

	* [r7037] This fixes the crashes. Arto, the problem was in the
	  FTCHD output, that is being done always!!! Can you fix this? And,
	  BTW, what is FTCHD?

2010-10-19 22:20  dstrubbe

	* [r7038] *) Added push/pop's to lookup and sb_lookup_init.
	  *) The 'xx' variable in simul_box_in_box(_vec) is now of size
	  sb%dim, not MAX_DIM.

2010-10-20 06:59  dstrubbe

	* [r7039] Added missing dependency.

2010-10-20 19:11  fulvio

	* [r7040] Improved some comments

2010-10-20 20:19  dstrubbe

	* [r7041] Added some missing rules and dependencies in libxc.
	  Running a parallel make failed miserably before this, although
	  evidently it just happened to work anyway in serial. Something is
	  still not perfect since I get these warnings after "make -j
	  install":
	  Makefile:817: warning: overriding commands for target
	  `xc_f90_lib_m.mod'
	  Makefile:811: warning: ignoring old commands for target
	  `xc_f90_lib_m.mod'
	  Makefile:817: warning: overriding commands for target
	  `xc_f90_types_m.mod'
	  Makefile:811: warning: ignoring old commands for target
	  `xc_f90_types_m.mod'

2010-10-24 05:06  dstrubbe

	* [r7042] The working directories were not removed as stipulated by
	  the arguments passed to the testsuite Perl script in certain
	  cases, such as a disabled test.

2010-10-25 11:13  marques

	* [r7043] Bug fix: rge2 was not working.

2010-10-25 11:37  marques

	* [r7044] Bug fix: KT1 and KT2 were completely wrong.

2010-10-25 12:04  marques

	* [r7045] Becke functionals should not divide by zero when the
	  density is zero ;)

2010-10-25 13:15  marques

	* [r7046] Should not divide by zero in P86

2010-10-25 15:00  juho

	* [r7047] *) Fixed wrong datatypes.

2010-10-25 16:52  micael

	* [r7048] TPSS correlation is not an exchange functional ;)

2010-10-25 18:29  dstrubbe

	* [r7049] A correction to my r7041: now the right modules are
	  associated in the single/double precision cases. This solves the
	  warnings about redefining a rule for these targets.

2010-10-27 05:27  dstrubbe

	* [r7050] After much effort, I discovered that PGI compilers after
	  version 10.3 do some optimization on this file which causes
	  segmentation faults in many of the tests. By putting this pragma
	  in the file, the optimization level is set to -O0 for PGI
	  compilers, regardless of what may be specified on the command
	  line. It will just be a comment to other compilers.

2010-10-27 18:21  dstrubbe

	* [r7051] *) The test failures of SIC are distracting, so I have
	  disabled the test.
	  *) SIC is now labelled development-version only.

2010-10-27 19:04  dstrubbe

	* [r7052] Some clarifying comments about the PGI pragma. I think it
	  is a compiler bug that requires this workaround anyway.

2010-10-29 08:25  

	* [r7054] test

2010-10-29 08:55  marques

	* [r7055] test

2010-10-29 20:55  marques

	* [r7056] test

2010-10-30 06:40  dstrubbe

	* [r7057] A bugfix to the testsuite script: if the match command
	  returned nothing, e.g. because the program crashed and the output
	  file doesn't exist, the calculated value is taken as zero. This
	  behavior could lead to tests passing when the reference is
	  consistent with zero, as is the case for the Hartree component
	  tests. Now it will fail correctly instead.

2010-11-01 02:01  xavier

	* [r7059] Single line foralls must not use continuation marks.

2010-11-01 03:32  xavier

	* [r7060] Fixed a strange bug in the default value of the spacing
	  with g95.

2010-11-01 03:53  xavier

	* [r7061] Fixed a memory leak in the projectors.

2010-11-01 04:28  xavier

	* [r7062] Fixed a memory leak in the phases of the projectors.

2010-11-01 07:29  acastro

	* [r7063] Fixed a bug that affected time-dependent targets in
	  optimal control
	  runs.

2010-11-01 19:34  xavier

	* [r7064] Fixed cell volume calculation for dim > 3.

2010-11-02 10:37  acastro

	* [r7065] The options of the OutputMatrixElements variable did not
	  match weill
	  with what the code really did. Also, there was a small bug that
	  prevented the writing of the dipole matrix elements.

2010-11-02 19:12  olivares

	* [r7066] changes to electrostatic boundary condition calculations,
	  including the consideration of an ion with the metallic plates
	  and discounting from the self interaction error

2010-11-02 19:24  olivares

	* [r7067] Had to correct the safe_allocate_A calls that sometimes
	  certain compilers go crazy about when commented

2010-11-02 20:14  dstrubbe

	* [r7068] Please use the new style for PUSH_SUB and POP_SUB.

2010-11-02 20:15  dstrubbe

	* [r7069] *) Formatting of code and documentation.
	  *) Made some array references explicit.

2010-11-02 20:18  dstrubbe

	* [r7070] Reverted a file accidentally committed.

2010-11-03 12:18  fulvio

	* [r7071] Added and corrected some comments

2010-11-03 12:47  fulvio

	* [r7072] Modified the XC tail correction

2010-11-07 18:47  xavier

	* [r7073] Sometimes the subroutine name can be truncated in the
	  stack. If this
	  happened, verification would fail.

2010-11-07 20:21  xavier

	* [r7074] Removed the self-connection from the graph passed to
	  metis for grid
	  partitiiong. There wasn't a reason for it to be there and it
	  seems
	  that this improves the results.

2010-11-07 22:18  xavier

	* [r7075] Some more small fixes to grid partitioning.

2010-11-08 01:04  xavier

	* [r7076] Improved the output for opencl.

2010-11-08 02:46  xavier

	* [r7077] Divided the opencl initialization function.

2010-11-08 02:56  xavier

	* [r7078] Changes to some files missing in my previous commit.

2010-11-09 20:51  mjv500

	* [r7079] sample file had not been updated for new option names in
	  LCAO

2010-11-10 04:47  xavier

	* [r7080] Started the implementation of domain parallelization with
	  OpenCL.

2010-11-11 02:31  xavier

	* [r7081] The opencl projectors work with domain parallelization.

2010-11-11 06:22  xavier

	* [r7082] Now domain parallelization works with OpenCL.

2010-11-11 11:06  joseba

	* [r7083] Changed documentation to improve Doxygen generation. It
	  would be good if someone could improve the documentation of
	  batch.F90, as it's almost empty

2010-11-11 17:20  xavier

	* [r7084] * Bugfix: when only local pseudopotentials were used,
	  Octopus assumed
	  there was a non-local part.
	  
	  * A bit of code reorganization.

2010-11-12 10:53  acastro

	* [r7085] Added an interface to the numerical derivatives function
	  in GSL.

2010-11-15 05:45  acastro

	* [r7086] o Corrected a little bug in tdfunction.F90, regarding the
	  calculation
	  of Fourier transforms. This causes little changes in the results
	  of
	  optimal control tests, so I had to change some of them. The
	  accuracy
	  of OCT calculations improves with this change.
	  
	  o Now the numerical calculation of the gradient in OCT
	  calculations is
	  done with the GSL derivation function, which gives almost
	  numerical
	  accuracy.

2010-11-15 07:06  dstrubbe

	* [r7087] Fixed a few little language issues.

2010-11-17 08:06  dstrubbe

	* [r7088] The return value from the testsuite should indicate a
	  failure when all tests are skipped.

2010-11-17 21:36  acastro

	* [r7089] The oct-xyz-anim utility was broken because the new
	  "space_t" data
	  object was not initialized.

2010-11-20 01:20  xavier

	* [r7090] Removed some unnecessary global barriers.

2010-11-20 02:40  xavier

	* [r7091] It seems one barrier is needed.

2010-11-22 07:13  dstrubbe

	* [r7092] *) Consolidated some common lines between if/else
	  branches.
	  *) Now, a nonzero exit code from the executable does not cause
	  the matches to fail, but adds one to the number of failures. This
	  seems like a more informative way to handle the situation.
	  *) Typo.

2010-11-23 20:27  dstrubbe

	* [r7093] The testsuite Perl script now says what it was trying to
	  open if it cannot open the test file.

2010-11-25 14:23  umberto

	* [r7094] added interface for 3D array binay IO

2010-11-25 14:48  umberto

	* [r7095] Photoelectron part revised. This part is still under
	  development.

2010-11-25 15:43  umberto

	* [r7096] Removed useless DISABLE_PES macro

2010-11-25 16:55  acastro

	* [r7097] Improved the accuracy of the OCT calculations with
	  time-dependent
	  targets.

2010-11-25 23:02  xavier

	* [r7098] Improved initialization of OpenCL

2010-11-26 06:44  xavier

	* [r7099] Octopus now prints information about the available OpenCL
	  platforms. The platform can be selected by OpenCLPlatform.

2010-11-26 07:36  xavier

	* [r7100] Now octopus lists all opencl devices available in the
	  selected platform.

2010-11-26 17:02  xavier

	* [r7101] Some CL kernels were not released.

2010-11-27 18:36  acastro

	* [r7102] QOCT local time-dependent targets were not working
	  properly with
	  many-electron systems.

2010-11-28 22:40  dstrubbe

	* [r7103] The testsuite Perl script is now compatible with some
	  regressive MPI implementations that require supplying a machine
	  file to mpirun.

2010-11-29 01:11  dstrubbe

	* [r7104] Fixes to comment lines containing apostrophes which
	  generate cpp warnings.

2010-11-29 01:57  dstrubbe

	* [r7105] Changed two more apostrophes.

2010-11-29 19:45  dstrubbe

	* [r7106] Rewrote documentation line to avoid unterminated "
	  warnings from cpp.

2010-11-30 00:18  xavier

	* [r7107] * Updated to the last version of Zoltan.
	  * Zoltan now uses its own configure.ac.

2010-11-30 00:28  xavier

	* [r7108] One file was missing from my previous commit.

2010-11-30 02:52  xavier

	* [r7109] Octopus can now use an external installation of Zoltan.
	  
	  (In Debian/Ubuntu,, Zoltan comes in the libtrilinos-dev package).

2010-11-30 03:57  xavier

	* [r7110] This should fix compilation problems.

2010-11-30 04:35  xavier

	* [r7111] * Zoltan is now configured always. This is necessary for
	  "make dist"
	  to work.

2010-11-30 05:22  xavier

	* [r7112] Reverted all zoltan changes (from [7107] to [7111]). It
	  is tricky to
	  use the zoltan package since it has some problems:
	  
	  * It depends on C++ and Octopus doesn't.
	  * "make dist" is broken.
	  * It cannot be compiled without VPATHs.

2010-12-01 02:53  xavier

	* [r7113] Octopus now can use an external version of Zoltan.

2010-12-01 03:13  xavier

	* [r7114] Bugfix: A cl object was deallocated with cl disabled.

2010-12-01 04:49  dstrubbe

	* [r7115] *) Removed some semicolons.
	  *) Rewrote a part with a vile 'goto'.

2010-12-01 06:06  dstrubbe

	* [r7116] Most instances of 'use mpi_debug_m' were not necessary.

2010-12-01 06:18  dstrubbe

	* [r7117] *) Rewrote gdlib macro to avoid defining anything at all
	  if the test program fails to link. Otherwise GD_CFLAGS etc. would
	  still end up used for linking the code.
	  *) Removed an obsolete comment.

2010-12-01 21:26  dstrubbe

	* [r7118] The discretization lines in output now explain more about
	  what they are doing.

2010-12-03 08:41  dstrubbe

	* [r7119] *) Fixed failing dim4 gygi test that was due to
	  inappropriate use of MAX_DIM instead of sb%dim in
	  species_get_local, causing NaN's.
	  *) Removed semicolons.
	  *) Added separator lines.
	  *) Removed duplicated \warning.
	  *) Fixed indentation.
	  *) Removed spurious apostrophe causing cpp warning.

2010-12-03 09:12  dstrubbe

	* [r7120] More replacements of MAX_DIM with the actual dimension.

2010-12-03 19:51  dstrubbe

	* [r7121] Rooting out some more goto's, which are considered
	  harmful.

2010-12-04 06:54  dstrubbe

	* [r7122] XSF output of wavefunctions was only writing the real
	  part. Now for complex quantities the real and imaginary parts are
	  written separately. XCrySDen cannot handle complex fields in a
	  file.
	  
	  Cube output is also only the real part, so the analogous change
	  ought to be made for that part of the code too.

2010-12-04 08:56  dstrubbe

	* [r7123] Some code-cleaning.

2010-12-04 09:16  dstrubbe

	* [r7124] Rewrote some loops in archaic style.

2010-12-04 16:57  xavier

	* [r7125] Now CL local memory requests check that they fit in local
	  memory.

2010-12-04 21:34  xavier

	* [r7126] Types are now represented by a derived datatype instead
	  of an integer.

2010-12-04 22:13  xavier

	* [r7127] Fixed an error in my last commit.

2010-12-05 08:21  dstrubbe

	* [r7128] Got rid of some goto's and implicit's.

2010-12-05 20:57  dstrubbe

	* [r7129] More syntax modernization.

2010-12-05 22:09  xavier

	* [r7130] Replaced some multiplications by shifts in CL code

2010-12-06 08:14  dstrubbe

	* [r7131] Removed another goto.

2010-12-06 08:30  dstrubbe

	* [r7132] Another goto turned into a loop.

2010-12-06 20:11  dstrubbe

	* [r7133] Yet another goto turned into a loop.

2010-12-06 21:25  dstrubbe

	* [r7134] Enforcing our indentation style.

2010-12-06 21:56  dstrubbe

	* [r7135] Some indenting and intenting.

2010-12-07 02:15  dstrubbe

	* [r7136] Intent's, argument ordering, correction to documentation.

2010-12-07 02:58  dstrubbe

	* [r7137] More formatting and intent's, and sending a warning to
	  std error.

2010-12-07 03:41  dstrubbe

	* [r7138] File is now fully intent'ed. Corrected documentation.

2010-12-07 12:52  micael

	* [r7139] Periodicity is now taken into account when using
	  non-linear core corrections.

2010-12-07 15:28  acastro

	* [r7140] Added a call to "epot_precalc_local_potential" to speed
	  up certain
	  kind of QOCT calculations.

2010-12-07 15:39  mjv500

	* [r7141] fixed bug in reciprocal lattice volume calculation for n
	  .gt. 3

2010-12-07 16:34  acastro

	* [r7142] Fixed a memory leak.

2010-12-07 20:32  dstrubbe

	* [r7143] The last of the goto's are banished.

2010-12-08 02:37  dstrubbe

	* [r7144] For the purposes of the linear solver, the terminology
	  "omega" is confusing, since in all actual calls to solve_HXeY
	  (from Sternheimer and OEP) "omega" = -eigenvalue + frequency, not
	  "omega" = frequency, as you might expect. I have renamed it to
	  "shift", and added some clarifying comments.

2010-12-08 04:19  dstrubbe

	* [r7145] Some corrections for smearing in the dynamical case.

2010-12-08 08:56  sakko

	* [r7146] Now oct-propagation-spectrum can calculate also the
	  dynamic structure factor using ftchd.cos and ftchd.sin (Fourier
	  Transformed CHarge Density). The default mode is still the
	  absorption spectrum.

2010-12-08 13:40  marques

	* [r7147] Bug fix. Thanks to Gian-Marco Rignanese for this!

2010-12-08 16:17  xavier

	* [r7148] OpenCL is used even for size one blocks.

2010-12-08 16:22  xavier

	* [r7149] A function name was too long.

2010-12-08 16:51  xavier

	* [r7150] Workgroup size can be too large.

2010-12-08 17:50  xavier

	* [r7151] Now Octopus OpenCL implementation is compatible with
	  AMD/ATI GPUs.

2010-12-08 19:49  dstrubbe

	* [r7152] *) Fixed problem causing compilation failures: in
	  standard Fortran, the function is 'cmplx' not 'complex'. But an
	  exponential seems nicer anyway.
	  *) Added push/pop_sub's and separators.
	  *) A little improvement to documentation.

2010-12-08 21:41  dstrubbe

	* [r7153] Set Sternheimer with arbitrary occupations to devel
	  version pending rigorous testing.

2010-12-09 08:21  joseba

	* [r7154] fixed the interface /= to call types_not_equal function
	  instead of types_equal

2010-12-09 23:22  acastro

	* [r7155] I added a test for the option of using a target defined
	  in terms of
	  the velocities, in the optimal control directory.

2010-12-10 12:09  acastro

	* [r7156] Removed some unnecessary restrictions for some OCT input
	  file option.

2010-12-10 21:45  xavier

	* [r7157] A hack to avoid name clashes with other codes that use
	  bison.

2010-12-10 22:06  acastro

	* [r7158] Removed an unncessary constraint on the options of one
	  OCT input
	  variable.

2010-12-11 14:34  acastro

	* [r7159] Simplified some parts of the QOCT code (the
	  transformations of
	  coordinates when the constrained Fourier series is used to
	  represent
	  the control functions).

2010-12-11 17:12  xavier

	* [r7160] Now the workgroup size for the finite difference operator
	  is set so
	  the required shared memory fits in the card.

2010-12-11 17:17  xavier

	* [r7161] The second part of projectors is now applied
	  simultaneously.

2010-12-12 04:33  xavier

	* [r7162] Copying back the pseudo-potentials results to the
	  orbitals it is done
	  simultaneously for all projectors.

2010-12-12 07:04  dstrubbe

	* [r7163] While I try to purge goto's from the old code, new ones
	  arise...

2010-12-12 08:02  dstrubbe

	* [r7164] Refined condition for lack of first-order density
	  response of magnetic perturbation.

2010-12-12 08:05  dstrubbe

	* [r7165] I think this kills off the last of the goto's.

2010-12-12 20:33  acastro

	* [r7166] Removed the diagonalization, by LAPACK, of one matrix
	  used in some
	  coordinate transformation in the QOCT code. Instead, the
	  eigenvectors
	  and eigenvalues are explicitly defined, because they can be
	  computed
	  analytically.

2010-12-12 21:24  xavier

	* [r7167] Some small improvements in the CL code.

2010-12-13 00:37  xavier

	* [r7168] Added some matches for energy components to some tests.

2010-12-13 02:13  xavier

	* [r7169] Fixed a bug in the application of the projectors with CL.

2010-12-13 03:31  xavier

	* [r7170] Added an common interface for the calculate_eigenvalues
	  function (real
	  and complex).

2010-12-13 06:45  dstrubbe

	* [r7171] PUSH and POP.

2010-12-14 09:54  marques

	* [r7172] BUG fixes:
	  *) Fxc was missing from AM05 flags (thanks to Gian-Marco
	  Rignanese)
	  *) Vxc was wrong for x TPSS. Now I get exactly the same results
	  as GPAW

2010-12-15 01:43  xavier

	* [r7173] The AETRS and CAETS propagators now calculate the new
	  density.

2010-12-15 02:47  xavier

	* [r7174] Added a batch_sync function, it copies the packed content
	  to the batch.

2010-12-15 03:42  xavier

	* [r7175] * Now the density can be calculated with packed states.
	  * The AETRS/CAETRS propagators calculated the density from packed
	  states.

2010-12-15 14:32  acastro

	* [r7176] Removed an out of bounds bug that caused a test to fail.
	  However, the test
	  keeps failing due to other more complicated reasons, so I have
	  removed it
	  from the execution list until I figure out how to solve the
	  problem.

2010-12-15 15:39  marques

	* [r7177] First steps at the second derivatives of the meta-GGAs.
	  Several things are already OK for the tpss (exchange) but there
	  are still some terms missing.

2010-12-15 16:14  xavier

	* [r7178] Removed the states_dens_accumulate function, only the
	  batch version
	  remains.

2010-12-15 16:19  marques

	* [r7179] The rest of the derivatives are there. I will test it
	  more thoroughly tomorrow, and finish to change the interface to
	  include also the derivatives of the laplacian of rho.

2010-12-15 16:49  xavier

	* [r7180] Moved some density-related functions from states_m to the
	  new
	  density_m module.

2010-12-15 17:19  xavier

	* [r7181] Another new module with functions from states_m:
	  states_io_m.

2010-12-15 18:28  xavier

	* [r7182] * The calculation of the density by blocks is now
	  associated with an object.
	  * The states_calc_density function is now called density_calc,
	  the
	  density array must be passed explicitly.
	  * Removed a single quote from a comment.

2010-12-15 19:28  dstrubbe

	* [r7183] states_m and its descendants had 'use mpi_m' twice.

2010-12-15 22:08  dstrubbe

	* [r7184] Fixed two mistakes in m4.

2010-12-15 22:17  xavier

	* [r7185] The weight in the calculation of the density is now
	  precalculated,
	  this makes the code cleaner.

2010-12-15 22:20  dstrubbe

	* [r7186] Fixed macro typo.

2010-12-16 00:14  xavier

	* [r7187] Now the density can be calculated using OpenCL.

2010-12-16 10:49  joseba

	* [r7188] Added capability to compile with BLACS/SCALAPACK. To use
	  it ./configure --with-blacs --with-scalapack. To insert
	  BLACS/SCALAPACK code use the HAVE_SCALAPACK flag.

2010-12-16 13:47  marques

	* [r7189] Finished the interface for the fxcs in the meta-ggas.
	  Moreover, I think now that the TPSS exchange fxc is correct.

2010-12-16 14:01  marques

	* [r7190] Had a misplaced ';'

2010-12-16 18:14  xavier

	* [r7191] Added a test for orthogonalization routines.

2010-12-16 18:38  xavier

	* [r7192] Added a test for Gram-Schmidt orthogonalization.

2010-12-16 19:00  xavier

	* [r7193] * Fixed a bug in mgs orthogonalization.
	  * Added a test for mgs.

2010-12-16 19:53  dstrubbe

	* [r7194] * Added PUSH_SUB's.
	  * Corrected variable documentation.

2010-12-16 21:09  xavier

	* [r7195] Now the orthogonalization test also works with states
	  parallelization.

2010-12-17 07:51  dstrubbe

	* [r7196] Improvements to documentation.

2010-12-17 08:34  dstrubbe

	* [r7197] Removed unused variable and added missing deallocation.

2010-12-17 16:33  xavier

	* [r7198] * Bugfix: The wrong work array size was passed to the QR
	  routine.
	  * Added a test for the QR orthogonalization.

2010-12-17 20:10  dstrubbe

	* [r7199] * Fixed my still mistaken fix to gdlib.m4...
	  * hamiltonian_update now takes states as an argument, which will
	  shortly be needed for electric fields in periodic systems.
	  * Formatting.

2010-12-17 23:58  dstrubbe

	* [r7200] Conversion of MAX_DIM to sb%dim in some places.

2010-12-18 00:20  dstrubbe

	* [r7201] More use of the actual dimension of the calculation.

2010-12-18 01:31  dstrubbe

	* [r7202] Implementation of the Hamiltonian for coupling of
	  polarization to electric field in a periodic system, via the
	  single-point Berry's phase which is valid for large supercells.

2010-12-18 02:35  dstrubbe

	* [r7203] Improvement to calculation of the effective potential for
	  the electric enthalpy.

2010-12-19 00:16  dstrubbe

	* [r7204] Bugfix in reorganization of Berry-phase determinant: an
	  exponentiation rather than a multiplication was needed.

2010-12-19 09:04  dstrubbe

	* [r7205] Reorganized Berry-phase potential as requested by Xavier,
	  so that it is calculated in v_ks_calc, stored in hm, and then
	  added in hamiltonian_update, as with other potentials. It is not
	  a self-induced or Hartree potential though, because it describes
	  interaction with an external field rather than within the system,
	  so it is its own separate thing.

2010-12-19 18:19  acastro

	* [r7206] Removed one unnecessary function, and changed a little
	  the
	  transformation of cartesian to hyperspherical coordinates.

2010-12-19 19:44  acastro

	* [r7207] A little bug fix in the optimal control part, and a
	  change in the
	  tolerance threshold for the linear solver of the Crank-Nicholson
	  td
	  propagator.

2010-12-20 02:01  dstrubbe

	* [r7208] Some fixes for Berry potential.

2010-12-20 06:26  dstrubbe

	* [r7209] * Clarified documentation and warnings about single-point
	  Berry phase.
	  * Application of electric field in finite system had the wrong
	  sign (static_pol.F90 had it right though).

2010-12-20 20:30  dstrubbe

	* [r7210] hamiltonian_update no longer takes st as an argument.

2010-12-20 20:40  dstrubbe

	* [r7211] * The eigenvalues are summed for all theory levels so I
	  pulled it out of the select statement.
	  * Fixed typo.

2010-12-20 21:18  dstrubbe

	* [r7212] Since the appropriate term in the total energy (or
	  electric enthalpy) for a periodic system under applied electric
	  field is not the expectation value of the corresponding
	  potential, a correction term must be calculated.

2010-12-20 22:49  dstrubbe

	* [r7213] * I accidentally had been multiplying rather than
	  dividing by the determinant in the Berry potential.
	  * When doing LCAO to set up the Hamiltonian, there are no
	  wavefunctions yet, so we must just set the Berry potential to
	  zero.
	  * Added a condition to prevent division by zero: det = 0 is
	  physically unreasonable so we should never get there unless there
	  are bugs.

2010-12-20 23:55  dstrubbe

	* [r7214] Reorganized Berry-phase-related things into a new module.

2010-12-21 01:54  dstrubbe

	* [r7215] Rationalized names.

2011-01-01 17:05  xavier

	* [r7216] Decreased the precision of the orthogonalization tests.

2011-01-02 04:53  xavier

	* [r7217] By default libxc is now compiled statically. This will
	  probably save a
	  lot of problems for users (and for us).

2011-01-02 17:27  xavier

	* [r7218] Fixed the calculation of forces for max_dim=4.

2011-01-03 01:18  xavier

	* [r7219] Some cleaning and fixes for max-dim=4.

2011-01-03 21:53  xavier

	* [r7220] Multicomm_init now receives the communicator as argument
	  instead of
	  using mpi_world.

2011-01-03 22:51  xavier

	* [r7221] Moved the topology object to its own module.

2011-01-03 23:45  xavier

	* [r7222] I started adding the infrastructure for task
	  parallelisation. For the
	  moment only added a new variable not connected to anything.

2011-01-03 23:51  xavier

	* [r7223] Removed the UseTopology functionality. It was nice but
	  makes the code
	  more complicated. I will keep the topology module for the moment,
	  I
	  think it will be useful for OpenCL.

2011-01-04 04:41  xavier

	* [r7224] Now some nodes can be defined as "slaves". For the moment
	  they don't
	  do anything, while master nodes run the calculation.

2011-01-04 15:54  xavier

	* [r7225] * Added a non-blocking interface for the calculation of
	  the KS potential.

2011-01-05 00:15  xavier

	* [r7226] The self-consistency in TD propagation is now controlled
	  by the
	  TDSelfConsistentSteps variable.

2011-01-05 01:24  xavier

	* [r7227] Now Octopus print the number of self-consistency steps in
	  the output.

2011-01-05 01:37  xavier

	* [r7228] The self-consistency steps where counted wrong before, so
	  only 2 were
	  applied instead of 3. So I had to update the results for one
	  test.

2011-01-05 04:23  xavier

	* [r7229] More reorganization of the kohn-sham potential
	  calculation.

2011-01-05 04:45  xavier

	* [r7230] The v_hartree function is no longer public. The one-shot
	  mode uses
	  v_ks_calc instead.

2011-01-07 19:40  xavier

	* [r7231] Added a communicator for states/kpoints combined.

2011-01-07 20:43  xavier

	* [r7232] Some routines passed the hm argument as intent(inout)
	  when intent(in)
	  is enough.

2011-01-07 21:03  xavier

	* [r7233] * More modifications to the calculation of the KS
	  potential to make it
	  asynchronous.
	  * Simplified the allocation of the magnetic field.

2011-01-07 21:52  xavier

	* [r7234] * Moved the energy values from hamiltonian_t to a
	  separated object.

2011-01-07 22:11  xavier

	* [r7235] Using pointer tricks, the energies can be calculated in
	  v_ks_calc_start
	  without changing the hamiltonian until v_ks_calc_finish.

2011-01-07 23:01  xavier

	* [r7236] * Now the HF states are also changed in v_ks_calc_finish
	  (more pointer
	  tricks).
	  
	  * Bugfix: Calling states_end on a states_t that was nullified
	  could
	  cause segmentation fault.

2011-01-08 04:33  xavier

	* [r7237] Fixes a bug in my previous commit. The old energy values
	  need to be copied.

2011-01-08 16:31  xavier

	* [r7238] The vxc potential is now set by v_ks_calc_finish.

2011-01-08 21:33  xavier

	* [r7239] Removed the redundant calculation of the xc energy in the
	  one-shot mode.

2011-01-08 22:30  xavier

	* [r7240] The other XC potentials, vtau and axc, are now set by
	  v_ks_calc_finish.

2011-01-09 00:12  xavier

	* [r7241] Now v_ks_calc_start does not modify the hamiltonian. All
	  changes are
	  made by v_ks_calc_finish.
	  
	  David, I am not sure that the vberry part is working if it is not
	  checked by the tests.

2011-01-09 03:23  xavier

	* [r7242] Renamed the DevelVersion variable to
	  ExperimentalFeatures. This should
	  avoid confusion with the development version of Octopus.

2011-01-09 05:23  xavier

	* [r7243] The CAETRS propagator now is compatible with task
	  parallelization.

2011-01-10 12:12  joseba

	* [r7244] A line was too long

2011-01-10 18:41  xavier

	* [r7245] The xc_ks_inversion_calc has a confusing interface, it
	  received a vxc
	  argument but actually set the vxc inside hm. Now it uses the vxc
	  argument. This should fix the problem with ifort.

2011-01-10 18:54  xavier

	* [r7246] * Renamed TDSelfConsistentSteps to
	  TDStepsWithSelfConsistency.
	  * Improved the variable description.
	  
	  I hope this makes things easier to understand.

2011-01-10 20:05  dstrubbe

	* [r7247] * Added PUSH_SUB's.
	  * Corrected typo.

2011-01-10 21:38  xavier

	* [r7248] Creation of intercommunicators for sending messages to
	  slaves.

2011-01-10 21:39  dstrubbe

	* [r7249] Updated terminology of development version to
	  experimental in some places in the variable documentation.

2011-01-10 21:53  xavier

	* [r7250] The sanity checks take into account slaves.

2011-01-10 22:01  xavier

	* [r7251] Fixed serial compilation.

2011-01-10 22:50  xavier

	* [r7252] Slaves now enter a loop and wait for work.

2011-01-11 00:03  xavier

	* [r7253] Serial compilation was broken again, sorry.

2011-01-11 01:43  xavier

	* [r7254] Communicators are now properly deallocated.

2011-01-11 01:50  dstrubbe

	* [r7255] A type was not declared public, causing PGI compilation
	  failure.

2011-01-11 03:53  xavier

	* [r7256] The poisson_solver initialization receives the
	  communicator for
	  all_nodes as argument.

2011-01-11 04:16  xavier

	* [r7257] Moved the data of the isf solver to an object.

2011-01-11 15:26  xavier

	* [r7258] * Bugfix: A dangling pointer was deallocated by the
	  poisson_isf solver.
	  * Capitalised the names of some constants.

2011-01-11 16:52  xavier

	* [r7259] Removed some global barriers from restart functions. I
	  don't think
	  this barriers are really needed and they may cause deadlocks.

2011-01-11 18:23  xavier

	* [r7260] One barrier is in fact needed when writing restart info.
	  I put a
	  global barrier for the moment but a "smaller" one is needed.

2011-01-11 20:56  xavier

	* [r7261] The function states_distribute_nodes is now called during
	  system
	  initialization instead of being called by the run modes.

2011-01-11 21:21  xavier

	* [r7262] * Added a communicator for the kpoints-states-domains
	  cubes.
	  * This new communicator is used for the barrier in restart_write.

2011-01-11 21:23  dstrubbe

	* [r7263] Added a missing type public declaration that prevented
	  PGI compilation.

2011-01-11 21:28  xavier

	* [r7264] The first implementation of task parallelisation.

2011-01-11 22:03  xavier

	* [r7265] * The task parallelisation can use more than 1 processor
	  per domains.
	  * Added profiling regions for task-parallelisation.

2011-01-11 22:09  dstrubbe

	* [r7266] Added and fixed PUSH_SUB's.

2011-01-11 23:40  xavier

	* [r7267] Merged some states and k-points reductions.

2011-01-12 16:45  xavier

	* [r7268] Some reorganization and cleaning in v_ks.

2011-01-12 17:57  xavier

	* [r7269] Some changes to the regression tests:
	  
	  * Execution counts as one match.
	  
	  * If execution fails, results are not checked. This is because
	  sometimes output files from previous runs can cause false passed
	  tests.
	  
	  * Improved the format of the output, the [ OK ] and [ FAIL ] are
	  always
	  in the same column.

2011-01-12 18:13  xavier

	* [r7270] Now Octopus calls the C exit function instead of Fortran
	  stop. This ensures
	  that a proper error code is returned.

2011-01-12 21:23  xavier

	* [r7271] * Declared task parallelization as experimental.
	  
	  * Added a test for task parallelization.

2011-01-12 23:10  xavier

	* [r7272] Some cleaning of the isf poisson code.

2011-01-13 00:11  dstrubbe

	* [r7273] A less restrictive PGI optimization pragma: we can use
	  routine scope instead of global scope.

2011-01-13 20:17  xavier

	* [r7274] Added the variable TotalStates, which sets the total
	  number of states
	  used for the calculation.

2011-01-14 04:40  xavier

	* [r7275] * Now v_ks_calc does not always calculate the energy
	  values. This is
	  controlled by the optional argument calc_energy (true by
	  default).

2011-01-16 04:18  xavier

	* [r7276] Some optimizations for libxc:
	  
	  * Defined a faster function calculate to f(z). It calculates all
	  the
	  required derivatives at once, and avoids the calculation if the
	  system
	  is unpolarized.
	  
	  * The new function is used by the lda_xc_teter93 functional.

2011-01-16 05:52  xavier

	* [r7277] Some optimization for lda_xc_teter93.

2011-01-17 11:53  joseba

	* [r7278] The first implementation of ScaLAPACK, but it doesn't
	  work; it fails in the execution.
	  
	  Also, changed some comments for Doxygen.

2011-01-17 12:09  joseba

	* [r7279] Deleted some unnecessary comments

2011-01-17 23:48  xavier

	* [r7280] The scalapack version of QR is called when mesh
	  parallelisation is
	  used.

2011-01-18 08:18  joseba

	* [r7281] Added a pragma to compile with g95

2011-01-18 15:13  marques

	* [r7282] Added a new kinetic energy functional

2011-01-18 15:34  marques

	* [r7283] Another kinetic energy functional

2011-01-18 19:39  dstrubbe

	* [r7284] * Added hyphen, changed m-dash to hyphen (for page
	  numbers) which could render strangely.
	  * The new file was missing .c in the Makefile.

2011-01-18 20:46  dstrubbe

	* [r7285] Fixed PGI compilation error via missing prototype.
	  PGC-S-0043-Redefinition of symbol, xc_gga_k_tflw_set_params_
	  (gga_k_tflw.c: 55)

2011-01-19 23:01  dstrubbe

	* [r7286] The NetCDF part of the configure script was trying to
	  find netcdf.mod in /usr/include/netcdf-3. That does not seem to
	  be a standard place for it to be. Now it checks instead in
	  /usr/include, which is where it comes with the Ubuntu package and
	  also is where the ETSF_IO configure script looks for it.

2011-01-19 23:21  xavier

	* [r7287] Changed the macro used to initialize libxc so it works
	  with old
	  libtool versions.

2011-01-20 00:01  dstrubbe

	* [r7288] QR orthogonalization, both serial and parallel, had
	  serious problems. We should never use external library calls
	  without an explicit interface because the compiler will not
	  notice if the arguments supplied are wrong. Joseba, I am sure
	  this is why you reported that ScaLAPACK QR wasn't working. Now
	  the function calls obey the correct interface, although I have
	  not done any test on how it runs.
	  * Created new scalapack_blacs module containing interfaces
	  (copied from BerkeleyGW).
	  * Defined new pX() macro for ScaLAPACK calls.
	  * Added interface for LAPACK calls for QR which were missing. I
	  tried to imitate the common interfaces of the other LAPACK calls
	  in the module, but I couldn't get it to compile for some reason.
	  * Removed 'external' statement which refers to a nonexistent
	  routine.
	  * Made ScaLAPACK/LAPACK routines be correctly of complex/real
	  flavor.
	  * Added workspace queries for ScaLAPACK calls.
	  * Made 'tmp' workspace variable of appropriate type.

2011-01-20 00:22  dstrubbe

	* [r7289] Due to usage of BLACS in mpi.F90, scalapack_blacs.F90
	  must be in basic, not math.

2011-01-20 02:56  xavier

	* [r7290] * Modified the interfaces for lapack/scalapack functions.
	  All array
	  arguments are now declared as scalars. This is to avoid compilers
	  (specially
	  ifort) to copy arrays when calling the functions.
	  
	  * Removed the limitation of complex wave-functions for QR
	  orthogonalization. (Thanks, David :-)

2011-01-20 03:16  dstrubbe

	* [r7291] * Since the interfaces are declared as scalars, tmp can
	  just be a scalar too.
	  * The ScaLAPACK calls need work(1) too like the LAPACK calls.
	  hbar buildslave will do ScaLAPACK soon to check these things.

2011-01-20 03:52  dstrubbe

	* [r7292] * Included ACML in the set of BLAS libraries to check,
	  since it comes with PGI.
	  * Gave a more transparent name to the ScaLAPACK m4.

2011-01-20 03:57  dstrubbe

	* [r7293] We need to link against BLAS too when checking ScaLAPACK.

2011-01-20 20:10  dstrubbe

	* [r7294] The configure script now looks for blas with just -lblas,
	  which is appropriate if blas is installed from an Ubuntu package,
	  and is a sensible default regardless.

2011-01-20 21:58  dstrubbe

	* [r7295] * Correction: it is actually LAPACK rather than BLAS
	  which ScaLAPACK needs to be linked with.
	  * -lacml will be tried as an option for LAPACK.

2011-01-20 22:05  dstrubbe

	* [r7296] Correction to correction: ScaLAPACK, at least sometimes,
	  needs both BLAS and LAPACK.

2011-01-20 22:16  dstrubbe

	* [r7297] Now ScaLAPACK and BLACS libraries are handled like all
	  the others: they are not tacked onto $LIBS in the m4, but rather
	  put in the correct order in common-rules.mk. If not in the right
	  order, the linking may fail.

2011-01-21 01:29  xavier

	* [r7298] * QR decomposition now works with domain parallelization
	  using
	  scalapack.

2011-01-21 03:13  xavier

	* [r7299] Split scalapack_blacs_m into blacs_m and scalapack_m.

2011-01-21 14:24  davidk

	* [r7300] Changes concern Optimal Control Theory:
	  
	  ====================================
	  
	  1.
	  file: target.F90
	  subroutines/functions: target_init, j1_functional, calc_chi
	  
	  Implementation of functionals that involves the current
	  (oct_tg_current) such that it can be used alone or in combination
	  with other functionals. So far it can be combined only with a
	  density target (oct_tg_density).
	  1a. Functional that minimizes the current.
	  1b. still not implemented, but about to come.
	  
	  ====================================
	  
	  2.
	  file: iter.F90
	  subroutine: iterator_write
	  Instead of 999 laser files now 9999 laser files can be written.
	  
	  ======================================
	  
	  3.
	  file: target.F90
	  subroutine: calc_chi
	  in the case of "oct_tg_density", for more than 1 electron, do the
	  loop over meshpoints: do ip = 1, gr%mesh%np
	  Before it was: do ip = 1, gr%mesh%np_part, while for the case of
	  1 electron it always was do ip = 1, gr%mesh%np.
	  
	  =======================================================================
	  =======================================================================

2011-01-21 14:32  davidk

	* [r7301] 2 testsuites for current added

2011-01-21 17:27  joseba

	* [r7302] Now is not trying to link with BLACK/ScaLAPACK if MPI is
	  not found before

2011-01-21 18:00  xavier

	* [r7303] * Changed the way the parallelization strategies are
	  selected. Now each
	  mode must declare additional supported modes.
	  
	  * With this change, tests inside oct-test can also specify
	  additional
	  parallelization strategies.

2011-01-22 00:09  xavier

	* [r7304] The calc_mode now does not contain the id of the
	  calculation mode
	  being executed. This avoids code that behaves differently
	  depending on
	  the calculation mode (a very bad idea).

2011-01-22 00:49  xavier

	* [r7305] Removed poisson_isf as an external library and integrated
	  the code in
	  Octopus. In this way we can use Octopus infrastracture for
	  debugging,
	  profiling, output, etc.

2011-01-22 01:20  dstrubbe

	* [r7306] * Listed default via option name instead of number.
	  * More standard error-handling in optimal control.
	  * Removed unnecessary variables mpi_err from two files: this is
	  defined in mpi_m.

2011-01-22 02:14  xavier

	* [r7307] * Removed some unused test functions.
	  * Included some source files in poisson_isf.

2011-01-22 02:59  xavier

	* [r7308] More code re-organization in poisson_isf.

2011-01-22 03:35  xavier

	* [r7309] Moved a data table from poisson_isf to a text file.

2011-01-22 04:11  xavier

	* [r7310] Removed the code associated to scaling functions that are
	  not used.

2011-01-22 04:30  xavier

	* [r7311] * Removed more unused code.
	  * Forgot to remove some files from the Makefile.

2011-01-22 15:26  xavier

	* [r7312] Bugfix: The file for filter data was not closed after
	  reading.

2011-01-22 18:55  xavier

	* [r7313] More code cleaning in poisson_isf.

2011-01-22 22:21  xavier

	* [r7314] Moved the FFTs from poisson_isf to a module in math/.

2011-01-22 23:40  xavier

	* [r7315] Code cleaning in sgfft.

2011-01-23 04:59  xavier

	* [r7316] * More code cleaning.
	  * Added profiling regions for the ISF solver.

2011-01-24 01:12  xavier

	* [r7317] Added a module to optimize the mesh to cube copy.

2011-01-24 01:34  xavier

	* [r7318] * Fixed a compilation problem in my last commit.
	  * Enabled "state" parallelization for the poisson test.

2011-01-24 03:47  xavier

	* [r7319] Replaced MeshBlockSizeXY and MeshBlockSizeZ by the
	  MeshBlockSize block.

2011-01-24 06:09  xavier

	* [r7320] Bugfix: Now restart for open boundaries is done properly
	  and should
	  work properly for any MeshBlockSize. (Unfortunately it seems that
	  other parts of the open boundaries code seem to have problems
	  with
	  MeshBlockSize != 1).

2011-01-25 01:12  xavier

	* [r7321] * Bugfix: OEP response wave-functions were not being
	  initialized. This
	  caused the test to fail.
	  
	  * Removed an unnecessary orthogonalization in OEP solve.

2011-01-25 01:54  xavier

	* [r7322] Moved 2 orthogonalization tests to the long-run group.

2011-01-25 03:27  xavier

	* [r7323] Bugfix: the calculation of XC energy for OEP could result
	  in NaNs.

2011-01-25 04:43  xavier

	* [r7324] Fixed several compilation warnings.

2011-01-25 09:54  joseba

	* [r7325] Sorry, if it changes something. I will revert as soon as
	  posible

2011-01-25 10:10  joseba

	* [r7326] Deleted a mistakenly created folder

2011-01-25 12:45  marques

	* [r7327] *) changed the order of files in makefile.am to see if it
	  helps with nowii
	  *) Added fxc for the BR functional

2011-01-25 12:49  marques

	* [r7328] Tried to remove inline to see if nowii compiles libxc

2011-01-25 12:59  marques

	* [r7329] There was still one inline left. This seems to be the
	  source of the confusion of the xlc compiler...

2011-01-25 15:54  xavier

	* [r7330] Some cleaning of the restart_read..

2011-01-25 17:05  xavier

	* [r7331] The scheme that we use to divide data is not compatible
	  with
	  scalapack. Added the interface for a run mode to ask for a
	  scalapack-compatible division scheme.

2011-01-25 18:09  joseba

	* [r7332] Added scalapack-compatible division scheme

2011-01-25 20:06  xavier

	* [r7333] * Added a function that initializes a blacs context from
	  a MPI
	  communicator.
	  
	  * This function is now used by the QR orthogonalization.

2011-01-25 20:38  dstrubbe

	* [r7334] Added formatting footer.

2011-01-25 20:58  xavier

	* [r7335] * Renamed blacs_grp_t to blacs_proc_grid_t and remove the
	  desc and info
	  components. Descriptors are associated to a distributed arrays
	  and not
	  to the process grid.

2011-01-25 21:01  xavier

	* [r7336] Fixes compilation in serial.

2011-01-25 22:33  xavier

	* [r7337] * There is no need for a global blacs process grid.
	  * The orthogonalization test requires a scalapack compatible
	  division.

2011-01-25 23:11  micael

	* [r7338] *) Added a test for non-linear core corrections.

2011-01-26 00:39  xavier

	* [r7339] When running with MPI and 1 node. Octopus tried to use
	  unitialized communicators. This should fix the problems with the
	  MPI test.

2011-01-26 00:55  xavier

	* [r7340] Bugfix: The multicomm_divide_range did not initialize the
	  lsize argument.

2011-01-26 04:22  xavier

	* [r7341] Fixed a deadlock in restart_read. I am not sure why this
	  happens, but
	  it seems to be fixed by using the full communicator for the
	  reads.

2011-01-26 04:37  xavier

	* [r7342] The orthogonalization test now should print 1 for the
	  overlap of a
	  vector with itself (before it substracted 1 so it was supposed to
	  print 0 for all overlaps).

2011-01-26 05:28  xavier

	* [r7343] Fixed a memory leak.

2011-01-26 12:21  xavier

	* [r7344] Bugfix: some communicators need to be initialized in
	  serial mode.

2011-01-26 13:32  xavier

	* [r7345] Added an optional offset argument to the binary read
	  functions.

2011-01-26 16:17  xavier

	* [r7346] Now with domain parallelization, each file reads a part
	  of the file.
	  This avoid allocating an array with the size of the global grid.

2011-01-26 17:29  joseba

	* [r7347] Now Scalapack should work with par_domains + par_states.
	  Is not working with only par_states. It might be wrong

2011-01-26 19:12  xavier

	* [r7348] Some small fixes in QR orthogonalization. Now it works
	  with domain and
	  states parallelization.

2011-01-26 23:17  xavier

	* [r7349] * Renamed the variable WhichTest to TestMode.
	  
	  * Renamed TestOrthogonalization and TestDerivatives to TestType.
	  
	  * Added a test mode for subspace diagonalization.

2011-01-28 17:48  xavier

	* [r7350] Added an interface for pblas.

2011-01-28 20:34  xavier

	* [r7351] Partial implementation of subspace diagonalization using
	  scalapack.
	  The calculation of the subspace hamiltonian and the rotation of
	  the
	  states are done using pblas. The diagonalization is still done in
	  serial.

2011-01-28 21:30  xavier

	* [r7352] Fixed compilation without scalapack. For the moment the
	  old version of
	  states-parallel subspace diagonalization is used when scalapack
	  is not
	  available.

2011-01-28 22:33  xavier

	* [r7353] * Now oct-test also receives command line options.
	  * Added the '-c' argument. It shows the compilation options of
	  the
	  executable.

2011-01-29 00:15  xavier

	* [r7354] * Added a new feature to the testsuite. Tests can depend
	  on a
	  configure option. For example:
	  
	  * The LOBPCG test now only runs in parallel if the executable was
	  compiled with scalapack.

2011-01-29 00:50  xavier

	* [r7355] * Appended _mpi_grp to the mpi_grp_t objects in states.
	  
	  * Added the domain-states BLACS process grid to states_t.

2011-01-29 02:01  xavier

	* [r7356] * Moved blacs_proc_grid_t to its own module.
	  * Blacs_proc_grid_t can now be initialized with any communicator.
	  * Subspace diagonalization and orthogonalization uses
	  st%dom_st_proc_grid.

2011-01-29 02:07  xavier

	* [r7357] Fixed serial compilation.

2011-01-29 04:13  xavier

	* [r7358] * Added PUSH_SUBs/POP_SUBs and SAFE_ALLOCATE.
	  * Fixed compilation with xlf.

2011-01-29 04:47  xavier

	* [r7359] Workaround for the failing MPI test: the dom_st_proc_grid
	  is only
	  created for ground state calculations.

2011-01-29 15:56  xavier

	* [r7360] Changes to blacs_proc_grid_t:
	  
	  * Added a nullify function.
	  * The context is now deallocated.
	  * Copy creates a copy of the context.

2011-01-29 17:53  xavier

	* [r7361] * Added a function to calculate the blacs block size of
	  the states.
	  * The QR orthogonalization works with spinors.
	  * The LOBPCG test now uses QR orthogonalization.

2011-01-30 00:33  xavier

	* [r7362] Improved the error messages for the blacs/scalapack
	  macros.

2011-01-30 01:35  xavier

	* [r7363] The old states-parallel orthogonalization routine can be
	  selected by
	  StatesOrthogonalization.

2011-01-30 04:45  xavier

	* [r7364] A fix to my previous commit.

2011-01-30 04:56  xavier

	* [r7365] Removed some PUSH_SUBs from functions that are called too
	  often.

2011-01-30 06:06  xavier

	* [r7366] Added a variable that selects the routine used for
	  subspace
	  diagonalization. This is mainly for testing the state
	  parallelization.

2011-01-30 08:52  xavier

	* [r7367] A small fix in the scalapack subspace diagonalizer. The
	  eigenvalues
	  must be broadcast.

2011-01-30 16:36  xavier

	* [r7368] Passing the boundaries to an array arguments caused
	  problems with ifort (probably a stack copy was being made.

2011-01-30 21:23  xavier

	* [r7369] Scalapack routines are now used for the diagonalization
	  of the
	  subpspace Hamiltonian.

2011-01-30 21:52  xavier

	* [r7370] To avoid problems, we need to pass the Scalapack
	  descriptors as
	  an integer instead of an array.

2011-01-31 04:37  xavier

	* [r7371] The subspace Hamiltonian now is distributed between
	  nodes.

2011-01-31 04:50  xavier

	* [r7372] Fixed a problem with the pdsyev and pzheev interfaces.

2011-01-31 04:56  xavier

	* [r7373] Declared all scalapack interfaces as implicit none.

2011-01-31 05:59  xavier

	* [r7374] Improved the selection of the scalapack blocksize for the
	  subspace hamiltonian.

2011-01-31 10:09  marques

	* [r7375] Slightly wrong logic in ifs in the PES stuff

2011-01-31 12:34  joseba

	* [r7376] *) Changed documentation for doxygen
	  *) The first implementation of deingensolve with scalapack

2011-01-31 15:35  xavier

	* [r7377] Added a file for scalapack functions. It is compiled for
	  real and
	  complex values.

2011-01-31 18:11  joseba

	* [r7378] *) fixed the scalapack_syev interface
	  *) implemented scalapac_syev with complex

2011-01-31 18:15  xavier

	* [r7379] Some data required by the alternative lcao is calculated
	  during
	  initialization.

2011-01-31 19:49  dstrubbe

	* [r7380] A few corrections to documentation, comments, PUSH_SUB,
	  and output.

2011-01-31 22:08  dstrubbe

	* [r7381] We should try linking BLACS with LAPACK and BLAS in the
	  configure script, since that is how it will eventually be linked
	  in the compilation. For MKL, you need to give BLAS, LAPACK, and
	  BLACS all together as
	  
	  --with-blas="-Wl,--start-group $MKL_DIR/libmkl_intel_lp64.a
	  $MKL_DIR/libmkl_sequential.a $MKL_DIR/libmkl_core.a
	  $MKL_DIR/libmkl_blacs_openmpi_lp64.a -Wl,--end-group -lpthread"
	  
	  in which case LIBS_BLACS="" works, but only if LIBS_BLAS was used
	  in the link line too.

2011-01-31 22:35  xavier

	* [r7382] * Distributed_init now only requires a communicator and
	  not a
	  multicomm_t.
	  * Renamed geo%atoms to geo%atoms_dist.

2011-02-01 01:11  xavier

	* [r7383] This should fix the compilation problem.

2011-02-01 01:36  dstrubbe

	* [r7384] Two lines are too long.

2011-02-01 09:10  marques

	* [r7385] Now octopus prints the walltime at the end of the run

2011-02-01 19:34  xavier

	* [r7386] * The diagonalization in LCAO is now done by dsygvx
	  instead of dsygv.
	  So only the required eigenvectors are calculated.
	  
	  * Added a distributed object to divide the orbitals between
	  processors.

2011-02-02 00:11  xavier

	* [r7387] Scalapack is used for the diagonalization in the LCAO
	  (for the moment
	  the matrix is stored in one node).

2011-02-02 00:37  dstrubbe

	* [r7388] Corrected typos.

2011-02-02 02:51  xavier

	* [r7389] More changes for the parallelization of LCAO.

2011-02-02 04:16  xavier

	* [r7390] More updates in LCAO:
	  
	  * The Hamiltonian and the overlap matrices are stored in local
	  arrays.
	  
	  * Moved the reductions to a subsubroutine.
	  
	  * Bugfix: the node indexes in the process grid were off by 1.

2011-02-02 07:57  xavier

	* [r7391] * Bugfix: the alternative LCAO could segfault with atoms
	  with different
	  atoms.
	  
	  * Some fixed for parallelization.

2011-02-02 09:13  xavier

	* [r7392] Implemented the missing reduction operations for submesh
	  operations.

2011-02-02 09:25  xavier

	* [r7393] Now the scalapack alternative LCAO works with mesh
	  parallelization.

2011-02-02 13:14  marques

	* [r7394] Some debug lines were forgotten...

2011-02-02 14:09  joseba

	* [r7395] Added the implementation of LIBFM to solve the Poisson
	  equation.
	  https://trac.version.fz-juelich.de/libfm
	  To compile I had to add this line: export LDFLAGS=$LDFLAGS"
	  -L$LIBFM_HOME -lfm_$
	  
	  Libfm is working in some cases, but is a library problem.
	  The m4 needs improvements, is not working as spected.

2011-02-02 15:05  nitsche

	* [r7396] * changed direct calls to zsymv to lalg_symv (this might
	  fix the runtime problems for David as it not the first integer
	  but the array was passed)

2011-02-02 16:10  nitsche

	* [r7397] * another change of a direct call of a blas function

2011-02-02 17:48  xavier

	* [r7398] * Implemented the copy from the scalapack-distributed
	  matrix of
	  LCAO eigenvectors to the state-parallelization-distributed one.
	  
	  * Removed the global reduction, an attempt to make the code a bit
	  simpler.

2011-02-02 18:46  xavier

	* [r7399] Some small fixes to my previous commit.

2011-02-02 19:24  xavier

	* [r7400] The alternative LCAO can now work with an arbitrary block
	  size. This
	  means that matrix operations are distributed.

2011-02-02 20:46  xavier

	* [r7401] Avoid the calculation of unnecessary matrix elements.

2011-02-02 22:28  xavier

	* [r7402] Bugfix: the multicomm_divide_range function could give
	  wrong results in scalapack mode.

2011-02-02 22:30  xavier

	* [r7403] I forgot to remove some debugging output.

2011-02-03 18:55  dstrubbe

	* [r7404] Several dependencies were missing, causing a compilation
	  failure on hbar.

2011-02-03 18:59  xavier

	* [r7405] Bugfix: The reduction in the submesh was wrong if the
	  output array was
	  larger than the necessary size.

2011-02-03 19:03  dstrubbe

	* [r7406] This test which DavidK added was failing because the
	  result was just slightly outside the tolerance. I increased the
	  tolerance slightly so it can pass.

2011-02-03 22:49  xavier

	* [r7407] When more than 20% of the time will be wasted, now
	  Octopus only gives
	  a warning instead of an error.

2011-02-03 22:52  xavier

	* [r7408] * Added a new parallel orthogonalizer: par_gram_schmidt.
	  It is based
	  on gram_schmidt but using scalapack routines.
	  
	  * Added some pblas/scalapack interfaces.
	  
	  * Added an ASSERT to prevent problems with mesh_batch_dotp_self.

2011-02-03 22:56  xavier

	* [r7409] Fixed serial compilation.

2011-02-04 00:58  xavier

	* [r7410] * Added a variable to control the tolerance in the LCAO
	  diagonalization.
	  
	  * If LCAO diagonalization fails, execution continues.

2011-02-04 05:00  xavier

	* [r7411] * Orbitals for LCAO are now allocated and generated on
	  demand.
	  
	  * By default orbitals are kept in memory. The variable
	  LCAOKeepOrbitals changes this behaviour.
	  
	  * Moved all LCAO related variables (except LCAOStart) from SCF to
	  SCF::LCAO.

2011-02-04 15:05  davidk

	* [r7412] opt-control
	  file: target.F90:
	  Added current functional for maximal current on quantum ring.
	  Affected: target.j1_functional and target.calc_chi

2011-02-04 17:15  joseba

	* [r7413] *) Fixed the input variables, to use the values from inp.
	  *) Removed gradient variable
	  
	  The libfm was changed, so now we are much closter to real results
	  for Poisson.
	  
	  I and Pablo GR

2011-02-04 18:54  xavier

	* [r7414] Now, when the long range local potential is calculated
	  using the poisson
	  equation, the density is collected and the poisson equation is
	  solved once.

2011-02-04 19:17  dstrubbe

	* [r7415] * Fixed inconsistency in documentation.
	  * Added PUSH_SUB's.

2011-02-04 19:52  xavier

	* [r7416] Replaced numerical values by the corresponding names.
	  Numbers must
	  never be used in this context, since they can change.

2011-02-04 20:40  xavier

	* [r7417] Not surprisingly, PGI has problems to compile elemental
	  functions.

2011-02-04 23:00  xavier

	* [r7418] Added some messages to the output.

2011-02-04 23:04  xavier

	* [r7419] Reverted some accidental changes.

2011-02-04 23:36  xavier

	* [r7420] Parallelization in atoms of guess_density.

2011-02-05 17:20  xavier

	* [r7421] * The scalapack subspace diagonalizer is now the default
	  for state
	  parallelization (if scalapack is available).
	  
	  * Added some checks to avoid using the wrong diagonalizer.
	  
	  * The scalapack subspace diagonalizer uses the blocked
	  hamiltonian.

2011-02-05 18:23  xavier

	* [r7422] * The default orthogonalizer for states parallelization
	  is now
	  par_gram_schmidt.
	  
	  * Added checks for the selection of the orthogonalizer.
	  
	  * Improved the documentation for SubspaceDiagonalization and
	  StatesOrthogonalization.

2011-02-06 02:21  xavier

	* [r7423] The alternative LCAO works again with complex
	  wave-functions.

2011-02-06 02:46  dstrubbe

	* [r7424] * Got rid of some unused variables and 'target'
	  specifications.
	  * Added an intent.

2011-02-06 06:03  dstrubbe

	* [r7425] Unused variables, targets, intent's.

2011-02-06 09:29  xavier

	* [r7426] I have assumed that blacs process ids where equivalent to
	  MPI ones. This is not the always the case, so to generate a the
	  blacs context one must translate the ids.

2011-02-06 19:09  xavier

	* [r7427] * The profiling routines are no longer threadsafe. This
	  is not really
	  necessary.

2011-02-07 02:57  xavier

	* [r7428] Bugfix: When scalapack mode is used, the st%nodes array
	  was not
	  consistent with the other parallelization data.

2011-02-07 13:40  xavier

	* [r7429] The rmmdiis eigensolver first has to do a few (5)
	  iterations of
	  steepest descent. Before, all these iterations were done in one
	  SCF
	  iteration, now each iteration counts as one SCF iteration. This
	  makes the
	  time per SCF iteration more regular.

2011-02-07 16:05  xavier

	* [r7430] Modified the restart procedure so the files are read in
	  parallel by
	  all processors.

2011-02-07 16:41  xavier

	* [r7431] This fixes the problem with k point parallelization and
	  scalapack.

2011-02-07 21:31  xavier

	* [r7432] * Implemented a function that exchanges grid points
	  according to a
	  map and works with domain parallelization (for the moment it
	  doesn't work without domain parallelization ;-).
	  
	  * The new function is used for restart in parallel.

2011-02-08 03:32  xavier

	* [r7433] * The epot_t object now has its own poisson solver
	  object, which is initialized
	  only if required.

2011-02-08 17:29  nitsche

	* [r7434] * Open boundary restart now reads all wave functions, not
	  just the occupied.
	  * Removed the rescaling of the k-weights as it is wrong for
	  Hartree.
	  * changed the test files accordingly (eigenenergies of states
	  changed due to removal of rescaling).

2011-02-10 00:04  dstrubbe

	* [r7435] Changes to enable running testsuite on Lonestar at TACC
	  which uses "ibrun" as part of the SGE queueing system:
	  * The number of processors to run on is not specified by a
	  command-line argument but by an environment variable.
	  * The environment variable QUEUE is set by the scheduler, so we
	  need to use a different name in the testsuite script.

2011-02-10 14:12  xavier

	* [r7436] Removed an unfinished module for fourier transforms.

2011-02-10 15:51  xavier

	* [r7437] A reorganization of cube_function_m. Now dcf_t and zcf_t
	  are replaced
	  by a single object, cube_function_t, that can contain both real
	  or
	  complex values.

2011-02-10 17:23  xavier

	* [r7438] More changes to the interface of mesh_function_m.

2011-02-10 17:51  joseba

	* [r7439] Starting implementing PFFT library.
	  For the moment only compiles

2011-02-10 18:09  xavier

	* [r7440] * Added the variable EigensolverMinimizationIter that
	  controls the
	  number of steepest descent minimizations in the rmmdiis
	  eigensolver.
	  
	  * Updated the test results for rmmdiis with spinors.

2011-02-10 19:13  xavier

	* [r7441] Some commented macros are causing compilation problems.

2011-02-10 19:43  dstrubbe

	* [r7442] For comprehensibility in debugging, it is important to
	  make sure the names put on the stack match the actual name of the
	  function. Also, the PUSH_SUB was inside the ifdef but the POP_SUB
	  was not, which will cause trouble.

2011-02-11 08:23  joseba

	* [r7443] Uncommented the PFFT procesors grid and PFFT environment
	  creation.

2011-02-11 20:50  xavier

	* [r7444] Some optimization in application of the phase in the
	  CAETRS propagator.

2011-02-12 17:45  joseba

	* [r7445] Improved the FMM implementation.
	  
	  This commit belongs to Pablo Garcia Risueño

2011-02-12 18:16  joseba

	* [r7446] Fixed for IBM compiler

2011-02-13 02:53  dstrubbe

	* [r7447] Fixed a wrong number of lines for write_warning, and
	  slight improvement to variable documentation.

2011-02-13 06:45  dstrubbe

	* [r7448] A change in r7445 broke a lot of things, so I reverted
	  it. We can't just comment out poisson_init, it causes segfaults
	  when things are not initialized.

2011-02-13 07:31  dstrubbe

	* [r7449] * Fixed apostrophes causing CPP warnings.
	  * A source file was missing from source list in Makefile.am,
	  causing distcheck failure.

2011-02-14 05:10  dstrubbe

	* [r7450] Part of the change in r7438 caused a large number of dim4
	  tests to fail with an array bound mismatch, so I undid it.

2011-02-14 07:02  dstrubbe

	* [r7451] Loosened tolerance a little more so this test can pass on
	  gfortran/openmpi.

2011-02-14 10:03  joseba

	* [r7452] Added the ability to run fourier transforms with PFFT

2011-02-14 10:14  xavier

	* [r7453] The write_fatal function now calls MPI_Abort when MPI is
	  enabled.

2011-02-14 10:15  xavier

	* [r7454] More optimizations in the calculation of the phase in the
	  CAETRS.

2011-02-14 12:53  xavier

	* [r7455] Now the profiling mode prints the profile only for the
	  first node by
	  default. To print it for all nodes one can use the
	  ProfilingAllNodes
	  variable.

2011-02-14 13:12  marques

	* [r7456] Flag XC_FLAGS_3D was missing from the hybrid functionals

2011-02-14 13:13  marques

	* [r7457] _xc_ functionals should be treated as correlation and not
	  as exchange, otherwise hybrids will not work. Now B3LYP seems to
	  work.

2011-02-14 22:09  dstrubbe

	* [r7459] Fixing the angular momentum test in the long test that
	  has been failing on most or all slaves for a month. It began at
	  r7226 which changed the definition of SCF steps in
	  time-propagation. The results for this test should have been
	  updated along with AETRS in r7228. Please check whether your
	  commit has caused a test to start failing!

2011-02-15 15:32  xavier

	* [r7460] Renamed poisson_fmm.F90 to poisson_fmm_inc.F90.

2011-02-15 16:00  xavier

	* [r7461] Added the communicator for all nodes to the fmm data
	  structure (plus some style fixes).

2011-02-15 16:01  davidk

	* [r7462] Affected files:
	  src/opt_control/target.F90:
	  implemented td current target. restructered existing current
	  functionals.
	  
	  src/opt_control/check_input_inc.F90:
	  check that only problems without spin polarization take current
	  OCT functionals.
	  testsuite/optimal_control:
	  added one inp for on current+density with td current target.

2011-02-15 17:04  xavier

	* [r7463] Some fixes to my last commit.

2011-02-16 07:28  xavier

	* [r7464] Now the FMM poisson solver works with states/kpoints
	  parallelization.

2011-02-16 08:43  xavier

	* [r7465] Fixes compilation without libfm.

2011-02-16 11:07  xavier

	* [r7466] Now octopus prints a message when restart files are read.

2011-02-16 13:52  xavier

	* [r7467] Added a progress bar to restart_read.

2011-02-16 23:44  dstrubbe

	* [r7468] * Fixed BLACS interfaces.
	  * When copying a BLACS processor grid, it seems we must call
	  blacs_get for the new context. See
	  http://www.netlib.org/blacs/BLACS/Examples.html#BLACS_GRIDMAP
	  Without this, even one core the 1D and 2D HF tests failed with
	  the error message "Invalid MPI Communicator" on Hopper 2 (Cray
	  XT5) and Lonestar (Intel/MVAPICH).
	  I think the fact that it only happened on some machines is
	  related to this comment:
	  http://www.fz-juelich.de/jsc/jugene/usage/FAQ/Invalidcomm/
	  "On a number of systems the MPI_COMM_WORLD communicator is set to
	  0 (zero). Incidentally, the BLACS context number is zero on many
	  systems, too."

2011-02-17 01:22  dstrubbe

	* [r7469] * Removed debugging output that can appear a large number
	  of times in output.
	  * A stray character written accidentally into the output can make
	  grep considered it binary and return nothing; this could cause
	  matches in the testsuite to fail for no apparent reason. By
	  passing -a to grep, we instruct it to search even if it thinks it
	  is binary, making the testsuite more robust.

2011-02-17 09:28  marques

	* [r7470] I believe that someone changed the units of the magnetic
	  susceptibility! Whoever did
	  it, can you please check that it is now correct?

2011-02-17 13:10  marques

	* [r7471] Patch by Janne.Blomqvist@tkk.fi:
	  
	  The attached patch does some minor optimizations and cleanups,
	  mostly
	  replacing usage of pow() with cbrt() as pow() can be somewhat
	  expensive.
	  
	  - Add tests for sqrtf, cbrtf, cbrt in configure.ac
	  - Add SQRT and CBRT macros to xc_config.h
	  - pow => POW if argument is FLOAT
	  - sqrt => SQRT if argument is FLOAT
	  - cbrt => CBRT
	  - POW(x, 1.0/3.0) => CBRT(x)
	  - POW(x, -1.0/3.0) => 1.0/CBRT(x)
	  - POW(x, 1.0/2.0) => SQRT(x)
	  - POX(x, -1.0/2.0) => 1.0/SQRT(x)
	  - POW(x, 1.0/4.0) => SQRT(SQRT(x))
	  - sqrt(2.0) => M_SQRT2
	  
	  Some of the pow(x,y) optimizations above can be done
	  automatically by
	  the compiler if one enables -ffast-math (or equivalent) but due
	  to
	  different corner-case behavior the compiler cannot enable them
	  otherwise (e.g. sqrt(-0.0) == -0.0 != pow(-0.0, 1.0/2.0) ==
	  +0.0). See
	  e.g.
	  
	  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=25620
	  
	  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=43419
	  
	  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=42694
	  
	  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=28252
	  
	  
	  I ran the testsuite, and while I did get some failures I also got
	  exactly the same failures with the trunk, so as far as the
	  testsuite
	  is concerned the patch does not affect the numerics in any way.

2011-02-17 15:21  davidk

	* [r7472] src/opt_control:
	  1. target.F90: user defined target state enabled
	  ("oct_tg_userdefined").
	  2. check_input_inc.F90: disabled for td targets the possibilty to
	  use
	  "TDEvolutionMethod = exp_mid" with "TDExponentialMethod =
	  lanczos", as
	  it leads to segmentation fault. Now, only crank_nicholson is
	  available.
	  
	  testsuite/optimal_control:
	  1. added test for "oct_tg_userdefined" to already existing
	  testsuite
	  "01-asym_doublewell.test"

2011-02-17 22:40  dstrubbe

	* [r7473] * The check for an external Zoltan library in the
	  configure script only worked for Trilinos in a particular
	  installation location. Now it tries no extra include and library
	  flags as an option, which allows it to detect the library on a
	  Cray. You can also set the location via --with-external_zoltan on
	  the configure command line.
	  * This is now in a separate m4 file.
	  * Some improvements to the pre-existing check, such as using
	  whatever is in LIBS and CPPFLAGS in doing the checks.
	  * The include file is always zoltan.h now, the path is just
	  specified by -I if necessary.

2011-02-18 00:34  dstrubbe

	* [r7474] * Passing things with -L or -l in CPPFLAGS causes a lot
	  of warnings.
	  * An extra -I should not be added to CPPFLAGS_ZOLTAN for include.

2011-02-18 01:39  dstrubbe

	* [r7475] * The default include directory for zoltan needs -I now.
	  * The zoltan include and libs are not tacked onto CPPFLAGS and
	  LIBS anymore but are their own variables, as is done for other
	  libraries.
	  * Removed duplicated libraries in the Makefile.

2011-02-18 06:37  dstrubbe

	* [r7476] The include flags for Zoltan are now used for compiling C
	  files.

2011-02-18 07:09  dstrubbe

	* [r7477] Slight improvement to documentation.

2011-02-18 07:20  dstrubbe

	* [r7478] * More improvements to variable documentation.
	  * Removed duplicate variable description for FFTLibrary.

2011-02-18 11:33  xavier

	* [r7479] An attempt to fix the libxc problem in nowii.

2011-02-18 18:53  dstrubbe

	* [r7480] Replaced a few apostrophes and fixed format in order to
	  suppress CPP/Fortran warnings. The SP format descriptor is
	  supposed to be on its own, not next to an integer descriptor, and
	  it applies for the rest of the line.

2011-02-20 03:31  dstrubbe

	* [r7481] In calculating the residual, the QMR solver can divide by
	  zero and produce a floating-point exception (this was happening
	  in the OEP-EXX test). Now we set the residual to something huge
	  in this case, to prevent the division by zero and make sure we do
	  not have a false convergence. This issue probably did not affect
	  any results.

2011-02-20 14:59  xavier

	* [r7482] Split the calculation of the forces and the Born charges
	  into two
	  different functions. I think it is clearer this way.

2011-02-20 15:29  xavier

	* [r7483] Force calculation is done with real arithmetic instead of
	  complex.

2011-02-20 16:46  xavier

	* [r7484] Fixed compilation in parallel.

2011-02-20 17:22  xavier

	* [r7485] * Boundary conditions are not set for \nabla\psi in the
	  calculation of
	  the forces. Boundary points are not required for the application
	  of
	  projectors. This was introduced in [4982] but I don't understand
	  how
	  it could make a difference in the results (perhaps a bug
	  somewhere?).
	  
	  * Fixed the type for communication operations.

2011-02-20 17:36  xavier

	* [r7486] * Combined the reductions for states and k-points
	  parallelization.
	  
	  * Renamed the FORCES_MPI profiling area to FORCES_COMM.

2011-02-20 21:56  dstrubbe

	* [r7487] A slightly more robust check for whether +/- frequencies
	  are needed in Sternheimer: multiple zero frequencies still won't
	  need +/- frequencies.

2011-02-22 19:37  dstrubbe

	* [r7488] When ScaLAPACK fails, we should write out the error code
	  for use in debugging.

2011-02-23 10:28  marques

	* [r7489] Added a new GGA functional (WL) and more importantly,
	  added a new framework for GGA correlations. Most GGA correlations
	  will be adapted to this new framework in the future. Note: the
	  second derivatives in the spin polarized case are still missing.

2011-02-23 10:29  marques

	* [r7490] Sorry, just realized that I used // comments...

2011-02-23 12:57  xavier

	* [r7491] * Added the LD macro, that returns the leading dimension
	  of an array
	  (useful for Lapack calls).
	  
	  * Some cleaning of the Lapack interface.

2011-02-23 16:20  xavier

	* [r7492] * Removed some explicit array sizes in function arguments
	  (compilers
	  tend to make a copy of the arrays if the boundaries are given).
	  
	  * Some cleaning.

2011-02-24 15:26  marques

	* [r7493] *) Added the Gombas interpolation of the correlation
	  energy
	  *) Corrected a numerical coefficient in the RPA functional
	  *) A factor of 1/2 was missing in the ML functional

2011-02-24 20:56  dstrubbe

	* [r7494] With Ubuntu SPARSKIT package, linking against -lskit
	  results in use of libskit.so, and this causes unresolved symbols
	  for some reason. There is probably some other library that is
	  supposed to be linked along with it. Anyway, the problem can be
	  simply resolved by using the full name /usr/lib/libskit.a as the
	  configure script's guess.

2011-02-25 04:14  dstrubbe

	* [r7495] In light of r7493, the LDA_C_RPA test match needs to be
	  changed slightly.

2011-02-26 12:11  xavier

	* [r7496] * Added a function to perform the gathering of the
	  forces.
	  
	  * Removed the if(present(lr)) parts of forces_born_charges.

2011-02-26 12:35  xavier

	* [r7497] Added the forces_from_local_potential function, that
	  replaces shared
	  code in the forces and born charges calculation.

2011-02-26 13:47  xavier

	* [r7498] Added a function (and a module) to perform reductions.

2011-02-26 15:21  xavier

	* [r7499] Added 0 and 2 dimensional reduction functions.

2011-02-26 16:55  xavier

	* [r7500] Optimized the reduction for 2d arrays.

2011-02-26 17:25  xavier

	* [r7501] * Fixed compilation in serial.
	  
	  * Added assertions to check that the arrays passed to our blas
	  interface are contiguous in memory.

2011-02-26 20:10  xavier

	* [r7502] Added a function to simplify using optional argument. The
	  function is
	  called optional_default, the first parameter is the optional
	  argument
	  and the second is the default value. If the first argument is
	  present,
	  the function returns its value, if it is not present, it returns
	  the
	  default value.
	  
	  With this function it is possible to evaluate optional arguments
	  in one
	  line, for example:
	  
	  ! ----------------------
	  
	  logical :: reduce_
	  
	  reduce_ = .true.
	  if(present(reduce)) reduce_ = reduce
	  
	  if(reduce_) then ...
	  
	  ! ----------------------
	  
	  becomes
	  
	  ! ----------------------
	  
	  if(optional_default(reduce, .true.)) then ...
	  
	  ! ----------------------

2011-02-26 22:41  dstrubbe

	* [r7503] Added PUSH and POP for new functions.

2011-02-27 02:06  dstrubbe

	* [r7504] * Added a caveat about forces: they may not be correct
	  for non-pseudopotential species if the potential does not vanish
	  at infinity.
	  * Made typecasts to REAL explicit for the forces.

2011-02-27 12:06  xavier

	* [r7505] Removed a non-implemented run mode.

2011-02-27 13:06  xavier

	* [r7506] * Removed some unused functions from lalg_basic.
	  
	  * Lalg_dot(u) was only used two times, so I replaced it by a
	  direct call
	  to blas.

2011-02-28 11:11  marques

	* [r7507] Added a new GGA correlation functional: Wilson and
	  Ivanov. Note that this functional only has a spin-unpolarized
	  version

2011-02-28 19:13  dstrubbe

	* [r7508] Actually everything is fine for forces with user-defined
	  species. Added reference showing derivation.

2011-03-01 03:34  xavier

	* [r7509] * Replaced some calls to MPI_Allreduce with
	  comm_allreduce.
	  * Some cleaning.

2011-03-01 04:08  xavier

	* [r7510] Removed the mesh_alltoall_m module, that is not used and
	  has not been tested.

2011-03-01 04:37  xavier

	* [r7511] * Replaced more calls to MPI_Allreduce with
	  comm_allreduce.
	  
	  * Fixed a compilation issue with a commented macro.

2011-03-01 07:57  dstrubbe

	* [r7512] * It makes more sense to me to link against the Fortran
	  init for BLACS since we only call BLACS from Fortran -- somehow
	  it is interchangeable which to use, which I don't understand.
	  * The link line was using the libraries in a different order than
	  what the configure script tested, which could cause problems.

2011-03-01 13:42  nitsche

	* [r7513] * poisson solver direct2D was not working in serial mode
	  with non curvilinear coordinates

2011-03-01 15:24  xavier

	* [r7514] Renamed psia_project_psib to projector_matrix_element.

2011-03-01 18:04  xavier

	* [r7515] Fixed the problem with the force calculation and spinors.
	  It only
	  affected spinors with (non-relativistic) KB pseudpotentials.

2011-03-01 18:35  xavier

	* [r7516] * Removed some PUSH/POP_SUB from functions that are
	  called too often.
	  * A PUSH_SUB was used instead of POP_SUB.

2011-03-01 18:42  xavier

	* [r7517] Fixed the deadlock reported by Maria and Danilo. The
	  problem appeared
	  when trying to print the acceleration of the dipole with domain
	  parallelization enabled.

2011-03-01 20:16  dstrubbe

	* [r7518] Back to blacsCinit since it doesn't work with
	  blacsF77init on one machine for some reason.

2011-03-02 12:41  marques

	* [r7519] Some programs pass negative densities to libxc. This
	  commit should fix many of the functionals in this case.

2011-03-02 12:42  marques

	* [r7520] There was a problem in the b86 functional. First, what I
	  called b86_r was in fact b86. Then my b86 had a wrong
	  coefficient. So I deleted b86_r and rewrote in a clearer way b86.

2011-03-02 12:42  marques

	* [r7521] I rewrote lyp to the new framework. Now the file is half
	  the size as before, and it will be easy to get the second
	  derivatives.

2011-03-02 12:44  marques

	* [r7522] Delete the b86_r functional and updated the b86

2011-03-02 21:57  xavier

	* [r7523] Some cleaning of the alternative LCAO.

2011-03-02 22:08  dstrubbe

	* [r7524] I have changed back to blacsF77init, but changed the link
	  line to -lblacs -lblacsF77init -lblacs, as for some reason BLACS
	  libraries often contain cyclic dependencies that require this
	  linking order. Hopefully this addresses the problem Joseba
	  reported.

2011-03-02 23:07  xavier

	* [r7525] The localization radius of the atomic orbitals is now
	  printed and
	  checked.

2011-03-02 23:39  xavier

	* [r7526] More cleaning.

2011-03-03 01:05  xavier

	* [r7527] Added a test for diamond, this is a copy of the silicon
	  test but using
	  carbon.

2011-03-03 01:17  xavier

	* [r7528] The eigensolver test now uses C instead of Si.

2011-03-03 01:33  xavier

	* [r7529] * Removed the Si pseudo-potential. The orbitals of this
	  pseudo are
	  wrong, we should not include it in the package.
	  
	  * Removed the silicon test.

2011-03-03 01:46  xavier

	* [r7530] The check for the radius of the orbitals is now done
	  independently of
	  the potentials.

2011-03-03 01:48  dstrubbe

	* [r7531] Moved variable LocalMagneticMomentsSphereRadius to
	  scf.F90 and Section Output since it applies to both static and
	  time-dependent calculations.

2011-03-03 06:42  dstrubbe

	* [r7532] * Removed the spurious sqrt in the definition of
	  abs_dens. Now it is \int | rho_in - rho_out | d3r as intended in
	  r3856, so that the code now agrees with the documentation.
	  * rel_dens = abs_dens / qtot is of course affected too. New
	  rel_dens = qtot * old^2. I reset the default ConvRelDens to a
	  value that is identical if qtot = 10.
	  * Changed all ConvAbsDens in testsuite to the square of the
	  previous number, so the convergence will be equivalent.
	  * Changed most ConvRelDens to the corresponding new value. A few
	  I left alone that did not make a test fail.
	  * Updated test values for finite_systems_3d/05-output,
	  20-eigensolver, and 22-time_propagation for the new default
	  ConvRelDens.
	  * Added same ConvRelDens to
	  finite_systems_3d/01-carbon_atom.03-ground_state_double_grid.inp
	  as in 01 and 02 input files.
	  
	  The 08-diamond test is failing, but was before this change. Not
	  sure why.
	  Also, many of the tests complain that pseudo radii are too large.

2011-03-03 13:23  marques

	* [r7533] Added a very simple exchange functional, the Herman
	  X\alpha\beta functional. This is perhaps the first GGA for the
	  exhange

2011-03-03 13:40  xavier

	* [r7534] Updated the values for the diamond test.

2011-03-03 16:10  xavier

	* [r7535] Increased to 20 the threshold for the warning of orbital
	  radius.

2011-03-03 19:17  dstrubbe

	* [r7536] If we do not find an installed version of Zoltan, we
	  should not leave in the link line things we tried in the
	  configure script.

2011-03-03 20:09  xavier

	* [r7537] The application of the phase with opencl was missing.

2011-03-03 20:37  xavier

	* [r7538] Fixed compilation with --disable-f90-forall.

2011-03-03 21:22  dstrubbe

	* [r7539] One test needs a tighter convergence criterion to satisfy
	  the desired precision with the new ConvRelDens default; the other
	  needed to have its ConvRelDens updated to the equivalent new
	  value.

2011-03-04 01:32  xavier

	* [r7540] Fixed the calculation of the external energy with opencl.

2011-03-06 22:00  dstrubbe

	* [r7541] Updated ConvRelDens values in tests that have failed.

2011-03-07 01:47  xavier

	* [r7542] Now make check can run with debugging enabled.

2011-03-07 02:32  xavier

	* [r7543] Now 'make check-full' runs in debug mode.

2011-03-07 14:40  nitsche

	* [r7544] * fixed a bug I introduced in the direct 2d poisson
	  solver (missing scaling factor)

2011-03-07 16:59  joseba

	* [r7545] Improved the PFFT implementation.
	  But, is not working yet. Some help will be welcome.
	  
	  Miquel Huix helped me with this commit.

2011-03-07 19:04  dstrubbe

	* [r7546] Fixing a couple of compilation problems:
	  * CPP and Fortran conditionals seemed to be mixed up in
	  fourier_space_inc.F90.
	  * If the pfft_t type contains something defined only in its
	  header file, then basically all of the pfft module needs to be
	  only compiled if HAVE_PFFT, to avoid compilation error if it is
	  not available.
	  
	  * Added PUSH/POP.

2011-03-07 19:22  dstrubbe

	* [r7547] Hid references to PFFT when it is not used in
	  cube_function, to fix compilation.

2011-03-08 19:55  xavier

	* [r7548] * Now k-points are ordered by their norm and position.
	  * Fixed the tests results affected by this change.

2011-03-08 22:00  xavier

	* [r7549] The share/PP/defaults file is now in atomic units.

2011-03-08 22:12  xavier

	* [r7550] Restored the Si pseudo.

2011-03-08 23:59  xavier

	* [r7551] * Added a check to remove unbound atomic orbitals.
	  * Restored the Si test and removed the diamond one.
	  * One of the pseudos from the spin orbit coupling test also had
	  unbound states. So the test result changed (since this
	  calculation is
	  not converged).

2011-03-10 09:35  juho

	* [r7552] 1) Added a maximize-current target to OCT. \n2) Added the
	  possibility to output velocity directly from octopus (neater &
	  faster than having to go to matlab to integrate the
	  acceleration). \n3) Added the possibility to calculate the
	  HHG-spectrum from dipole velocity.

2011-03-10 18:47  dstrubbe

	* [r7553] * Don't use the plain allocate statement, use the
	  SAFE_ALLOCATE macro always.
	  * The PUSH_SUB should be first executable line in each
	  subroutine.
	  * Added a missing deallocation.
	  * The filename listed in the documentation was incorrect.

2011-03-15 19:46  xavier

	* [r7554] Regenerated the bison part with a name-prefix, to avoid
	  clashes with
	  other packages.

2011-03-16 01:13  dstrubbe

	* [r7555] * The problem in test finite_systems_3d/11-sic (still
	  disabled) that led me to mark SIC as an experimental feature is
	  actually due to the initial LCAO calculation, so I have removed
	  the mark that it is experimental.
	  * Updated ConvRelDens in this test for the new definition.
	  
	  Alberto, the problem with 11-sic began with r6876/r6877 in which
	  you fixed the fact that no orbitals were available for LCAO with
	  HGH Ar. The test fails only every few runs, not consistently. Can
	  you check this? This is ticket #97.

2011-03-16 17:42  acastro

	* [r7556] Reactivated 11-sic.test, let us see if it passes through
	  tests in all
	  machines. At least now it seems to give consistently the same
	  result
	  on the same machine, which it did not before. One reason could be
	  a
	  dubious access to uninitialized memory in epot.F90, but it seems
	  that
	  the biggest source of "randomness" is in the use of the
	  fft_corrected
	  scheme (I don't know why).

2011-03-16 18:22  dstrubbe

	* [r7557] The SIC test seems to be working now, and for parallel
	  runs as well.

2011-03-17 00:21  dstrubbe

	* [r7558] * Fixed PUSH/POP's not corresponding to function name.
	  * Removed spurious semicolon.
	  * Fixed typo.

2011-03-17 01:20  dstrubbe

	* [r7559] In Poisson routines, there were a number of
	  floating-point comparisons against M_ZERO. This should never be
	  done. Instead, it should be a check for absolute value less than
	  M_EPSILON, because comparison of a very small number to zero will
	  be controlled by random numerical noise. This was causing a GSL
	  underflow in a call to Bessel_K0 in my calculation.

2011-03-17 16:07  xavier

	* [r7560] Fixed the calculation of linear response density:
	  * with spin polarization.
	  * with states/k-point parallelization.

2011-03-17 16:24  xavier

	* [r7561] * Some cleaning of the Sternheimer code.
	  * Added some spinors indexes missing.
	  * Nothing fixed for spin polarization, though.

2011-03-17 18:57  xavier

	* [r7562] * Removed the OEP kernel, that was not implemented.

2011-03-17 19:13  xavier

	* [r7563] Fixed a bug introduced in my last commit.

2011-03-17 19:28  dstrubbe

	* [r7564] * Bugfix: hyperpolarizability for spin-polarized systems
	  was calculated using only same-spin part of kernel Kxc. Now the
	  proper 2x2x2 product is done.
	  * Only calculate Kxc and allocate relevant arrays when it will be
	  used.
	  * kxc should be deallocated at the end.

2011-03-18 02:52  xavier

	* [r7566] * Some cleaning of etsf format output.
	  
	  * Octopus now stops with an error if etsf format is requested and
	  etsf_io
	  is not available.
	  
	  * Bugfix: etsf format output was not generated if other format
	  was
	  requested.

2011-03-18 03:59  xavier

	* [r7567] * Fixed compilation without etsf_io.
	  * Now symmetries are included in the etsf output.

2011-03-18 05:36  dstrubbe

	* [r7568] Added another spinor dimension in Sternheimer.
	  
	  An odd-electron spin-polarized Sternheimer calculation checks out
	  for polarizability and hyperpolarizability compared to finite
	  differences, so I think we have the spin-polarized Sternheimer
	  bugs fixed.

2011-03-18 05:59  xavier

	* [r7569] More improvements to the etsf format output:
	  * Now k-points are written.
	  * Removed some duplicated code.

2011-03-18 06:26  xavier

	* [r7570] Fixes to my last commits. This should fix the test that
	  is failing.

2011-03-18 06:38  dstrubbe

	* [r7571] Changed norms over MAX_DIM to sb%dim to avoid using
	  uninitialized matrix components.

2011-03-18 10:24  micael

	* [r7572] * A constant was wrong in the Thomas-Fermi kinetic energy
	  functional.
	  * Definition of XC_KINETIC was missing from libxc_master.F90.

2011-03-18 15:15  micael

	* [r7573] * Now I think the constant in the Thomas-Fermi functional
	  is finally correct.

2011-03-18 18:59  dstrubbe

	* [r7574] The finite-difference electric-field calculation now
	  saves the field used as well as the dipoles so that it will not
	  use the saved dipoles if the field is different from the one set
	  in the input file. Otherwise you would get the wrong answer if
	  you ran with FromScratch = no and used a different field than in
	  a previous calculation.

2011-03-18 21:58  xavier

	* [r7575] The space group number (as calculated by spg) is now
	  included in the
	  etsf file.

2011-03-18 23:23  xavier

	* [r7576] More improvements to the etsf format output:
	  * Now the files can be read by v_sim.
	  * The species name is now included, this is not required by the
	  standard but v_sim cannot read the file without it.
	  * The full geometry is included in all the files.

2011-03-19 01:11  dstrubbe

	* [r7577] Only write symmetry info from one node.

2011-03-19 02:58  xavier

	* [r7578] * Now mesh_to_cube can act on local arrays.
	  * The etsf output now works with domain parallelization.

2011-03-19 06:56  dstrubbe

	* [r7579] * em_resp is now set up to do partially periodic systems,
	  using d/dk for periodic directions and r for finite directions.
	  * Changed gr%mesh%sb%dim to gr%sb%dim in a few places, for
	  brevity.
	  * VdW dies on periodic systems since the formalism for periodic
	  systems (if existent) is not implemented.

2011-03-19 21:28  dstrubbe

	* [r7580] An uninitialized OutputHow was being checked for a
	  reference to ETSF_IO and dying on pathscale. Now the check is in
	  the routine that reads OutputHOw so the check will only be
	  performed if OutputHow is read. Also, OutputHow before would
	  silently ignore requests to use netCDF or ETSF_IO output if those
	  were not available; now a fatal error is generated instead, which
	  seems more helpful to the user.

2011-03-19 23:53  xavier

	* [r7581] The number of electrons is now included in the wfs in
	  etsf format.
	  This makes possible for Yambo to read the file without
	  complaining.

2011-03-21 02:06  xavier

	* [r7582] Added a "classical" theory level. This will allow us to
	  test geometry
	  optimization with precise forces..

2011-03-21 03:29  xavier

	* [r7583] Added the IonicInteraction block, that controls the type
	  of
	  interaction between ions. The options are Coulomb and
	  Lennard-Jones.
	  Lennard-Jones for the moment does nothing.

2011-03-21 04:16  xavier

	* [r7584] Implemented Lennard-Jones interaction (I still have to
	  test it). Now
	  Octopus is a classical molecular dynamics code ;-)

2011-03-21 04:40  xavier

	* [r7585] Fixed the sign for Lennard-Jones force.

2011-03-21 04:58  xavier

	* [r7586] * Now loct_pointer_copy nullifies the output pointer, if
	  the input one
	  is null.
	  
	  * The ion interaction arrays are now copied by geometry_copy.

2011-03-21 05:08  xavier

	* [r7587] The interaction has to be re-initialized after the open
	  boundaries
	  code has messed with all the geometry components.

2011-03-21 15:45  marques

	* [r7588] New kinetic energy GGA (actually the first of all), the
	  Lee, Lee and Parr functional

2011-03-22 16:00  marques

	* [r7589] Corrected the value of K_FACTOR_C to the correct
	  spin-polarized and including the factor of 2 from our definition
	  of tau.
	  Added the von Weiszaecker functional

2011-03-22 16:09  marques

	* [r7590] Sorry, forgot an } and had an error in a comment

2011-03-22 21:57  xavier

	* [r7591] Some reorganization of the ETSF output.

2011-03-22 22:48  xavier

	* [r7592] Fixed compilation without etsf_io.

2011-03-22 22:57  xavier

	* [r7593] More reorganization of the etsf output.

2011-03-22 23:18  xavier

	* [r7594] Moved the writing of the etsf electron data to its own
	  routine.

2011-03-23 03:13  xavier

	* [r7595] More code cleaning in the etsf output.

2011-03-23 04:59  xavier

	* [r7596] Finished with the reorganization of the etsf output.

2011-03-23 14:11  marques

	* [r7597] Added a bunch of functionals of the form gamma T_TF +
	  lambda T_vW

2011-03-23 14:33  marques

	* [r7598] Now the LLP kinetic functional shares the same routine as
	  B88

2011-03-23 19:20  xavier

	* [r7599] Fixed compilation with max-dim=4.

2011-03-23 20:38  xavier

	* [r7600] I commited the wrong file. I hope this time this solves
	  compilation issues with
	  max-dim=4.

2011-03-24 08:46  marques

	* [r7601] Yes, you were right Tobias. Thanks.

2011-03-24 11:01  marques

	* [r7602] Two more kinetic functionals OL1 and OL2
	  Fixed one reference (thanks Tobias)

2011-03-24 13:24  marques

	* [r7603] Again problems with the pre-factors. Hopefully this way
	  of doing things is a bit more robust.

2011-03-24 14:14  marques

	* [r7604] Added a new LDA functional for the kinetic energy

2011-03-24 20:54  xavier

	* [r7605] Added checks for the size of the arrays passed to binary
	  i/o.

2011-03-24 22:04  xavier

	* [r7606] * With max-dim > 3 the grid checksum was calculated over
	  non-initialized values.
	  
	  * Added explicit boundaries to an expression to avoid problems
	  with
	  max-dim > 3.
	  
	  * Added an assertion in restart_read_function.

2011-03-25 01:43  xavier

	* [r7607] The user definet atomic magnetization was not calculated
	  correctly
	  with max-dim > 3.

2011-03-25 02:51  xavier

	* [r7608] Added a test for a calculation with the density in a fine
	  mesh.

2011-03-25 03:17  xavier

	* [r7609] Added a check to stop the fine mesh with domain
	  parallelization.

2011-03-25 03:41  xavier

	* [r7610] Renamed the write_info, write_fatal, write_warning and
	  write_debug
	  routines to messages_info, messages_fatal, etc.

2011-03-25 11:30  marques

	* [r7611] Bug fix: in the case of the kinetic energy density, I was
	  using the wrong power in the definition of x. It should always be
	  4/3 and not 5/3

2011-03-25 13:04  marques

	* [r7612] Another version of becke 88 for the kinetic energy
	  density

2011-03-25 13:05  marques

	* [r7613] Sorry, a factor was wrong

2011-03-25 13:23  marques

	* [r7614] Added a kinetic version of the PW86 exchange functional

2011-03-25 13:23  marques

	* [r7615] An assert was wrong

2011-03-25 15:25  xavier

	* [r7616] * Bugfix: A call to hamiltonian_update was missing.
	  
	  * Removed PUSH_SUB/POP_SUB from a routine that is called to
	  often.

2011-03-25 18:34  xavier

	* [r7617] Updated the results for the Lithium test, that changed
	  slightly due to
	  my previous commit (I did a long propagation to check).

2011-03-26 02:57  xavier

	* [r7618] * Renamed h_sys_output_m to output_m.

2011-03-26 03:03  xavier

	* [r7619] Renamed input_function and output_function to
	  io_function_input and
	  io_function_output.

2011-03-26 05:14  xavier

	* [r7620] Started the implementation of etsf plane-wave output.

2011-03-26 14:02  xavier

	* [r7621] * Added libetsf_io_utils to the etsf_io macro.
	  
	  * Now octopus generates an ETSF file with the wave-functions in
	  fourier space.

2011-03-26 18:44  xavier

	* [r7622] * Now the etsf pw contains a spherical grid.

2011-03-26 19:28  xavier

	* [r7623] Plane-waves in the etsf file are now ordered by norm.

2011-03-26 20:01  xavier

	* [r7624] Added an option to output wave-functions in Fourier
	  space. Only works
	  with the ETSF format.

2011-03-26 21:10  xavier

	* [r7625] The k_dependent argument in ETSF outpur must be set to
	  false.

2011-03-27 05:10  dstrubbe

	* [r7626] Fixed typos and funny characters in libxc.

2011-03-28 03:02  xavier

	* [r7627] Now symmetrization works with domain parallelization.

2011-03-28 15:02  marques

	* [r7628] Rename the LB functional as "exchange", otherwise octopus
	  can not sum the PW92 correlation to it.
	  Added a modified LB potential by the Amsterdam group

2011-03-28 15:06  micael

	* [r7629] * A couple of KED functionals were labeled as exchange
	  functionals.

2011-03-28 15:14  marques

	* [r7630] Changed xc_lb to x_lb

2011-03-28 15:17  marques

	* [r7631] Sorry forgot to change XC->X in these files

2011-03-28 15:27  marques

	* [r7632] Sometimes is better not to do things, than to do them in
	  a hurry...

2011-03-28 15:30  micael

	* [r7633] * Another KED functional that was labeled as exchange.

2011-03-28 16:13  marques

	* [r7634] Changed the name of the lb file in the Makefile.am.

2011-03-28 16:15  micael

	* [r7635] * The lambda parameter in the TflW functionals was not
	  set correctly.

2011-03-28 20:52  dstrubbe

	* [r7636] * It seems clearer to me to say that the classical mode
	  considers interactions between ions rather than particles,
	  because otherwise it sounds like a Hartree term will still be
	  considered. Of course, in the periodic case it seems we are
	  considering an electron contribution to neutralize the cell and
	  prevent the Ewald sum from diverging.
	  * Added PUSH_SUB and moved one to the beginning of the routine.
	  * Typo.

2011-03-28 21:05  dstrubbe

	* [r7637] Three dimensions is assumed throughout our implementation
	  of spinors, so I am blocking noncollinear calculations for dim /=
	  3. For example, there are not four components of the density but
	  1 + ndim in general I think (identity and a Pauli matrix for each
	  direction). The initialization of magnetization also loops over 3
	  dimensions and will not work in 2D.

2011-03-28 23:13  dstrubbe

	* [r7638] Actually, we can and do use spinors in dimensions other
	  than 3: the spatial dimensions are different, but the spin vector
	  exists in 3 dimensions regardless. Now the test
	  finite_systems_2d/05-spin_precession.test will proceed again.

2011-03-28 23:39  dstrubbe

	* [r7639] * MultiResolution assumes 3 dimensions in its array
	  setup, so I am blocking calculations that are not in 3D.
	  * Added emacs format block.

2011-03-29 00:39  dstrubbe

	* [r7640] * Added PUSH_SUB's.
	  * Added a comma in documentation.

2011-03-29 00:43  dstrubbe

	* [r7641] * Standardized capitalization of a variable.
	  * Made explicit that max-dim must be at least 3: large portions
	  of the code assume 3 <= MAX_DIM, and will not work (or even
	  compile) if it is 1 or 2.

2011-03-29 19:05  dstrubbe

	* [r7642] Lxyz is now lxyz everywhere.

2011-03-29 19:32  dstrubbe

	* [r7643] * Removed unneeded semicolons.
	  * Checksum is calculated with mesh%sb%dim rather than MAX_DIM
	  again. With the current checksum function, I think the two
	  choices are equivalent, because using the whole array up to
	  MAX_DIM only involves adding the zero contributions of elements
	  which are set to zero.

2011-03-30 08:19  xavier

	* [r7644] For the calculation of the gauge field "force", now the
	  current
	  density is calculated first and then integrated.

2011-03-30 08:38  xavier

	* [r7645] Now the gauge filed current is also symmetrized if
	  requested.

2011-03-30 12:17  marques

	* [r7646] Bug fix in K_OL2. The formula was not correct.
	  Added the functional X_OL2, but I have very strong reasons to
	  believe that the formula in the paper is wrong.

2011-03-30 13:02  marques

	* [r7647] Added the dePristo and Kress GGA for the kinetic energy
	  density

2011-03-30 18:20  xavier

	* [r7648] Now the projectors in matrix form can apply the phase.

2011-03-30 18:20  xavier

	* [r7649] There is no need to calculate the number of electrons.

2011-03-30 20:15  dstrubbe

	* [r7650] Added and fixed PUSH_SUB's.

2011-03-31 02:17  dstrubbe

	* [r7651] Corrected discrepancy about default for
	  EigensolverMaxIter between documentation and code.

2011-03-31 14:26  davidk

	* [r7652] Changes concern opt-control/target.F90:
	  1.) Introduction of a weight for current functionals that depends
	  on the position: "OCTSpatialCurrWeight".
	  2.) Variable "OCTCurrentFunctional" now has restructered options,
	  in that way former options "oct_min_curr" and "oct_max_curr" are
	  unified to "oct_curr_square". Also a time-dependent unifying
	  option is available: "oct_curr_square_td".
	  
	  Affected input files in testsuite are have been adapted.

2011-03-31 15:22  marques

	* [r7653] Another bunch of functionals for the kinetic energy.
	  These ones are all absed on a Pade approximant.

2011-03-31 18:23  dstrubbe

	* [r7654] Loosening tolerance a little on one test to let it pass
	  on lascar/gfortran.

2011-03-31 19:42  dstrubbe

	* [r7655] Fixed an array bounds mismatch.

2011-04-01 02:23  dstrubbe

	* [r7656] * Corrected definition of theta_ij for fixed occupations.
	  * Removed unnecessarily skeptical comments about smearing
	  functions.
	  * No need to set beta_ij to zero by hand when i or j is
	  unoccupied, this comes naturally.

2011-04-01 08:57  marques

	* [r7657] Added the kinetic counterpart of PW91

2011-04-01 08:59  marques

	* [r7658] Sorry I had left some bugs around

2011-04-01 09:42  marques

	* [r7659] Now the VW term is defined withour the TF part as
	  requested by Micael

2011-04-02 20:54  dstrubbe

	* [r7660] Removed PUSH_SUB's from root solver routines that are
	  called very frequently.

2011-04-05 01:19  xavier

	* [r7661] Bugfix: If not enough orbitals were found, some pointers
	  in lcao_t
	  were not initialized nor nullified by lcao_init.
	  
	  This fixes the problem with the current test.

2011-04-05 01:20  xavier

	* [r7662] Some subroutines that are called too often are not
	  included in the
	  debugging stack.

2011-04-05 18:28  fulvio

	* [r7663] XC tail correction improved

2011-04-05 20:22  dstrubbe

	* [r7664] The limit term in the beta_ij coefficient for smeared
	  Sternheimer should not be calculated in the dynamic case.

2011-04-05 20:51  dstrubbe

	* [r7665] * Fixes to formatting and grammar.
	  * Use messages_fatal, not "messages_info; stop" or else only one
	  process will be halted and the other nodes will continue running.

2011-04-06 01:47  dstrubbe

	* [r7666] Two typos.

2011-04-06 05:59  dstrubbe

	* [r7667] Corrected a typo in test labelling.

2011-04-06 12:29  davidk

	* [r7668] opt-control/controlfunction: found and resolved bug of
	  writing Fourier components of more than one electric field with
	  'OCTControlFunctionType'='controlfunction_mode_epsilon'. Opened
	  files ('cpw-') were not closed properly, leading to too many open
	  files and IO-Error.

2011-04-06 18:38  dstrubbe

	* [r7669] For simplicity, when Born charges are real, we do not
	  write imaginary part and phase.

2011-04-06 19:13  dstrubbe

	* [r7670] Updated line numbers in test, after changing format of
	  Born charges file.

2011-04-06 19:56  dstrubbe

	* [r7671] vberry is allocated and calculated only if an electric
	  field is applied in a periodic direction, not just if there is a
	  field and the system is periodic: this makes a difference for
	  partially periodic systems.

2011-04-06 20:15  dstrubbe

	* [r7672] Typos, formatting, PUSH_SUB's.

2011-04-06 20:52  dstrubbe

	* [r7673] The SIC calculation is really ill-conditioned, I am not
	  sure why. Tightening up some numerical tolerances seems like it
	  will help make the results on different buildslaves agree more.

2011-04-07 01:16  dstrubbe

	* [r7674] * Renamed subroutine for clarity.
	  * Fixed typo.

2011-04-07 02:37  dstrubbe

	* [r7675] * If no restart dipoles for finite-difference em_resp, no
	  warning is written about wrong field.
	  * Updated line numbers for matches in sodium test.

2011-04-07 02:41  dstrubbe

	* [r7676] The Berry potential is now part of hm%vhxc, so that it
	  can be part of potential mixing.

2011-04-07 03:49  dstrubbe

	* [r7677] Fixed a mistake in my last commit that caused many test
	  failures.

2011-04-07 20:59  dstrubbe

	* [r7678] * Replaced apostrophe to suppress CPP warning.
	  * hm%vberry should be nullified so that associated(hm%vberry)
	  will always work later on.

2011-04-08 02:32  dstrubbe

	* [r7679] * Output of wfs and density response is now possible for
	  kdotp.
	  * The norm of the density response is written out for kdotp: it
	  should be small if the k-sampling is converged.

2011-04-08 03:39  xavier

	* [r7680] The number of iterations is printed when SCF does not
	  converge.
	  
	  (It seems that the problem with test 09-spinors is that SCF is
	  not
	  converging.)

2011-04-08 20:03  xavier

	* [r7681] The dielectric function utility now also calculates the
	  polarizability.

2011-04-08 20:44  xavier

	* [r7682] There is no need to remove the dc component in the
	  calculation of the
	  dielectric function.

2011-04-08 21:32  dstrubbe

	* [r7683] kdotp now writes the relative density variation, not the
	  absolute.

2011-04-09 21:46  dstrubbe

	* [r7684] * Further info in documentation on EMEta and Born charge
	  acoustic sum rule.
	  * Born charges and polarizability are complex only if there is an
	  eta, not just if the wavefunctions involved are complex.
	  * An error will be written if eta is negative, which would make
	  acausal response functions.

2011-04-10 12:59  xavier

	* [r7685] * Added messages_init and messages_end functions.
	  
	  * ExperimentalFeatures and DebugLevel are now parsed by
	  messages_init.
	  
	  * Added calls to messages_init and messages_end to all
	  executables.
	  
	  * The debug/ directory is now generated by io_init.

2011-04-10 14:47  xavier

	* [r7686] Fixed the calculation of the energy for periodic systems.

2011-04-10 21:47  xavier

	* [r7687] * Fixed the calculation of the forces for periodic
	  systems.
	  
	  * Updated the energy results for the periodic lithium test.

2011-04-11 02:43  xavier

	* [r7688] The convergence parameters for the Ewals sum are now
	  calculated for
	  optimal precision.

2011-04-11 10:51  xavier

	* [r7689] Fixed two tests that failed due to my changes:
	  
	  * ExperimentalFeatures was missing from the QR test.
	  
	  * Updated the value for the total energy in the Water in
	  Supercell test.

2011-04-11 11:40  xavier

	* [r7690] Added energy checks to the tests for 3D periodic systems.

2011-04-11 15:11  xavier

	* [r7691] Correct calculation of the off-diagonal terms of the
	  dielectric function and friends.

2011-04-11 19:27  dstrubbe

	* [r7692] The plural of 'index' should be 'indices'. Also, fixed
	  typos 'maximixes' and 'allocatation'.

2011-04-12 03:21  dstrubbe

	* [r7693] * The Berry phase matrix is not Hermitian, so it really
	  should not be made to be Hermitian. Now we calculate explicitly
	  the (j,i) as well as (i,j) matrix elements. Without this,
	  sometimes the code would divide by zero.
	  * This affects the dipole moment in a test: it agrees
	  considerably better with the isolated case now.

2011-04-12 11:22  juho

	* [r7694] We needed a time-dependent user-defined potential, so I
	  made a small modification to allow for this.

2011-04-12 13:42  xavier

	* [r7695] * The spinors test had an unreachable convergence
	  threshold.
	  
	  * A small fix for max-dim > 3.

2011-04-12 15:10  xavier

	* [r7696] At the end of the run, Octopus now prints the number of
	  warnings
	  emitted and the number of experimental features used.

2011-04-12 15:13  xavier

	* [r7697] Renamed the "exec/out.oct" file to "exec/parser.log".

2011-04-12 18:16  dstrubbe

	* [r7698] Fixed a typo.

2011-04-13 01:00  dstrubbe

	* [r7699] The Berry energy correction should be computed via the
	  density, rather than reconstructing it from the wavefunctions.

2011-04-13 01:37  dstrubbe

	* [r7700] Only occupied states should be used in constructing the
	  Berry phase.

2011-04-13 02:16  dstrubbe

	* [r7701] We must avoid calling lalg_determinant in berry_phase_det
	  when no states are occupied: these seems to be what goes on in
	  open boundaries, causing a LAPACK error.

2011-04-14 00:54  dstrubbe

	* [r7702] * The dipole moment is written in each SCF step when an
	  electric field is being applied in a periodic direction.
	  * Fixed a 3 to MAX_DIM.

2011-04-14 18:34  xavier

	* [r7703] Replaced MAX_DIM by space%dim in the calculation of the
	  dielectric
	  function.

2011-04-14 19:37  xavier

	* [r7704] The dielectric function and the polarizability are
	  correctly
	  calculated from the inversion of the inverse dielectric tensor.

2011-04-14 20:27  dstrubbe

	* [r7705] Further tightening of tolerances on SIC test to try to
	  get it to pass on all the buildslaves.

2011-04-14 21:05  dstrubbe

	* [r7706] Typo and formatting.

2011-04-15 10:06  marques

	* [r7707] Also v2rho2 is well calculated in spin polarized mode.
	  Now it is only missing v2sigma2 and v2rhosigma

2011-04-15 18:07  dstrubbe

	* [r7708] * When Hxc is frozen, Berry potential should still be
	  calculated.
	  * The ASSERT and setting of the calculating switch in
	  v_ks_calc_finish should be before leaving the function.

2011-04-15 18:47  dstrubbe

	* [r7709] * When things go really wrong, more than two decimal
	  places may be needed to write the number of warnings...
	  * A more helpful error message from the Occupations block.
	  * Capitalization.

2011-04-15 20:43  dstrubbe

	* [r7710] Avoid dividing by zero in Sternheimer for fixed
	  occupations.

2011-04-16 19:12  micael

	* [r7711] * Fixed AM05 correlation for very small densities.

2011-04-16 19:53  xavier

	* [r7712] The message about single point berry phase and integer
	  occupations is
	  printed in the static/info file and not as warning.

2011-04-16 23:40  dstrubbe

	* [r7713] The dipole is now calculated and written by separate
	  functions.

2011-04-17 00:08  dstrubbe

	* [r7714] Fixing a sign error for the dipole in my last commit.

2011-04-17 01:02  dstrubbe

	* [r7715] An inner cycle to optimize the wavefunctions and Berry
	  potential at fixed Hartree and XC potentials is now done, which
	  is needed to be able to converge calculations of a crystal with
	  applied electric field. The cycle stops when a maximum number of
	  iterations is hit, or the dipole is converged.

2011-04-17 14:42  xavier

	* [r7716] In some cases the states are required to generate the KS
	  potential,
	  but the states were initialized to zero. Now they are initialized
	  using atomic orbitals.

2011-04-17 16:08  xavier

	* [r7717] Now species_get_orbital returns all the periodic copies
	  of the orbital.

2011-04-18 05:07  dstrubbe

	* [r7718] A simpler way to remove the quanta of polarization in
	  Berry dipole, which should fix the test failures.

2011-04-18 05:13  dstrubbe

	* [r7719] Added PUSH_SUB, fixed typos.

2011-04-18 14:18  micael

	* [r7720] * Two functionals had the same identifier.

2011-04-18 19:24  xavier

	* [r7721] The number of warnings and experimental features is now
	  printed to
	  a file called exec/messages.

2011-04-18 21:35  dstrubbe

	* [r7722] * Fatal error should go to standard error not standard
	  out.
	  * Should set dipole = 0 to make sure elements between sb%dim and
	  MAX_DIM are initialized.

2011-04-18 23:22  dstrubbe

	* [r7723] r7695 made it impossible to use DebugLevel = 99, because
	  the call io_mkdir('debug') tried to use the unitialized
	  current_label from datasets, causing segfaults and/or inability
	  to create the directory. Now datasets_init is called prior to
	  io_init so that current_label has been initialized, and
	  unnecessary extra creations of that directory are removed from
	  io_datasets_init and some of the utilities.

2011-04-19 06:25  dstrubbe

	* [r7724] For some reason, PGI has memory corruption in writing the
	  debug kpoints file unless I separate the index2axis call from the
	  write statement.

2011-04-19 07:13  dstrubbe

	* [r7725] Missing PUSH_SUB.

2011-04-19 18:51  dstrubbe

	* [r7726] * Clarifications to error messages in LCAO
	  diagonalization.
	  * Added a missing deallocation.

2011-04-19 19:58  xavier

	* [r7727] Added the default values to the description of some GO
	  variables.

2011-04-19 21:47  xavier

	* [r7728] Renamed GOWhat2Minimize to GOObjective.

2011-04-20 00:04  dstrubbe

	* [r7729] Added and corrected PUSH_SUB's.

2011-04-20 14:02  marques

	* [r7730] New functional, a modified Becke 88 for proton transfer
	  reactions.

2011-04-20 14:04  marques

	* [r7731] Sorry forgot two "M"

2011-04-20 19:35  xavier

	* [r7732] Added an interface to set a thermostat and a temperature.
	  For the moment it does nothing.

2011-04-20 20:04  marques

	* [r7733] Sorry for the mess. Let's see if it compiles now.

2011-04-20 20:17  xavier

	* [r7734] Implemented the velocity_scaling thermostat.

2011-04-20 22:10  xavier

	* [r7735] Now messages_print_var_value for logicals prints 'yes' or
	  'no' instead
	  of 'T' and 'F'.

2011-04-20 22:33  xavier

	* [r7736] * MoveIons is now a logical variable.
	  
	  * The Nose-Hoover thermostat is now selected by the Thermostat
	  variable (I still have to check that it works).

2011-04-21 01:40  dstrubbe

	* [r7737] Blocking calculation of vibrational modes by linear
	  response for periodic systems, since the ionic part of the
	  dynamical matrix, as well as the infrared intensities, are not
	  correct in this case.

2011-04-21 03:27  xavier

	* [r7738] Some small fixes to the Nose-Hoover thermostat. It seems
	  to be
	  working now.

2011-04-21 13:26  marques

	* [r7739] An unused variable was left behind. Thanks David.

2011-04-21 14:00  xavier

	* [r7740] * Now ionic temperatures are stored in energy units.
	  Conversion is
	  done on input and output.
	  * Defined unit_kelvin to convert energy to temperature.

2011-04-21 16:04  xavier

	* [r7741] The conversion factor for density in gr/cm^3 to atomic
	  units was wrong.

2011-04-21 19:04  xavier

	* [r7742] Bugfix: Since [6395] geometry optimization fails if no
	  restart
	  cannot be read (unless the FromScratch variable was passed).
	  
	  I made change [6395] but I don't know what I was thinking :-/

2011-04-21 22:48  xavier

	* [r7743] The phase is now pre-calculated in the Berry dipole.

2011-04-21 23:42  dstrubbe

	* [r7744] * Added and corrected PUSH_SUB's.
	  * Improved comments/output.

2011-04-22 00:14  xavier

	* [r7745] Introduced the SCFCalculateDipole variable, the default
	  is yes for
	  finite systems and no for periodic systems. This is because the
	  calculation of the Berry dipole is an O(n^3) operation, so it can
	  take
	  a considerable time.

2011-04-22 00:14  dstrubbe

	* [r7746] References for Fermi-Dirac and spline smearing.

2011-04-22 01:13  xavier

	* [r7747] Bugfix: The number of self-consistent steps was not
	  initialized for
	  BOMD.

2011-04-22 02:14  xavier

	* [r7748] Removed the small imaginary part from the calculation of
	  the
	  dielectric function. It is not necessary.

2011-04-22 02:15  xavier

	* [r7749] Added a check for atoms outside the box in geometry
	  optimization.

2011-04-22 03:33  xavier

	* [r7750] Bugfix: the time in the temperature output was wrong.

2011-04-22 07:08  dstrubbe

	* [r7751] * Bugfix: there was a discrepancy between tags in
	  vib_modes and those used generally for Sternheimer, preventing
	  the reloading of restart data.
	  * More information about vibrational-mode calculation is now
	  printed.
	  * Added missing function declarations.
	  * A few more checks of vibrational-mode properties to ensure
	  correctness.

2011-04-22 14:58  xavier

	* [r7752] * The ion_dynamics_{save,restore}_state functions now
	  consider the
	  Nose-Hoover variables.
	  
	  * Renamed some variables.

2011-04-22 19:03  dstrubbe

	* [r7753] * Clarified documentation about SCFCalculateDipole.
	  * Added this variable to input for H2O supercell test, because
	  the lack of dipole moment in output was making this test fail.

2011-04-22 20:54  xavier

	* [r7754] For the Nose-Hoover thermostat the potential must be
	  regenerated twice.

2011-04-22 23:25  dstrubbe

	* [r7755] * In periodic systems with smearing, a Fermi-level shift
	  term must be included in the Sternheimer density response.
	  * The limit term in beta_ij for smearing in Sternheimer should be
	  computed without the frequency in the dynamic case, to properly
	  account for occupation variation.

2011-04-22 23:43  dstrubbe

	* [r7756] * Fixed unpaired apostrophe in comment.
	  * Fixed PUSH_SUB.

2011-04-23 03:25  xavier

	* [r7757] Added the (experimental) option of using femtoseconds as
	  the time units.

2011-04-23 05:04  xavier

	* [r7758] Optimization of the Ewald sum.

2011-04-23 05:34  dstrubbe

	* [r7759] * Contrary to popular belief, 'rwork' for ScaLAPACK and
	  LAPACK is supposed to be real, not complex...
	  * The temporary argument passed as 'work' in a workspace query
	  must be an array of size at least 3, as stated in ScaLAPACK
	  documentation. Using a scalar as we had causes seg faults.

2011-04-23 14:50  xavier

	* [r7760] A small optimization in the application of the
	  wave-function phase.

2011-04-23 15:53  xavier

	* [r7761] * Replaced some messages with calls to
	  messages_not_implemented.
	  
	  * Removed some options that are not implemented.

2011-04-23 19:33  xavier

	* [r7762] * The periodic_copy_t object returned more copies than
	  necessary.
	  
	  * Updated the results for the silicon test (the difference is
	  very
	  small).

2011-04-23 20:06  dstrubbe

	* [r7763] Syntax error.

2011-04-23 20:40  dstrubbe

	* [r7764] More info in warnings for QR decomposition in ScaLAPACK.

2011-04-24 21:22  xavier

	* [r7765] Now the ionic density is generated in a spherical mesh
	  instead of the
	  full mesh.

2011-04-25 01:09  xavier

	* [r7766] There is a bug in the submesh implementation, if the
	  sphere radius is
	  larger than the simulation box and the system is periodic,
	  multiple
	  replicas should be considered in some regions but currently only
	  one
	  is considered.
	  
	  This is not very serious since this case is quite unphysical for
	  the
	  potential and the ionic density but I might happen for orbitals.
	  
	  I will fix it later (I have to figure out the best way to do it),
	  but
	  for the moment I put a warning.

2011-04-25 01:51  xavier

	* [r7767] * Some cleaning of the submesh_m module.
	  * Renamed some components to more meaningful names.

2011-04-25 02:31  xavier

	* [r7768] Fixed the calculation of orbitals in a submesh.

2011-04-25 15:13  xavier

	* [r7769] Only periodic dimensions are considered when checking for
	  the size of
	  the submesh.

2011-04-26 00:51  dstrubbe

	* [r7770] Added a PGI pragma to prevent erroneous optimization in a
	  particular routine.

2011-04-26 02:36  dstrubbe

	* [r7771] vib_modes should use wfs_tag_sigma for consistency in
	  generating restart filenames.

2011-04-26 02:51  dstrubbe

	* [r7772] A non-SCF sigma- and state-dependent inhomogeneous term
	  can be added to the RHS of the Sternheimer equation, for use in
	  the second order.

2011-04-26 15:27  xavier

	* [r7773] Made the calculation of the ionic density in the submesh
	  more precise.
	  The threshold for the calculation is smaller now and the charge
	  is
	  renormalized to the exact value.

2011-04-26 15:40  xavier

	* [r7774] Replaced some single quotes.

2011-04-26 16:00  xavier

	* [r7775] Updated the matches for some periodic tests due to the
	  change in the
	  calculation of the ionic charge. The changes are very
	  small, only three matches were above the threshold.

2011-04-26 16:17  xavier

	* [r7776] Bugfix: Octopus now checks if more than one method to
	  specify the
	  coordinates is used at the same time.

2011-04-26 18:45  dstrubbe

	* [r7777] A first stab at the second-order Sternheimer equation.
	  Not yet used or tested.

2011-04-26 19:00  dstrubbe

	* [r7778] * Shortened a function name that is longer than what some
	  compilers will accept.
	  * Added syntax-highlighting block.

2011-04-26 19:43  xavier

	* [r7779] Now reduced coordinates can be specified in the input
	  file using the
	  ReducedCoordinates block.
	  
	  Initialization is a bit tricky, since the box is needed to
	  convert
	  reduced coordinates to real coordinates, but the coordinates are
	  required to initialize the box (for the minimum box). So
	  coordinates
	  from geometry_t cannot be used until simul_box_init is called,
	  this
	  was also true before since in this step atoms are moved into the
	  box
	  if the system is periodic.

2011-04-26 19:55  xavier

	* [r7780] Now all calls to geometry_init are followed by calls to
	  simul_box_init.

2011-04-26 20:05  xavier

	* [r7781] Converted the silicon test input files to
	  ReducedCoordinates.

2011-04-26 22:08  xavier

	* [r7782] Bugfix: a non-initialized value was being used.

2011-04-26 22:20  dstrubbe

	* [r7783] Typos.

2011-04-27 00:25  xavier

	* [r7784] Removed explicit boundaries in arguments.

2011-04-27 01:45  xavier

	* [r7785] * Fixed the interface for zherk.
	  
	  * An array must be initialized to zero to avoid problems with
	  NaNs.

2011-04-27 11:29  xavier

	* [r7786] Updated eigenvalue matches for the silicon tests. This
	  should fix the
	  problem with the ifort test on chum.

2011-04-27 11:33  xavier

	* [r7787] A forall with a continuation line was causing the xlf
	  compilation to fail.

2011-04-28 01:47  xavier

	* [r7788] A variable in states_t was used without initialization.

2011-04-28 02:43  xavier

	* [r7789] * Another uninitialized variable.
	  
	  * Some style fixes.

2011-04-28 03:16  xavier

	* [r7790] The ftchd TDOutput was enabled even if it was not
	  initialized.

2011-04-28 03:42  xavier

	* [r7791] By defining the EXEC environment variable it is possible
	  to run test
	  with octopus inside valgrind or other similar tool.

2011-04-28 08:28  marques

	* [r7792] Bug fix: use of a couple of unitialized variables for
	  non-interacting (and classical) particles

2011-04-28 08:48  marques

	* [r7793] A default was wrong, leading to the use of an unitialized
	  variable

2011-04-28 08:55  marques

	* [r7794] Another unitialized variable.

2011-04-28 09:26  marques

	* [r7795] Two more memory leaks, one due to wrong logics, and the
	  other to misplaced ifdefs

2011-04-28 09:41  marques

	* [r7796] Final leak of the 1D hydrogen test is fixed. I suppose
	  that most of the noise in the valgrind buildbot is also gone.
	  
	  I would propose that we all make an effort to correct _all_
	  unitialized variables, memory leaks, and tests, and then release
	  the new version.

2011-04-28 10:55  xavier

	* [r7797] Simplified the macro to detect libxc.

2011-04-28 11:34  xavier

	* [r7798] Improved the netcdf macro, now the configure option is
	  --with-netcdf-prefix.

2011-04-28 12:31  xavier

	* [r7799] * Now etsf_io location is given by the
	  --with-etsf-io-prefix flag.
	  * Fixed the behaviour for --with-netcdf-prefix=no.

2011-04-28 12:57  xavier

	* [r7800] Added the --with-libxc-include, --with-netcdf-include and
	  --with-etsf-io-include configure flags which define the location
	  of
	  the include files for their respective libraries.

2011-04-28 16:42  micael

	* [r7801] * In some cases where ETSF I/O was not available,
	  FCFLAGS_ETSF_IO and LIBS_ETSF_IO were not empty as they should.

2011-04-28 17:32  xavier

	* [r7802] * Included Micael's etsf_io.m4 fix in libxc.m4 and
	  netcdf.m4. These 3 macros are
	  very similar, so a fix in one is probably required in the other
	  2.
	  
	  * AC_SUBST is now called at end to make sure the definition is
	  correct.

2011-04-28 17:36  micael

	* [r7803] * A factor of two was wrong in the extra term of the
	  MGGA's in the hamiltonian.

2011-04-28 20:48  micael

	* [r7804] * I believe the UPF format has been enough tested not to
	  be considered an experimental feature any more.

2011-04-29 01:56  dstrubbe

	* [r7805] Some fixes to the m4 macros:
	  * We should not clear LIBS_ and FC_ as setting these is a
	  standard and sometimes necessary way to set them, if the prefix
	  doesn't fully describe what needs to be done.
	  * We should try "" for netcdf, and try without netcdff before
	  with it, for simplicity.
	  * The etsf_io.m4 attempt to set the include directory will never
	  work: the include directory is include/fc_type, where fc_type is
	  the compiler (e.g. gcc, intel, pgi, etc.) as determined by
	  etsf_io's configure script. Therefore I have copied in the macro
	  that sets that directory (ultimately from ABINIT) so we can
	  choose the correct include directory.

2011-04-29 02:16  dstrubbe

	* [r7806] The etsf_io test should use the NetCDF include flags.

2011-04-29 03:38  xavier

	* [r7807] My turn with the exquisite corpse:
	  
	  * Removed all the preprocessor macro definitions from the abinit
	  compiler detection routine. Otherwise we may end up with compiler
	  dependent code, which is a very bad idea.
	  
	  * Distributions follow the FHS and put the etsf_io modules
	  directly in
	  include/, so now both variants are checked.
	  
	  * The include flags are printed together with the library flags.

2011-04-29 08:49  marques

	* [r7808] More memory holes plugged. I had to clean a lot the
	  states_copy/alloc/dealloc in order to understand what was
	  happening. Please be _careful_ when you add stuff to states_t in
	  the future!!!!

2011-04-29 09:31  marques

	* [r7809] Spline should be deallocated

2011-04-29 09:36  marques

	* [r7810] Poisson_end should be called

2011-04-29 22:15  dstrubbe

	* [r7811] * Adding $fc_type to etsf_io include path didn't seem to
	  do anything before that variable was initialized.
	  * netcdf was used instead of etsf_io in an if statement,
	  preventing the check from trying the second option,
	  include/fc_type.
	  * Removed redundant assignment to FCFLAGS_ETSF_IO.

2011-04-29 23:07  dstrubbe

	* [r7812] * The current method for cold smearing in the Sternheimer
	  equation is not correct. theta_ij must be calculated in another
	  way so that theta_ij + theta_ji = 1. ESPRESSO uses Gaussian
	  theta_ij always; equivalently, I will make the code used the
	  FIXED_OCC version.
	  * It may be better numerically to average the delta function at
	  the two energies, which is what ABINIT does.
	  * Let's test the polarizability of Na2 in parallel also.

2011-04-30 04:38  xavier

	* [r7813] Some code cleaning in geometry optimization.

2011-04-30 04:41  dstrubbe

	* [r7814] * The Fermi-level shift for the Sternheimer equation
	  actually can apply to finite systems too. There doesn't happen to
	  be one for our Na2 vib_modes test.
	  * The Na2 vib_modes test will run in parallel too.

2011-04-30 05:22  dstrubbe

	* [r7815] Don't bother checking for BLACS when we don't have MPI.

2011-04-30 05:33  dstrubbe

	* [r7816] I misunderstood what ACX_REQUIRE does: this should
	  actually do the trick I think.

2011-04-30 06:31  xavier

	* [r7817] More cleaning.

2011-04-30 16:28  xavier

	* [r7818] The species index and not z are now used as atom types to
	  get
	  symmetries.

2011-04-30 18:11  xavier

	* [r7819] Rearranged the output of K-points to avoid printing
	  non-initialized
	  variables.

2011-04-30 18:27  xavier

	* [r7820] Fixed some memory leaks in spglib.

2011-04-30 18:39  xavier

	* [r7821] Another memory leak fixed.

2011-04-30 21:55  xavier

	* [r7822] Deallocation of ffts was missings.

2011-04-30 22:46  xavier

	* [r7823] Missing object destruction.

2011-04-30 23:09  xavier

	* [r7824] * At the moment it is not possible to have several
	  instances of the
	  FFT poisson solver, so the poisson solver in epot_t is just a
	  pointer
	  to the global poisson solver.

2011-04-30 23:18  xavier

	* [r7825] The FFT library cannot be selected at each poisson solver
	  call.

2011-05-01 00:07  xavier

	* [r7826] The destructor of the gga_c_pbe functional was missing.

2011-05-01 01:17  xavier

	* [r7827] Missing deallocations in libxc.

2011-05-01 02:37  xavier

	* [r7828] Fixed some memory leaks associated to open boundaries.

2011-05-01 03:05  xavier

	* [r7829] Another missing deallocation.

2011-05-01 16:53  xavier

	* [r7830] Fixes an unitialized value problem in an open boundaries
	  test.

2011-05-01 19:12  dstrubbe

	* [r7831] We should do this test in parallel too.

2011-05-01 19:22  dstrubbe

	* [r7832] This test can be done in parallel over states. Set
	  FromScratch to suppress a warning.

2011-05-02 18:22  dstrubbe

	* [r7833] The Pathscale compiler obtains the negative of the result
	  of other compilers for the displacement in the libration mode.
	  Since this sign is arbitrary, I'm just going to remove this
	  match.

2011-05-02 20:24  dstrubbe

	* [r7834] Negative eigenvalue differences in Casida now cause a
	  fatal error rather than just a warning, because the
	  diagonalization later will probably fail. I added a suggestion
	  about the cause.

2011-05-03 01:15  dstrubbe

	* [r7835] Made a filename agree with the module it contains.

2011-05-03 01:49  dstrubbe

	* [r7836] At least with bounds-checking, the submesh calculations
	  can cause a runtime error if the number of points in the sphere
	  for a processor in domain parallelization is zero.

2011-05-03 02:42  xavier

	* [r7837] Some missing brackets caused autoreconf warnings.

2011-05-03 20:07  xavier

	* [r7838] Now the messages_print_var_value function can take the
	  unit as an
	  optional argument.

2011-05-03 20:14  xavier

	* [r7839] * Now the default time-step is the maximum value for the
	  spacing that is
	  been used.
	  
	  * The values TDIonicTimeScale and TDTimeStep are printed to the
	  console.
	  
	  * One test used the default value for the time step.

2011-05-04 15:46  xavier

	* [r7840] Removed the samples directory and its content. These
	  input files are
	  always obsolete.

2011-05-04 16:11  xavier

	* [r7841] * Renamed the TDEvolutionMethod variable to TDPropagator.

2011-05-05 16:20  joseba

	* [r7842] Improved the PFFT implementation. The PFFT library itself
	  is working fine, but with Octopus needs more tuning. We still
	  working
	  
	  Added also some improvement in coments.

2011-05-05 18:13  dstrubbe

	* [r7843] * Typos.
	  * Fixed archaic function name that was causing compilation
	  failures.

2011-05-06 08:42  joseba

	* [r7844] Fixed calls to fft_ends

2011-05-09 11:11  joseba

	* [r7845] Corrected the 64 bits version, PFFT works in the same way
	  with 32 and 64 bits. It doesn't still work.
	  Fixed, also, a printing index.

2011-05-09 18:34  dstrubbe

	* [r7846] Fixing format for options in PFFT variable.

2011-05-10 17:27  nitsche

	* [r7847] * added a optional_default function for strings
	  * made use of optional_default in some subroutines
	  * removed a non used parameter in poisson_cg
	  * some typos and cleanings
	  * changed the convergence check for the surface Greens's function
	  to be relative

2011-05-10 18:13  dstrubbe

	* [r7848] The construct used for the soptional_default routine does
	  not seem to be accepted by most compilers. I made a fixed length
	  of 80 instead, requiring use of 'trim' in the calling routines.

2011-05-10 18:19  nitsche

	* [r7849] * changed the eta for the greens function back to 10^-7
	  and removed the division by energy as it might lead to problems
	  for energies close to zero. The convergence check is still done
	  relative, not absolute

2011-05-10 22:43  xavier

	* [r7850] * Renamed OEP_Level to OEPLevel and OEP_Mixing to
	  OEPMixing.
	  
	  * Documented OEPMixing.
	  
	  Almost all variables use captialization to mark spaces, but a few
	  ones
	  use underscores. I think we should rename them. What do you
	  think?

2011-05-10 23:06  xavier

	* [r7851] Renamed KS_Inversion_Level to KSInversionLevel.

2011-05-10 23:33  xavier

	* [r7852] Renamed CalcPES_rc to PhotoElectronSpectrum and
	  CalcPES_mask to
	  PhotoElectronSpectrumMask. PES is a bad name as it can also mean
	  Potential Energy Surface.

2011-05-11 00:18  xavier

	* [r7853] * Changed the way the photoelectron spectrum input works.
	  Now
	  PhotoElectronSpectrum uses flags to select the desired methods.
	  
	  * Renamed PES_rc_points to PhotoElectronSpectrumPoints.

2011-05-11 01:24  xavier

	* [r7854] * Fixed the reference for the mask photoelectron
	  spectrum.

2011-05-11 02:24  xavier

	* [r7855] * Renamed all KdotP_* variables to KdotP*.
	  * I had to implement the *_obsolete_variables function for
	  several
	  modules, since they receive a prefix argument that prepend to the
	  variable name.

2011-05-11 02:24  xavier

	* [r7856] Variable name change in the kdotp test.

2011-05-11 05:10  dstrubbe

	* [r7857] For IR intensities, we can just use the complex conjugate
	  rather than calculating another expectation value.

2011-05-11 06:24  dstrubbe

	* [r7858] Infrared intensities can now be computed in periodic
	  systems with the kdotp wavefunctions. Too bad you still can't
	  compute phonon modes correctly in a periodic system.

2011-05-11 09:17  marques

	* [r7859] Added the APBE functional (both X and K, I will implement
	  C now)

2011-05-11 09:57  marques

	* [r7860] The correlation version of the previous functional

2011-05-11 10:01  marques

	* [r7861] Small bug corrected

2011-05-11 10:19  marques

	* [r7862] The 4 versions of the PBE for kinetics by Tran and
	  Wesolowski

2011-05-11 12:46  marques

	* [r7863] Added the Thakkar approximation to the kinetic energy
	  density. I believe that this concludes the GGAs for tau (at least
	  I do not have any further on my list)

2011-05-11 13:06  xavier

	* [r7864] Renamed KdotP_UseNonLocalPseudopotential to
	  KdotPUseNonLocalPseudopotential.

2011-05-11 13:17  xavier

	* [r7865] Renamed SoftInteraction1D_alpha to Interaction1D and
	  SoftInteraction1D_alpha to Interaction1DScreening.

2011-05-11 13:23  xavier

	* [r7866] Renamed MR_InterpolationOrder to
	  MultiResolutionInterpolationOrder.

2011-05-11 13:28  xavier

	* [r7867] Renamed vdW_npoints to vdWNPoints.

2011-05-11 15:16  xavier

	* [r7868] Fixed the force over the ions due a static electric field
	  and a laser.
	  I did a quick fix and put comments, but we should do things more
	  consistent.

2011-05-11 19:26  dstrubbe

	* [r7869] An if condition was backwards.

2011-05-11 20:10  dstrubbe

	* [r7870] The array called "infrared" in vib_modes is the minus of
	  the Born charges, so we can write them out too.

2011-05-11 20:21  dstrubbe

	* [r7871] beta should only use kdotp in periodic directions, if the
	  system is only partially periodic.

2011-05-12 00:13  dstrubbe

	* [r7872] Slight improvements to documentation.

2011-05-12 02:04  xavier

	* [r7873] Now Octopus can read the non-standard UPF files generated
	  by Quantum
	  Espresso.

2011-05-12 03:13  xavier

	* [r7874] Density symmetrization is not experimental anymore. It is
	  enabled by
	  default when symmetries are used to reduce the K points.

2011-05-12 06:48  dstrubbe

	* [r7875] * Changed the Linear Response::Response category for
	  variables to Linear Response::Casida, which seems more
	  informative.
	  * Swapped sign of electric fields printed to output for
	  static_pol, for consistency with other parts of the code.
	  * Added a check that the electric perturbation is not being
	  applied in periodic systems.

2011-05-12 14:14  johanna

	* [r7876] * Added new algorithm for KS inversion (PRL 100, 153004
	  (2008), Eq. (6))
	  * Added regression test for KS inversion
	  * Some small clean-ups in the KS inversion scheme

2011-05-12 14:18  xavier

	* [r7877] Fixed the check for an electric perturbation in periodic
	  dimensions.

2011-05-12 14:33  johanna

	* [r7878] Fixed intent statement.

2011-05-12 14:44  xavier

	* [r7879] * Made the KS inversion an independent test.
	  
	  * KS inversion files were missing from the Makefile.

2011-05-12 14:55  xavier

	* [r7880] The hm argument in xc_ks_inversion_calc is intent(in) for
	  a reason.

2011-05-12 15:57  xavier

	* [r7881] Libxc now defines XC_GGA_XC_LB to point to XC_GGA_X_LB.
	  This keeps
	  compatibility.

2011-05-12 17:04  xavier

	* [r7883] The ks inversion test does not work in parallel.

2011-05-12 17:31  joseba

	* [r7884] * Gathered the result array of PFFT, after backward
	  execution, in 3D (into a loop).
	  * Changed a gather to allgather
	  * Deleted an unnecesary variable
	  * Changed the implementation of optional output files

2011-05-12 18:36  dstrubbe

	* [r7885] * Indentation.
	  * Improvement to documentation and comment.
	  * Removed unnecessary module use statement.
	  * Fixed PUSH/POP's.

2011-05-12 19:06  xavier

	* [r7886] * Reverted commit [7876] and subsequent changes to these
	  files. I am
	  sorry to do this, but This code is clearly not ready for release
	  and
	  overwrites at least one previous changeset ([7851]).
	  
	  * Disabled the KS inversion test.

2011-05-12 19:16  dstrubbe

	* [r7887] Removed the error if applying electric perturbation in
	  periodic direction: adding this error actually disabled the
	  EMForceNoKdotP option which is useful for testing.

2011-05-12 19:58  dstrubbe

	* [r7888] * Fixed ionic contribution to dipole: in td multipoles
	  for a spin-polarized system, now half of the ionic contribution
	  is assigned to each spin, which gives the appropriate sums and
	  differences.
	  * Typos in testsuite files.

2011-05-12 22:16  xavier

	* [r7889] I forgot to rename the KS inversion test.

2011-05-13 00:34  xavier

	* [r7890] Some test files were missing from the Makefile.

2011-05-13 00:49  xavier

	* [r7891] Updated the debian control file.

2011-05-13 01:02  xavier

	* [r7892] Removed a useless message.

2011-05-13 02:06  xavier

	* [r7895] .: Created the 4.0.x branch.

2011-05-18 14:10  xavier

	* [r7908] libxc/src/gga_k_dk.c: Backport: corrected the parameters
	  of two KED functionals.

2011-05-24 21:33  dstrubbe

	* [r7920] src/grid/submesh.F90, src/species/species.F90: Backport
	  of r7915 and 7916: Typo and mistake in warning.

2011-05-24 23:46  dstrubbe

	* [r7923] src/sternheimer/phonons_lr.F90: Backport of r7921 to
	  4.0.x:
	  
	  *Bugfix to r7771: fixing one restart-name discrepancy caused
	  another one. sternheimer_solve adds the sigma suffix, so the tag
	  function should not do it. Also, failing to read response wfns
	  when computing normal mode wfns is now a fatal error.
	  *Fixed mistaken PUSH_SUB name.

2011-05-25 19:24  dstrubbe

	* [r7930] testsuite/linear_response/04-vib_modes.test: Backport of
	  r7929: Fixed wrong column in test match, which sort of by chance
	  was working anyway.

2011-05-25 19:35  dstrubbe

	* [r7931] src/states/restart.F90: Backport of r7925: Bugfix: if not
	  all restart wfns are present for Sternheimer calculation (as
	  could happen if a parallel job timed out), the occupations of the
	  missing ones were set to zero, yielding incorrect results due to
	  improper orthogonalization against these states. Moreover, the
	  wfn was initialized randomly, which is much worse than leaving it
	  as zero, and could lead to diverging SCF iterations.

2011-05-25 23:06  dstrubbe

	* [r7940] src/sternheimer/phonons_lr.F90: Backport of r7939: The
	  contribution to the response density for vibrational modes from
	  non-linear core corrections is not included.

2011-06-01 19:49  dstrubbe

	* [r7964] src/basic/distributed.F90, src/basic/multicomm.F90,
	  src/states/states.F90, src/system/forces_inc.F90: Backport of the
	  key parts of r7955-r7958:
	  * If there are no states/atoms being managed by a processor,
	  don't write which they are, which is meaningless and something
	  like "1 - 0".
	  * Fix to array out of bounds in force calculation from a
	  processor with no atoms to manage.
	  * ScaLAPACK-compatible version of multicomm_divide_range now
	  assigns 1:0 to idle nodes, like the non-ScaLAPACK version.
	  * The states managed are not written for idle nodes, as I just
	  did for atoms.
	  * It seems a large amount of changes are needed to enable the
	  code to run with empty states-groups, so I made it die if that
	  happens with a meaningful message rather than some unexplained
	  segfault later on.

2011-06-01 22:31  dstrubbe

	* [r7968] src/sternheimer/em_resp_calc_inc.F90: Backport of r7966:
	  
	  Bugfix to r7579: polarizability was not calculated in periodic
	  directions if EMForceNoKdotP was set.

2011-06-01 22:34  dstrubbe

	* [r7969] src/hamiltonian/projector_inc.F90: Backport of r7926:
	  Fixed the problem with the non-associated phases of the
	  projector.

2011-06-06 10:46  micael

	* [r7977] src/opt_control/propagation.F90, src/td/propagator.F90,
	  src/td/td.F90: * Transformed the assigment of an assumed size
	  array into a forall contruct as a workaround for a bug in the
	  Intel 11.1 compiler.

2011-06-06 19:16  dstrubbe

	* [r7981] m4/zdotc.m4: Backport of r7978:
	  zdotc test was not double precision - fails on ifort lblas and
	  lmkl
	  
	  Hopefully this will trigger the BuildBot, for which I just
	  enabled builds on branches/4.0.x as well as trunk, since it is
	  even more important that the release passes the tests than the
	  development version does!

2011-06-06 22:31  dstrubbe

	* [r7982] src/ions/xyz_file.F90: Backport of r7965, a trivial
	  change (PUSH_SUB) to see if BuildBot will check the branch
	  commit.

2011-06-09 22:03  dstrubbe

	* [r8005] testsuite/oct-run_regression_test.pl: Backport of r8004:
	  Bugfix: test working directory was saved only if the last match
	  failed, rather than if any match had failed.

2011-06-20 02:47  xavier

	* [r8036] debian/changelog: Updated the version of the debian
	  package.

2011-06-22 00:49  dstrubbe

	* [r8043] src/sternheimer/sternheimer_inc.F90: Backport of r8042 to
	  4.0.x:
	  Fixed sign of frequency used in Sternheimer orthogonalizations:
	  this only matters for fractional occupations.

2011-08-05 19:22  xavier

	* [r8145] src/basic/opencl.F90: Bugfix backport: Compilation failed
	  in 32 bit systems with OpenCL.

2011-08-15 22:10  xavier

	* [r8192] src/basic/opencl_iface_inc.F90: Bugfix (backport): some
	  intent(out) variables in the OpenCL interface were
	  declared as intent(in).
	  

2011-08-23 07:56  dstrubbe

	* [r8218] src/sternheimer/phonons_lr.F90: Backport of r8217:
	  missing ionic contributions to infrared intensities.

2011-08-28 01:44  dstrubbe

	* [r8229] src/main/main.F90: Backport r8228: Removed 'raman' from
	  the list of CalculationModes since it was deleted some time ago.

2011-08-30 23:25  dstrubbe

	* [r8234] src/main/casida.F90: Backport of r8233:
	  
	  Bugfix: The formula for the Petersilka oscillator strengths was
	  used for the transition dipole matrix elements, making the
	  written result for oscillator strengths more or less the square
	  of the correct result. (This bug is from r4780: Micael said "Can
	  someone check that what I did is correct?" I guess no one did...)

2011-08-31 06:07  dstrubbe

	* [r8238] src/main/casida.F90: Backport of r8236: correcting
	  spin-polarized Petersilka, and the transition dipoles for
	  eps-diff and Petersilka.

2011-09-02 02:51  dstrubbe

	* [r8250] src/scf/ground_state.F90, src/states/states.F90: Backport
	  r8294:
	  * Condition to warn about lack of empty states for smearing was
	  wrong if spin-polarized.
	  * The condition for whether to read occupations on restart was
	  backwards, meaning that the Occupations block from the input file
	  was ignored.

2011-09-26 22:45  xavier

	* [r8328] src/utils/casida_spectrum.F90: Backport.
	  
	  * Bugfix 1: The oct-casida_spectrum utility failed silently if
	  the
	  required files were not present. Now it prints a warning.
	  
	  * Bugfix 2: The eigenvalue-differences spectrum was not created
	  since
	  the utility tried to open the wrong file.

2011-10-28 08:10  micael

	* [r8444] src/species/ps.F90, src/species/ps_upf.F90: * Backport of
	  r8430.

2011-11-05 22:54  dstrubbe

	* [r8507] src/species/Makefile.am, src/species/ps_upf.F90: Backport
	  of r8432 and r8448 (fixes to backport r8444).

2011-11-06 02:11  dstrubbe

	* [r8511] src/sternheimer/phonons_lr.F90: * Bugfix in 4.0.x: I made
	  a mistake in r8218, which was not quite a backport of r8217.
	  * Backport of r8216.

2011-11-13 03:39  xavier

	* [r8555] src/grid/operate.c: Bugfix backport: non-aligned accesses
	  could happen when using AVX
	  instructions (this causes a segmentation fault).

2011-11-17 16:29  xavier

	* [r8582] src/basic/opencl_low.c: 4.0.x bugfix: Removed some
	  non-standard C.

2011-11-17 18:05  xavier

	* [r8583] src/basic/opencl.F90, src/basic/opencl_iface_inc.F90,
	  src/basic/opencl_low.c: 4.0.x bugfix: Now the OpenCL context only
	  contains the device used by
	  Octopus.

2011-12-20 10:02  acastro

	* [r8711] src/system/forces.F90: Backport of the bug fixed in
	  revision 8710.

2011-12-20 21:44  dstrubbe

	* [r8714] testsuite/periodic_systems/04-silicon.test: Tweaking a
	  test value so that hbar doesn't fail occasionally with a
	  discrepancy 4% larger than the tolerance.

2012-01-09 18:01  dstrubbe

	* [r8749] src/main/casida.F90: The file created by casida was
	  eps-diff while the broadening utility was looking for eps_diff.
	  Now they are both with the underscore. This was fixed (perhaps
	  inadvertently) in the development version.

2012-01-10 16:00  dstrubbe

	* [r8752] src/utils/casida_spectrum.F90: Backport of r8751: Fix for
	  incorrect vertical scale of Casida spectrum: it was being treated
	  as if it were in units of energy instead of length^2.

2012-01-11 09:39  dstrubbe

	* [r8756] src/td/spectrum.F90, src/utils/casida_spectrum.F90:
	  Backport of r8754: The strength function (for both Casida and td)
	  has units of 1/energy. This was wrong in both places (though the
	  header was correct for td). My "fix" r8751 yesterday was wrong
	  too. (Backported as r8752).

2012-01-19 17:44  dstrubbe

	* [r8783] ., src/main/unocc.F90, src/states/restart.F90: Backport
	  r8782: Fix for bug reported by Jeiran Jokar: CalculationMode
	  unocc and casida do not work with the Occupations block. After
	  that block was read, the occupations array was being deallocated
	  and reallocated, and initialized to zero. If smearing was not
	  used, the values were left as zero for the rest of the run.
	  Fortunately, it was clear something was wrong because a warning
	  that the occupations summed to zero was triggered. There was a
	  notation FIXME around both of these problematic pieces of code; I
	  think what I did addresses at most a part of the concern expresed
	  in those comments, so I am leaving the FIXME's.

2012-02-03 10:18  micael

	* [r8834] src/system/xc_oep_inc.F90: * Bug fix: reverted change
	  from r4714, as it broke the OEP with complex wavefunctions.

